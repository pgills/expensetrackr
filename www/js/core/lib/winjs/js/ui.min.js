WinJS.Utilities._writeProfilerMark("WinJS.2.1 2.0.1.WinJS.2014.4.28 ui.js,StartTM"),function(a){"use strict";function b(a,b,c){return a.keyframe?a.keyframe:!c||a.left!==b.left||a.top!==b.top||a.rtlflip&&!b.rtlflip?null:a.rtlflip?d(c):c}function c(a,b){return b&&a.rtlflip?d(b):b}function d(a){var b=a+"-rtl";return function(c,d){return"ltr"===window.getComputedStyle(d).direction?a:b}}function e(a){return Array.isArray(a)||a instanceof NodeList||a instanceof HTMLCollection?a:a?[a]:[]}function f(a){for(var b=[],c=0;c<a.length;c++){var d={top:a[c].offsetTop,left:a[c].offsetLeft},e=window.getComputedStyle(a[c],null)[t.scriptName].split(",");6===e.length&&(d.left+=parseFloat(e[4]),d.top+=parseFloat(e[5])),b.push(d)}return b}function g(a,b,c,d){return function(e){for(var f=a,g=0;e>g;g++)b*=c,f+=b;return d&&(f=Math.min(f,d)),f}}function h(a,b){for(var c=0;c<b.length;c++)b[c].top-=a[c].offsetTop,b[c].left-=a[c].offsetLeft}function i(a,b,c){h(a,b);for(var d=0;d<a.length;d++)(0!==b[d].top||0!==b[d].left)&&(a[d].style[t.scriptName]="translate("+b[d].left+"px, "+b[d].top+"px)");return s.executeTransition(a,c)}function j(a,b,c,d,e,f,g,h){function i(a,b,c){if(a){var d={left:b+"px",top:"0px"},e={left:c+"px",top:"0px"};if(+a.length===a.length)for(var f=0,g=a.length;g>f;f++)j.push(a[f]),k.push(d),l.push(e);else j.push(a),k.push(d),l.push(e)}}var j=[],k=[],l=[],n=200,o=0!==b?0>b?-n:n:0,p=0!==c?0>c?-n:n:0;return i(e,b,c),i(f,o,p),i(g,2*o,2*p),i(h,3*o,3*p),k=new v(k),l=new v(l),s.executeTransition(j,[{property:t.cssName,delay:0,duration:350,timing:a,from:m(k),to:m(l)},{property:"opacity",delay:0,duration:350,timing:d?"cubic-bezier(0,2,0,2)":"cubic-bezier(1,-0.42,0.995,-0.425)",from:d?0:1,to:d?1:0}])}function k(b,c,d){function f(){l(b)}b=e(b),c=e(c);for(var g=0,h=b.length;h>g;g++){var i="rtl"===window.getComputedStyle(b[g]).direction;b[g].style[a.Utilities._browserStyleEquivalents["transform-origin"].scriptName]=c[Math.min(c.length-1,g)][i?"rtl":"ltr"]}return s.executeTransition(b,d).then(f,f)}function l(b){for(var c=0,d=b.length;d>c;c++)b[c].style[a.Utilities._browserStyleEquivalents["transform-origin"].scriptName]="",b[c].style[t.scriptName]="",b[c].style.opacity=""}function m(a,b){return b=b||"",function(c,d){var e=a.getOffset(c),f=e.left;return e.rtlflip&&"rtl"===window.getComputedStyle(d).direction&&(f=f.toString(),f="-"===f.charAt(0)?f.substring(1):"-"+f),b+"translate("+f+", "+e.top+")"}}function n(a,b){return b=b||"",function(c){var d=a[c];return"translate("+d.left+"px, "+d.top+"px) "+b}}function o(a,b){return function(c){var d=a[c];return 0===d.left&&0===d.top?b:null}}function p(a,b,c,d){var g=e(b),h=e(c),i=f(h);return new a(g,h,i,d)}function q(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c].getBoundingClientRect(),f=-(40+e.left),g=40+(window.innerWidth-e.right),h=window.innerHeight/2-e.top;b.push({ltr:f+"px "+h+"px",rtl:g+"px "+h+"px"})}return b}function r(b){a.Utilities._writeProfilerMark("WinJS.UI.Animation:"+b)}var s=a.UI,t=a.Utilities._browserStyleEquivalents.transform,u=[{top:"0px",left:"11px",rtlflip:!0}];a.Namespace.define("WinJS.UI",{PageNavigationAnimation:{turnstile:"turnstile",slide:"slide",enterPage:"enterPage",continuum:"continuum"}});var v=a.Class.define(function(a,d,e){e=e||u,Array.isArray(a)&&a.length>0?(this.offsetArray=a,1===a.length&&(this.keyframe=b(a[0],e[0],d))):a&&a.hasOwnProperty("top")&&a.hasOwnProperty("left")?(this.offsetArray=[a],this.keyframe=b(a,e[0],d)):(this.offsetArray=e,this.keyframe=c(e[0],d))},{getOffset:function(a){return a>=this.offsetArray.length&&(a=this.offsetArray.length-1),this.offsetArray[a]}},{supportedForProcessing:!1}),w=a.Class.define(function(a,b,c){this.revealedArray=a,this.affectedArray=b,this.offsetArray=c},{execute:function(){r("expandAnimation,StartTM");var b=s.executeAnimation(this.revealedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?200:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}),c=i(this.affectedArray,this.offsetArray,{property:t.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([b,c]).then(function(){r("expandAnimation,StopTM")})}},{supportedForProcessing:!1}),x=a.Class.define(function(a,b,c){this.hiddenArray=a,this.affectedArray=b,this.offsetArray=c},{execute:function(){r("collapseAnimation,StartTM");var b=s.executeAnimation(this.hiddenArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0}),c=i(this.affectedArray,this.offsetArray,{property:t.cssName,delay:this.hiddenArray.length>0?167:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([b,c]).then(function(){r("collapseAnimation,StopTM")})}},{supportedForProcessing:!1}),y=a.Class.define(function(a,b,c){this.elementArray=b,this.offsetArray=c},{execute:function(){return r("repositionAnimation,StartTM"),i(this.elementArray,this.offsetArray,{property:t.cssName,delay:g(0,33,1,250),duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){r("repositionAnimation,StopTM")})}},{supportedForProcessing:!1}),z=a.Class.define(function(a,b,c){this.addedArray=a,this.affectedArray=b,this.offsetArray=c},{execute:function(){r("addToListAnimation,StartTM");var b=this.affectedArray.length>0?240:0,c=s.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:t.cssName,delay:b,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:b,duration:120,timing:"linear",from:0,to:1}]),d=i(this.affectedArray,this.offsetArray,{property:t.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([c,d]).then(function(){r("addToListAnimation,StopTM")})}},{supportedForProcessing:!1}),A=a.Class.define(function(a,b,c){this.deletedArray=a,this.remainingArray=b,this.offsetArray=c},{execute:function(){r("deleteFromListAnimation,StartTM");var b=s.executeAnimation(this.deletedArray,[{keyframe:"WinJS-scale-down",property:t.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:"none",to:"scale(0.85)"},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]),c=i(this.remainingArray,this.offsetArray,{property:t.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([b,c]).then(function(){r("deleteFromListAnimation,StopTM")})}},{supportedForProcessing:!1}),B=a.Class.define(function(a,b,c,d){this.addedArray=a,this.affectedArray=b,this.offsetArray=c;var g=e(d);this.deletedArray=g,this.deletedOffsetArray=f(g)},{execute:function(){r("_updateListAnimation,StartTM"),h(this.deletedArray,this.deletedOffsetArray);var b=0,c=s.executeAnimation(this.deletedArray,[{keyframe:o(this.deletedOffsetArray,"WinJS-scale-down"),property:t.cssName,delay:0,duration:120,timing:"cubic-bezier(0.11, 0.5, 0.24, .96)",from:n(this.deletedOffsetArray),to:n(this.deletedOffsetArray,"scale(0.85)")},{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:120,timing:"linear",from:1,to:0}]);this.deletedArray.length>0&&(b+=60);var d=i(this.affectedArray,this.offsetArray,{property:t.cssName,delay:b,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});this.affectedArray.length>0?b+=240:b&&(b+=60);var e=s.executeAnimation(this.addedArray,[{keyframe:"WinJS-scale-up",property:t.cssName,delay:b,duration:120,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"scale(0.85)",to:"none"},{keyframe:"WinJS-opacity-in",property:"opacity",delay:b,duration:120,timing:"linear",from:0,to:1}]);return a.Promise.join([c,d,e]).then(function(){r("_updateListAnimation,StopTM")})}},{supportedForProcessing:!1}),C=a.Class.define(function(a,b,c){this.addedArray=a,this.affectedArray=b,this.offsetArray=c},{execute:function(){r("addToSearchListAnimation,StartTM");var b=s.executeAnimation(this.addedArray,{keyframe:"WinJS-opacity-in",property:"opacity",delay:this.affectedArray.length>0?240:0,duration:117,timing:"linear",from:0,to:1}),c=i(this.affectedArray,this.offsetArray,{property:t.cssName,delay:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([b,c]).then(function(){r("addToSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),D=a.Class.define(function(a,b,c){this.deletedArray=a,this.remainingArray=b,this.offsetArray=c},{execute:function(){r("deleteFromSearchListAnimation,StartTM");var b=s.executeAnimation(this.deletedArray,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:93,timing:"linear",from:1,to:0}),c=i(this.remainingArray,this.offsetArray,{property:t.cssName,delay:this.deletedArray.length>0?60:0,duration:400,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([b,c]).then(function(){r("deleteFromSearchListAnimation,StopTM")})}},{supportedForProcessing:!1}),E=a.Class.define(function(a,b,c){this.elementArray=b,this.offsetArray=c},{execute:function(){return r("peekAnimation,StartTM"),i(this.elementArray,this.offsetArray,{property:t.cssName,delay:0,duration:2e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){r("peekAnimation,StopTM")})}},{supportedForProcessing:!1});a.Namespace.define("WinJS.UI.Animation",{createExpandAnimation:function(a,b){return p(w,a,b)},createCollapseAnimation:function(a,b){return p(x,a,b)},createRepositionAnimation:function(a){return p(y,null,a)},fadeIn:function(a){return r("fadeIn,StartTM"),s.executeTransition(a,{property:"opacity",delay:0,duration:250,timing:"linear",from:0,to:1}).then(function(){r("fadeIn,StopTM")})},fadeOut:function(a){return r("fadeOut,StartTM"),s.executeTransition(a,{property:"opacity",delay:0,duration:167,timing:"linear",to:0}).then(function(){r("fadeOut,StopTM")})},createAddToListAnimation:function(a,b){return p(z,a,b)},createDeleteFromListAnimation:function(a,b){return p(A,a,b)},_createUpdateListAnimation:function(a,b,c){return p(B,a,c,b)},createAddToSearchListAnimation:function(a,b){return p(C,a,b)},createDeleteFromSearchListAnimation:function(a,b){return p(D,a,b)},showEdgeUI:function(a,b,c){r("showEdgeUI,StartTM");var d=new v(b,"WinJS-showEdgeUI",[{top:"-70px",left:"0px"}]);return s[c&&"transition"===c.mechanism?"executeTransition":"executeAnimation"](a,{keyframe:d.keyframe,property:t.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:d.keyframe||m(d),to:"none"}).then(function(){r("showEdgeUI,StopTM")})},showPanel:function(a,b){r("showPanel,StartTM");var c=new v(b,"WinJS-showPanel",[{top:"0px",left:"364px",rtlflip:!0}]);return s.executeAnimation(a,{keyframe:c.keyframe,property:t.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:c.keyframe||m(c),to:"none"}).then(function(){r("showPanel,StopTM")})},hideEdgeUI:function(a,b,c){r("hideEdgeUI,StartTM");var d=new v(b,"WinJS-hideEdgeUI",[{top:"-70px",left:"0px"}]);return s[c&&"transition"===c.mechanism?"executeTransition":"executeAnimation"](a,{keyframe:d.keyframe,property:t.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:d.keyframe||m(d)}).then(function(){r("hideEdgeUI,StopTM")})},hidePanel:function(a,b){r("hidePanel,StartTM");var c=new v(b,"WinJS-hidePanel",[{top:"0px",left:"364px",rtlflip:!0}]);return s.executeAnimation(a,{keyframe:c.keyframe,property:t.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"none",to:c.keyframe||m(c)}).then(function(){r("hidePanel,StopTM")})},showPopup:function(a,b){r("showPopup,StartTM");var c=new v(b,"WinJS-showPopup",[{top:"50px",left:"0px"}]);return s.executeAnimation(a,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:83,duration:83,timing:"linear",from:0,to:1},{keyframe:c.keyframe,property:t.cssName,delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:c.keyframe||m(c),to:"none"}]).then(function(){r("showPopup,StopTM")})},hidePopup:function(a){return r("hidePopup,StartTM"),s.executeAnimation(a,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:83,timing:"linear",from:1,to:0}).then(function(){r("hidePopup,StopTM")})},pointerDown:function(a){return r("pointerDown,StartTM"),s.executeTransition(a,{property:t.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.975, 0.975)"}).then(function(){r("pointerDown,StopTM")})},pointerUp:function(a){return r("pointerUp,StartTM"),s.executeTransition(a,{property:t.cssName,delay:0,duration:167,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}).then(function(){r("pointerUp,StopTM")})},dragSourceStart:function(b,c){r("dragSourceStart,StartTM");var d=s.executeTransition(b,[{property:t.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(1.05)"},{property:"opacity",delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:.65}]),e=s.executeTransition(c,{property:t.cssName,delay:0,duration:240,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"});return a.Promise.join([d,e]).then(function(){r("dragSourceStart,StopTM")})},dragSourceEnd:function(b,c,d){r("dragSourceEnd,StartTM");var e=new v(c,"WinJS-dragSourceEnd"),f=s.executeTransition(b,[{property:t.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""},{property:"opacity",delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:1}]),g=s.executeAnimation(b,{keyframe:e.keyframe,property:t.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:e.keyframe||m(e,"scale(1.05) "),to:"none"}),h=s.executeTransition(d,{property:t.cssName,delay:0,duration:500,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""});return a.Promise.join([f,g,h]).then(function(){r("dragSourceEnd,StopTM")})},enterContent:function(b,c,d){r("enterContent,StartTM");var e,f=new v(c,"WinJS-enterContent",[{top:"0px",left:"40px",rtlflip:!0}]);if(d&&"transition"===d.mechanism)e=s.executeTransition(b,[{property:t.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:m(f),to:"none"},{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1}]);else{var g=s.executeAnimation(b,{keyframe:f.keyframe,property:t.cssName,delay:0,duration:550,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:f.keyframe||m(f),to:"none"}),h=s.executeTransition(b,{property:"opacity",delay:0,duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});e=a.Promise.join([g,h])}return e.then(function(){r("enterContent,StopTM")})},exitContent:function(b,c){r("exitContent,StartTM");var d=new v(c,"WinJS-exit",[{top:"0px",left:"0px"}]),e=s.executeAnimation(b,c&&{keyframe:d.keyframe,property:t.cssName,delay:0,duration:117,timing:"linear",from:"none",to:d.keyframe||m(d)}),f=s.executeTransition(b,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return a.Promise.join([e,f]).then(function(){r("exitContent,StopTM")})},dragBetweenEnter:function(a,b){r("dragBetweenEnter,StartTM");var c=new v(b,null,[{top:"-40px",left:"0px"},{top:"40px",left:"0px"}]);return s.executeTransition(a,{property:t.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:m(c,"scale(0.95) ")}).then(function(){r("dragBetweenEnter,StopTM")})},dragBetweenLeave:function(a){return r("dragBetweenLeave,StartTM"),s.executeTransition(a,{property:t.cssName,delay:0,duration:200,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"scale(0.95)"}).then(function(){r("dragBetweenLeave,StopTM")})},swipeSelect:function(b,c){r("swipeSelect,StartTM");var d=s.executeTransition(b,{property:t.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),e=s.executeAnimation(c,{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return a.Promise.join([d,e]).then(function(){r("swipeSelect,StopTM")})},swipeDeselect:function(b,c){r("swipeDeselect,StartTM");var d=s.executeTransition(b,{property:t.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""}),e=s.executeAnimation(c,{keyframe:"WinJS-opacity-out",property:"opacity",delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:1,to:0});return a.Promise.join([d,e]).then(function(){r("swipeDeselect,StopTM")})},swipeReveal:function(a,b){r("swipeReveal,StartTM");var c=new v(b,null,[{top:"25px",left:"0px"}]);return s.executeTransition(a,{property:t.cssName,delay:0,duration:300,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:m(c)}).then(function(){r("swipeReveal,StopTM")})},enterPage:function(b,c){r("enterPage,StartTM");var d=new v(c,"WinJS-enterPage",[{top:"0px",left:"100px",rtlflip:!0}]),e=s.executeAnimation(b,{keyframe:d.keyframe,property:t.cssName,delay:g(0,83,1,333),duration:1e3,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:d.keyframe||m(d),to:"none"}),f=s.executeTransition(b,{property:"opacity",delay:g(0,83,1,333),duration:170,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1});return a.Promise.join([e,f]).then(function(){r("enterPage,StopTM")})},exitPage:function(b,c){r("exitPage,StartTM");var d=new v(c,"WinJS-exit",[{top:"0px",left:"0px"}]),e=s.executeAnimation(b,c&&{keyframe:d.keyframe,property:t.cssName,delay:0,duration:117,timing:"linear",from:"none",to:d.keyframe||m(d)}),f=s.executeTransition(b,{property:"opacity",delay:0,duration:117,timing:"linear",to:0});return a.Promise.join([e,f]).then(function(){r("exitPage,StopTM")})},crossFade:function(b,c){r("crossFade,StartTM");var d=s.executeTransition(b,{property:"opacity",delay:0,duration:167,timing:"linear",to:1}),e=s.executeTransition(c,{property:"opacity",delay:0,duration:167,timing:"linear",to:0});return a.Promise.join([d,e]).then(function(){r("crossFade,StopTM")})},createPeekAnimation:function(a){return p(E,null,a)},updateBadge:function(a,b){r("updateBadge,StartTM");var c=new v(b,"WinJS-updateBadge",[{top:"24px",left:"0px"}]);return s.executeAnimation(a,[{keyframe:"WinJS-opacity-in",property:"opacity",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:0,to:1},{keyframe:c.keyframe,property:t.cssName,delay:0,duration:1333,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:c.keyframe||m(c),to:"none"}]).then(function(){r("updateBadge,StopTM")})},turnstileForwardIn:function(a){r("turnstileForwardIn,StartTM"),a=e(a);var b=q(a);return k(a,b,[{property:t.cssName,delay:g(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(80deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:g(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){r("turnstileForwardIn,StopTM")})},turnstileForwardOut:function(a){r("turnstileForwardOut,StartTM"),a=e(a);var b=q(a);return k(a,b,[{property:t.cssName,delay:g(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(600px) rotateY(0deg)",to:"perspective(600px) rotateY(-50deg)"},{property:"opacity",delay:g(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){r("turnstileForwardOut,StopTM")})},turnstileBackwardIn:function(a){r("turnstileBackwardIn,StartTM"),a=e(a);var b=q(a);return k(a,b,[{property:t.cssName,delay:g(0,50,1,1e3),duration:300,timing:"cubic-bezier(0.01,0.975,0.4775,0.9775)",from:"perspective(600px) rotateY(-50deg)",to:"perspective(600px) rotateY(0deg)"},{property:"opacity",delay:g(0,50,1,1e3),duration:300,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){r("turnstileBackwardIn,StopTM")})},turnstileBackwardOut:function(a){r("turnstileBackwardOut,StartTM"),a=e(a);var b=q(a);return k(a,b,[{property:t.cssName,delay:g(0,50,1,1e3),duration:128,timing:"cubic-bezier(0.4925,0.01,0.7675,-0.01)",from:"perspective(800px) rotateY(0deg)",to:"perspective(800px) rotateY(80deg)"},{property:"opacity",delay:g(0,50,1,1e3),duration:128,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){r("turnstileBackwardOut,StopTM")})},slideDown:function(a){return r("slideDown,StartTM"),k(a,{ltr:"",rtl:""},[{property:t.cssName,delay:0,duration:250,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"translate(0px, 0px)",to:"translate(0px, 200px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){r("slideDown,StopTM")})},slideUp:function(a){return r("slideUp,StartTM"),k(a,{ltr:"",rtl:""},[{property:t.cssName,delay:0,duration:350,timing:"cubic-bezier(0.17,0.79,0.215,1.0025)",from:"translate(0px, 200px)",to:"translate(0px, 0px)"},{property:"opacity",delay:g(0,34,1,1e3),duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]).then(function(){r("slideUp,StopTM")})},slideRightIn:function(a,b,c,d){return r("slideRightIn,StartTM"),j("cubic-bezier(0.17,0.79,0.215,1.0025)",-window.innerWidth,0,!0,a,b,c,d).then(function(){r("slideRightIn,StopTM")})},slideRightOut:function(a,b,c,d){return r("slideRightOut,StartTM"),j("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,window.innerWidth,!1,a,b,c,d).then(function(){r("slideRightOut,StopTM")})},slideLeftIn:function(a,b,c,d){return r("slideLeftIn,StartTM"),j("cubic-bezier(0.17,0.79,0.215,1.0025)",window.innerWidth,0,!0,a,b,c,d).then(function(){r("slideLeftIn,StopTM")})},slideLeftOut:function(a,b,c,d){return r("slideLeftOut,StartTM"),j("cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",0,-window.innerWidth,!1,a,b,c,d).then(function(){r("slideLeftOut,StopTM")})},continuumForwardIn:function(b,c,d){return r("continuumForwardIn,StartTM"),a.Promise.join([s.executeTransition(b,[{property:t.cssName,delay:0,duration:350,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(0.5, 0.5)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),s.executeTransition(c,[{property:t.cssName,delay:0,duration:350,timing:"cubic-bezier(0.24,1.15,0.11,1.1575)",from:"translate(0px, 225px)",to:"translate(0px, 0px)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),k(d,{ltr:"0px 50%",rtl:"100% 50%"},[{property:t.cssName,delay:0,duration:350,timing:"cubic-bezier(0,0.62,0.8225,0.9625)",from:"rotateX(80deg) scale(1.5, 1.5)",to:"rotateX(0deg) scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:350,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){r("continuumForwardIn,StopTM")})},continuumForwardOut:function(b,c){return r("continuumForwardOut,StartTM"),a.Promise.join([s.executeTransition(b,[{property:t.cssName,delay:0,duration:120,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(1.1, 1.1)"},{property:"opacity",delay:0,duration:120,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]),k(c,{ltr:"0px 100%",rtl:"100% 100%"},[{property:t.cssName,delay:0,duration:152,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"rotateX(0deg) scale(1.0, 1.0) translate(0px, 0px)",to:"rotateX(80deg) scale(1.5, 1.5) translate(0px, 150px)"},{property:"opacity",delay:0,duration:152,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}])]).then(function(){r("continuumForwardOut,StopTM")})},continuumBackwardIn:function(b,c){return r("continuumBackwardIn,StartTM"),a.Promise.join([s.executeTransition(b,[{property:t.cssName,delay:0,duration:200,timing:"cubic-bezier(0.33, 0.18, 0.11, 1)",from:"scale(1.25, 1.25)",to:"scale(1.0, 1.0)"},{property:"opacity",delay:0,duration:200,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}]),k(c,{ltr:"0px 50%",rtl:"100% 50%"},[{property:t.cssName,delay:0,duration:250,timing:"cubic-bezier(0.2975, 0.7325, 0.4725, 0.99)",from:"rotateX(80deg) translate(0px, -100px)",to:"rotateX(0deg) translate(0px, 0px)"},{property:"opacity",delay:0,duration:250,timing:"cubic-bezier(0, 2, 0, 2)",from:0,to:1}])]).then(function(){r("continuumBackwardIn,StopTM")})},continuumBackwardOut:function(a){return r("continuumBackwardOut,StartTM"),s.executeTransition(a,[{property:t.cssName,delay:0,duration:167,timing:"cubic-bezier(0.3825,0.0025,0.8775,-0.1075)",from:"scale(1.0, 1.0)",to:"scale(0.5, 0.5)"},{property:"opacity",delay:0,duration:167,timing:"cubic-bezier(1,-0.42,0.995,-0.425)",from:1,to:0}]).then(function(){r("continuumBackwardOut,StopTM")})},createPageNavigationAnimations:function(b,c,d){function e(){return a.Promise.wrap()}var f=a.UI.PageNavigationAnimation;return a.Utilities.isPhone&&b!==f.enterPage&&c!==f.enterPage?(c||(c=f.turnstile),b===f.slide&&d||c===f.slide&&!d?{exit:d?a.UI.Animation.slideDown:e,entrance:d?e:a.UI.Animation.slideUp}:{exit:a.UI.Animation[c+(d?"Backward":"Forward")+"Out"],entrance:a.UI.Animation[c+(d?"Backward":"Forward")+"In"]}):{exit:e,entrance:a.UI.Animation.enterPage}}})}(WinJS),function(a,b){"use strict";WinJS.Namespace.define("WinJS.Binding",{_BindingListDataSource:WinJS.Namespace._lazy(function(){function c(a,b){for(var c=a.length;c-1>b;){var d=a.getItem(++b);if(d)return d.key}return null}function d(a,b){for(;b>0;){var c=a.getItem(--b);if(c)return c.key}return null}function e(a,b){Object.keys(b).forEach(function(c){a.addEventListener(c,b[c])})}function f(a,b){Object.keys(b).forEach(function(c){a.removeEventListener(c,b[c])})}function g(a,b){return b?new w(a,b):new v}function h(a,b,c){return b?new x(a,b,c):new v}function i(a,b,c){return b&&a._annotateWithIndex(b,c)}function j(a,b){return this._list.unshift(b),this.itemFromIndex(0)}function k(a,b,c){var d=this._list.indexOfKey(c);return-1===d?t.noLongerMeaningful:(this._list.splice(d,0,b),this.itemFromIndex(d))}function l(a,b,c){var d=this._list.indexOfKey(c);return-1===d?t.noLongerMeaningful:(d+=1,this._list.splice(d,0,b),this.itemFromIndex(d))}function m(a,b){return this._list.push(b),this.itemFromIndex(this._list.length-1)}function n(a,b){var c=this._list.indexOfKey(a);return-1===c?t.noLongerMeaningful:(this._list.setAt(c,b),this.itemFromIndex(c))}function o(a){var b=this._list.indexOfKey(a);if(-1===b)return t.noLongerMeaningful;var c=0;return this._list.move(b,c),this.itemFromIndex(c)}function p(a,b){var c=this._list.indexOfKey(a),d=this._list.indexOfKey(b);return-1===c||-1===d?t.noLongerMeaningful:(d=d>c?d-1:d,this._list.move(c,d),this.itemFromIndex(d))}function q(a,b){var c=this._list.indexOfKey(a),d=this._list.indexOfKey(b);return-1===c||-1===d?t.noLongerMeaningful:(d=d>=c?d:d+1,this._list.move(c,d),this.itemFromIndex(d))}function r(a){var b=this._list.indexOfKey(a);if(-1===b)return t.noLongerMeaningful;var c=this._list.length-1;return this._list.move(b,c),this.itemFromIndex(c)}function s(a){var b=this._list.indexOfKey(a);return-1===b?t.noLongerMeaningful:(this._list.splice(b,1),WinJS.Promise.wrap())}var t={get noLongerMeaningful(){return WinJS.Promise.wrapError(new WinJS.ErrorFromName(WinJS.UI.EditError.noLongerMeaningful))}},u=WinJS.Promise.wrap().constructor,v=WinJS.Class.derive(u,function(){this._value=null},{release:function(){},retain:function(){return this}},{supportedForProcessing:!1}),w=WinJS.Class.derive(u,function(a,b){this._value=b,this._listBinding=a},{handle:{get:function(){return this._value.key}},index:{get:function(){return this._value.index}},release:function(){this._listBinding._release(this._value,this._listBinding._list.indexOfKey(this._value.key))},retain:function(){return this._listBinding._addRef(this._value,this._listBinding._list.indexOfKey(this._value.key)),this}},{supportedForProcessing:!1}),x=WinJS.Class.derive(WinJS.Promise,function(a,b,c){var d=this;this._item=b,this._listBinding=a,WinJS.Promise.call(this,function(e){WinJS.Utilities.Scheduler.schedule(function(){return a._released?void d.cancel():void e(b)},WinJS.Utilities.Scheduler.Priority.normal,null,"WinJS.Binding.List."+c)})},{handle:{get:function(){return this._item.key}},index:{get:function(){return this._item.index}},release:function(){this._listBinding._release(this._item,this._listBinding._list.indexOfKey(this._item.key))},retain:function(){return this._listBinding._addRef(this._item,this._listBinding._list.indexOfKey(this._item.key)),this}},{supportedForProcessing:!1}),y=WinJS.Class.define(function(b,c,d,f){this._dataSource=b,this._list=c,this._editsCount=0,this._notificationHandler=d,this._pos=-1,this._retained=[],this._retained.length=c.length,this._retainedKeys={},this._affectedRange=null;var g=null;if(WinJS.Utilities.hasWinRT&&a.msSetWeakWinRTProperty&&a.msGetWeakWinRTProperty||(g=this),d){var h=function(a,b){var c=WinJS.Utilities._getWeakRefElement(f)||g;return c?(c["_"+a](b),!0):!1};this._handlers={itemchanged:function i(a){h("itemchanged",a)||c.removeEventListener("itemchanged",i)},iteminserted:function j(a){h("iteminserted",a)||c.removeEventListener("iteminserted",j)},itemmoved:function k(a){h("itemmoved",a)||c.removeEventListener("itemmoved",k)},itemremoved:function l(a){h("itemremoved",a)||c.removeEventListener("itemremoved",l)},reload:function m(){h("reload")||c.removeEventListener("reload",m)}},e(this._list,this._handlers)}},{_itemchanged:function(a){var b=a.detail.key,c=a.detail.index;this._updateAffectedRange(c,"changed");var d=a.detail.newItem,e=this._retained[c];if(e){var f=this._notificationHandler;if(e.index!==c){var g=e.index;e.index=c,f&&f.indexChanged&&f.indexChanged(d.key,c,g)}d=i(this._list,d,c),d._retainedCount=e._retainedCount,this._retained[c]=d,this._retainedKeys[b]=d,this._beginEdits(this._list.length),f&&f.changed&&f.changed(d,e),this._endEdits()}else this._beginEdits(this._list.length),this._endEdits()},_iteminserted:function(a){var b=(a.detail.key,a.detail.index);this._updateAffectedRange(b,"inserted"),this._beginEdits(this._list.length-1),b<=this._pos&&(this._pos=Math.min(this._pos+1,this._list.length));var e=this._retained;if(e.splice(b,0,0),delete e[b],this._shouldNotify(b)||1===this._list.length){var f=this._notificationHandler;f&&f.inserted&&f.inserted(g(this,i(this._list,this._list.getItem(b),b)),d(this._list,b),c(this._list,b))}this._endEdits()},_itemmoved:function(a){var b=(a.detail.key,a.detail.oldIndex),c=a.detail.newIndex;this._updateAffectedRange(b,"moved"),this._updateAffectedRange(c,"moved"),this._beginEdits(this._list.length),(b<this._pos||c<=this._pos)&&(c>this._pos?this._pos=Math.max(-1,this._pos-1):b>this._pos&&(this._pos=Math.min(this._pos+1,this._list.length)));var d=this._retained,e=d.splice(b,1)[0];d.splice(c,0,e),e||(delete d[c],e=i(this._list,this._list.getItem(c),c)),e._moved=!0,this._addRef(e,c),this._endEdits()},_itemremoved:function(a){var b=a.detail.key,c=a.detail.index;this._updateAffectedRange(c,"removed"),this._beginEdits(this._list.length+1),c<this._pos&&(this._pos=Math.max(-1,this._pos-1));var d=this._retained,e=this._retainedKeys,f=c in d;d.splice(c,1),delete e[b];var g=this._notificationHandler;f&&g&&g.removed&&g.removed(b,!1),this._endEdits()},_reload:function(){this._retained=[],this._retainedKeys={};var a=this._notificationHandler;a&&a.reload&&a.reload()},_addRef:function(a,b){b in this._retained?this._retained[b]._retainedCount++:(this._retained[b]=a,this._retainedKeys[a.key]=a,a._retainedCount=1)},_release:function(a,b){var c=this._retained[b];c&&(1===c._retainedCount?(delete this._retained[b],delete this._retainedKeys[c.key]):c._retainedCount--)},_shouldNotify:function(a){var b=this._retained;return a in b||a+1 in b||a-1 in b},_updateAffectedRange:function(a,b){if(this._notificationHandler.affectedRange){var c=a,d="removed"!==b?a+1:a;if(this._affectedRange){switch(b){case"inserted":a<=this._affectedRange.end&&++this._affectedRange.end;break;case"removed":a<this._affectedRange.end&&--this._affectedRange.end;break;case"moved":case"changed":}this._affectedRange.start=Math.min(this._affectedRange.start,c),this._affectedRange.end=Math.max(this._affectedRange.end,d)}else this._affectedRange={start:c,end:d}}},_notifyAffectedRange:function(){this._affectedRange&&(this._notificationHandler&&this._notificationHandler.affectedRange&&this._notificationHandler.affectedRange(this._affectedRange),this._affectedRange=null)},_notifyCountChanged:function(){var a=this._countAtBeginEdits,b=this._list.length;if(a!==b){var c=this._notificationHandler;c&&c.countChanged&&c.countChanged(b,a)}},_notifyIndicesChanged:function(){for(var a=this._retained,b=0,c=a.length;c>b;b++){var d=a[b];if(d&&d.index!==b){var e=b,f=d.index;d.index=e;
var g=this._notificationHandler;g&&g.indexChanged&&g.indexChanged(d.key,e,f)}}},_notifyMoved:function(){for(var a=this._retained,b=0,e=a.length;e>b;b++){var f=a[b];if(f&&f._moved&&(f._moved=!1,this._release(f,b),this._shouldNotify(b))){var h=this._notificationHandler;h&&h.moved&&h.moved(g(this,f),d(this._list,b),c(this._list,b))}}},_beginEdits:function(a,b){this._editsCount++;var c=this._notificationHandler;if(1===this._editsCount&&c){if(!b){this._editsCount++;var d=this;WinJS.Utilities.Scheduler.schedule(function(){d._endEdits()},WinJS.Utilities.Scheduler.Priority.high,null,"WinJS.Binding.List._endEdits")}c.beginNotifications&&c.beginNotifications(),this._countAtBeginEdits=a}},_endEdits:function(){this._editsCount--;var a=this._notificationHandler;0===this._editsCount&&a&&(this._notifyIndicesChanged(),this._notifyMoved(),this._notifyCountChanged(),this._notifyAffectedRange(),a.endNotifications&&a.endNotifications())},jumpToItem:function(a){var b=this._list.indexOfKey(a.handle);return-1===b?WinJS.Promise.wrap(null):(this._pos=b,this.current())},current:function(){return this.fromIndex(this._pos)},previous:function(){return this._pos=Math.max(-1,this._pos-1),this._fromIndex(this._pos,!0,"previous")},next:function(){return this._pos=Math.min(this._pos+1,this._list.length),this._fromIndex(this._pos,!0,"next")},releaseItem:function(a){a.release?a.release():this._release(a,this._list.indexOfKey(a.key))},release:function(){this._notificationHandler&&f(this._list,this._handlers),this._notificationHandler=null,this._dataSource._releaseBinding(this),this._released=!0},first:function(){return this.fromIndex(0)},last:function(){return this.fromIndex(this._list.length-1)},fromKey:function(a){var b,c=this._retainedKeys;return b=a in c?c[a]:i(this._list,this._list.getItemFromKey(a),this._list.indexOfKey(a)),g(this,b)},fromIndex:function(a){return this._fromIndex(a,!1,"fromIndex")},_fromIndex:function(a,b,c){var d,e=this._retained;return d=a in e?e[a]:i(this._list,this._list.getItem(a),a),b?h(this,d,c):g(this,d)}},{supportedForProcessing:!1}),z=0,A=WinJS.Class.define(function(b){this._usingWeakRef=WinJS.Utilities.hasWinRT&&a.msSetWeakWinRTProperty&&a.msGetWeakWinRTProperty,this._bindings={},this._list=b,b.unshift&&(this.insertAtStart=j),b.push&&(this.insertAtEnd=m),b.setAt&&(this.change=n),b.splice&&(this.insertAfter=l,this.insertBefore=k,this.remove=s),b.move&&(this.moveAfter=q,this.moveBefore=p,this.moveToEnd=r,this.moveToStart=o)},{_releaseBinding:function(a){delete this._bindings[a._id]},addEventListener:function(){},removeEventListener:function(){},createListBinding:function(a){var b="ds_"+ ++z,c=new y(this,this._list,a,b);return c._id=b,this._usingWeakRef?(WinJS.Utilities._createWeakRef(c,b),this._bindings[b]=b):this._bindings[b]=c,c},getCount:function(){return WinJS.Promise.wrap(this._list.length)},itemFromKey:function(a){var b=this._list,c=i(b,b.getItemFromKey(a),-1);return Object.defineProperty(c,"index",{get:function(){return b.indexOfKey(a)},enumerable:!1,configurable:!0}),WinJS.Promise.wrap(c)},itemFromIndex:function(a){return WinJS.Promise.wrap(i(this._list,this._list.getItem(a),a))},list:{get:function(){return this._list}},beginEdits:function(){var a=this._list.length;this._forEachBinding(function(b){b._beginEdits(a,!0)})},endEdits:function(){this._forEachBinding(function(a){a._endEdits()})},_forEachBinding:function(a){if(this._usingWeakRef){var b=[];Object.keys(this._bindings).forEach(function(c){var d=WinJS.Utilities._getWeakRefElement(c);d?a(d):b.push(c)});for(var c=0,d=b.length;d>c;c++)delete this._bindings[b[c]]}else{var e=this;Object.keys(this._bindings).forEach(function(b){a(e._bindings[b])})}},invalidateAll:function(){return WinJS.Promise.wrap()},moveAfter:b,moveBefore:b,moveToEnd:b,moveToStart:b},{supportedForProcessing:!1});return A})})}(this),function(a){"use strict";WinJS.Namespace.define("WinJS.UI",{DataSourceStatus:{ready:"ready",waiting:"waiting",failure:"failure"},CountResult:{unknown:"unknown"},CountError:{noResponse:"noResponse"},FetchError:{noResponse:"noResponse",doesNotExist:"doesNotExist"},EditError:{noResponse:"noResponse",canceled:"canceled",notPermitted:"notPermitted",noLongerMeaningful:"noLongerMeaningful"},VirtualizedDataSource:WinJS.Namespace._lazy(function(){function f(f,o){function p(a){var b="WinJS.UI.VirtualizedDataSource:"+le+":"+a+",StartTM";WinJS.Utilities._writeProfilerMark(b),WinJS.log&&WinJS.log(b,"winjs vds","perf")}function q(a){var b="WinJS.UI.VirtualizedDataSource:"+le+":"+a+",StopTM";WinJS.Utilities._writeProfilerMark(b),WinJS.log&&WinJS.log(b,"winjs vds","perf")}function r(a){return"number"==typeof a&&a>=0}function s(a){return r(a)&&a===Math.floor(a)}function t(b){if(null===b)b=a;else if(b!==a&&!s(b))throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidIndexReturned",m.invalidIndexReturned);return b}function u(b){if(null===b)b=a;else if(b!==a&&!s(b)&&b!==c.unknown)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidCountReturned",m.invalidCountReturned);return b}function v(){var a=(jd++).toString(),b={handle:a,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return Jd[a]=b,b}function w(){return v()}function x(a,b){a.prev=b.prev,a.next=b,a.prev.next=a,b.prev=a}function y(a){a.lastInSequence&&(delete a.lastInSequence,a.prev.lastInSequence=!0),a.firstInSequence&&(delete a.firstInSequence,a.next.firstInSequence=!0),a.prev.next=a.next,a.next.prev=a.prev}function z(a){for(;!a.firstInSequence;)a=a.prev;return a}function A(a){for(;!a.lastInSequence;)a=a.next;return a}function B(a,b,c){return b.prev.next=c.next,c.next.prev=b.prev,b.prev=a.prev,c.next=a,b.prev.next=b,a.prev=c,!0}function C(a,b,c){return b.prev.next=c.next,c.next.prev=b.prev,b.prev=a,c.next=a.next,a.next=b,c.next.prev=c,!0}function D(a){delete a.lastInSequence,delete a.next.firstInSequence}function E(b){var c=b.next;b.lastInSequence=!0,c.firstInSequence=!0,c===Hd&&jb(Hd,a)}function F(a,b,c,d){x(a,b);var e=a.prev;e.lastInSequence&&(c?delete e.lastInSequence:a.firstInSequence=!0,d?delete b.firstInSequence:a.lastInSequence=!0)}function G(a,b){a.key=b,Kd[a.key]=a}function H(a,b,c){+b===b&&(a.index=b,c[b]=a,wd||(a.firstInSequence&&a.prev&&a.prev.index===b-1&&D(a.prev),a.lastInSequence&&a.next&&a.next.index===b+1&&D(a)))}function I(a,b){var c=b===Ld?w():v();return x(c,a),c}function J(a,b,c){var d=I(a,c);return d.firstInSequence=!0,d.lastInSequence=!0,H(d,b,c),d}function K(a,b){return J(a,b,Ld)}function L(a,b){var c=I(a,b);return delete a.firstInSequence,c.prev.index===c.index-1?delete c.prev.lastInSequence:c.firstInSequence=!0,H(c,a.index-1,b),c}function M(a,b){var c=I(a.next,b);return delete a.lastInSequence,c.next.index===c.index+1?delete c.next.firstInSequence:c.lastInSequence=!0,H(c,a.index+1,b),c}function N(b,c,d,e){F(b,c,d,e),Kd[b.key]=b;b.index;b.index!==a&&(Ld[b.index]=b)}function O(b){y(b),b.key&&delete Kd[b.key],b.index!==a&&Ld[b.index]===b&&delete Ld[b.index];var c=b.bindingMap;for(var d in c){var e=c[d].handle;e&&Jd[e]===b&&delete Jd[e]}Jd[b.handle]===b&&delete Jd[b.handle]}function P(a){return!Jd[a.handle]}function Q(b,c,d,e,f){var g=f?null:c[b-1];if(g&&(g.next!==e||e.firstInSequence))g=g.next;else if(g=c[b+1],!g){g=d.next;for(var h;;){if(g.firstInSequence&&(h=g),!(b>=g.index)||g===e)break;g=g.next}g!==e||e.firstInSequence||(g=h&&h.index===a?h:a)}return g}function R(a){return!a.item&&!a.itemNew&&a!==Hd}function S(a,b){Object.defineProperty(a,"handle",{value:b,writable:!1,enumerable:!1,configurable:!0})}function T(a,b,c){S(a,c),Object.defineProperty(a,"index",{get:function(){for(;b.slotMergedWith;)b=b.slotMergedWith;return b.index},enumerable:!1,configurable:!0})}function U(b){if(b===a)return b;var c=JSON.stringify(b);if(c===a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.ObjectIsNotValidJson",m.objectIsNotValidJson);return c}function V(a){return f.itemSignature?f.itemSignature(a.data):U(a.data)}function W(a){var b=a.itemNew;a.itemNew=null,b&&(b=Object.create(b),T(b,a,a.handle),f.compareByIdentity||(a.signature=V(b))),a.item=b,delete a.indexRequested,delete a.keyRequested}function X(a){return a.bindingMap||a.cursorCount>0}function Y(a){return X(a)||a.fetchListeners||a.directFetchListeners}function Z(a){return Y(a)||!a.firstInSequence&&X(a.prev)||!a.lastInSequence&&X(a.next)||!ee&&(!a.firstInSequence&&a.prev!==Gd&&!(a.prev.item||a.prev.itemNew))|(!a.lastInSequence&&a.next!==Hd&&!(a.next.item||a.next.itemNew))}function $(a){E(a),O(a)}function _(){if(!rd){(!Nd||P(Nd))&&(Nd=Hd.prev);for(var a=Nd.prev,b=Nd.next,c=0,d=function(a){a===Hd||Z(a)||(dd>=c?c++:$(a))};a||b;){if(a){var e=a;a=e.prev,e!==Gd&&d(e)}if(b){var f=b;b=f.next,f!==Id&&d(f)}}Md=0}}function ab(a){if(!Y(a)){if(l._PerfMeasurement_leakSlots)return;Md++,rd||Qd||(Nd=a,Md>dd&&!Od&&(Od=!0,k.schedule(function(){Od=!1,_()},k.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested")))}}function bb(a){for(var b in hd)a(hd[b])}function cb(a,b){for(var c in a.bindingMap)b(a.bindingMap[c].bindingRecord,c)}function db(a){return a.notificationsSent||(a.notificationsSent=!0,a.notificationHandler.beginNotifications&&a.notificationHandler.beginNotifications()),a.notificationHandler}function eb(){od||ud||bb(function(a){a.notificationsSent&&(a.notificationsSent=!1,a.notificationHandler.endNotifications&&a.notificationHandler.endNotifications())})}function fb(a,b){var c=a.bindingMap;if(c){var d=c[b];if(d){var e=d.handle;if(e)return e}}return a.handle}function gb(a,b){return a&&a.handle!==b&&(a=Object.create(a),S(a,b)),a}function hb(a){var b=Fd;Fd=a,bb(function(a){a.notificationHandler&&a.notificationHandler.countChanged&&db(a).countChanged(Fd,b)})}function ib(a,b){cb(a,function(c,d){c.notificationHandler.indexChanged&&db(c).indexChanged(fb(a,d),a.index,b)})}function jb(b,c){var d=b.index;if(d!==a&&Ld[d]===b&&delete Ld[d],+c===c)H(b,c,Ld);else{if(+d!==d)return;delete b.index}ib(b,d)}function kb(a,b,c,d,e){var f={};if(!(!d&&b.lastInSequence||!e&&c.firstInSequence))if(b===Gd)if(c===Hd)for(var g in hd)f[g]=hd[g];else for(var g in c.bindingMap)f[g]=hd[g];else if(c===Hd||c.bindingMap)for(var g in b.bindingMap)(c===Hd||c.bindingMap[g])&&(f[g]=hd[g]);for(var g in a.bindingMap)f[g]=hd[g];return f}function lb(a){var b,c=a.prev,d=a.next,e=kb(a,c,d);for(b in e){var f=e[b];f.notificationHandler&&db(f).inserted(f.itemPromiseFromKnownSlot(a),c.lastInSequence||c===Gd?null:fb(c,b),d.firstInSequence||d===Hd?null:fb(d,b))}}function mb(a){var b=a.item;W(a),cb(a,function(c,d){var e=fb(a,d);db(c).changed(gb(a.item,e),gb(b,e))})}function nb(a,b,c,d,e){var f,g=b.prev;if(b===a){if(!a.firstInSequence||!c)return;b=a.next}else if(g===a){if(!a.lastInSequence||!d)return;g=a.prev}if(!e){var h=kb(a,g,b,c,d);for(f in h){var i=h[f];db(i).moved(i.itemPromiseFromKnownSlot(a),(g.lastInSequence||g===a.prev)&&!c||g===Gd?null:fb(g,f),(b.firstInSequence||b===a.next)&&!d||b===Hd?null:fb(b,f))}bb(function(b){b.adjustCurrentSlot(a)})}y(a),F(a,b,c,d)}function ob(a,b){xb(a,!0),cb(a,function(c,d){db(c).removed(fb(a,d),b)}),bb(function(b){b.adjustCurrentSlot(a)}),O(a)}function pb(a){for(;!a.firstInSequence;)a=a.prev;var b;do{b=a.lastInSequence;var c=a.next;ob(a,!0),a=c}while(!b)}function qb(a){var b;if(!a)return b;for(var c=0;!a.firstInSequence;)c++,a=a.prev;return"number"==typeof a.indexNew?a.indexNew+c:"number"==typeof a.index?a.index+c:b}function rb(b,c){for(b=b.next;b;b=b.next)if(b.firstInSequence){var d=b.indexNew!==a?b.indexNew:b.index;d!==a&&(b.indexNew=d+c)}vd+=c,wd=!0,Qd?sc():yd++}function sb(b,c){if(b.firstInSequence){var d;if(0>c)d=b.indexNew,d!==a?delete b.indexNew:d=b.index,b.lastInSequence||(b=b.next,d!==a&&(b.indexNew=d));else if(!b.lastInSequence){var e=b.next;d=e.indexNew,d!==a?delete e.indexNew:d=e.index,d!==a&&(b.indexNew=d)}}rb(b,c)}function tb(b,c){for(var d=Gd;d!==Hd;d=d.next){var e=d.indexNew;if(e!==a&&e>=b){rb(d,c);break}}}function ub(){var b,c,d;for(b=Gd;;b=b.next){if(b.firstInSequence){if(c=b,b.indexNew!==a){if(d=b.indexNew,delete b.indexNew,isNaN(d))break}else d=b.index;b!==Gd&&b.prev.index===d-1&&D(b.prev)}if(b.lastInSequence)for(var e=d,f=c;f!==b.next;f=f.next)e!==f.index&&jb(f,e),+e===e&&e++;if(b===Hd)break}for(;b!==Id;b=b.next)b.index!==a&&b!==Hd&&jb(b,a);wd=!1,vd&&+Fd===Fd&&(ld?ld.reset():hb(Fd+vd),vd=0)}function vb(a,b,c,d,e){if(a.item)return new i(function(b){e?e(b,a.item):b(a.item)});var f={listBindingID:d,retained:!1};return a[b]||(a[b]={}),a[b][c]=f,f.promise=new i(function(a,b){f.complete=e?function(b){e(a,b)}:a,f.error=b},function(){for(;a.slotMergedWith;)a=a.slotMergedWith;var d=a[b];if(d){delete d[c];for(var e in d)return;delete a[b]}ab(a)}),f.promise}function wb(a,b){for(var c in b)b[c].complete(a)}function xb(a,b){var c=a.fetchListeners,d=a.directFetchListeners;if(c||d){W(a);var e=a.item,f=function(a){b?wb(e,a):Cd.push(function(){wb(e,a)})};d&&(a.directFetchListeners=null,f(d)),c&&(a.fetchListeners=null,f(c)),ab(a)}}function yb(){var a=Cd;Cd=[];for(var b=0,c=a.length;c>b;b++)a[b]()}function zb(a,b){var c=a.directFetchListeners;if(c){a.directFetchListeners=null;for(var d in c)c[d].error(b);ab(a)}}function Ab(a){return a.firstInSequence&&L(a,Ld),a.lastInSequence&&M(a,Ld),a.itemNew&&W(a),Yb(),a}function Bb(a){if(!a.firstInSequence){var b=a.prev;return b===Gd?null:Ab(b)}return Ab(L(a,Ld))}function Cb(a){if(!a.lastInSequence){var b=a.next;return b===Hd?null:Ab(b)}return Ab(M(a,Ld))}function Db(a){return a?vb(a,"directFetchListeners",(kd++).toString()):i.wrap(null)}function Eb(a){if("string"!=typeof a||!a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.KeyIsInvalid",m.keyIsInvalid)}function Fb(a){var b=K(Id);return G(b,a),b.keyRequested=!0,b}function Gb(a,b){Eb(a);var c=Kd[a];return c||(c=Fb(a),c.hints=b),Ab(c)}function Hb(b){if("number"!=typeof b||0>b)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.IndexIsInvalid",m.indexIsInvalid);if(Hd.index<=b)return null;var c=Ld[b];if(!c){var d=Q(b,Ld,Gd,Hd);if(!d)return null;d===Hd&&b>=Hd&&jb(Hd,a),c=d.prev.index===b-1?M(d.prev,Ld):d.index===b+1?L(d,Ld):K(d,b)}return c.item||(c.indexRequested=!0),Ab(c)}function Ib(a){var b=K(Id);return b.description=a,Ab(b)}function Jb(a){if(fd=a,ed!==fd){var b=function(){gd=!1,ed!==fd&&(ed=fd,me.dispatchEvent(n,ed))};fd===WinJS.UI.DataSourceStatus.failure?b():gd||(gd=!0,setTimeout(b,40))}}function Kb(a){var b=a.fetchID;return b&&Bd[b]}function Lb(a,b){a.fetchID=b}function Mb(){var a=Ad;return Ad++,Bd[a]=!0,a}function Nb(a,b,c){var d=Mb();Lb(a,d);for(var e=a;!e.firstInSequence&&b>0;)e=e.prev,b--,Lb(e,d);for(var f=a;!f.lastInSequence&&c>0;)f=f.next,c--,Lb(f,d);return d}function Ob(a){var b=a.items,c=a.offset,d=a.totalCount,e=a.absoluteIndex,f=a.atStart,g=a.atEnd;if(r(e)){if(r(d)){var h=b.length;e-c+h===d&&(g=!0)}c===e&&(f=!0)}f&&(b.unshift(Dd),a.offset++),g&&b.push(Ed)}function Pb(a,b,c){return delete Bd[c],b!==yd||P(a)?(Yb(),!1):!0}function Qb(a,b,c,e){var f=yd;c.then(function(c){if(!c.items||!c.items.length)return i.wrapError(new WinJS.ErrorFromName(d.doesNotExist));var g="itemsFetched id="+b+" count="+c.items.length;p(g),Pb(a,f,b)&&(+e===e&&(c.absoluteIndex=e),Ob(c),mc(a,c.items,c.offset,c.totalCount,c.absoluteIndex)),q(g)}).then(null,function(c){Pb(a,f,b)&&nc(a,c)})}function Rb(a,b,c,e){var f=yd;e.then(function(e){if(!e.items||!e.items.length)return i.wrapError(new WinJS.ErrorFromName(d.doesNotExist));var g="itemsFetched id="+c+" count="+e.items.length;p(g),Pb(b,f,c)&&(e.absoluteIndex=a,Ob(e),oc(a,b,e.items,e.offset,e.totalCount,e.absoluteIndex)),q(g)}).then(null,function(){Pb(b,f,c)&&pc(a,b,f,name)})}function Sb(a,b){var c=Nb(a,0,b-1);fe?Qb(a,c,fe(c,b),0):Qb(a,c,ee(c,0,0,b-1),0)}function Tb(a,b){var c=Nb(a,b-1,0);Qb(a,c,ge(c,b))}function Ub(a,b,c){var d=Nb(a,b,c);Qb(a,d,de(d,a.key,b,c,a.hints))}function Vb(b,c,d){var e=b.index;if(c>e&&(c=e),ee){var f=Nb(b,c,d);Qb(b,f,ee(f,e,c,d),e)}else if(b.key)Ub(b,c,d);else{var g,h,i=Gd,j=e+1;for(g=b.prev;g!==Gd;g=g.prev)if(g.index!==a&&g.key){h=e-g.index,j>h&&(j=h,i=g);break}for(g=b.next;g!==Hd;g=g.next)if(g.index!==a&&g.key){h=g.index-e,j>h&&(j=h,i=g);break}if(i===Gd){var f=Nb(b,0,e+1);Rb(0,b,f,fe(f,e+1))}else{var k=Math.max(i.index-e,0),l=Math.max(e-i.index,0),f=Nb(i,k,l);Rb(i.index,b,f,de(f,i.key,k,l,b.hints))}}}function Wb(a,b,c){var d=Nb(a,b,c);Qb(a,d,he(d,a.description,b,c))}function Xb(){if(!Qd){for(var c,d,e,f,g,h,i,j,k=!1,l=!1,m=Gd.next;m!==Id;){var n=m.next;if(m!==Hd&&R(m)&&(l=!0,c?d++:(c=m,d=1),Kb(m)&&(k=!0),m.keyRequested&&!e&&(e=m,f=d-1),m.description===a||g||(g=m,h=d-1),m.indexRequested&&!i&&(i=m,j=d-1),m.lastInSequence||n===Id||!R(n))){if(k)k=!1;else{if(md=!1,!c.firstInSequence&&c.prev.key&&de?Ub(c.prev,0,d):!m.lastInSequence&&n.key&&de?Ub(n,d,0):c.prev!==Gd||c.firstInSequence||!fe&&!ee?n===Hd&&!m.lastInSequence&&ge?Tb(m,d):e?Ub(e,f,d-1-f):g?Wb(g,h,d-1-h):i?Vb(i,j,d-1-j):"number"==typeof c.index?Vb(c,d-1,0):pb(c):Sb(c,d),md)return void Yb();if(Qd)return}c=i=e=null}m=n}Jb(l?b.waiting:b.ready)}}function Yb(){zd||(zd=!0,k.schedule(function(){zd=!1,Xb(),eb()},k.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function Zb(a){var b=a.itemNew;if(!b)return!1;var c=a.item;for(var d in c)switch(d){case"data":break;default:if(c[d]!==b[d])return!0}return f.compareByIdentity?c.data!==b.data:a.signature!==V(b)}function $b(a){Y(a)?Zb(a)?mb(a):a.itemNew=null:a.item=null}function _b(a){a.item?$b(a):xb(a)}function ac(a,b){a.key||G(a,b.key),a.itemNew=b,_b(a)}function bc(a,b,c){var d=b.bindingMap;if(d)for(var e in c)if(d[e]){var f=b.fetchListeners;for(var g in f){var h=f[g];h.listBindingID===e&&h.retained&&(delete f[g],h.complete(null))}var i=d[e].bindingRecord;db(i).removed(fb(b,e),!0,fb(a,e)),b.bindingMap&&delete b.bindingMap[e]}}function cc(a,b){if(a.index!==b.index){var c=b.index;b.index=a.index,ib(b,c)}b.slotMergedWith=a;var d=b.bindingMap;for(var e in d){a.bindingMap||(a.bindingMap={});var f=d[e];f.handle||(f.handle=b.handle),Jd[f.handle]=a,a.bindingMap[e]=f}bb(function(c){c.adjustCurrentSlot(b,a)});var g=b.itemNew||b.item;if(g&&(g=Object.create(g),T(g,a,a.handle),ac(a,g)),a.item)b.directFetchListeners&&Cd.push(function(){wb(a.item,b.directFetchListeners)}),b.fetchListeners&&Cd.push(function(){wb(a.item,b.fetchListeners)});else{var h;for(h in b.directFetchListeners)a.directFetchListeners||(a.directFetchListeners={}),a.directFetchListeners[h]=b.directFetchListeners[h];for(h in b.fetchListeners)a.fetchListeners||(a.fetchListeners={}),a.fetchListeners[h]=b.fetchListeners[h]}a.itemNew&&xb(a),b.handle=(jd++).toString(),E(b),O(b)}function dc(a,b,c){b&&b.key&&(c||(c=b.itemNew||b.item),delete b.key,delete Kd[c.key],b.itemNew=null,b.item=null),c&&ac(a,c),b&&cc(a,b)}function ec(a){if("object"!=typeof a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",m.invalidItemReturned);if(a===Dd)return Gd;if(a===Ed)return Hd;if(a.key)return WinJS.validation&&Eb(a.key),Kd[a.key];throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",m.invalidKeyReturned)}function fc(a,b){var c=ec(b);c===a&&(c=null),c&&bc(a,c,a.bindingMap),dc(a,c,b)}function gc(a,b,c,d){if(b&&a.key&&a.key!==b.key)return sc(),!1;var e=Ld[c];if(e)if(e===a)e=null;else{if(e.key&&(a.key||b&&e.key!==b.key))return sc(),!1;if(!a.key&&e.bindingMap)return!1}var f;if(b)if(f=Kd[b.key],f===a)f=null;else if(f&&f.bindingMap)return!1;return e?(bc(a,e,a.bindingMap),delete Ld[c],jb(a,c),a.prev.index===c-1&&D(a.prev),a.next.index===c+1&&D(a),d.slotNext=e.slotNext,b||(b=e.itemNew||e.item,b&&(f=Kd[b.key]))):jb(a,c),f&&e!==f&&bc(a,f,a.bindingMap),dc(a,f,b),e&&e!==f&&cc(a,e),!0}function hc(a,b,c){if(b.key&&a.key&&b.key!==a.key)return sc(),!1;for(var d in a.bindingMap)c[d]=!0;return bc(a,b,c),dc(a,b),!0}function ic(a,b){for(var c={};a;){var d=a.firstInSequence?null:a.prev;if(b.firstInSequence||b.prev!==Gd){if(b=b.firstInSequence?L(b,Ld):b.prev,!hc(b,a,c))return}else ob(a,!0);a=d}}function jc(a,b){for(var c={};a;){var d=a.lastInSequence?null:a.next;if(b.lastInSequence||b.next!==Hd){if(b=b.lastInSequence?M(b,Ld):b.next,!hc(b,a,c))return}else ob(a,!0);a=d}}function kc(a){for(var b=0;b<a.length;b++){var c=a[b];ic(c.slotBeforeSequence,c.slotFirstInSequence),jc(c.slotAfterSequence,c.slotLastInSequence)}}function lc(b,c){function d(c){for(var d=Hd.prev;!(d.index<b)&&d!==c;){var f=d.prev;d.index!==a&&ob(d,!0),d=f}e=0}for(var e=0,f=Hd.prev;!(f.index<b)||e>0;){var g=f.prev;if(f===Gd){d(Gd);break}if(f.key){if(f.index>=b)return sc(),!1;if(!(f.index>=c))return de?Ub(f,0,e):Vb(f,0,e),!1;d(f)}else f.indexRequested||f.firstInSequence?d(g):e++;f=g}return!0}function mc(b,d,e,f,g){var h="WinJS.UI.ListDataSource.processResults";return p(h),g=t(g),f=u(f),rd?void q(h):(wd&&ub(),!r(f)&&f!==c.unknown||f===Fd||Hd.firstInSequence?(md=!0,function(){var c,h,i,j,k=d.length;if("number"!=typeof g)for(c=0;k>c;c++)if(i=ec(d[c]),i&&i.index!==a){g=i.index+e-c;break}"number"==typeof g&&d[k-1]===Ed?f=g-e+k-1:!r(f)||g!==a&&null!==g||(g=f-(k-1)+e),r(f)&&!lc(f,g-e)&&(f=a);var l=new Array(k);for(c=0;k>c;c++){var m=null;if(i=ec(d[c])){if(c>0&&!i.firstInSequence&&i.prev.key&&i.prev.key!==d[c-1].key||"number"==typeof g&&i.index!==a&&i.index!==g-e+c)return void sc();(i===Gd||i===Hd||i.bindingMap)&&(m=i)}if("number"==typeof g&&(i=Ld[g-e+c])){if(i.key&&i.key!==d[c].key)return void sc();!m&&i.bindingMap&&(m=i)}if(c===e){if(b.key&&b.key!==d[c].key||"number"==typeof b.index&&"number"==typeof g&&b.index!==g)return void sc();m||(m=b)}l[c]=m}for(c=0;k>c;c++)i=l[c],i&&i.index!==a&&i!==Gd&&i!==Hd&&fc(i,d[c]);var n=[],o=!0;for(c=0;k>c;c++)if(i=l[c],i&&i!==Hd){var p=c;if(i.index===a){var q={};gc(i,d[c],g-e+c,q);var s,t=i,u=i;for(h=c-1;!t.firstInSequence&&(s=d[h],s!==Dd);h--){var v=g-e+h;if(0>v)break;if(!gc(t.prev,s,v,q))break;t=t.prev,h>=0&&(l[h]=t)}for(h=c+1;!u.lastInSequence&&(s=d[h],s!==Ed&&h!==f||u.next===Hd)&&(u.next===Hd||gc(u.next,s,g-e+h,q))&&(u=u.next,k>h&&(l[h]=u),p=h,u!==Hd);h++);var w=t.firstInSequence?null:t.prev,x=u.lastInSequence?null:u.next;if(w&&E(w),x&&E(u),"number"==typeof g){if(u===Hd)w&&C(Hd,z(w),w);else{var y=q.slotNext;y||(y=Q(u.index,Ld,Gd,Hd,!0)),B(y,t,u)}t.prev.index===t.index-1&&D(t.prev),u.next.index===u.index+1&&D(u)}else o||(j=l[c-1],j&&(t.prev!==j&&(u===Hd?(w&&C(Hd,z(w),w),B(t,z(j),j)):C(j,t,u)),D(j)));if(o=!1,Pd)return;n.push({slotBeforeSequence:w,slotFirstInSequence:t,slotLastInSequence:u,slotAfterSequence:x})}c!==e||i===b||P(b)||(w=b.firstInSequence?null:b.prev,x=b.lastInSequence?null:b.next,bc(i,b,i.bindingMap),cc(i,b),n.push({slotBeforeSequence:w,slotFirstInSequence:i,slotLastInSequence:i,slotAfterSequence:x})),c=p}for(r(f)&&Hd.index!==f&&jb(Hd,f),kc(n),c=0;k>c;c++)if(i=l[c]){for(h=c-1;h>=0;h--){var F=l[h+1];fc(l[h]=F.firstInSequence?L(l[h+1],Ld):F.prev,d[h])}for(h=c+1;k>h;h++)j=l[h-1],i=l[h],i?i.firstInSequence&&(i.prev!==j&&C(j,i,A(i)),D(j)):fc(l[h]=j.lastInSequence?M(j,Ld):j.next,d[h]);break}delete b.description}(),Pd||(f!==a&&f!==Fd&&hb(f),Yb()),eb(),yb(),void q(h)):(sc(),void q(h)))}function nc(a,c){switch(c.name){case d.noResponse:Jb(b.failure),zb(a,c);break;case d.doesNotExist:a.indexRequested?lc(a.index):(a.keyRequested||a.description)&&pb(a),eb(),sc()}}function oc(a,b,c,d,e,f){f=t(f),e=u(e);var g=a-d,h=c.length;if(b.index>=g&&b.index<g+h)mc(b,c,b.index-g,e,b.index);else if(d===h-1&&a<b.index||r(e)&&e<=b.index)nc(b,new WinJS.ErrorFromName(l.FetchError.doesNotExist));else if(b.index<g){var i=Nb(b,0,g-b.index);Rb(g,b,i,de(i,c[0].key,g-b.index,0))}else{var j=g+h-1,i=Nb(b,b.index-j,0);Rb(j,b,i,de(i,c[h-1].key,0,b.index-j))}}function pc(a,b,c){switch(c.name){case d.doesNotExist:a===Gd.index?(lc(0),nc(b,c)):sc();break;default:nc(b,c)}}function qc(){for(var a=0;a<je.length&&"beginRefresh"!==je[a].kind;a++);for(var b=a;b<je.length&&"beginRefresh"!==je[b].kind;b++);if(b>a&&b+(b-a)<je.length){for(var c=!0,d=b-a,e=0;d>e;e++)if(je[a+e].kind!==je[b+e].kind){c=!1;break}if(c&&WinJS.log){WinJS.log(m.refreshCycleIdentified,"winjs vds","error");for(var e=a;b>e;e++)WinJS.log(""+(e-a)+": "+JSON.stringify(je[e]),"winjs vds","error")}return c}}function rc(){return++ie>g&&qc()?void setState(b.failure):(je[++ke%je.length]={kind:"beginRefresh"},Vd={firstInSequence:!0,lastInSequence:!0,index:-1},Wd={firstInSequence:!0,lastInSequence:!0},Vd.next=Wd,Wd.prev=Vd,Td=!1,Ud=a,Xd={},Yd={},Zd={},Zd[-1]=Vd,void($d={}))}function sc(){if(!Pd){if(Pd=!0,Jb(b.waiting),td)return td=!1,void Vc();if(!rd){var a=++yd;Qd=!0,Sd=0,k.schedule(function(){if(yd===a){Pd=!1,rc();for(var b=Gd.next;b!==Id;){var c=b.next;Z(b)||b===Hd||$(b),b=c}Ac()}},k.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function tc(){return Rd=Rd||new j,sc(),Rd.promise}function uc(a,b){return delete Bd[b],a!==yd?!1:(Sd--,!0)}function vc(a,b,c,e,f){var g=yd;Sd++,e.then(function(b){if(!b.items||!b.items.length)return i.wrapError(new WinJS.ErrorFromName(d.doesNotExist));var e="itemsFetched id="+c+" count="+b.items.length;p(e),uc(g,c)&&(Ob(b),Gc(a,b.items,b.offset,b.totalCount,"number"==typeof f?f:b.absoluteIndex)),q(e)}).then(null,function(d){uc(g,c)&&Hc(a,b,d)})}function wc(a,b,c,d){if(de)vc(a.key,!1,b,de(b,a.key,c,d,a.hints));else{var e=10,f=a.index;Zd[f]&&Zd[f].firstInSequence?vc(a.key,!1,b,ee(b,f-1,Math.min(c+e,f)-1,d+1+e),f-1):Zd[f]&&Zd[f].lastInSequence?vc(a.key,!1,b,ee(b,f+1,Math.min(c+e,f)+1,d-1+e),f+1):vc(a.key,!1,b,ee(b,f,Math.min(c+e,f),d+e),f)}}function xc(a){fe?vc(null,!0,a,fe(a,1),0):ee&&vc(null,!0,a,ee(a,0,0,0),0)}function yc(a){return Bd[Xd[a]]}function zc(a,b){for(var c,d,e,f=3,g=yd,h=0,i=a;i!==Id;i=i.next){if(!c&&i.key&&!$d[i.key]&&!yc(i.key)){var j=Yd[i.key];(!j||j.firstInSequence||j.lastInSequence)&&(c=i,d=j,e=Mb())}if(c){var k=yc(i.key);if($d[i.key]||Yd[i.key]||k||(i.key&&(Xd[i.key]=e),h++),i.lastInSequence||i.next===Hd||k){if(wc(c,e,!d||d.firstInSequence?f:0,h-1+f),!b)break;c=null,h=0}}else i.key&&R(i)&&!$d[i.key]&&(Yd[i.key]||(e=Mb(),vc(i.key,!1,e,de(e,i.key,1,1,i.hints))))}0!==Sd||Td||yd!==g||xc(Mb())}function Ac(){var a=yd;do _d=!1,ae=!0,zc(Gd.next,!0),ae=!1;while(0===Sd&&_d&&yd===a&&Qd);0===Sd&&yd===a&&Qc()}function Bc(a){var b=yd;if(a){var c=Kd[a];c||(c=Gd.next);do be=!1,ce=!0,zc(c,!1),ce=!1;while(be&&yd===b&&Qd)}ae?_d=!0:0===Sd&&yd===b&&Ac()}function Cc(a){if("object"==typeof a&&a){if(a===Dd)return Vd;if(a===Ed)return Wd;if(a.key)return Yd[a.key];throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",m.invalidKeyReturned)}throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",m.invalidItemReturned)}function Dc(b,c){for(;b.index===a;){if(H(b,c,Zd),b.firstInSequence)return!0;b=b.prev,c--}return b.index!==c?(sc(),!1):!0}function Ec(a,b){a.key=b.key,Yd[a.key]=a,a.item=b}function Fc(){for(var a=Wd;!a.firstInSequence;)if(a=a.prev,a===Vd)return null;return a}function Gc(b,d,e,f,g){g=t(g),f=u(f);var h=!1;Td=!0;var i=g-e,j=d[0];j.key===b&&(h=!0);var k=Cc(j);if(k){if(+i===i&&!Dc(k,i))return}else{if(Zd[i])return void sc();var l;if(g!==a&&(l=Zd[i-1])){if(!l.lastInSequence)return void sc();k=M(l,Zd)}else{var m=+i===i?Q(i,Zd,Vd,Wd):Fc(Vd,Wd);if(!m)return void sc();k=J(m,i,Zd)}Ec(k,d[0])}for(var n=d.length,o=1;n>o;o++){j=d[o],j.key===b&&(h=!0);var p=Cc(j);if(p){if(k.index!==a&&!Dc(p,k.index+1))return;if(p!==k.next){if(!k.lastInSequence||!p.firstInSequence)return void sc();var q=A(p);if(q!==Wd)C(k,p,q);else{var s=z(k);if(s===Vd)return void sc();B(p,s,k)}D(k)}else k.lastInSequence&&D(k)}else{if(!k.lastInSequence)return void sc();p=M(k,Zd),Ec(p,j)}k=p}if(h||($d[b]=!0),!r(f)&&!Wd.firstInSequence){var v=Wd.prev.index;v!==a&&(f=v+1)}if(r(f)||f===c.unknown){if(r(Ud)){if(f!==Ud)return void sc()}else Ud=f;r(Ud)&&!Zd[Ud]&&H(Wd,Ud,Zd)}ce?be=!0:Bc(b)}function Hc(a,c,e){switch(e.name){case d.noResponse:Jb(b.failure);break;case d.doesNotExist:c?(H(Wd,0,Zd),Ud=0,Qc()):($d[a]=!0,ce?be=!0:Bc(a))}}function Ic(a){return a===Vd?Gd:a===Wd?Hd:Kd[a.key]}function Jc(a){return a===Gd?Vd:a===Hd?Wd:Yd[a.key]}function Kc(a){D(a),a.next.mergedForRefresh=!0}function Lc(a,b){G(b,a.key),b.itemNew=a.item}function Mc(a,b,c){var d=w();Lc(a,d),F(d,b,c,!c);var e=a.index;return+e!==e&&(e=c?d.prev.index+1:b.next.index-1),H(d,e,Ld),d}function Nc(a,b,c){a?(bc(a,b,a.bindingMap),dc(a,b,c.item)):(Lc(c,b),b.indexRequested&&_b(b))}function Oc(a,b,c){return b.key?!1:(a?(c.mergeWithPrev=!b.firstInSequence,c.mergeWithNext=!b.lastInSequence):c.stationary=!0,Nc(a,b,c),!0)}function Pc(a){var b;if(a.indexRequested)b=a.index;else{var c=Jc(a);c&&(b=c.index)}return b}function Qc(){ie=0,je=new Array(100),ke=-1,wd=!0,Xd={};var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[],u=[];for(p=0,i=Vd;i;i=i.next)i.sequenceNumber=p,i.firstInSequence&&(k=i),i.lastInSequence&&(u[p]={first:k,last:i,matchingItems:0},p++);for(Nd=null,Md=0,d=Gd.next;d!==Id;)i=Yd[d.key],f=d.next,d!==Hd&&(Z(d)?d.key&&!i?ob(d,!1):0===Ud||d.indexRequested&&d.index>=Ud?ob(d,!0):d.item||d.keyRequested?d.itemNew=i.item:d.key&&(d.keyRequested||(delete Kd[d.key],delete d.key),d.itemNew=null):$(d)),d=f;for(d=Gd.next;d!==Hd;)f=d.next,d.indexRequested&&(i=Zd[d.index],i&&Nc(Ic(i),d,i)),d=f;var v,w,x,y,z,A=0,F=[];for(l=0,d=Gd;d!==Id;d=d.next){if(d.firstInSequence)for(k=d,x=null,b=0;p>b;b++)F[b]=0;if(d.indexRequested&&(x=d),i=Jc(d),i&&F[i.sequenceNumber]++,d.lastInSequence){for(w=0,b=A;p>b;b++)w<F[b]&&(w=F[b],v=b);m={first:k,last:d,sequenceNew:w>0?u[v]:a,matchingItems:w},x&&(m.indexRequested=!0,m.stationarySlot=x),t[l]=m,d===Hd&&(y=l,z=m),l++,u[v].first.index!==a&&(A=v)}}t[0].sequenceNew!==u[0]&&(E(Gd),t[0].first=Gd.next,t.unshift({first:Gd,last:Gd,sequenceNew:u[0],matchingItems:1}),y++,l++);var G=!Hd.firstInSequence;for(z.sequenceNew!==u[p-1]&&(E(Hd.prev),z.last=Hd.prev,y++,t.splice(y,0,{first:Hd,last:Hd,sequenceNew:u[p-1],matchingItems:1}),l++,z=t[y]),b=0;l>b;b++)q=t[b].sequenceNew,q&&q.matchingItems<t[b].matchingItems&&(q.matchingItems=t[b].matchingItems,q.sequenceOld=t[b]);for(u[p-1].sequenceOld=z,z.stationarySlot=Hd,u[0].sequenceOld=t[0],t[0].stationarySlot=Gd,b=0;y>=b;b++)m=t[b],m.sequenceNew&&(o=m.sequenceNew.sequenceOld)===n&&n.last!==Hd?(Kc(o.last),o.last=m.last,delete t[b]):n=m;for(n=null,b=y;b>=0;b--)m=t[b],m&&(m.sequenceNew&&(o=m.sequenceNew.sequenceOld)===n&&m.last!==Hd?(Kc(m.last),o.first=m.first,delete t[b]):n=m);G&&delete Hd.mergedForRefresh;var H=[];for(b=y+1;l>b;b++)if(m=t[b],m&&(!m.sequenceNew||m.sequenceNew.sequenceOld!==m)){var I=!0,J=null,K=null,L=0;for(i=Jc(m.first),i&&(J=K=i,L=1),d=m.first;d!=m.last;d=d.next){var M=Jc(d.next);if(i&&M&&(i.lastInSequence||i.next!==M)){I=!1;break}i&&!J&&(J=K=i),M&&J&&(K=M,L++),i=M}if(I&&J&&J.index!==a){var N;J.firstInSequence||(g=Ic(J.prev),g&&(N=g.index));var O;if(K.lastInSequence||(h=Ic(K.next),h&&(O=h.index)),(!h||h.lastInSequence||h.mergedForRefresh)&&(N===a||O===a||O-N-1>=L)){for(m.locationJustDetermined=!0,i=J;i.locationJustDetermined=!0,i!==K;i=i.next);var k=Ic(J),P=Ic(K);H.push({slotBeforeSequence:k.firstInSequence?null:k.prev,slotFirstInSequence:k,slotLastInSequence:P,slotAfterSequence:P.lastInSequence?null:P.next})}}}for(b=0;l>b;b++)if(m=t[b],!(!m||m.indexRequested||m.locationJustDetermined||m.sequenceNew&&m.sequenceNew.sequenceOld===m)){m.sequenceNew=null,d=m.first;var Q;do{if(Q=d===m.last,f=d.next,d!==Gd&&d!==Hd&&d!==Id&&!d.item&&!d.keyRequested)if(ob(d,!0),m.first===d){if(m.last===d){delete t[b];break}m.first=d.next}else m.last===d&&(m.last=d.prev);d=f}while(!Q)}for(b=0;p>b;b++){for(q=u[b],i=q.first;!Ic(i)&&!i.lastInSequence;i=i.next);if(i.lastInSequence&&!Ic(i))q.firstInner=q.lastInner=null;else{for(q.firstInner=i,i=q.last;!Ic(i);i=i.prev);q.lastInner=i}}for(b=0;p>b;b++)if(q=u[b],q&&q.firstInner&&(m=q.sequenceOld)){var S=0;for(d=m.first;!0&&(i=Jc(d),i&&i.sequenceNumber===q.firstInner.sequenceNumber&&(i.ordinal=S),!d.lastInSequence);d=d.next,S++);var T=[];for(i=q.firstInner;!0;i=i.next){if(S=i.ordinal,S!==a){for(var U=0,V=T.length-1;V>=U;){var X=Math.floor(.5*(U+V));T[X].ordinal<S?U=X+1:V=X-1}T[U]=i,U>0&&(i.predecessor=T[U-1])}if(i===q.lastInner)break}var Y=[],_=T.length;for(i=T[_-1],c=_;c--;)i.stationary=!0,Y[c]=i,i=i.predecessor;m.stationarySlot=Ic(Y[0]),i=Y[0],d=Ic(i),e=d.prev;for(var ab=d.firstInSequence;!i.firstInSequence;)if(i=i.prev,j=Ic(i),!j||i.locationJustDetermined)for(;!ab&&e!==Gd&&(d=e,e=d.prev,ab=d.firstInSequence,!Oc(j,d,i)););for(c=0;_-1>c;c++){i=Y[c],d=Ic(i);
var j,bb=Y[c+1],cb=null,db=Ic(bb);for(f=d.next,i=i.next;i!==bb&&!cb&&d!==db;i=i.next)if(j=Ic(i),!j||i.locationJustDetermined)for(;f!==db;){if(f.mergedForRefresh){cb=i.prev;break}if(d=f,f=d.next,Oc(j,d,i))break}if(cb)for(e=db.prev,i=bb.prev;i!==cb&&db!==d;i=i.prev)if(j=Ic(i),!j||i.locationJustDetermined)for(;e!==d&&(db=e,e=db.prev,!Oc(j,db,i)););for(;f!==db;)d=f,f=d.next,d!==Gd&&R(d)&&!d.keyRequested&&ob(d)}for(i=Y[_-1],d=Ic(i),f=d.next,ab=d.lastInSequence;!i.lastInSequence;)if(i=i.next,j=Ic(i),!j||i.locationJustDetermined)for(;!ab&&f!==Hd&&(d=f,f=d.next,ab=d.lastInSequence,!Oc(j,d,i)););}for(b=0;p>b;b++)if(q=u[b],q.firstInner)for(e=null,i=q.firstInner;!0;i=i.next){if(d=Ic(i)){if(!i.stationary){var fb,gb=!1,ib=!1;if(e)fb=e.next,gb=!0;else{var kb;for(kb=q.firstInner;!kb.stationary&&kb!==q.lastInner;kb=kb.next);if(kb.stationary)fb=Ic(kb),ib=!0;else if(r=i.index,0===r)fb=Gd.next,gb=!0;else if(r===a)fb=Id;else{fb=Gd.next;for(var mb=null;;){if(fb.firstInSequence&&(mb=fb),r<fb.index&&mb||fb===Hd)break;fb=fb.next}!fb.firstInSequence&&mb&&(fb=mb)}}d.mergedForRefresh&&(delete d.mergedForRefresh,d.lastInSequence||(d.next.mergedForRefresh=!0)),gb=gb||i.mergeWithPrev,ib=ib||i.mergeWithNext;var pb=i.locationJustDetermined;nb(d,fb,gb,ib,pb),pb&&ib&&(fb.mergedForRefresh=!0)}e=d}if(i===q.lastInner)break}for(b=0;p>b;b++)if(q=u[b],q.firstInner)for(e=null,i=q.firstInner;!0;i=i.next){if(d=Ic(i),!d){var qb;if(e)qb=e.next;else{var rb;for(rb=q.firstInner;!Ic(rb);rb=rb.next);qb=Ic(rb)}d=Mc(i,qb,!!e);var M=Jc(qb);qb.mergedForRefresh||M&&M.locationJustDetermined||(W(d),lb(d))}if(e=d,i===q.lastInner)break}Ld=[];var sb=-1;for(d=Gd,s=0;d!==Id;s++){var f=d.next;if(d.firstInSequence&&(k=d,s=0),sb===a){var tb=Pc(d);tb!==a&&(sb=tb-s)}if(sb!==a&&!d.lastInSequence){var ub=Pc(d.next);if(ub!==a&&ub!==sb+s+1){E(d);for(var vb=!0,wb=d.next,xb=!1;!xb&&wb!==Hd;){var zb=wb.next;xb=wb.lastInSequence,nb(wb,zb,!vb,!1),vb=!1,wb=zb}}}if(d.lastInSequence){r=sb;for(var Ab=k;Ab!==f;){var Bb=Ab.next;if(r>=Ud&&Ab!==Hd)ob(Ab,!0);else{var Cb=Ld[r];r!==Ab.index?(delete Ld[r],jb(Ab,r)):+r===r&&Ld[r]!==Ab&&(Ld[r]=Ab),Ab.itemNew&&_b(Ab),Cb&&(Ab.key?(bc(Ab,Cb,Ab.bindingMap),cc(Ab,Cb),+r===r&&(Ld[r]=Ab)):(bc(Cb,Ab,Cb.bindingMap),cc(Cb,Ab),+r===r&&(Ld[r]=Cb))),+r===r&&r++}Ab=Bb}sb=a}d=f}var Db,Eb=-2;for(d=Gd,s=0;d!==Id;s++){var f=d.next;if(d.firstInSequence&&(k=d,s=0),delete d.mergedForRefresh,d.lastInSequence)if(k.index===a){g=k.prev;var Fb;g&&(Fb=Jc(g))&&!Fb.lastInSequence&&(i=Jc(d))&&i.prev===Fb?(C(g,k,d),D(g)):d===Hd||Db||B(Id,k,d)}else{if(Eb<d.index&&!Db)Eb=d.index;else{for(h=Gd.next;h.index<d.index;h=h.next);for(var wb=k;wb!==f;){var zb=wb.next;i=Jc(wb),nb(wb,h,h.prev.index===wb.index-1,h.index===wb.index+1,i&&i.locationJustDetermined),wb=zb}}g=k.prev,g&&g.index===k.index-1&&D(g)}d===Hd&&(Db=!0),d=f}wd=!1,kc(H),Ud!==a&&Ud!==Fd&&hb(Ud),eb();var Gb=[];for(b=0;p>b;b++){q=u[b];var Hb=[];d=null,s=0;var Ib;for(i=q.first;!0&&(i===Vd?Hb.push(Dd):i===Wd?Hb.push(Ed):(Hb.push(i.item),d||(d=Ic(i),Ib=s)),!i.lastInSequence);i=i.next,s++);d&&Gb.push({slot:d,results:Hb,offset:Ib})}for(rc(),Qd=!1,yb(),b=0;b<Gb.length;b++){var Jb=Gb[b];mc(Jb.slot,Jb.results,Jb.offset,Fd,Jb.slot.index)}if(Rd){var Kb=Rd;Rd=null,Kb.complete()}Yb()}function Rc(a,b,c,d,e,f,g){var h=qd.prev,i={prev:h,next:qd,applyEdit:a,editType:b,complete:c,error:d,keyUpdate:e};h.next=i,qd.prev=i,rd=!0,(Pd||Qd)&&(yd++,Qd=!1,Pd=!0),qd.next===i&&Vc(),i.failed||(f(),i.undo=g),od||Wc()}function Sc(){pd=!1;var a=qd.next.next;qd.next=a,a.prev=qd}function Tc(){for(;qd.prev!==qd;){var a=qd.prev;a.error&&a.error(new WinJS.ErrorFromName(l.EditError.canceled)),a.undo&&!Pd&&a.undo(),qd.prev=a.prev}qd.next=qd,od=!1,Wc()}function Uc(a){function c(){td||(h?sd=!0:Vc())}function d(b){if(b)if(i&&i.key!==b.key){var d=b.key;if(a.undo){var e=i.slot;if(e){var f=e.key;f&&delete Kd[f],G(e,d),e.itemNew=b,e.item?(mb(e),eb()):xb(e)}}else i.key=d}else a.editType===ne.change&&(e.itemNew=b,h||$b(e));Sc(),a.complete&&a.complete(b),c()}function g(d){switch(d.Name){case e.noResponse:return Jb(b.failure),td=!0,void(pd=!1);case e.notPermitted:break;case e.noLongerMeaningful:sc()}a.failed=!0,Sc(),Tc(),a.error&&a.error(d),c()}if(!pd){var h=!0,i=a.keyUpdate;f.beginEdits&&!nd&&(nd=!0,f.beginEdits()),pd=!0,a.applyEdit().then(d,g),h=!1}}function Vc(){for(;qd.next!==qd;)if(sd=!1,Uc(qd.next),!sd)return;Xc()}function Wc(){ub(),eb(),yb(),qd.next===qd&&Xc()}function Xc(){rd=!1,f.endEdits&&nd&&!od&&(nd=!1,f.endEdits()),Pd?(Pd=!1,sc()):Yb()}function Yc(a){return Eb(a),Kd[a]||Fb(a)}function Zc(a,b,c,d,e){var f=w();return F(f,c,d,e),a&&G(f,a),f.itemNew=b,sb(f,1),od||ud||(f.firstInSequence||"number"!=typeof f.prev.index?f.lastInSequence||"number"!=typeof f.next.index||H(f,f.next.index-1,Ld):H(f,f.prev.index+1,Ld)),W(f),lb(f),f}function $c(a,b,c,d,e){var f={key:a};return new i(function(a,g){Rc(e,ne.insert,a,g,f,function(){if(c){var a={key:f.key,data:b};f.slot=Zc(f.key,a,c,d,!d)}},function(){var a=f.slot;a&&(sb(a,-1),ob(a,!1))})})}function _c(a,b,c,d){return new i(function(e,f){var g,h,i,j;Rc(d,ne.move,e,f,null,function(){h=a.next,i=a.firstInSequence,j=a.lastInSequence;var d=a.prev;g=!("number"==typeof a.index||!i&&d.item||!j&&h.item),sb(a,-1),nb(a,b,c,!c),sb(a,1),g&&(E(d),i||ic(d,a),j||jc(h,a))},function(){g?sc():(sb(a,-1),nb(a,h,!i,!j),sb(a,1))})})}function ad(){function b(){ud||(ub(),eb(),yb())}this.invalidateAll=function(){return 0===Fd?(this.reload(),i.wrap()):tc()},this.reload=function(){ld&&ld.cancel(),Rd&&Rd.cancel();for(var a=Gd.next;a!==Id;a=a.next){var b=a.fetchListeners;for(var c in b)b[c].promise.cancel();var d=a.directFetchListeners;for(var c in d)d[c].promise.cancel()}bd(),bb(function(a){a.notificationHandler&&a.notificationHandler.reload()})},this.beginNotifications=function(){ud=!0},this.inserted=function(c,d,e,f){if(rd)sc();else{var g=c.key,h=Kd[d],i=Kd[e],j="string"==typeof d,k="string"==typeof e;if(j?i&&!i.firstInSequence&&(h=i.prev):k&&h&&!h.lastInSequence&&(i=h.next),(j||k)&&!h&&!i&&Gd.next===Hd)return void sc();if(Kd[g])return void sc();if(h&&i&&(h.next!==i||h.lastInSequence||i.firstInSequence))return void sc();if(h&&(h.keyRequested||h.indexRequested)||i&&(i.keyRequested||i.indexRequested))return void sc();if(h||i)Zc(g,c,i?i:h.next,!!h,!!i);else if(Gd.next===Hd)Zc(g,c,Gd.next,!0,!0);else{if(f===a)return void sc();tb(f,1)}b()}},this.changed=function(a){if(rd)sc();else{var c=a.key,d=Kd[c];d&&(d.keyRequested?sc():(d.itemNew=a,d.item&&(mb(d),b())))}},this.moved=function(c,d,e,f,g){if(rd)sc();else{var h=c.key,i=Kd[h],j=Kd[d],k=Kd[e];i&&i.keyRequested||j&&j.keyRequested||k&&k.keyRequested?sc():i?j&&k&&(j.next!==k||j.lastInSequence||k.firstInSequence)?sc():j||k?(sb(i,-1),nb(i,k?k:j.next,!!j,!!k),sb(i,1),b()):(sb(i,-1),ob(i,!1),f!==a&&(g>f&&g--,tb(g,1)),b()):j||k?(f!==a&&(tb(f,-1),g>f&&g--),this.inserted(c,d,e,g)):f!==a&&(tb(f,-1),g>f&&g--,tb(g,1),b())}},this.removed=function(c,d){if(rd)sc();else{var e;e="string"==typeof c?Kd[c]:Ld[d],e?e.keyRequested?sc():(sb(e,-1),ob(e,!1),b()):d!==a&&(tb(d,-1),b())}},this.endNotifications=function(){ud=!1,b()}}function bd(){Jb(b.ready),ld=null,nd=!1,od=!1,pd=!1,qd={},qd.next=qd,qd.prev=qd,rd=!1,td=!1,vd=0,wd=!1,xd=0,Bd={},Cd=[],Fd=c.unknown,Gd={firstInSequence:!0,lastInSequence:!0,index:-1},Hd={firstInSequence:!0,lastInSequence:!0},Id={firstInSequence:!0,lastInSequence:!0},Gd.next=Hd,Hd.prev=Gd,Hd.next=Id,Id.prev=Hd,Jd={},Kd={},Ld={},Ld[-1]=Gd,Md=0,Nd=null,Od=!1,Pd=!1,Qd=!1,Rd=null}var cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,Md,Nd,Od,Pd,Qd,Rd,Sd,Td,Ud,Vd,Wd,Xd,Yd,Zd,$d,_d,ae,be,ce,de,ee,fe,ge,he,ie=0,je=new Array(100),ke=-1;f.itemsFromKey&&(de=function(a,b,c,d,e){var g="fetchItemsFromKey id="+a+" key="+b+" countBefore="+c+" countAfter="+d;p(g),je[++ke%je.length]={kind:"itemsFromKey",key:b,countBefore:c,countAfter:d};var h=f.itemsFromKey(b,c,d,e);return q(g),h}),f.itemsFromIndex&&(ee=function(a,b,c,d){var e="fetchItemsFromIndex id="+a+" index="+b+" countBefore="+c+" countAfter="+d;p(e),je[++ke%je.length]={kind:"itemsFromIndex",index:b,countBefore:c,countAfter:d};var g=f.itemsFromIndex(b,c,d);return q(e),g}),f.itemsFromStart&&(fe=function(a,b){var c="fetchItemsFromStart id="+a+" count="+b;p(c),je[++ke%je.length]={kind:"itemsFromStart",count:b};var d=f.itemsFromStart(b);return q(c),d}),f.itemsFromEnd&&(ge=function(a,b){var c="fetchItemsFromEnd id="+a+" count="+b;p(c),je[++ke%je.length]={kind:"itemsFromEnd",count:b};var d=f.itemsFromEnd(b);return q(c),d}),f.itemsFromDescription&&(he=function(a,b,c,d){var e="fetchItemsFromDescription id="+a+" desc="+b+" countBefore="+c+" countAfter="+d;p(e),je[++ke%je.length]={kind:"itemsFromDescription",description:b,countBefore:c,countAfter:d};var g=f.itemsFromDescription(b,c,d);return q(e),g});var le=++h,me=this,ne={insert:"insert",change:"change",move:"move",remove:"remove"};if(!f)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",m.listDataAdapterIsInvalid);dd=f.compareByIdentity?0:200,o&&"number"==typeof o.cacheSize&&(dd=o.cacheSize),f.setNotificationHandler&&(cd=new ad,f.setNotificationHandler(cd)),ed=b.ready,gd=!1,hd={},id=0,jd=1,kd=0,yd=0,zd=!1,Ad=1,Dd={},Ed={},bd(),this.createListBinding=function(a){function b(a){a&&a.cursorCount++}function c(a){a&&0===--a.cursorCount&&ab(a)}function d(a){b(a),c(m),m=a}function e(a,b){a===m&&(b||(b=!m||m.lastInSequence||m.next===Hd?null:m.next),d(b))}function f(a){var b=a.bindingMap,c=b[l].handle;delete a.bindingMap[l];var d=!0,e=!0;for(var f in b)if(d=!1,c&&b[f].handle===c){e=!1;break}c&&e&&delete Jd[c],d&&(a.bindingMap=null,ab(a))}function g(a,b){a.bindingMap||(a.bindingMap={});var c=a.bindingMap[l];if(c?c.count++:a.bindingMap[l]={bindingRecord:hd[l],count:1},a.fetchListeners){var d=a.fetchListeners[b];d&&(d.retained=!0)}}function h(a){var b=Jd[a];if(b){var c=b.bindingMap[l];if(0===--c.count){var d=b.fetchListeners;for(var e in d){var g=d[e];g.listBindingID===l&&(g.retained=!1)}f(b)}}}function j(b){var c=fb(b,l),d=(kd++).toString(),e=vb(b,"fetchListeners",d,l,function(a,b){a(gb(b,c))});return T(e,b,c),a&&(e.retain=function(){return o._retainItem(b,d),e},e.release=function(){o._releaseItem(c)}),e}function k(b){var c;return!n&&b?c=j(b):(n?(c=new i(function(){}),c.cancel()):c=i.wrap(null),S(c,null),a&&(c.retain=function(){return c},c.release=function(){})),d(b),c}var l=(id++).toString(),m=null,n=!1;hd[l]={notificationHandler:a,notificationsSent:!1,adjustCurrentSlot:e,itemPromiseFromKnownSlot:j};var o={_retainItem:function(a,b){g(a,b)},_releaseItem:function(a){h(a)},jumpToItem:function(a){return k(a?Jd[a.handle]:null)},current:function(){return k(m)},previous:function(){return k(m?Bb(m):null)},next:function(){return k(m?Cb(m):null)},releaseItem:function(a){this._releaseItem(a.handle)},release:function(){n=!0,c(m),m=null;for(var a=Gd.next;a!==Id;){var b=a.next,d=a.fetchListeners;for(var e in d){var g=d[e];g.listBindingID===l&&(g.promise.cancel(),delete d[e])}a.bindingMap&&a.bindingMap[l]&&f(a),a=b}delete hd[l]}};return(fe||ee)&&(o.first=function(){return k(Cb(Gd))}),ge&&(o.last=function(){return k(Bb(Hd))}),de&&(o.fromKey=function(a,b){return k(Gb(a,b))}),(ee||fe&&de)&&(o.fromIndex=function(a){return k(Hb(a))}),he&&(o.fromDescription=function(a){return k(Ib(a))}),o},this.invalidateAll=function(){return tc()};var oe=function(a,b){var c=new WinJS._Signal;a.then(function(a){c.complete(a)},function(a){c.error(a)});var d=c.promise.then(null,function(c){return"WinJS.UI.VirtualizedDataSource.resetCount"===c.name?(ld=null,a=b.getCount()):i.wrapError(c)}),e=0,f={get:function(){return e++,new i(function(a,b){d.then(a,b)},function(){0===--e&&(c.promise.cancel(),a.cancel(),f===ld&&(ld=null))})},reset:function(){c.error(new WinJS.ErrorFromName("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){c.promise.cancel(),a.cancel(),f===ld&&(ld=null)}};return f};this.getCount=function(){if(f.getCount){var d=this;return i.wrap().then(function(){if(od||rd)return Fd;var a;if(!ld){var b;a=f.getCount();var c;a.then(function(){ld===b&&(ld=null),c=!0},function(){ld===b&&(ld=null),c=!0}),vd=0,c||(b=ld=oe(a,d))}return ld?ld.get():a}).then(function(b){if(!s(b)&&b!==a)throw new WinJS.ErrorFromName("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",m.invalidRequestedCountReturned);return b!==Fd&&(Fd===c.unknown?Fd=b:(hb(b),eb())),0===b&&(Gd.next!==Hd||Hd.next!==Id?sc():Gd.lastInSequence&&(D(Gd),Hd.index=0)),b}).then(null,function(a){return a.name===l.CountError.noResponse?(Jb(b.failure),Fd):WinJS.Promise.wrapError(a)})}return i.wrap(Fd)},de&&(this.itemFromKey=function(a,b){return Db(Gb(a,b))}),(ee||fe&&de)&&(this.itemFromIndex=function(a){return Db(Hb(a))}),he&&(this.itemFromDescription=function(a){return Db(Ib(a))}),this.beginEdits=function(){od=!0},f.insertAtStart&&(this.insertAtStart=function(a,b){return $c(a,b,Gd.lastInSequence?null:Gd.next,!0,function(){return f.insertAtStart(a,b)})}),f.insertBefore&&(this.insertBefore=function(a,b,c){var d=Yc(c);return $c(a,b,d,!1,function(){return f.insertBefore(a,b,c,qb(d))})}),f.insertAfter&&(this.insertAfter=function(a,b,c){var d=Yc(c);return $c(a,b,d?d.next:null,!0,function(){return f.insertAfter(a,b,c,qb(d))})}),f.insertAtEnd&&(this.insertAtEnd=function(a,b){return $c(a,b,Hd.firstInSequence?null:Hd,!1,function(){return f.insertAtEnd(a,b)})}),f.change&&(this.change=function(a,b){var c=Yc(a);return new i(function(d,e){var g;Rc(function(){return f.change(a,b,qb(c))},ne.change,d,e,null,function(){g=c.item,c.itemNew={key:a,data:b},g?mb(c):xb(c)},function(){g?(c.itemNew=g,mb(c)):sc()})})}),f.moveToStart&&(this.moveToStart=function(a){var b=Yc(a);return _c(b,Gd.next,!0,function(){return f.moveToStart(a,qb(b))})}),f.moveBefore&&(this.moveBefore=function(a,b){var c=Yc(a),d=Yc(b);return _c(c,d,!1,function(){return f.moveBefore(a,b,qb(c),qb(d))})}),f.moveAfter&&(this.moveAfter=function(a,b){var c=Yc(a),d=Yc(b);return _c(c,d.next,!0,function(){return f.moveAfter(a,b,qb(c),qb(d))})}),f.moveToEnd&&(this.moveToEnd=function(a){var b=Yc(a);return _c(b,Hd,!1,function(){return f.moveToEnd(a,qb(b))})}),f.remove&&(this.remove=function(a){Eb(a);var b=Kd[a];return new i(function(c,d){var e,g,h;Rc(function(){return f.remove(a,qb(b))},ne.remove,c,d,null,function(){b&&(e=b.next,g=b.firstInSequence,h=b.lastInSequence,sb(b,-1),ob(b,!1))},function(){b&&(N(b,e,!g,!h),sb(b,1),lb(b))})})}),this.endEdits=function(){od=!1,Wc()}}var g=100,h=1,i=WinJS.Promise,j=WinJS._Signal,k=WinJS.Utilities.Scheduler,l=WinJS.UI,m={get listDataAdapterIsInvalid(){return WinJS.Resources._getWinJSString("ui/listDataAdapterIsInvalid").value},get indexIsInvalid(){return WinJS.Resources._getWinJSString("ui/indexIsInvalid").value},get keyIsInvalid(){return WinJS.Resources._getWinJSString("ui/keyIsInvalid").value},get invalidItemReturned(){return WinJS.Resources._getWinJSString("ui/undefinedItemReturned").value},get invalidKeyReturned(){return WinJS.Resources._getWinJSString("ui/invalidKeyReturned").value},get invalidIndexReturned(){return WinJS.Resources._getWinJSString("ui/invalidIndexReturned").value},get invalidCountReturned(){return WinJS.Resources._getWinJSString("ui/invalidCountReturned").value},get invalidRequestedCountReturned(){return WinJS.Resources._getWinJSString("ui/invalidRequestedCountReturned").value},get refreshCycleIdentified(){return WinJS.Resources._getWinJSString("ui/refreshCycleIdentified").value}},n="statuschanged",o=WinJS.Class.define(function(){},{_baseDataSourceConstructor:f},{supportedForProcessing:!1});return WinJS.Class.mix(o,WinJS.Utilities.eventMixin),o})});var b=WinJS.UI.DataSourceStatus,c=WinJS.UI.CountResult,d=WinJS.UI.FetchError,e=WinJS.UI.EditError}(),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_GroupDataSource:WinJS.Namespace._lazy(function(){function a(){return new WinJS.ErrorFromName(c.FetchError.doesNotExist)}function b(a){return a&&a.firstReached&&a.lastReached}var c=WinJS.UI,d=WinJS.Promise,e=WinJS.Utilities.Scheduler,f=101,g=WinJS.Class.define(function(a){this._groupDataAdapter=a},{beginNotifications:function(){},inserted:function(a,b,c){this._groupDataAdapter._inserted(a,b,c)},changed:function(a,b){this._groupDataAdapter._changed(a,b)},moved:function(a,b,c){this._groupDataAdapter._moved(a,b,c)},removed:function(a,b){this._groupDataAdapter._removed(a,b)},countChanged:function(a,b){0===a&&0!==b&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(a,b,c){this._groupDataAdapter._indexChanged(a,b,c)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),h=WinJS.Class.define(function(a,b,c,d){this._listBinding=a.createListBinding(new g(this)),this._groupKey=b,this._groupData=c,this._initializeState(),this._batchSize=f,this._count=null,d&&("number"==typeof d.groupCountEstimate&&(this._count=d.groupCountEstimate<0?null:Math.max(d.groupCountEstimate,1)),"number"==typeof d.batchSize&&(this._batchSize=d.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(a){var b=this;return this._fetchItems(function(){return b._lastGroup},function(a){if(a)return!1;var c=b._count;return+c!==c?!0:c>0?!0:void 0},function(){b._fetchBatch(b._listBinding.last(),b._batchSize-1,0)},a-1,0)})},{setNotificationHandler:function(a){this._listDataNotificationHandler=a},compareByIdentity:!0,itemsFromKey:function(a,b,c,d){var e=this;return this._fetchItems(function(){return e._keyMap[a]},function(){var a=e._lastGroup;return a?+a.index!==a.index?!0:void 0:!0},function(){d=d||{};var a="string"==typeof d.groupMemberKey&&e._listBinding.fromKey?e._listBinding.fromKey(d.groupMemberKey):"number"==typeof d.groupMemberIndex&&e._listBinding.fromIndex?e._listBinding.fromIndex(d.groupMemberIndex):void 0!==d.groupMemberDescription&&e._listBinding.fromDescription?e._listBinding.fromDescription(d.groupMemberDescription):e._listBinding.first(),b=Math.floor(.5*(e._batchSize-1));e._fetchBatch(a,b,e._batchSize-1-b)},b,c)},itemsFromIndex:function(a,b,c){var d=this;return this._fetchItems(function(){return d._indexMap[a]},function(){var b=d._lastGroup;return b?+b.index!==b.index?!0:a<=b.index?!0:void 0:!0},function(){d._fetchNextIndex()},b,c)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return d.wrap(this._count);var a=this,b=new d(function(b){var c={initialBatch:function(){a._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(c){c&&(a._count=0);var d=a._count;return"number"==typeof d?(b(d),!0):!1}};a._fetchQueue.push(c),a._itemBatch||a._continueFetch(c)});return"number"==typeof this._count?d.wrap(this._count):b},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(a){delete this._handleMap[a.handle],this._listBinding.releaseItem(a)},_processBatch:function(){for(var a=null,b=null,c=null,d=0,f=!0,g=0;g<this._batchSize;g++){var h=this._itemBatch[g],i=h?this._groupKey(h):null;if(h&&(f=!1),b&&null!==i&&i===b.key)d++,b.lastItem===a?(b.lastItem.handle!==b.firstItem.handle&&this._releaseItem(b.lastItem),b.lastItem=h,this._handleMap[h.handle]=b,b.size++):b.firstItem===h&&(b.firstItem.handle!==b.lastItem.handle&&this._releaseItem(b.firstItem),b.firstItem=c,this._handleMap[c.handle]=b,b.size+=d);else{var j=null;if(b&&(b.lastReached=!0,"number"==typeof b.index&&(j=b.index+1)),h){var k=this._keyMap[i];if(k||(k={key:i,data:this._groupData(h),firstItem:h,lastItem:h,size:1},this._keyMap[k.key]=k,this._handleMap[h.handle]=k),g>0&&(k.firstReached=!0,b||(j=0)),"number"!=typeof k.index&&"number"==typeof j){for(var l=k;l;l=this._nextGroup(l))l.index=j,this._indexMap[j]=l,j++;this._indexMax=j,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}c=h,d=0,b=k}else b&&(this._lastGroup=b,"number"==typeof b.index&&(this._count=b.index+1),this._listDataNotificationHandler.invalidateAll(),b=null)}a=h}var m;for(m=this._fetchQueue[0];m&&m.complete(f);m=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(m){var n=this;e.schedule(function(){n._continueFetch(m)},e.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(a,b){a.retain(),this._itemBatch[b]=a;var c=this;a.then(function(a){c._itemBatch[b]=a,0===--c._itemsToFetch&&c._processBatch()})},_fetchBatch:function(a,b){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(a,b);var c;for(this._listBinding.jumpToItem(a),c=b-1;c>=0;c--)this._processPromise(this._listBinding.previous(),c);for(this._listBinding.jumpToItem(a),c=b+1;c<this._batchSize;c++)this._processPromise(this._listBinding.next(),c)},_fetchAdjacent:function(a,b){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(a.key):this._listBinding.fromIndex(a.index),b?0:this._batchSize-1,b?this._batchSize-1:0)},_fetchNextIndex:function(){var a=this._indexMap[this._indexMax-1];a?this._fetchAdjacent(a.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(a){if(a.initialBatch)a.initialBatch(),a.initialBatch=null;else{var c=a.getGroup();if(c){var d,e;c.firstReached?c.lastReached?a.countBefore>0&&0!==c.index&&!b(d=this._previousGroup(c))?this._fetchAdjacent(d&&d.lastReached?d.firstItem:c.firstItem,!1):(e=this._nextGroup(c),this._fetchAdjacent(e&&e.firstReached?e.lastItem:c.lastItem,!0)):this._fetchAdjacent(c.lastItem,!0):this._fetchAdjacent(c.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(a,d,e,f,g){if(b(a)){var h=this._previousGroup(a);if(f||b(h)||0===a.index||0===d){var i=this._nextGroup(a);if(f||b(i)||this._lastGroup===a||0===e){for(var j=0,k=a;d>j&&(h=this._previousGroup(k),b(h));)k=h,j++;for(var l=0,m=a;e>l&&(i=this._nextGroup(m),b(i));)m=i,l++;for(var n=j+1+l,o=new Array(n),p=0;n>p;p++){var q={key:k.key,data:k.data,firstItemKey:k.firstItem.key,groupSize:k.size},r=k.firstItem.index;"number"==typeof r&&(q.firstItemIndexHint=r),o[p]=q,k=this._nextGroup(k)}var s={items:o,offset:j};return s.totalCount="number"==typeof this._count?this._count:c.CountResult.unknown,"number"==typeof a.index&&(s.absoluteIndex=a.index),m===this._lastGroup&&(s.atEnd=!0),g(s),!0}}}return!1},_fetchItems:function(b,c,e,f,g){var h=this;return new d(function(d,i){function j(e){var j=b();return j?h._fetchComplete(j,f,g,l,d,i):l&&!c(e)?(i(a()),!0):m>2?(i(a()),!0):(e?m++:m=0,!1)}var k=b(),l=!k,m=0;if(!j()){var n={initialBatch:l?e:null,getGroup:b,countBefore:f,countAfter:g,complete:j};h._fetchQueue.push(n),h._itemBatch||h._continueFetch(n)}})},_previousGroup:function(a){return a&&a.firstReached?(this._listBinding.jumpToItem(a.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(a){return a&&a.lastReached?(this._listBinding.jumpToItem(a.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(a){this._count=null,this._lastGroup=null,"number"==typeof a.index&&(this._indexMax=a.index>0?a.index:null);for(var b=a;b&&"number"==typeof b.index;b=this._nextGroup(b))delete this._indexMap[b.index],b.index=null},_releaseGroup:function(a){this._invalidateIndices(a),delete this._keyMap[a.key],this._lastGroup===a&&(this._lastGroup=null),a.firstItem!==a.lastItem&&this._releaseItem(a.firstItem),this._releaseItem(a.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var a=0;a<this._batchSize;a++){var b=this._itemBatch[a];b&&(b.cancel&&b.cancel(),this._listBinding.releaseItem(b))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(a,b,c){var d=this._handleMap[b],e=this._handleMap[c],f=null;d&&(d.lastReached&&b===d.lastItem.handle&&(f=this._groupKey(a))!==d.key?this._lastGroup===d&&(this._lastGroup=null,this._count=null):this._releaseGroup(d),this._beginRefresh()),e&&e!==d&&(this._invalidateIndices(e),e.firstReached&&c===e.firstItem.handle&&(null!==f?f:this._groupKey(a))!==e.key||this._releaseGroup(e),this._beginRefresh())},_processRemoval:function(a){var b=this._handleMap[a];if(!b||a!==b.firstItem.handle&&a!==b.lastItem.handle){if(this._itemBatch)for(var c=0;c<this._batchSize;c++){var d=this._itemBatch[c];if(d&&d.handle===a){this._beginRefresh();break}}}else this._releaseGroup(b),this._beginRefresh()},_inserted:function(a,b,c){var d=this;a.then(function(a){d._processInsertion(a,b,c)})},_changed:function(a,b){var c=this._handleMap[a.handle];if(c&&a.handle===c.firstItem.handle&&(this._releaseGroup(c),this._beginRefresh()),this._groupKey(a)!==this._groupKey(b)){this._listBinding.jumpToItem(a);var d=this._listBinding.previous().handle;this._listBinding.jumpToItem(a);var e=this._listBinding.next().handle;this._processRemoval(a.handle),this._processInsertion(a,d,e)}},_moved:function(a,b,c){this._processRemoval(a.handle);var d=this;a.then(function(a){d._processInsertion(a,b,c)})},_removed:function(a,b){b||this._processRemoval(a)},_indexChanged:function(a,b,c){"number"==typeof c&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var a in this._keyMap){var b=this._keyMap[a];if(b.firstReached&&b.lastReached){var c=b.lastItem.index+1-b.firstItem.index;isNaN(c)||(b.size=c)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return WinJS.Class.derive(c.VirtualizedDataSource,function(a,b,c,d){var e=new h(a,b,c,d);this._baseDataSourceConstructor(e),this.extensions={invalidateGroups:function(){e.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}(),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(a,b,c,d){function e(a){if(a){var d=Object.create(a);return d.groupKey=b(a),c&&(d.groupData=c(a)),d}return null}function f(a){var b=Object.create(a);return b.then=function(b,c,d){return a.then(function(a){return b(e(a))},c,d)},b}var g=Object.create(a);g.createListBinding=function(b){var c;b?(c=Object.create(b),c.inserted=function(a,c,d){return b.inserted(f(a),c,d)},c.changed=function(a,c){return b.changed(e(a),e(c))},c.moved=function(a,c,d){return b.moved(f(a),c,d)}):c=null;for(var d=a.createListBinding(c),g=Object.create(d),h=["first","last","fromDescription","jumpToItem","current"],i=0,j=h.length;j>i;i++)!function(a){d[a]&&(g[a]=function(){return f(d[a].apply(d,arguments))})}(h[i]);return d.fromKey&&(g.fromKey=function(a){return f(d.fromKey(a))}),d.fromIndex&&(g.fromIndex=function(a){return f(d.fromIndex(a))}),g.prev=function(){return f(d.prev())},g.next=function(){return f(d.next())},g};for(var h=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],i=0,j=h.length;j>i;i++)!function(b){a[b]&&(g[b]=function(){return f(a[b].apply(a,arguments))})}(h[i]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(b){a[b]&&(g[b]=function(){return a[b].apply(a,arguments)})});var k=null;return Object.defineProperty(g,"groups",{get:function(){return k||(k=new WinJS.UI._GroupDataSource(a,b,c,d)),k},enumerable:!0,configurable:!0}),g}})}(),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{StorageDataSource:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(a,b){WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:constructor,StartTM");var c,d=Windows.Storage.FileProperties.ThumbnailMode.singleItem,e=256,f=Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,g=!0;if("Pictures"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.picturesView,c=Windows.Storage.KnownFolders.picturesLibrary,e=190):"Music"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.musicView,c=Windows.Storage.KnownFolders.musicLibrary,e=256):"Documents"===a?(d=Windows.Storage.FileProperties.ThumbnailMode.documentsView,c=Windows.Storage.KnownFolders.documentsLibrary,e=40):"Videos"===a&&(d=Windows.Storage.FileProperties.ThumbnailMode.videosView,c=Windows.Storage.KnownFolders.videosLibrary,e=190),c){var h=new Windows.Storage.Search.QueryOptions;h.folderDepth=Windows.Storage.Search.FolderDepth.deep,h.indexerOption=Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=c.createFileQueryWithOptions(h)}else this._query=a;if(b){if("number"==typeof b.mode&&(d=b.mode),"number"==typeof b.requestedThumbnailSize)e=Math.max(1,Math.min(b.requestedThumbnailSize,1024));else switch(d){case Windows.Storage.FileProperties.ThumbnailMode.picturesView:case Windows.Storage.FileProperties.ThumbnailMode.videosView:e=190;break;case Windows.Storage.FileProperties.ThumbnailMode.documentsView:case Windows.Storage.FileProperties.ThumbnailMode.listView:e=40;break;case Windows.Storage.FileProperties.ThumbnailMode.musicView:case Windows.Storage.FileProperties.ThumbnailMode.singleItem:e=256}"number"==typeof b.thumbnailOptions&&(f=b.thumbnailOptions),"boolean"==typeof b.waitForFileLoad&&(g=!b.waitForFileLoad)}this._loader=new Windows.Storage.BulkAccess.FileInformationFactory(this._query,d,e,f,g),this.compareByIdentity=!1,this.firstDataRequest=!0,WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(a){this._notificationHandler=a,this._query.addEventListener("contentschanged",function(){a.invalidateAll()}),this._query.addEventListener("optionschanged",function(){a.invalidateAll()})},itemsFromEnd:function(a){var b=this;return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(c){return 0===c?WinJS.Promise.wrapError(new WinJS.ErrorFromName(WinJS.UI.FetchError.doesNotExist)):b.itemsFromIndex(c-1,Math.min(c-1,a-1),1)})},itemsFromIndex:function(a,b,c){function d(a){g._notificationHandler.changed(g._item(a.target))}b+c>64&&(b=Math.min(b,32),c=64-(b+1));var e=a-b,f=b+1+c,g=this;g.firstDataRequest&&(g.firstDataRequest=!1,f=Math.max(f,32));var h="WinJS.UI.StorageDataSource:itemsFromIndex("+e+"-"+(e+f-1)+")";return WinJS.Utilities._writeProfilerMark(h+",StartTM"),this._loader.getItemsAsync(e,f).then(function(c){var i=c.size;if(b>=i)return WinJS.Promise.wrapError(new WinJS.ErrorFromName(WinJS.UI.FetchError.doesNotExist));var j=new Array(i),k=new Array(i);c.getMany(0,k);for(var l=0;i>l;l++)j[l]=g._item(k[l]),k[l].addEventListener("propertiesupdated",d);var m={items:j,offset:b,absoluteIndex:a};return f>i&&(m.totalCount=e+i),WinJS.Utilities._writeProfilerMark(h+",StopTM"),m})},itemsFromDescription:function(a,b,c){var d=this;return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(a).then(function(a){return d.itemsFromIndex(a,b,c)})},getCount:function(){return WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(a){return a.folderRelativeId},_item:function(a){return{key:a.path||a.folderRelativeId,data:a}}},{supportedForProcessing:!1});return WinJS.Class.derive(WinJS.UI.VirtualizedDataSource,function(b,c){this._baseDataSourceConstructor(new a(b,c))},{},{loadThumbnail:function(a,b){var c,d,e=!1;return new WinJS.Promise(function(f){var g=b?!0:!1,h=function(h){if(h){var i=URL.createObjectURL(h,{oneTimeOnly:!0});d=d?d.then(function(b){return a.loadImage(i,b)}):a.loadImage(i,b).then(function(b){return a.isOnScreen().then(function(a){var c;return a&&g?c=WinJS.UI.Animation.fadeIn(b).then(function(){return b}):(b.style.opacity=1,c=WinJS.Promise.wrap(b)),c})}),h.type==Windows.Storage.FileProperties.ThumbnailType.icon||h.returnedSmallerCachedSize||(WinJS.Utilities._writeProfilerMark("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),a.data.removeEventListener("thumbnailupdated",c),e=!1,d=d.then(function(a){c=null,d=null,f(a)
}))}};c=function(a){e&&h(a.target.thumbnail)},a.data.addEventListener("thumbnailupdated",c),e=!0,h(a.data.thumbnail)},function(){a.data.removeEventListener("thumbnailupdated",c),e=!1,c=null,d&&(d.cancel(),d=null)})},supportedForProcessing:!1})})})}(),function(){"use strict";function a(a,b){var c=!1,d=!1;return a.isOnScreen().then(function(a){c=a}),b.isOnScreen().then(function(a){d=a}),(c?0:1)-(d?0:1)}function b(a){if(!/^blob:/i.test(a)&&(p[a]=!0,q.push(a),q.length>s)){var b=q;p={},q=[];for(var c=0,d=b.length-1;d>=0&&r>c;d--){var e=b[d];p[e]||(p[e]=!0,c++)}}}function c(c,d,e){var f=o++;return g=g||new WinJS.UI._ParallelWorkQueue(6),g.queue(function(){return new WinJS.Promise(function(e,h){j.schedule(function(f){d||(d=document.createElement("img"));var i=p[c];i?(b(c),d.src=c,e(d)):f.setPromise(new WinJS.Promise(function(f){var i=document.createElement("img"),j=function(){i.removeEventListener("load",k,!1),i.removeEventListener("error",l,!1),d.src=c;var b=new Date;b-m>n&&(m=b,g.sort(a))},k=function(){f(o)},l=function(){f(p)},o=function(){b(c),j(),e(d)},p=function(){j(),h(d)};i.addEventListener("load",k,!1),i.addEventListener("error",l,!1),i.src=c}))},j.Priority.normal,null,"WinJS.UI._ImageLoader._image"+f)})},e)}function d(a){return p[a]}function e(){return document.createElement("div")}var f=WinJS.Utilities.markSupportedForProcessing;WinJS.Namespace.define("WinJS.UI",{_normalizeRendererReturn:function(a){if(a){if("object"==typeof a&&a.element){var b=WinJS.Promise.as(a.element);return b.then(function(b){return{element:b,renderComplete:WinJS.Promise.as(a.renderComplete)}})}var b=WinJS.Promise.as(a);return b.then(function(a){return{element:a,renderComplete:WinJS.Promise.as()}})}return{element:null,renderComplete:WinJS.Promise.as()}},simpleItemRenderer:function(a){return f(function(b,c){return b.then(function(b){return b?a(b,c):null})})}});var g,h=WinJS.Promise,i=WinJS._Signal,j=WinJS.Utilities.Scheduler,k=WinJS.Utilities._uniqueID,l=(WinJS.UI,{get listDataSourceIsInvalid(){return WinJS.Resources._getWinJSString("ui/listDataSourceIsInvalid").value},get itemRendererIsInvalid(){return WinJS.Resources._getWinJSString("ui/itemRendererIsInvalid").value},get itemIsInvalid(){return WinJS.Resources._getWinJSString("ui/itemIsInvalid").value},get invalidItemsManagerCallback(){return WinJS.Resources._getWinJSString("ui/invalidItemsManagerCallback").value}}),m=new Date,n=64,o=0,p={},q=[],r=250,s=1e3;WinJS.Namespace.define("WinJS.UI",{_seenUrl:b,_getSeenUrls:function(){return p},_getSeenUrlsMRU:function(){return q},_seenUrlsMaxSize:r,_seenUrlsMRUMaxSize:s}),WinJS.Namespace.define("WinJS.UI",{_createItemsManager:WinJS.Namespace._lazy(function(){var a=WinJS.Class.define(function(a){this._itemsManager=a},{beginNotifications:function(){this._itemsManager._versionManager.beginNotifications(),this._itemsManager._beginNotifications()},inserted:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._inserted(a,b,c)},changed:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._changed(a,b)},moved:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._moved(a,b,c)},removed:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._removed(a,b)},countChanged:function(a,b){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._countChanged(a,b)},indexChanged:function(a,b,c){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._indexChanged(a,b,c)},affectedRange:function(a){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._affectedRange(a)},endNotifications:function(){this._itemsManager._versionManager.endNotifications(),this._itemsManager._endNotifications()},reload:function(){this._itemsManager._versionManager.receivedNotification(),this._itemsManager._reload()}},{supportedForProcessing:!1}),b=WinJS.Class.define(function(b,c,d,e){if(!b)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ListDataSourceIsInvalid",l.listDataSourceIsInvalid);if(!c)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemRendererIsInvalid",l.itemRendererIsInvalid);this.$pipeline_callbacksMap={},this._listDataSource=b,this.dataSource=this._listDataSource,this._elementNotificationHandler=d,this._listBinding=this._listDataSource.createListBinding(new a(this)),e&&(e.ownerElement&&(this._ownerElement=e.ownerElement),this._profilerId=e.profilerId,this._versionManager=e.versionManager||new WinJS.UI._VersionManager),this._indexInView=e&&e.indexInView,this._itemRenderer=c,this._viewCallsReady=e&&e.viewCallsReady,this._elementMap={},this._handleMap={},this._jobOwner=j.createOwnerToken(),this._notificationsSent=!1,this._listBinding.last&&(this.lastItem=function(){return this._elementForItem(this._listBinding.last())})},{_itemFromItemPromise:function(a){return this._waitForElement(this._elementForItem(a))},_itemFromItemPromiseThrottled:function(a){return this._waitForElement(this._elementForItem(a,!0))},_itemAtIndex:function(a){var b=this._itemPromiseAtIndex(a),c=this._itemFromItemPromise(b);return c.then(null,function(a){return b.cancel(),WinJS.Promise.wrapError(a)})},_itemPromiseAtIndex:function(a){var b=this._listBinding.fromIndex(a);return b},_waitForElement:function(a){var b=this;return new WinJS.Promise(function(c){if(a)if(b.isPlaceholder(a)){var d=k(a),e=b.$pipeline_callbacksMap[d];e?e.push(c):b.$pipeline_callbacksMap[d]=[c]}else c(a);else c(a)})},_updateElement:function(a,b){var c=k(b),d=this.$pipeline_callbacksMap[c];d&&(delete this.$pipeline_callbacksMap[c],d.forEach(function(b){b(a)}))},_firstItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.first()))},_lastItem:function(){return this._waitForElement(this._elementForItem(this._listBinding.last()))},_previousItem:function(a){return this._listBinding.jumpToItem(this._itemFromElement(a)),this._waitForElement(this._elementForItem(this._listBinding.previous()))},_nextItem:function(a){return this._listBinding.jumpToItem(this._itemFromElement(a)),this._waitForElement(this._elementForItem(this._listBinding.next()))},_itemFromPromise:function(a){return this._waitForElement(this._elementForItem(a))},isPlaceholder:function(a){return!!this._recordFromElement(a).elementIsPlaceholder},itemObject:function(a){return this._itemFromElement(a)},release:function(){this._listBinding.release(),this._elementNotificationHandler=null,this._listBinding=null,this._jobOwner.cancelAll(),this._released=!0},releaseItemPromise:function(a){var b=a.handle,c=this._handleMap[b];c?this._releaseRecord(c):a.cancel()},releaseItem:function(a){var b=this._elementMap[k(a)];this._releaseRecord(b)},_releaseRecord:function(a){a&&(a.renderPromise&&a.renderPromise.cancel(),a.itemPromise&&a.itemPromise.cancel(),a.imagePromises&&a.imagePromises.forEach(function(a){a.cancel()}),a.itemReadyPromise&&a.itemReadyPromise.cancel(),a.renderComplete&&a.renderComplete.cancel(),this._removeEntryFromElementMap(a.element),this._removeEntryFromHandleMap(a.itemPromise.handle,a),a.item&&this._listBinding.releaseItem(a.item))},refresh:function(){return this._listDataSource.invalidateAll()},_handlerToNotifyCaresAboutItemAvailable:function(){return!(!this._elementNotificationHandler||!this._elementNotificationHandler.itemAvailable)},_handlerToNotify:function(){return this._notificationsSent||(this._notificationsSent=!0,this._elementNotificationHandler&&this._elementNotificationHandler.beginNotifications&&this._elementNotificationHandler.beginNotifications()),this._elementNotificationHandler},_defineIndexProperty:function(a,b,c){c.indexObserved=!1,Object.defineProperty(a,"index",{get:function(){return c.indexObserved=!0,b.index}})},_renderPlaceholder:function(a){var b={},c=e(b);return a.elementIsPlaceholder=!0,c},_renderItem:function(a,b,e){function f(){a.then(function(a){g._writeProfilerMark(n+",StartTM"),l.complete(a),g._writeProfilerMark(n+",StopTM")})}var g=this,k=g._indexInView||function(){return!0},l=new i,m=new i,n="_renderItem("+b.item.index+"):itemPromise",o=!0,p=!1;a.then(function(a){p=!0,o&&l.complete(a)}),o=!1;var q=l.promise.then(function(a){if(a){var e=Object.create(a);return g._defineIndexProperty(e,a,b),e.ready=m.promise,e.isOnScreen=function(){return h.wrap(k(a.index))},e.loadImage=function(a,d){var f=c(a,d,e);return b.imagePromises?b.imagePromises.push(f):b.imagePromises=[f],f},e.isImageCached=d,e}return WinJS.Promise.cancel});p||(e?(b.stage0=a,b.startStage1=function(){b.startStage1=null,f()}):f()),q.handle=a.handle,b.itemPromise=q,b.itemReadyPromise=m.promise,b.readyComplete=!1;var r="_renderItem("+b.item.index+(p?"):syncItemPromise":"):placeholder"),s="_renderItem("+b.item.index+"):itemReady";this._writeProfilerMark(r+",StartTM");var t=WinJS.Promise.as(g._itemRenderer(q,b.element)).then(WinJS.UI._normalizeRendererReturn).then(function(a){return g._released?WinJS.Promise.cancel:(q.then(function(a){if(b.pendingReady=function(){b.pendingReady&&(b.pendingReady=null,b.readyComplete=!0,g._writeProfilerMark(s+",StartTM"),m.complete(a),g._writeProfilerMark(s+",StopTM"))},!g._viewCallsReady){var c=j.schedule(b.pendingReady,j.Priority.normal,b,"WinJS.UI._ItemsManager._pendingReady");c.owner=g._jobOwner}}),a)});return this._writeProfilerMark(r+",StopTM"),t},_replaceElement:function(a,b){this._removeEntryFromElementMap(a.element),a.element=b,this._addEntryToElementMap(b,a)},_changeElement:function(a,b,c){a.renderPromise=null;var d=a.element,e=a.item;a.newItem&&(a.item=a.newItem,a.newItem=null),this._replaceElement(a,b),a.item&&a.elementIsPlaceholder&&!c?(a.elementDelayed=null,a.elementIsPlaceholder=!1,this._updateElement(a.element,d),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(a.element,d)):this._handlerToNotify().changed(b,d,e)},_elementForItem:function(a,b){var c,d=a.handle,e=this._recordFromHandle(d,!0);if(!d)return null;if(e)c=e.element;else{e={item:a,itemPromise:a},this._addEntryToHandleMap(d,e);var f=this,g=!1,h=!1,i=f._renderItem(a,e,b).then(function(b){var d=b.element;e.renderComplete=b.renderComplete,a.then(function(a){e.item=a,a||(g=!0,c=null)}),h=!0,e.renderPromise=null,d&&(c?f._presentElements(e,d):c=d)});g||(h||(e.renderPromise=i),c||(c=this._renderPlaceholder(e)),e.element=c,this._addEntryToElementMap(c,e),a.retain())}return c},_addEntryToElementMap:function(a,b){this._elementMap[k(a)]=b},_removeEntryFromElementMap:function(a){delete this._elementMap[k(a)]},_recordFromElement:function(a){var b=this._elementMap[k(a)];if(!b)throw this._writeProfilerMark("_recordFromElement:ItemIsInvalidError,info"),new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",l.itemIsInvalid);return b},_addEntryToHandleMap:function(a,b){this._handleMap[a]=b},_removeEntryFromHandleMap:function(a){delete this._handleMap[a]},_handleInHandleMap:function(a){return!!this._handleMap[a]},_recordFromHandle:function(a,b){var c=this._handleMap[a];if(!c&&!b)throw new WinJS.ErrorFromName("WinJS.UI.ItemsManager.ItemIsInvalid",l.itemIsInvalid);return c},_foreachRecord:function(a){var b=this._handleMap;for(var c in b){var d=b[c];a(d)}},_itemFromElement:function(a){return this._recordFromElement(a).item},_elementFromHandle:function(a){if(a){var b=this._recordFromHandle(a,!0);if(b&&b.element)return b.element}return null},_inserted:function(a,b,c){this._handlerToNotify().inserted(a,b,c)},_changed:function(a,b){if(this._handleInHandleMap(b.handle)){var c=this._recordFromHandle(b.handle);c.renderPromise&&c.renderPromise.cancel(),c.itemPromise&&c.itemPromise.cancel(),c.imagePromises&&c.imagePromises.forEach(function(a){a.cancel()}),c.itemReadyPromise&&c.itemReadyPromise.cancel(),c.renderComplete&&c.renderComplete.cancel(),c.newItem=a;var d=this,e=WinJS.Promise.as(a);e.handle=c.itemPromise.handle,c.renderPromise=this._renderItem(e,c).then(function(a){c.renderComplete=a.renderComplete,d._changeElement(c,a.element,!1),d._presentElements(c)})}},_moved:function(a,b,c){var d=this._elementFromHandle(a.handle),e=this._elementFromHandle(b),f=this._elementFromHandle(c);this._handlerToNotify().moved(d,e,f,a),this._presentAllElements()},_removed:function(a,b){if(this._handleInHandleMap(a)){var c=this._elementFromHandle(a);this._handlerToNotify().removed(c,b,a),this.releaseItem(c),this._presentAllElements()}else this._handlerToNotify().removed(null,b,a)},_countChanged:function(a,b){this._elementNotificationHandler&&this._elementNotificationHandler.countChanged&&this._handlerToNotify().countChanged(a,b)},_indexChanged:function(a,b,c){var d;if(this._handleInHandleMap(a)){var e=this._recordFromHandle(a);if(e.indexObserved)if(e.elementIsPlaceholder)this._changeElement(e,this._renderPlaceholder(e),!0);else if(e.item.index!==b){e.renderPromise&&e.renderPromise.cancel(),e.renderComplete&&e.renderComplete.cancel();var f=e.newItem||e.item;f.index=b;var g=WinJS.Promise.as(f);g.handle=e.itemPromise.handle;var h=this;e.renderPromise=this._renderItem(g,e).then(function(a){e.renderComplete=a.renderComplete,h._changeElement(e,a.element,!1),h._presentElements(e)})}d=e.element}this._elementNotificationHandler&&this._elementNotificationHandler.indexChanged&&this._handlerToNotify().indexChanged(d,b,c)},_affectedRange:function(a){this._elementNotificationHandler&&this._elementNotificationHandler.updateAffectedRange&&this._handlerToNotify().updateAffectedRange(a)},_beginNotifications:function(){this._externalBegin=!0;this._handlerToNotify()},_endNotifications:function(){this._notificationsSent&&(this._notificationsSent=!1,this._externalBegin=!1,this._elementNotificationHandler&&this._elementNotificationHandler.endNotifications&&this._elementNotificationHandler.endNotifications())},_reload:function(){this._elementNotificationHandler&&this._elementNotificationHandler.reload&&this._elementNotificationHandler.reload()},_postEndNotifications:function(){if(this._notificationsSent&&!this._externalBegin&&!this._endNotificationsPosted){this._endNotificationsPosted=!0;var a=this;j.schedule(function(){a._endNotificationsPosted=!1,a._endNotifications()},j.Priority.high,null,"WinJS.UI._ItemsManager._postEndNotifications")}},_presentElement:function(a){var b=a.element;this._replaceElement(a,a.elementDelayed),a.elementDelayed=null,a.elementIsPlaceholder=!1,this._updateElement(a.element,b),this._handlerToNotifyCaresAboutItemAvailable()&&this._handlerToNotify().itemAvailable(a.element,b)},_presentElements:function(a,b){b&&(a.elementDelayed=b),this._listBinding.jumpToItem(a.item),a.elementDelayed&&this._presentElement(a),this._postEndNotifications()},_presentAllElements:function(){var a=this;this._foreachRecord(function(b){b.elementDelayed&&a._presentElement(b)})},_writeProfilerMark:function(a){var b="WinJS.UI._ItemsManager:"+(this._profilerId?this._profilerId+":":":")+a;WinJS.Utilities._writeProfilerMark(b)}},{supportedForProcessing:!1});return function(a,c,d,e){return new b(a,c,d,e)}})})}(this),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_ParallelWorkQueue:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a){function b(){h--,i||WinJS.Utilities.Scheduler.schedule(c,WinJS.Utilities.Scheduler.Priority.normal,null,"WinJS._ParallelWorkQueue.runNext")}function c(){for(i++;a>h;h++){var c,d;do c=g.shift(),d=c&&f[c];while(c&&!d);if(!d)break;delete f[c];try{d().then(b,b)}catch(e){b()}}i--}function d(a,b,d){var h,i="w"+e++;return new WinJS.Promise(function(e,j,k){var l=function(){return h=a().then(e,j,k)};l.data=b,f[i]=l,d?g.unshift(i):g.push(i),c()},function(){delete f[i],h&&h.cancel()})}var e=0,f={},g=[];a=a||3;var h=0,i=0;this.sort=function(a){g.sort(function(b,c){return b=f[b],c=f[c],void 0===b&&void 0===c?0:void 0===b?1:void 0===c?-1:a(b.data,c.data)})},this.queue=d},{},{supportedForProcessing:!1})})})}(this),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_VersionManager:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(){this._unlocked=new WinJS._Signal,this._unlocked.complete()},{_cancelCount:0,_notificationCount:0,_updateCount:0,_version:0,locked:{get:function(){return 0!==this._notificationCount||0!==this._updateCount}},noOutstandingNotifications:{get:function(){return 0===this._notificationCount}},version:{get:function(){return this._version}},unlocked:{get:function(){return this._unlocked.promise}},_dispose:function(){this._unlocked&&(this._unlocked.cancel(),this._unlocked=null)},beginUpdating:function(){this._checkLocked(),this._updateCount++},endUpdating:function(){this._updateCount--,this._checkUnlocked()},beginNotifications:function(){this._checkLocked(),this._notificationCount++},endNotifications:function(){this._notificationCount--,this._checkUnlocked()},_checkLocked:function(){this.locked||(this._dispose(),this._unlocked=new WinJS._Signal)},_checkUnlocked:function(){this.locked||this._unlocked.complete()},receivedNotification:function(){if(this._version++,this._cancel){var a=this._cancel;this._cancel=null,a.forEach(function(a){a&&a.cancel()})}},cancelOnNotification:function(a){return this._cancel||(this._cancel=[],this._cancelCount=0),this._cancel[this._cancelCount++]=a,this._cancelCount-1},clearCancelOnNotification:function(a){this._cancel&&delete this._cancel[a]}},{supportedForProcessing:!1})})})}(),function(a){"use strict";a.Namespace.define("WinJS.UI",{FlipView:a.Namespace._lazy(function(){function b(b){var c=b[0].target.winControl;c&&c instanceof a.UI.FlipView&&b.some(function(a){return"dir"===a.attributeName?!0:"style"===a.attributeName?c._cachedStyleDir!=a.target.style.direction:!1})&&(c._cachedStyleDir=c._flipviewDiv.style.direction,c._rtl="rtl"===window.getComputedStyle(c._flipviewDiv,null).direction,c._setupOrientation())}function c(b){var c=b.target&&b.target.winControl;c&&c instanceof a.UI.FlipView&&(a.Utilities._writeProfilerMark("WinJS.UI.FlipView:resize,StartTM"),c._resize())}var d=a.UI,e=a.Utilities,f=a.Utilities.Scheduler,g=a.UI.Animation,h="win-navbutton",i="win-flipview",j="win-navleft",k="win-navright",l="win-navtop",m="win-navbottom",n="Previous",o="Next",p=3e3,q=500,r="&#57570;",s="&#57571;",t="&#57572;",u="&#57573;",v=40,w={get badAxis(){return a.Resources._getWinJSString("ui/badAxis").value},get badCurrentPage(){return a.Resources._getWinJSString("ui/badCurrentPage").value},get noitemsManagerForCount(){return a.Resources._getWinJSString("ui/noitemsManagerForCount").value},get badItemSpacingAmount(){return a.Resources._getWinJSString("ui/badItemSpacingAmount").value},get navigationDuringStateChange(){return a.Resources._getWinJSString("ui/flipViewNavigationDuringStateChange").value},get panningContainerAriaLabel(){return a.Resources._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},x=a.Class.define(function(b,c){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,b=b||document.createElement("div");var d=!0,f=null,g=a.UI._trivialHtmlRenderer,h=0,i=0;if(c){if(c.orientation&&"string"==typeof c.orientation)switch(c.orientation.toLowerCase()){case"horizontal":d=!0;break;case"vertical":d=!1}c.currentPage&&(h=c.currentPage>>0,h=0>h?0:h),c.itemDataSource&&(f=c.itemDataSource),c.itemTemplate&&(g=this._getItemRenderer(c.itemTemplate)),c.itemSpacing&&(i=c.itemSpacing>>0,i=0>i?0:i)}if(!f){var j=new a.Binding.List;f=j.dataSource}e.empty(b),this._flipviewDiv=b,a.UI._setOptions(this,c,!0),this._initializeFlipView(b,d,f,g,h,i),b.winControl=this,a.Utilities.addClass(b,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),window.addEventListener("wheel",this._windowWheelHandlerBound),a.Utilities._writeProfilerMark("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(window.removeEventListener("wheel",this._windowWheelHandlerBound),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:next,info");var b=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,b)},previous:function(){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:prev,info");var b=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,b)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(b){if(a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var c=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){c._pageManager._notificationsEndedSignal=null,c.currentPage=b})}if(!this._animating||this._cancelAnimation())if(b>>=0,b=0>b?0:b,this._refreshTimer)this._indexAfterRefresh=b;else{this._pageManager._cachedSize>0?b=Math.min(this._pageManager._cachedSize-1,b):0===this._pageManager._cachedSize&&(b=0);var c=this;if(this._jumpingToIndex===b)return;var d=function(){c._jumpingToIndex=null};this._jumpingToIndex=b;var e=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),f=this._jumpAnimation?null:this._cancelDefaultAnimation,g=function(){c._completeJump()};this._pageManager.startAnimatedJump(b,f,g).then(function(b){if(b){c._animationsStarted();var f=b.oldPage.pageRoot,h=b.newPage.pageRoot;c._contentDiv.appendChild(f),c._contentDiv.appendChild(h),c._completeJumpPending=!0,e(f,h).then(function(){c._completeJumpPending&&(g(),a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(d,d)}else d()},d)}}},orientation:{get:function(){return this._axisAsString()},set:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_orientation,info");var c="horizontal"===b;c!==this._horizontal&&(this._horizontal=c,this._setupOrientation(),this._pageManager.setOrientation(this._horizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=b||(new a.Binding.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(b),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:set_itemSpacing,info"),b>>=0,b=0>b?0:b,this._pageManager.setItemSpacing(b)}},count:function(){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:count,info");var b=this;return new a.Promise(function(c,e){b._itemsManager?b._pageManager._cachedSize===a.UI.CountResult.unknown||b._pageManager._cachedSize>=0?c(b._pageManager._cachedSize):b._dataSource.getCount().then(function(a){b._pageManager._cachedSize=a,c(a)}):e(d.FlipView.noitemsManagerForCount)})},setCustomAnimations:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==b.next&&(this._nextAnimation=b.next),void 0!==b.previous&&(this._prevAnimation=b.previous),void 0!==b.jump&&(this._jumpAnimation=b.jump)},forceLayout:function(){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(f,g,h,j,k,l){function m(a){a.setAttribute("aria-hidden",!0),a.style.visibility="hidden",a.style.opacity=0,a.tabIndex=-1,a.style.zIndex=1e3}function p(a){if(a.pointerType!==y){if(x._touchInteraction=!1,a.screenX===x._lastMouseX&&a.screenY===x._lastMouseY)return;x._lastMouseX=a.screenX,x._lastMouseY=a.screenY,x._mouseInViewport=!0,x._fadeInButton("prev"),x._fadeInButton("next"),x._fadeOutButtons()}}this._flipviewDiv=f,e.addClass(this._flipviewDiv,i),this._contentDiv=document.createElement("div"),this._panningDivContainer=document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=document.createElement("div"),this._prevButton=document.createElement("button"),this._nextButton=document.createElement("button"),this._horizontal=g,this._dataSource=h,this._itemRenderer=j,this._itemsManager=null,this._pageManager=null;for(var q=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],r=!0,s=a.Utilities._browserStyleEquivalents,t=0,u=q.length;u>t;t++)r=r&&!!s[q[t]];r=r&&!!a.Utilities._browserEventEquivalents.manipulationStateChanged,this._environmentSupportsTouch=r;var v=this._flipviewDiv.getAttribute("aria-label");v||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",w.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),m(this._prevButton),m(this._nextButton),this._prevButton.setAttribute("aria-label",n),this._nextButton.setAttribute("aria-label",o),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton);var x=this;this._itemsManagerCallback={inserted:function(a,b,c){x._itemsManager._itemFromPromise(a).then(function(a){var d=x._itemsManager._elementFromHandle(b),e=x._itemsManager._elementFromHandle(c);x._pageManager.inserted(a,d,e,!0)})},countChanged:function(b,c){x._pageManager._cachedSize=b,c!==a.UI.CountResult.unknown&&x._fireDatasourceCountChangedEvent()},changed:function(a,b){x._pageManager.changed(a,b)},moved:function(a,b,c,d){var e=function(a){x._pageManager.moved(a,b,c)};a?e(a):x._itemsManager._itemFromPromise(d).then(e)},removed:function(a,b){a&&x._pageManager.removed(a,b,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){x._cancelAnimation(),x._pageManager.notificationsStarted()},endNotifications:function(){x._pageManager.notificationsEnded()},itemAvailable:function(a,b){x._pageManager.itemRetrieved(a,b)},reload:function(){x._pageManager.reload()}},this._dataSource&&(this._itemsManager=d._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new d._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,l,r,{hidePreviousButton:function(){x._hasPrevContent=!1,x._fadeOutButton("prev"),x._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){x._hasPrevContent=!0,x._fadeInButton("prev"),x._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){x._hasNextContent=!1,x._fadeOutButton("next"),x._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){x._hasNextContent=!0,x._fadeInButton("next"),x._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(k,this._horizontal,this._environmentSupportsTouch),this._dataSource.getCount().then(function(a){x._pageManager._cachedSize=a}),this._prevButton.addEventListener("click",function(){x.previous()},!1),this._nextButton.addEventListener("click",function(){x.next()},!1),new a.Utilities._MutationObserver(b).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._flipviewDiv.addEventListener("mselementresize",c),this._contentDiv.addEventListener("mouseleave",function(){x._mouseInViewport=!1},!1);var y=a.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._contentDiv.addEventListener("pointermove",p,!1),this._contentDiv.addEventListener("pointerdown",function(a){a.pointerType===y?(x._mouseInViewport=!1,x._touchInteraction=!0,x._fadeOutButtons(!0)):(x._touchInteraction=!1,x._isInteractive(a.target)||0!==(4&a.buttons)&&(a.stopPropagation(),a.preventDefault()))},!1),this._contentDiv.addEventListener("pointerup",function(a){a.pointerType!==y&&(x._touchInteraction=!1)},!1),this._panningDivContainer.addEventListener("scroll",function(){x._scrollPosChanged()},!1),this._panningDiv.addEventListener("deactivate",function(){x._touchInteraction||x._fadeOutButtons()},!0),this._flipviewDiv.addEventListener("DOMNodeInserted",function(a){a.target===x._flipviewDiv&&x._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(a){var b=!0;if(!x._isInteractive(a.target)){var c=e.Key,d=!1;if(x._horizontal)switch(a.keyCode){case c.leftArrow:x._rtl?x.next():x.previous(),d=!0;break;case c.pageUp:x.previous(),d=!0;break;case c.rightArrow:x._rtl?x.previous():x.next(),d=!0;break;case c.pageDown:x.next(),d=!0;break;case c.upArrow:case c.downArrow:d=!0,b=!1}else switch(a.keyCode){case c.upArrow:case c.pageUp:x.previous(),d=!0;break;case c.downArrow:case c.pageDown:x.next(),d=!0;break;case c.space:d=!0}switch(a.keyCode){case c.home:x.currentPage=0,d=!0;break;case c.end:x._pageManager._cachedSize>0&&(x.currentPage=x._pageManager._cachedSize-1),d=!0}if(d)return a.preventDefault(),a.cancelBubble=b,!0}},!1)},_windowWheelHandler:function(b){var c=b.target&&(this._flipviewDiv.contains(b.target)||this._flipviewDiv===b.target),d=this,e=a.Utilities._now(),f=this._avoidTrappingTime>e;(!c||f)&&(this._avoidTrappingTime=e+q),c&&f&&(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",a.Utilities._yieldForDomModification(function(){d._pageManager._ensureCentered(),d._horizontal?(d._panningDivContainer.style.overflowX=d._environmentSupportsTouch?"scroll":"hidden",d._panningDivContainer.style.overflowY="hidden"):(d._panningDivContainer.style.overflowY=d._environmentSupportsTouch?"scroll":"hidden",d._panningDivContainer.style.overflowX="hidden")}))},_isInteractive:function(a){if(a.parentNode)for(var b=a.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),c=0,d=b.length;d>c;c++)if(b[c]===a)return!0;return!1},_refreshHandler:function(){var a=this._dataSourceAfterRefresh||this._dataSource,b=this._itemRendererAfterRefresh||this._itemRenderer,c=this._indexAfterRefresh||0;this._setDatasource(a,b,c),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var a=this;this._refreshTimer=!0,f.schedule(function(){a._refreshTimer&&!a._disposed&&a._refreshHandler()},f.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(b){var c=null;if("function"==typeof b){var d=new a.Promise(function(){}),e=b(d);c=e.element?"object"==typeof e.element&&"function"==typeof e.element.then?function(c){var d=document.createElement("div");return d.className="win-template",a.Utilities.markDisposable(d),{element:d,renderComplete:b(c).element.then(function(a){d.appendChild(a)})}}:b:function(c){var d=document.createElement("div");return d.className="win-template",a.Utilities.markDisposable(d),{element:d,renderComplete:c.then(function(){return a.Promise.as(b(c)).then(function(a){d.appendChild(a)})})}}}else"object"==typeof b&&(c=b.renderItem);return c},_navigate:function(b,c){if(a.validation&&this._refreshTimer)throw new a.ErrorFromName("WinJS.UI.FlipView.NavigationDuringStateChange",w.navigationDuringStateChange);if(this._animating||(this._animatingForward=b),this._goForward=b,this._animating&&!this._cancelAnimation())return!1;var d=this,e=b?this._nextAnimation:this._prevAnimation,f=e?e:this._defaultAnimation.bind(this),g=function(a){d._completeNavigation(a)
},h=this._pageManager.startAnimatedNavigation(b,c,g);if(h){this._animationsStarted();var i=h.outgoing.pageRoot,j=h.incoming.pageRoot;return this._contentDiv.appendChild(i),this._contentDiv.appendChild(j),this._completeNavigationPending=!0,f(i,j).then(function(){d._completeNavigationPending&&g(d._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(a,b){a.style.opacity=0,b.style.animationName="",b.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var a=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(a&&(a=a.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var b=this._pageManager._navigationAnimationRecord.elementContainers[0],c=this._pageManager._navigationAnimationRecord.elementContainers[1],d=b.pageRoot,e=c.pageRoot;return a&&a(d,e),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(a){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var b=this._pageManager._navigationAnimationRecord.elementContainers[0],c=this._pageManager._navigationAnimationRecord.elementContainers[1],d=b.pageRoot,e=c.pageRoot;d.parentNode&&d.parentNode.removeChild(d),e.parentNode&&e.parentNode.removeChild(e),this._pageManager.endAnimatedNavigation(a,b,c),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var a=this._pageManager._navigationAnimationRecord.elementContainers[0],b=this._pageManager._navigationAnimationRecord.elementContainers[1],c=a.pageRoot,d=b.pageRoot;c.parentNode&&c.parentNode.removeChild(c),d.parentNode&&d.parentNode.removeChild(d),this._pageManager.endAnimatedJump(a,b),this._animationsFinished()}this._completeJumpPending=!1}},_resize:function(){this._pageManager.resized()},_setCurrentIndex:function(a){return this._pageManager.jumpToIndex(a)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(a,b,c){this._animating&&this._cancelAnimation();var e=0;void 0!==c&&(e=c),this._dataSource=a,this._itemRenderer=b;var f=this._itemsManager;this._itemsManager=d._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var g=this;this._dataSource.getCount().then(function(a){g._pageManager._cachedSize=a}),this._pageManager.setNewItemsManager(this._itemsManager,e),f&&f.release()},_fireDatasourceCountChangedEvent:function(){var b=this;f.schedule(function(){var c=document.createEvent("Event");c.initEvent(d.FlipView.datasourceCountChangedEvent,!0,!0),a.Utilities._writeProfilerMark("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),b._flipviewDiv.dispatchEvent(c)},f.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._horizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._horizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var a="rtl"===window.getComputedStyle(this._flipviewDiv,null).direction;this._rtl=a,a?(this._prevButton.className=h+" "+k,this._nextButton.className=h+" "+j):(this._prevButton.className=h+" "+j,this._nextButton.className=h+" "+k),this._prevButton.innerHTML=a?s:r,this._nextButton.innerHTML=a?r:s}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=h+" "+l,this._nextButton.className=h+" "+m,this._prevButton.innerHTML=t,this._nextButton.innerHTML=u;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(a,b){(this._mouseInViewport||b||!this._environmentSupportsTouch)&&("next"===a&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===a&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(a){var b=this;return"next"===a?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=g.fadeOut(this._nextButton).then(function(){b._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=g.fadeOut(this._prevButton).then(function(){b._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(b){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var c=this;this._buttonFadePromise=(b?a.Promise.wrap():a.Promise.timeout(a.UI._animationTimeAdjustment(p))).then(function(){c._fadeOutButton("prev"),c._fadeOutButton("next"),c._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(b,c){var d={};c.style.left="0px",c.style.top="0px",c.style.opacity=0;var e=b.itemIndex>c.itemIndex?-v:v;d.left=(this._horizontal?this._rtl?-e:e:0)+"px",d.top=(this._horizontal?0:e)+"px";var f=g.fadeOut(b),h=g.enterContent(c,[d],{mechanism:"transition"});return a.Promise.join([f,h])},_fadeInFromCurrentValue:function(a){return d.executeTransition(a,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}});return x.datasourceCountChangedEvent="datasourcecountchanged",x.pageVisibilityChangedEvent="pagevisibilitychanged",x.pageSelectedEvent="pageselected",x.pageCompletedEvent="pagecompleted",a.Class.mix(x,a.Utilities.createEventProperties(x.datasourceCountChangedEvent,x.pageVisibilityChangedEvent,x.pageSelectedEvent,x.pageCompletedEvent)),a.Class.mix(x,a.UI.DOMEventMixin),x})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{_FlipPageManager:a.Namespace._lazy(function(){function b(b){var c=b.winControl;return c&&c instanceof a.UI.FlipView?!0:!1}function c(b){b.forEach(function(b){var c=b.target;c.winControl&&c.tabIndex>=0&&(c.winControl._pageManager._updateTabIndex(c.tabIndex),c.tabIndex=-1);var d=c.winControl;if(d&&d instanceof a.UI.FlipView){var e=!1;"dir"===b.attributeName?e=!0:"style"===b.attributeName&&(e=d._cachedStyleDir!=c.style.direction),e&&(d._cachedStyleDir=c.style.direction,d._pageManager._rtl="rtl"===window.getComputedStyle(d._pageManager._flipperDiv,null).direction,d._pageManager.resized())}})}var d=a.UI,e=a.Utilities,f=a.Utilities._uniqueID,g=e._browserStyleEquivalents,h=a.Utilities.Scheduler,i=a.UI.Animation,j=50,k=250,l={get badCurrentPage(){return a.Resources._getWinJSString("ui/badCurrentPage").value}},m=a.Class.define(function(b,f,g,h,i,j,k){this._visibleElements=[],this._flipperDiv=b,this._panningDiv=f,this._panningDivContainer=g,this._buttonVisibilityHandler=k,this._currentPage=null,this._rtl="rtl"===window.getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=h,this._itemSpacing=i,this._tabIndex=void 0!==b.tabIndex&&b.tabIndex>=0?b.tabIndex:0,b.tabIndex=-1,this._tabManager=new a.UI.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=d._FlipPageManager.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=j;var l=this;this._panningDiv.addEventListener("keydown",function(a){l._blockTabs&&a.keyCode===e.Key.tab&&(a.stopImmediatePropagation(),a.preventDefault())},!0),a.Utilities._addEventListener(this._flipperDiv,"focusin",function(b){b.target===l._flipperDiv&&l._currentPage.element&&a.Utilities._setActive(l._currentPage.element)},!1),new a.Utilities._MutationObserver(c).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._panningDiv.addEventListener("activate",function(){l._hasFocus=!0},!0),this._panningDiv.addEventListener("deactivate",function(){l._hasFocus=!1},!0),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(a.Utilities._browserEventEquivalents.manipulationStateChanged,function(a){l._manipulationState=a.currentState,0===a.currentState&&a.target===l._panningDivContainer&&(l._itemSettledOn(),l._ensureCentered())},!0)},{initialize:function(a,b){var c=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._horizontal=b,!this._currentPage){this._bufferAriaStartMarker=document.createElement("div"),this._bufferAriaStartMarker.id=f(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),c=this._currentPage,this._panningDiv.appendChild(c.pageRoot);for(var d=2*this._bufferSize,e=0;d>e;e++)c=this._createFlipPage(c,this),this._panningDiv.appendChild(c.pageRoot);this._bufferAriaEndMarker=document.createElement("div"),this._bufferAriaEndMarker.id=f(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,a)},dispose:function(){var b=this._currentPage,c=b;do a.Utilities._disposeElement(c.element),c=c.next;while(c!==b)},setOrientation:function(a){if(this._notificationsEndedSignal){var b=this;return void this._notificationsEndedSignal.promise.done(function(){b._notificationsEndedSignal=null,b.setOrientation(a)})}if(a!==this._horizontal){this._isOrientationChanging=!0,this._horizontal=a,this._forEachPage(function(a){var b=a.pageRoot.style;b.left="0px",b.top="0px"}),this._panningDivContainer.scrollLeft=0,this._panningDivContainer.scrollTop=0;var c=this._panningDivContainer.style;c.overflowX="hidden",c.overflowY="hidden";var b=this;requestAnimationFrame(function(){b._isOrientationChanging=!1,c.overflowX=b._horizontal&&b._environmentSupportsTouch?"scroll":"hidden",c.overflowY=b._horizontal||!b._environmentSupportsTouch?"hidden":"scroll",b._ensureCentered()})}},resetState:function(b){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==b){var c=this.jumpToIndex(b,!0);if(!c&&a.validation)throw new a.ErrorFromName("WinJS.UI.FlipView.BadCurrentPage",l.badCurrentPage);return c}a.Utilities.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var d=this,e=a.Promise.wrap(!0);return this._itemsManager&&(e=d._itemsManager._firstItem().then(function(a){return d._currentPage.setElement(a),d._fetchPreviousItems(!0).then(function(){return d._fetchNextItems()}).then(function(){d._setButtonStates()})})),e.then(function(){d._tabManager.childFocus=d._currentPage.element,d._ensureCentered(),d._itemSettledOn()})},setNewItemsManager:function(a,b){this._itemsManager=a;var c=this;return this.resetState(b).then(function(){0!==b&&(c._tabManager.childFocus=c._currentPage.element,c._ensureCentered(),c._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var a=0,b=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return b&&(a=this._getElementIndex(b)),a},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var a=this._viewportStart(),b=this._lastScrollPos>a?this._getTailOfBuffer():this._getHeadOfBuffer();if(a!==this._lastScrollPos){for(;this._currentPage.element&&this._itemStart(this._currentPage)>a&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(b.prev),b=b.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=a&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(b.next),b=b.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=a,this._tabManager.childFocus=this._currentPage.pageRoot,this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(a,b){var c=this;if(this._forEachPage(function(d){return d.element===b?(d===c._currentPage||d===c._currentPage.next?c._changeFlipPage(d,b,a):d.setElement(a,!0),!0):void 0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var d=this._navigationAnimationRecord.elementContainers,e=0,f=d.length;f>e;e++)d[e].element===b&&(c._changeFlipPage(d[e],b,a),d[e].element=a);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var a=this;this._forEachPage(function(b){b.pageRoot.style.width=a._panningDivContainerOffsetWidth+"px",b.pageRoot.style.height=a._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(b,c){if(!c){if(!this._itemsManager||!this._currentPage.element||0>b)return a.Promise.wrap(!1);var d=this._getElementIndex(this._currentPage.element),e=Math.abs(b-d);if(0===e)return a.Promise.wrap(!1)}var f=a.Promise.wrap(!0),g=this;return f=f.then(function(){var d=g._itemsManager._itemPromiseAtIndex(b);return a.Promise.join({element:g._itemsManager._itemFromItemPromise(d),item:d}).then(function(a){var b=a.element;return g._resetBuffer(b,c),b?(g._currentPage.setElement(b),g._fetchNextItems().then(function(){return g._fetchPreviousItems(!0)}).then(function(){return!0})):!1})}),f=f.then(function(a){return g._setButtonStates(),a})},startAnimatedNavigation:function(b,c,d){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var e=this._currentPage,g=b?this._currentPage.next:this._currentPage.prev;if(g.element){this._hasFocus&&a.Utilities._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=b,this._navigationAnimationRecord.cancelAnimationCallback=c,this._navigationAnimationRecord.completionCallback=d,this._navigationAnimationRecord.oldCurrentPage=e,this._navigationAnimationRecord.newCurrentPage=g;var h=e.element,i=g.element;this._navigationAnimationRecord.newCurrentElement=i,e.setElement(null,!0),e.elementUniqueID=f(h),g.setElement(null,!0),g.elementUniqueID=f(i);var j=this._createDiscardablePage(h),k=this._createDiscardablePage(i);return j.pageRoot.itemIndex=this._getElementIndex(h),k.pageRoot.itemIndex=j.pageRoot.itemIndex+(b?1:-1),j.pageRoot.style.position="absolute",k.pageRoot.style.position="absolute",j.pageRoot.style.zIndex=1,k.pageRoot.style.zIndex=2,this._itemStart(j,0,0),this._itemStart(k,0,0),this._blockTabs=!0,this._visibleElements.push(i),this._announceElementVisible(i),this._navigationAnimationRecord.elementContainers=[j,k],{outgoing:j,incoming:k}}}return null},endAnimatedNavigation:function(a,b,c){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var d=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,b);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,c),d||this._viewportStart(this._itemStart(a?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(b,c,d){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._currentPage.element){var e=this._currentPage.element,g=this._getElementIndex(e),h=this;return h.jumpToIndex(b).then(function(a){if(!a)return null;if(h._navigationAnimationRecord={},h._navigationAnimationRecord.cancelAnimationCallback=c,h._navigationAnimationRecord.completionCallback=d,h._navigationAnimationRecord.oldCurrentPage=null,h._forEachPage(function(a){return a.element===e?(h._navigationAnimationRecord.oldCurrentPage=a,!0):void 0}),h._navigationAnimationRecord.newCurrentPage=h._currentPage,h._navigationAnimationRecord.newCurrentPage===h._navigationAnimationRecord.oldCurrentPage)return null;var i=h._currentPage.element;h._navigationAnimationRecord.newCurrentElement=i,h._currentPage.setElement(null,!0),h._currentPage.elementUniqueID=f(i),h._navigationAnimationRecord.oldCurrentPage&&h._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var j=h._createDiscardablePage(e),k=h._createDiscardablePage(i);return j.pageRoot.itemIndex=g,k.pageRoot.itemIndex=b,j.pageRoot.style.position="absolute",k.pageRoot.style.position="absolute",j.pageRoot.style.zIndex=1,k.pageRoot.style.zIndex=2,h._itemStart(j,0,0),h._itemStart(k,h._itemSize(h._currentPage),0),h._visibleElements.push(i),h._announceElementVisible(i),h._navigationAnimationRecord.elementContainers=[j,k],h._blockTabs=!0,{oldPage:j,newPage:k}})}return a.Promise.wrap(null)},endAnimatedJump:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(a.element,!0):a.element.parentNode&&a.element.parentNode.removeChild(a.element),this._navigationAnimationRecord.newCurrentPage.setElement(b.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(a,b,c,d){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var e=this._prevMarker,g=!1,h=!1;if(d&&(this._createAnimationRecord(f(a),null),this._getAnimationRecord(a).inserted=!0),b){do{if(e===this._currentPage&&(g=!0),e.elementUniqueID===f(b)){h=!0;var i,j=e,k=a,l=f(a);if(g)for(;j.next!==this._prevMarker;)i=j.next.element,l=j.next.elementUniqueID,j.next.setElement(k,!0),!k&&l&&(j.next.elementUniqueID=l),k=i,j=j.next;else for(e.elementUniqueID===e.next.elementUniqueID&&e.elementUniqueID&&(j=e.next);j.next!==this._prevMarker;)i=j.element,l=j.elementUniqueID,j.setElement(k,!0),!k&&l&&(j.elementUniqueID=l),k=i,j=j.prev;if(k){var m=!1;this._forEachPage(function(a){return f(k)===a.elementUniqueID?(m=!0,!0):void 0}),m||this._releaseElementIfNotAnimated(k)}break}e=e.next}while(e!==this._prevMarker)}else if(c){for(;e.next!==this._prevMarker&&e.elementUniqueID!==f(c);)e===this._currentPage&&(g=!0),e=e.next;e.elementUniqueID===f(c)&&e!==this._prevMarker?(e.prev.setElement(a),h=!0):this._releaseElementIfNotAnimated(a)}else this._currentPage.setElement(a);this._getAnimationRecord(a).successfullyMoved=h,this._setButtonStates()},changed:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var c=(this._prevMarker,this);if(this._forEachPage(function(d){if(d.elementUniqueID===f(b)){var e=c._animationRecords[d.elementUniqueID];return e.changed=!0,e.oldElement=b,e.newElement=a,d.element=a,d.elementUniqueID=f(a),c._animationRecords[f(a)]=e,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var d=0,e=this._navigationAnimationRecord.elementContainers.length;e>d;d++){var g=this._navigationAnimationRecord.elementContainers[d];g&&g.elementUniqueID===f(b)&&(g.element=a,g.elementUniqueID=f(a))}var h=this._navigationAnimationRecord.newCurrentElement;h&&f(h)===f(b)&&(this._navigationAnimationRecord.newCurrentElement=a)}},moved:function(a,b,c){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var d=this._getAnimationRecord(a);d||(d=this._createAnimationRecord(f(a))),d.moved=!0,this.removed(a,!1,!1),b||c?this.inserted(a,b,c,!1):d.successfullyMoved=!1},removed:function(b,c,d){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var e=this,g=this._prevMarker,h=a.Promise.wrap();if(c){var i=!1;return this._forEachPage(function(a){(a.elementUniqueID===f(b)||i)&&(a.setElement(null,!0),i=!0)}),void this._setButtonStates()}if(d){var j=this._getAnimationRecord(b);j&&(j.removed=!0)}if(this._currentPage.elementUniqueID===f(b))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(g.elementUniqueID===f(b))g.next.element?h=this._itemsManager._previousItem(g.next.element).then(function(a){return a===b&&(a=e._itemsManager._previousItem(a)),a}).then(function(a){g.setElement(a,!0)}):g.setElement(null,!0);else if(g.prev.elementUniqueID===f(b))g.prev.prev&&g.prev.prev.element?h=this._itemsManager._nextItem(g.prev.prev.element).then(function(a){return a===b&&(a=e._itemsManager._nextItem(a)),a}).then(function(a){g.prev.setElement(a,!0)}):g.prev.setElement(null,!0);else{for(var k=this._currentPage.prev,l=!1;k!==g&&!l;)k.elementUniqueID===f(b)&&(this._shiftRight(k),l=!0),k=k.prev;for(k=this._currentPage.next;k!==g&&!l;)k.elementUniqueID===f(b)&&(this._shiftLeft(k),l=!0),k=k.next}return h.then(function(){e._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(a){this._itemSpacing=a,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new a._Signal,this._temporaryKeys=[],this._animationRecords={};var b=this;this._forEachPage(function(a){b._createAnimationRecord(a.elementUniqueID,a)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var b=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function c(a){var c=null;return b._forEachPage(function(b){return b.element===a?(c=b,!0):void 0}),c}function d(a,c){b._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var d=b._createDiscardablePage(c);b._itemStart(d,a.originalLocation),g.push(b._deleteFlipPage(d))}function e(a,d){b._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var e,f=a.originalLocation;if(a.successfullyMoved)e=c(d),f=a.newLocation;else{e=b._createDiscardablePage(d);var h=b._getElementIndex(d),i=b._currentPage.element?b._getElementIndex(b._currentPage.element):0;f+=i>h?-100*b._bufferSize:100*b._bufferSize}e&&(b._itemStart(e,a.originalLocation),g.push(b._moveFlipPage(e,function(){b._itemStart(e,f)})))}function f(){return 0===g.length&&g.push(a.Promise.wrap()),a.Promise.join(g)}var g=[];b._forEachPage(function(a){var c=b._getAnimationRecord(a.element);c&&(c.changed&&(c.oldElement.removedFromChange=!0,g.push(b._changeFlipPage(a,c.oldElement,c.newElement))),c.newLocation=a.location,b._itemStart(a,c.originalLocation),c.inserted&&(a.elementRoot.style.opacity=0))});var h=b._animationRecords.currentPage,i=b._getAnimationRecord(h),j=b._animationRecords.nextPage,k=b._getAnimationRecord(j);i&&i.changed&&(h=i.newElement),k&&k.changed&&(j=k.newElement),(h!==b._currentPage.element||j!==b._currentPage.next.element)&&(i&&i.removed&&d(i,h),k&&k.removed&&d(k,j)),b._blockTabs=!0,f().then(function(){g=[],i&&i.moved&&e(i,h),k&&k.moved&&e(k,j);var a=b._getAnimationRecord(b._currentPage.element),c=b._getAnimationRecord(b._currentPage.next.element);b._forEachPage(function(d){var e=b._getAnimationRecord(d.element);e&&(e.inserted?e!==a&&e!==c&&(d.elementRoot.style.opacity=1):e.originalLocation!==e.newLocation&&(e!==i&&e!==k||e===i&&!i.moved||e===k&&!k.moved)&&g.push(b._moveFlipPage(d,function(){b._itemStart(d,e.newLocation)})))}),f().then(function(){g=[],a&&a.inserted&&g.push(b._insertFlipPage(b._currentPage)),c&&c.inserted&&g.push(b._insertFlipPage(b._currentPage.next)),f().then(function(){b._checkElementVisibility(!1),b._itemSettledOn(),b._setListEnds(),b._notificationsStarted--,0===b._notificationsStarted&&b._notificationsEndedSignal.complete(),b._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),b._logBuffer(),b._endNotificationsWork=null})})})})},_timeoutPageSelection:function(){var b=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=a.Promise.timeout(k).then(function(){b._itemSettledOn()})},_updateTabIndex:function(a){this._forEachPage(function(b){b.element&&(b.element.tabIndex=a)}),this._tabIndex=a,this._tabManager.tabIndex=a},_releaseElementIfNotAnimated:function(a){var b=this._getAnimationRecord(a);b&&(b.changed||b.inserted||b.moved||b.removed)||this._itemsManager.releaseItem(a)},_getAnimationRecord:function(a){return a?this._animationRecords[f(a)]:null},_createAnimationRecord:function(a,b){if(a){var c=this._animationRecords[a]={removed:!1,changed:!1,inserted:!1};return b&&(c.originalLocation=b.location),c}},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark(b),a.UI.FlipView._enabledDebug&&a.log&&a.log(b,null,"flipviewdebug")},_getElementIndex:function(a){var b=0;try{b=this._itemsManager.itemObject(a).index}catch(c){}return b},_resetBuffer:function(a,b){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var c=this._currentPage,d=c;do d.element&&d.element===a||b?d.setElement(null,!0):d.setElement(null),d=d.next;while(d!==c)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var b=this._createFlipPage(a,this);return this._panningDiv.appendChild(b.pageRoot),b},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var b=a.Promise.wrap(this._currentPage),c=this,d=0;d<this._bufferSize;d++)b=b.then(function(a){return a.next===c._prevMarker&&c._insertNewFlipPage(a),a.element?c._itemsManager._nextItem(a.element).then(function(b){return a.next.setElement(b),a.next}):(a.next.setElement(null),a.next)});return b},_fetchOneNext:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var b=a.prev.element;if(this._prevMarker===a&&(this._prevMarker=this._prevMarker.next),!b)return void a.setElement(null);var c=this;return this._itemsManager._nextItem(b).then(function(b){a.setElement(b),c._movePageAhead(a.prev,a)})},_fetchPreviousItems:function(b){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var c=this,d=a.Promise.wrap(this._currentPage),e=0;e<this._bufferSize;e++)d=d.then(function(a){return a.element?c._itemsManager._previousItem(a.element).then(function(b){return a.prev.setElement(b),a.prev}):(a.prev.setElement(null),a.prev)});return d.then(function(a){b&&(c._prevMarker=a)})},_fetchOnePrevious:function(b){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var c=b.next.element;if(this._prevMarker===b.next&&(this._prevMarker=this._prevMarker.prev),!c)return b.setElement(null),a.Promise.wrap();var d=this;return this._itemsManager._previousItem(c).then(function(a){b.setElement(a),d._movePageBehind(b.next,b)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._itemStart(this._currentPage,j*this._viewportSize());for(var b=this._currentPage;b!==this._prevMarker;)this._movePageBehind(b,b.prev),b=b.prev;for(b=this._currentPage;b.next!==this._prevMarker;)this._movePageAhead(b,b.next),b=b.next;var c=!1;this._lastScrollPos&&!a&&(this._setListEnds(),c=!0),this._lastScrollPos=this._itemStart(this._currentPage),this._viewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),c||this._setListEnds()},_ensureBufferConsistency:function(){var b=this,c=this._currentPage.element;if(!c)return a.Promise.wrap();var d=!1,e={},f={};this._forEachPage(function(a){if(a&&a.elementUniqueID){if(e[a.elementUniqueID])return d=!0,!0;if(e[a.elementUniqueID]=!0,a.location>0){if(f[a.location])return d=!0,!0;f[a.location]=!0}}});var g=Object.keys(this._animationRecords);return g.forEach(function(a){var c=b._animationRecords[a];c&&(c.changed||c.inserted||c.moved||c.removed)&&(d=!0)}),d?(this._resetBuffer(null,!0),this._currentPage.setElement(c),this._fetchNextItems().then(function(){return b._fetchPreviousItems(!0)}).then(function(){b._ensureCentered()})):a.Promise.wrap()},_shiftLeft:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var b=a,c=null;b!==this._prevMarker&&b.next!==this._prevMarker;)c=b.next.element,!c&&b.next.elementUniqueID&&(b.elementUniqueID=b.next.elementUniqueID),b.next.setElement(null,!0),b.setElement(c,!0),b=b.next;if(b!==this._prevMarker&&b.prev.element){var d=this;return this._itemsManager._nextItem(b.prev.element).then(function(a){b.setElement(a),d._createAnimationRecord(b.elementUniqueID,b)})}},_logBuffer:function(){if(a.UI.FlipView._enabledDebug){a.log&&a.log(this._currentPage.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"	"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),a.log&&a.log(this._currentPage.next.next.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"	"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),a.log&&a.log("> "+this._currentPage.elementUniqueID+"	@:"+this._currentPage.location+(this._currentPage.element?"	"+this._currentPage.element.textContent:""),null,"flipviewdebug"),a.log&&a.log(this._currentPage.next.elementUniqueID+"	@:"+this._currentPage.next.location+(this._currentPage.next.element?"	"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),a.log&&a.log(this._currentPage.next.next.elementUniqueID+"	@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"	"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var b=Object.keys(this._itemsManager._elementMap),c=[];this._forEachPage(function(a){a&&a.elementUniqueID&&c.push(a.elementUniqueID)}),a.log&&a.log("itemsmanager  = ["+b.join(" ")+"] flipview ["+c.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(a){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var b=a,c=null;b!==this._prevMarker;)c=b.prev.element,!c&&b.prev.elementUniqueID&&(b.elementUniqueID=b.prev.elementUniqueID),b.prev.setElement(null,!0),b.setElement(c,!0),b=b.prev;if(b.next.element){var d=this;return this._itemsManager._previousItem(b.next.element).then(function(a){b.setElement(a),d._createAnimationRecord(b.elementUniqueID,b)})}},_checkElementVisibility:function(a){var b,c;if(a){var d=this._currentPage.element;for(b=0,c=this._visibleElements.length;c>b;b++)this._visibleElements[b]!==d&&this._announceElementInvisible(this._visibleElements[b]);this._visibleElements=[],d&&(this._visibleElements.push(d),this._announceElementVisible(d))
}else{for(b=0,c=this._visibleElements.length;c>b;b++)(!this._visibleElements[b].parentNode||this._visibleElements[b].removedFromChange)&&this._announceElementInvisible(this._visibleElements[b]);this._visibleElements=[];var e=this;this._forEachPage(function(a){var b=a.element;b&&(e._itemInView(a)?(e._visibleElements.push(b),e._announceElementVisible(b)):e._announceElementInvisible(b))})}},_announceElementVisible:function(a){if(a&&!a.visible){a.visible=!0;var b=document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),b.initCustomEvent(d.FlipView.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),a.dispatchEvent(b)}},_announceElementInvisible:function(a){if(a&&a.visible){a.visible=!1;var b=!1;a.parentNode||(b=!0,this._panningDivContainer.appendChild(a));var c=document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),c.initCustomEvent(d.FlipView.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),a.dispatchEvent(c),b&&this._panningDivContainer.removeChild(a)}},_createDiscardablePage:function(a){var b=this._createPageContainer(),c={pageRoot:b.root,elementRoot:b.elementContainer,discardable:!0,element:a,elementUniqueID:f(a),discard:function(){c.pageRoot.parentNode&&c.pageRoot.parentNode.removeChild(c.pageRoot),c.element.parentNode&&c.element.parentNode.removeChild(c.element)}};return c.pageRoot.style.top="0px",c.elementRoot.appendChild(a),this._panningDiv.appendChild(c.pageRoot),c},_createPageContainer:function(){var a=this._panningDivContainerOffsetWidth,b=this._panningDivContainerOffsetHeight,c=document.createElement("div"),d=c.style,e=document.createElement("div");return e.className="win-item",d.position="absolute",d.overflow="hidden",d.width=a+"px",d.height=b+"px",c.appendChild(e),{root:c,elementContainer:e}},_createFlipPage:function(c,d){var g={};g.element=null,g.elementUniqueID=null,c?(g.prev=c,g.next=c.next,g.next.prev=g,c.next=g):(g.next=g,g.prev=g);var h=this._createPageContainer();return g.elementRoot=h.elementContainer,g.elementRoot.style.msOverflowStyle="auto",g.pageRoot=h.root,g.setElement=function(c,h){if(void 0===c&&(c=null),c===g.element)return void(c||(g.elementUniqueID=null));if(g.element&&(h||(d._itemsManager.releaseItem(g.element),a.Utilities._disposeElement(g.element))),g.element=c,g.elementUniqueID=c?f(c):null,e.empty(g.elementRoot),g.element){if(!b(g.element)){g.element.tabIndex=d._tabIndex,g.element.setAttribute("role","option"),g.element.setAttribute("aria-selected",!1),g.element.id||(g.element.id=f(g.element));var i=function(a,b,c){a.setAttribute(c,b.id)},j=!g.next.element||g===d._prevMarker.prev;j&&(i(g.element,d._bufferAriaEndMarker,"aria-flowto"),i(d._bufferAriaEndMarker,g.element,"x-ms-aria-flowfrom")),g!==d._prevMarker&&g.prev.element&&(i(g.prev.element,g.element,"aria-flowto"),i(g.element,g.prev.element,"x-ms-aria-flowfrom")),g.next!==d._prevMarker&&g.next.element&&(i(g.element,g.next.element,"aria-flowto"),i(g.next.element,g.element,"x-ms-aria-flowfrom")),g.prev.element||i(g.element,d._bufferAriaStartMarker,"x-ms-aria-flowfrom")}g.elementRoot.appendChild(g.element)}},g},_itemInView:function(a){return this._itemEnd(a)>this._viewportStart()&&this._itemStart(a)<this._viewportEnd()},_viewportStart:function(a){if(this._panningDivContainer.parentNode)if(this._horizontal){if(void 0===a)return this._panningDivContainer.scrollLeft;this._panningDivContainer.scrollLeft=a}else{if(void 0===a)return this._panningDivContainer.scrollTop;this._panningDivContainer.scrollTop=a}},_viewportEnd:function(){var a=this._panningDivContainer;return this._horizontal?this._rtl?this._viewportStart()+this._panningDivContainerOffsetWidth:a.scrollLeft+this._panningDivContainerOffsetWidth:a.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._horizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_itemStart:function(a,b){return void 0===b?a.location:(this._horizontal?a.pageRoot.style.left=(this._rtl?-b:b)+"px":a.pageRoot.style.top=b+"px",void(a.location=b))},_itemEnd:function(a){return(this._horizontal?a.location+this._panningDivContainerOffsetWidth:a.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._horizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(a,b){var c=this._itemSize(a)+this._itemSpacing;this._itemStart(b,this._itemStart(a)+c)},_movePageBehind:function(a,b){var c=this._itemSize(a)+this._itemSpacing;this._itemStart(b,this._itemStart(a)-c)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var a=this._panningDivContainer.style;a[g["scroll-snap-type"].scriptName]="mandatory";var b=this._viewportSize(),c=b+this._itemSpacing,d="scroll-snap-points",e=0,f=this._itemStart(this._currentPage);e=f%(b+this._itemSpacing),a[g[this._horizontal?d+"-x":d+"-y"].scriptName]="snapInterval("+e+"px, "+c+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var a=this._panningDivContainer.style,b=0,c=0,d=this._getTailOfBuffer(),e=this._getHeadOfBuffer(),f=g["scroll-limit-"+(this._horizontal?"x-min":"y-min")].scriptName,h=g["scroll-limit-"+(this._horizontal?"x-max":"y-max")].scriptName;!e.element&&(e=e.prev,e!=this._prevMarker.prev););for(;!d.element&&(d=d.next,d!=this._prevMarker););c=this._itemStart(e),b=this._itemStart(d),a[f]=b+"px",a[h]=c+"px"}},_viewportOnItemStart:function(){return this._itemStart(this._currentPage)===this._viewportStart()},_restoreAnimatedElement:function(a,b){var c=!0;return a.elementUniqueID!==f(b.element)||a.element?this._forEachPage(function(a){a.elementUniqueID!==b.elementUniqueID||a.element||(a.setElement(b.element,!0),c=!1)}):(a.setElement(b.element,!0),c=!1),c},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var c=this;a.Utilities._setImmediate(function(){c._viewportOnItemStart()&&(c._blockTabs=!1,c._currentPage.element&&(c._hasFocus&&(a.Utilities._setActive(c._currentPage.element),c._tabManager.childFocus=c._currentPage.element),c._lastSelectedElement!==c._currentPage.element&&(c._lastSelectedPage&&c._lastSelectedPage.element&&!b(c._lastSelectedPage.element)&&c._lastSelectedPage.element.setAttribute("aria-selected",!1),c._lastSelectedPage=c._currentPage,c._lastSelectedElement=c._currentPage.element,b(c._currentPage.element)||c._currentPage.element.setAttribute("aria-selected",!0),h.schedule(function(){if(c._currentPage.element){var a=document.createEvent("CustomEvent");a.initCustomEvent(d.FlipView.pageSelectedEvent,!0,!1,{source:c._flipperDiv}),c._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),c._currentPage.element.dispatchEvent(a);var b=c._currentPage.element;if(b){var e=c._itemsManager._recordFromElement(b,!0);e&&e.renderComplete.then(function(){b===c._currentPage.element&&(c._currentPage.element.setAttribute("aria-setsize",c._cachedSize),c._currentPage.element.setAttribute("aria-posinset",c.currentIndex()+1),c._bufferAriaStartMarker.setAttribute("aria-flowto",c._currentPage.element.id),a=document.createEvent("CustomEvent"),a.initCustomEvent(d.FlipView.pageCompletedEvent,!0,!1,{source:c._flipperDiv}),c._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),c._currentPage.element.dispatchEvent(a))})}}},h.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent"))))})},_forEachPage:function(a){for(var b=!0,c=this._prevMarker;b&&!a(c);)c=c.next,b=c!==this._prevMarker},_changeFlipPage:function(a,b,c){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),a.element=null,a.setElement?a.setElement(c,!0):(b.parentNode.removeChild(b),a.elementRoot.appendChild(c));var d=b.style;return d.position="absolute",d.left="0px",d.top="0px",d.opacity=1,a.pageRoot.appendChild(b),b.style.left=Math.max(0,(a.pageRoot.offsetWidth-b.offsetWidth)/2)+"px",b.style.top=Math.max(0,(a.pageRoot.offsetHeight-b.offsetHeight)/2)+"px",i.fadeOut(b).then(function(){b.parentNode&&b.parentNode.removeChild(b)})},_deleteFlipPage:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:_deleteFlipPage,info"),b.elementRoot.style.opacity=0;var c=i.createDeleteFromListAnimation([b.elementRoot]),d=this;return c.execute().then(function(){b.discardable&&(b.discard(),d._itemsManager.releaseItem(b.element))})},_insertFlipPage:function(b){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:_insertFlipPage,info"),b.elementRoot.style.opacity=1;var c=i.createAddToListAnimation([b.elementRoot]);return c.execute().then(function(){b.discardable&&b.discard()})},_moveFlipPage:function(b,c){a.Utilities._writeProfilerMark("WinJS.UI.FlipView:_moveFlipPage,info");var d=i.createRepositionAnimation(b.pageRoot);c();var e=this;return d.execute().then(function(){if(b.discardable){b.discard();var a=e._getAnimationRecord(b.element);a&&!a.successfullyMoved&&e._itemsManager.releaseItem(b.element)}})}},{supportedForProcessing:!1});return m.flipPageBufferCount=2,m})})}(WinJS),function(a,b){"use strict";var c=b.Utilities._browserStyleEquivalents.transform.scriptName;b.Namespace.define("WinJS.UI",{_getCursorPos:function(a){var b=document.documentElement;return{left:a.clientX+("rtl"===document.body.dir?-b.scrollLeft:b.scrollLeft),top:a.clientY+b.scrollTop}},_getElementsByClasses:function(a,b){for(var c=[],d=0,e=b.length;e>d;d++){var f=a.querySelector("."+b[d]);f&&c.push(f)}return c},_SelectionMode:b.Namespace._lazy(function(){function a(a,b,c){return Math.max(a,Math.min(b,c))}function d(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:b.index,oldFocusType:b.type,newFocus:c.index,newFocusType:c.type}),a.dispatchEvent(d)}var e=b.Utilities,f=b.Promise,g=(b.UI.Animation,function(a){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},this._pressedPosition=null,this.initialize(a)});return g.prototype={_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(a){function c(b,c){var d=function(c){return a._view.getAdjacent(c,b)};return d.clampToBounds=c,d}this.site=a,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var d=this.site,f=this;this._itemEventsHandler=new b.UI._ItemEventsHandler(Object.create({containerFromElement:function(a){return d._view.items.containerFrom(a)},indexForItemElement:function(a){return d._view.items.index(a)},indexForHeaderElement:function(a){return d._groups.index(a)},itemBoxAtIndex:function(a){return d._view.items.itemBoxAt(a)},itemAtIndex:function(a){return d._view.items.itemAt(a)},headerAtIndex:function(a){return d._groups.group(a).header},headerFromElement:function(a){return d._groups.headerFrom(a)},containerAtIndex:function(a){return d._view.items.containerAt(a)},isZombie:function(){return d._isZombie()},getItemPosition:function(a){return d._getItemPosition(a)},rtl:function(){return d._rtl()},fireInvokeEvent:function(a,b){return f._fireInvokeEvent(a,b)},verifySelectionAllowed:function(a){return f._verifySelectionAllowed(a)},changeFocus:function(a,b,c,e,f){return d._changeFocus(a,b,c,e,f)},selectRange:function(a,b,c){return f._selectRange(a,b,c)}},{pressedEntity:{enumerable:!0,get:function(){return f._pressedEntity},set:function(a){f._pressedEntity=a}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return f._pressedContainerScaleTransform},set:function(a){f._pressedContainerScaleTransform=a}},pressedContainer:{enumerable:!0,get:function(){return f._pressedContainer},set:function(a){f._pressedContainer=a}},pressedItemBox:{enumerable:!0,get:function(){return f._pressedItemBox},set:function(a){f._pressedItemBox=a}},pressedHeader:{enumerable:!0,get:function(){return f._pressedHeader},set:function(a){return f._pressedHeader=a}},pressedPosition:{enumerable:!0,get:function(){return f._pressedPosition},set:function(a){f._pressedPosition=a}},pressedElement:{enumerable:!0,set:function(a){f._pressedElement=a}},swipeBehavior:{enumerable:!0,get:function(){return d._swipeBehavior}},eventHandlerRoot:{enumerable:!0,get:function(){return d._viewport}},selectionMode:{enumerable:!0,get:function(){return d._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return b.UI._itemClass}},canvasProxy:{enumerable:!0,get:function(){return d._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return d._tap}},headerTapBehavior:{enumerable:!0,get:function(){return d._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return d.itemsDraggable||d.itemsReorderable}},selection:{enumerable:!0,get:function(){return d._selection}},horizontal:{enumerable:!0,get:function(){return d._horizontal()}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var g=e.Key;this._keyboardNavigationHandlers[g.upArrow]=c(g.upArrow),this._keyboardNavigationHandlers[g.downArrow]=c(g.downArrow),this._keyboardNavigationHandlers[g.leftArrow]=c(g.leftArrow),this._keyboardNavigationHandlers[g.rightArrow]=c(g.rightArrow),this._keyboardNavigationHandlers[g.pageUp]=c(g.pageUp,!0),this._keyboardNavigationHandlers[g.pageDown]=c(g.pageDown,!0),this._keyboardNavigationHandlers[g.home]=function(a){return b.Promise.wrap({type:a.type,index:0})},this._keyboardNavigationHandlers[g.end]=function(a){return a.type===b.UI.ObjectType.groupHeader?b.Promise.wrap({type:a.type,index:d._groups.length()-1}):f.site._view.finalItem().then(function(b){return{type:a.type,index:b}},function(a){return b.Promise.wrapError(a)})},this._keyboardAcceleratorHandlers[g.a]=function(){f.site._multiSelection()&&f._selectAll()}},staticMode:function(){return this.site._tap===b.UI.TapBehavior.none&&this.site._selectionMode===b.UI.SelectionMode.none},itemUnrealized:function(a,c){if(this._pressedEntity.type!==b.UI.ObjectType.groupHeader&&(this._pressedEntity.index===a&&this._resetPointerDownState(),this._itemBeingDragged(a)))for(var d=this._draggedItemBoxes.length-1;d>=0;d--)this._draggedItemBoxes[d]===c&&(e.removeClass(c,b.UI._dragSourceClass),this._draggedItemBoxes.splice(d,1))},_fireInvokeEvent:function(a,c){function d(b,d){var f=b.createListBinding(),g=f.fromIndex(a.index),h=d?"groupheaderinvoked":"iteminvoked";g.done(function(){f.release()});var i=document.createEvent("CustomEvent");i.initCustomEvent(h,!0,!0,d?{groupHeaderPromise:g,groupHeaderIndex:a.index}:{itemPromise:g,itemIndex:a.index}),c.dispatchEvent(i)&&e.site._defaultInvoke(a)}if(c){var e=this;a.type===b.UI.ObjectType.groupHeader?this.site._groupHeaderTap===b.UI.GroupHeaderTapBehavior.invoke&&a.index!==b.UI._INVALID_INDEX&&d(this.site.groupDataSource,!0):this.site._tap!==b.UI.TapBehavior.none&&a.index!==b.UI._INVALID_INDEX&&d(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(a){if(a.type===b.UI.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var c=a.index,d=this.site,g=this.site._view.items.itemAt(c);if(!d._selectionAllowed()||!d._selectOnTap()&&d._swipeBehavior!==b.UI.SwipeBehavior.select||g&&e.hasClass(g,b.UI._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var h=d._selection._isIncluded(c),i=!d._multiSelection(),j=d._selection._cloneSelection();h?i?j.clear():j.remove(c):i?j.set(c):j.add(c);var k,l=document.createEvent("CustomEvent"),m=f.wrap(),n=!1,o=!1;l.initCustomEvent("selectionchanging",!0,!0,{newSelection:j,preventTapBehavior:function(){o=!0},setPromise:function(a){m=a}});var p=d._element.dispatchEvent(l);m.then(function(){n=!0,k=j._isIncluded(c),j.clear()});var q=p&&n&&(h||k);return{canSelect:q,canTapSelect:q&&!o}},_containedInElementWithClass:function(a,b){if(a.parentNode)for(var c=a.parentNode.querySelectorAll("."+b+", ."+b+" *"),d=0,e=c.length;e>d;d++)if(c[d]===a)return!0;return!1},_isDraggable:function(a){return!this._containedInElementWithClass(a,b.UI._nonDraggableClass)},_isInteractive:function(a){return this._containedInElementWithClass(a,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onMSManipulationStateChanged:function(a){this._itemEventsHandler.onMSManipulationStateChanged(a)},onPointerDown:function(a){this._itemEventsHandler.onPointerDown(a)},onclick:function(a){this._itemEventsHandler.onClick(a)},onPointerUp:function(a){this._itemEventsHandler.onPointerUp(a)},onPointerCancel:function(a){this._itemEventsHandler.onPointerCancel(a)},onLostPointerCapture:function(a){this._itemEventsHandler.onLostPointerCapture(a)},onContextMenu:function(a){this._itemEventsHandler.onContextMenu(a)},onMSHoldVisual:function(a){this._itemEventsHandler.onMSHoldVisual(a)},onDataChanged:function(a){this._itemEventsHandler.onDataChanged(a)},_removeTransform:function(a,b){b&&-1!==a.style[c].indexOf(b)&&(a.style[c]=a.style[c].replace(b,""))},_selectAll:function(){var a=[];this.site._view.items.each(function(c,d){d&&e.hasClass(d,b.UI._nonSelectableClass)&&a.push(c)}),this.site._selection.selectAll(),a.length>0&&this.site._selection.remove(a)},_selectRange:function(a,c,d){for(var f=[],g=-1,h=a;c>=h;h++){var i=this.site._view.items.itemAt(h);i&&e.hasClass(i,b.UI._nonSelectableClass)?-1!==g&&(f.push({firstIndex:g,lastIndex:h-1}),g=-1):-1===g&&(g=h)}-1!==g&&f.push({firstIndex:g,lastIndex:c}),f.length>0&&this.site._selection[d?"add":"set"](f)},onDragStart:function(a){if(this._pressedEntity={type:b.UI.ObjectType.item,index:this.site._view.items.index(a.target)},this.site._selection._pivot=b.UI._INVALID_INDEX,this._pressedEntity.index===b.UI._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(a.target)||this._pressedElement&&this._isInteractive(this._pressedElement))a.preventDefault();else{this._dragging=!0,this._dragDataTransfer=a.dataTransfer,this._pressedPosition=b.UI._getCursorPos(a),this._dragInfo=null,this._lastEnteredElement=a.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new b.UI._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var c=this.site.itemsReorderable,d=document.createEvent("CustomEvent");if(d.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:a.dataTransfer,dragInfo:this._dragInfo}),a.dataTransfer.setData("text",""),a.dataTransfer.setDragImage){var f=this.site._view.items.itemDataAt(this._pressedEntity.index);if(f&&f.container){var g=f.container.getBoundingClientRect();a.dataTransfer.setDragImage(f.container,a.clientX-g.left,a.clientY-g.top)}}this.site.element.dispatchEvent(d),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(a.dataTransfer)&&(c=!0,this._dragUnderstood=!0)),c&&(this._addedDragOverClass=!0,e.addClass(this.site._element,b.UI._dragOverClass)),this._draggedItemBoxes=[];var h=this,i=a.target;i.addEventListener("dragend",function j(a){i.removeEventListener("dragend",j),h.onDragEnd(a)}),b.Utilities._yieldForDomModification(function(){if(h._dragging)for(var a=h._dragInfo.getIndices(),b=0,c=a.length;c>b;b++){var d=h.site._view.items.itemDataAt(a[b]);d&&d.itemBox&&h._addDragSourceClass(d.itemBox)}})}},onDragEnter:function(a){var c=this._dragUnderstood;this._lastEnteredElement=a.target,this._exitEventTimer&&(clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(a.dataTransfer)&&(c=!0),(c||this._dragging&&this.site.itemsReorderable)&&(a.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,e.addClass(this.site._element,b.UI._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(a){a.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(a)},_fireDragEnterEvent:function(a){var b=document.createEvent("CustomEvent");b.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:a});var c=!this.site.element.dispatchEvent(b);return this._firedDragEnter=!0,c},_fireDragBetweenEvent:function(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("itemdragbetween",!0,!0,{index:a,insertAfterIndex:b,dataTransfer:c}),this.site.element.dispatchEvent(d)},_fireDropEvent:function(a,b,c){var d=document.createEvent("CustomEvent");return d.initCustomEvent("itemdragdrop",!0,!0,{index:a,insertAfterIndex:b,dataTransfer:c}),this.site.element.dispatchEvent(d)},_handleExitEvent:function(){this._exitEventTimer&&(clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var a=this;this._exitEventTimer=setTimeout(function(){if(a._pointerLeftRegion){if(a.site._layout.dragLeave&&a.site._layout.dragLeave(),a._pointerLeftRegion=!1,a._dragUnderstood=!1,a._lastEnteredElement=null,a._lastInsertPoint=null,a._dragBetweenDisabled=!1,a._firedDragEnter){var c=document.createEvent("CustomEvent");c.initCustomEvent("itemdragleave",!0,!1,{}),a.site.element.dispatchEvent(c),a._firedDragEnter=!1}a._addedDragOverClass&&(a._addedDragOverClass=!1,e.removeClass(a.site._element,b.UI._dragOverClass)),a._exitEventTimer=0,a._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(a,b){var c={left:0,top:0};try{c=a.getBoundingClientRect()}catch(d){}var e=window.getComputedStyle(a,null),f=parseInt(e.paddingLeft),g=parseInt(e.paddingTop),h=parseInt(e.borderLeftWidth),i=parseInt(e.borderTopWidth),j=b.clientX,k=b.clientY,l={x:+j===j?j-c.left-f-h:0,y:+k===k?k-c.top-g-i:0};return this.site._rtl()&&(l.x=c.right-c.left-l.x),l},_getPositionInCanvasSpace:function(a){var b=this.site._horizontal()?this.site.scrollPosition:0,c=this.site._horizontal()?0:this.site.scrollPosition,d=this._getEventPositionInElementSpace(this.site.element,a);return{x:d.x+b,y:d.y+c}},_itemBeingDragged:function(a){return this._dragging?this._draggingUnselectedItem&&this._dragInfo._isIncluded(a)||!this._draggingUnselectedItem&&this.site._isSelected(a):!1},_addDragSourceClass:function(a){this._draggedItemBoxes.push(a),e.addClass(a,b.UI._dragSourceClass),a.parentNode&&e.addClass(a.parentNode,b.UI._footprintClass)},renderDragSourceOnRealizedItem:function(a,b){this._itemBeingDragged(a)&&this._addDragSourceClass(b)},onDragOver:function(b){if(this._dragUnderstood){this._pointerLeftRegion=!1,b.preventDefault();var c=this._getPositionInCanvasSpace(b),d=this._getEventPositionInElementSpace(this.site.element,b);if(this._checkAutoScroll(d.x,d.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var e=this.site._view.hitTest(c.x,c.y);e.insertAfterIndex=a(-1,this.site._cachedCount-1,e.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===e.insertAfterIndex&&this._lastInsertPoint.index===e.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(e.index,e.insertAfterIndex,b.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(c.x,c.y,this._dragInfo)),this._lastInsertPoint=e}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,e.removeClass(this.site._element,b.UI._dragOverClass)),this._draggedItemBoxes){for(var a=0,c=this._draggedItemBoxes.length;c>a;a++)e.removeClass(this._draggedItemBoxes[a],b.UI._dragSourceClass),this._draggedItemBoxes[a].parentNode&&e.removeClass(this._draggedItemBoxes[a].parentNode,b.UI._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(a),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(a,b,c){for(var d=a.getIndices(),e=-1,f=this.site._cachedCount,g=d.length,h=-1,i=b,j=0;g>j;j++)if(d[j]===i){e=j,h=j;break}for(;e>=0&&i>=0;)c?(i++,g>e&&d[e+1]===i&&f>i?e++:i>=f?(c=!1,i=b,e=h):e=-1):(i--,e>0&&d[e-1]===i?e--:e=-1);return i},_reorderItems:function(a,b,c,d,e){var f=this.site,g=function(a){c?f._selection.remove({key:a[0].key}):f._selection.set({firstKey:a[0].key,lastKey:a[a.length-1].key}),e&&f.ensureVisible(f._selection._getFocused())};b.getItems().then(function(b){var c=f.itemDataSource;if(-1===a){c.beginEdits();for(var e=b.length-1;e>=0;e--)c.moveToStart(b[e].key);c.endEdits(),g(b)}else{var h=c.createListBinding();h.fromIndex(a).then(function(a){if(h.release(),c.beginEdits(),d)for(var e=0,f=b.length;f>e;e++)c.moveBefore(b[e].key,a.key);else for(var e=b.length-1;e>=0;e--)c.moveAfter(b[e].key,a.key);c.endEdits(),g(b)})}})},onDrop:function(c){if(this._draggedItemBoxes)for(var d=0,f=this._draggedItemBoxes.length;f>d;d++)this._draggedItemBoxes[d].parentNode&&e.removeClass(this._draggedItemBoxes[d].parentNode,b.UI._footprintClass);if(!this._dragBetweenDisabled){var g=this._getPositionInCanvasSpace(c),h=this.site._view.hitTest(g.x,g.y),i=a(-1,this.site._cachedCount-1,h.insertAfterIndex),j=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===i&&this._lastInsertPoint.index===h.index||(j=this._fireDragBetweenEvent(h.index,i,c.dataTransfer)),j&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(h.index,i,c.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;i=this._findFirstAvailableInsertPoint(this._dragInfo,i,!1),this._reorderItems(i,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),c.preventDefault()},_checkAutoScroll:function(a,c){var d=this.site._getViewportLength(),e=this.site._horizontal(),f=e?a:c,g=this.site._rtl(),h=this.site._getCanvasMargins(),i=this.site._canvas[e?"offsetWidth":"offsetHeight"]+h[e?g?"right":"left":"top"],j=Math.floor(this.site.scrollPosition),k=0;if(f<b.UI._AUTOSCROLL_THRESHOLD?k=f-b.UI._AUTOSCROLL_THRESHOLD:f>d-b.UI._AUTOSCROLL_THRESHOLD&&(k=f-(d-b.UI._AUTOSCROLL_THRESHOLD)),k=Math.round(k/b.UI._AUTOSCROLL_THRESHOLD*(b.UI._MAX_AUTOSCROLL_RATE-b.UI._MIN_AUTOSCROLL_RATE)),(0===j&&0>k||j>=i-d&&k>0)&&(k=0),0===k)this._autoScrollDelay&&(clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var l=this;this._autoScrollDelay=setTimeout(function(){if(l._autoScrollRate){l._lastDragTimeout=b.Utilities._now();var a=function(){if(!l._autoScrollRate&&l._autoScrollFrame||l.site._disposed)l._stopAutoScroll();else{var c=b.Utilities._now(),d=l._autoScrollRate*((c-l._lastDragTimeout)/1e3);d=0>d?Math.min(-1,d):Math.max(1,d),l.site._viewport[l.site._scrollProperty]+=d,l._lastDragTimeout=c,l._autoScrollFrame=requestAnimationFrame(a)}};l._autoScrollFrame=requestAnimationFrame(a)}},b.UI._AUTOSCROLL_DELAY)}this._autoScrollRate=k},_stopAutoScroll:function(){this._autoScrollDelay&&(clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(a){function c(a,c,e){function i(i){var j=!0,l=!1;if(e?a.index=Math.max(0,Math.min(i,a.index)):(a.index<0||a.index>i)&&(l=!0),!l&&(k.index!==a.index||k.type!==a.type)){var n=d(h._element,k,a);n&&(j=!1,g._setNewFocusItemOffsetPromise&&g._setNewFocusItemOffsetPromise.cancel(),h._batchViewUpdates(b.UI._ViewChange.realize,b.UI._ScrollToPriority.high,function(){return g._setNewFocusItemOffsetPromise=h._getItemOffset(k,!0).then(function(b){b=h._convertFromCanvasCoordinates(b);var d=b.end<=h.scrollPosition||b.begin>=h.scrollPosition+h._getViewportLength()-1;return g._setNewFocusItemOffsetPromise=h._getItemOffset(a).then(function(b){g._setNewFocusItemOffsetPromise=null;var e={position:h.scrollPosition,direction:"right"};return d&&(h._selection._setFocused(a,!0),b=h._convertFromCanvasCoordinates(b),a.index>k.index?(e.direction="right",e.position=b.end-h._getViewportLength()):(e.direction="left",e.position=b.begin)),h._changeFocus(a,c,m,d,!0),d?e:f.cancel},function(b){return h._changeFocus(a,c,m,!0,!0),f.wrapError(b)}),g._setNewFocusItemOffsetPromise},function(b){return h._changeFocus(a,c,m,!0,!0),f.wrapError(b)}),g._setNewFocusItemOffsetPromise},!0))}return j&&(h._selection._setFocused(k,!0),h.ensureVisible(k)),l?{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX}:a}return a.type!==b.UI.ObjectType.groupHeader?j.finalItem().then(i):f.wrap(h._groups.length()-1).then(i)}var g=this,h=this.site,i=h._swipeBehavior===b.UI.SwipeBehavior.select,j=h._view,k=h._selection._getFocused(),l=!0,m=a.ctrlKey,n=e.Key,o=a.keyCode,p=h._rtl();if(!this._isInteractive(a.target)){if(a.ctrlKey&&!a.altKey&&!a.shiftKey&&this._keyboardAcceleratorHandlers[o]&&this._keyboardAcceleratorHandlers[o](),h.itemsReorderable&&!a.ctrlKey&&a.altKey&&a.shiftKey&&k.type===b.UI.ObjectType.item&&(o===n.leftArrow||o===n.rightArrow||o===n.upArrow||o===n.downArrow)){var q=h._selection,r=k.index,s=!1,t=!0;if(!q.isEverything()){if(!q._isIncluded(r)){var u=h._view.items.itemAt(r);u&&e.hasClass(u,b.UI._nonDraggableClass)?t=!1:(s=!0,q=new b.UI._Selection(this.site,[{firstIndex:r,lastIndex:r}]))}if(t){var v=r;o===n.rightArrow?v+=p?-1:1:o===n.leftArrow?v+=p?1:-1:o===n.upArrow?v--:v++;var w=v>r,x=w;w&&v>=this.site._cachedCount&&(x=!1,v=this.site._cachedCount-1),v=this._findFirstAvailableInsertPoint(q,v,x),v=Math.min(Math.max(-1,v),this.site._cachedCount-1);var y=v-(w||-1===v?0:1),z=v,A=this.site._groupsEnabled();if(A){var B=this.site._groups,C=v>-1?B.groupFromItem(v):0;w?B.group(C).startIndex===v&&y--:C<B.length()-1&&v===B.group(C+1).startIndex-1&&y++}if(this._fireDragBetweenEvent(z,y,null)&&this._fireDropEvent(z,y,null)){if(A)return;this._reorderItems(v,q,s,!w,!0)}}}}else if(a.altKey)l=!1;else if(this._keyboardNavigationHandlers[o])this._keyboardNavigationHandlers[o](k).then(function(d){var e=g._keyboardNavigationHandlers[o].clampToBounds;d.type!==b.UI.ObjectType.groupHeader&&a.shiftKey&&h._selectionAllowed()&&h._multiSelection()?(h._selection._pivot===b.UI._INVALID_INDEX&&(h._selection._pivot=k.index),c(d,!0,e).then(function(c){if(c.index!==b.UI._INVALID_INDEX){var d=Math.min(c.index,h._selection._pivot),e=Math.max(c.index,h._selection._pivot),f=a.ctrlKey||h._tap===b.UI.TapBehavior.toggleSelect;g._selectRange(d,e,f)}})):(h._selection._pivot=b.UI._INVALID_INDEX,c(d,!1,e))});else if(a.ctrlKey||o!==n.enter)k.type!==b.UI.ObjectType.groupHeader&&(a.ctrlKey&&o===n.enter||i&&a.shiftKey&&o===n.F10||i&&o===n.menu||o===n.space)?(this._itemEventsHandler.handleSwipeBehavior(k.index),h._changeFocus(k,!0,m,!1,!0)):o===n.escape&&h._selection.count()>0?(h._selection._pivot=b.UI._INVALID_INDEX,h._selection.clear()):l=!1;else{var D=k.type===b.UI.ObjectType.groupHeader?h._groups.group(k.index).header:h._view.items.itemBoxAt(k.index);if(D){k.type===b.UI.ObjectType.groupHeader?(this._pressedHeader=D,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=D,this._pressedContainer=h._view.items.containerAt(k.index),this._pressedHeader=null);var E=this._verifySelectionAllowed(k);E.canTapSelect&&this._itemEventsHandler.handleTap(k),this._fireInvokeEvent(k,D)}}this._keyDownHandled=l,l&&(a.stopPropagation(),a.preventDefault())}o===n.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(a){this._keyDownHandled&&(a.stopPropagation(),a.preventDefault())},onTabEnter:function(a){if(0!==this.site._groups.length()){var c=this.site,e=c._selection._getFocused(),f=a.detail,g=!c._hasKeyboardFocus||a.target===c._canvas;if(g)if(this.inboundFocusHandled=!0,e.index=e.index===b.UI._INVALID_INDEX?0:e.index,f||!this.site._supportsGroupHeaderKeyboarding){var h={type:b.UI.ObjectType.item};
e.type===b.UI.ObjectType.groupHeader?(h.index=c._groupFocusCache.getIndexForGroup(e.index),d(c._element,e,h)?c._changeFocus(h,!0,!1,!1,!0):c._changeFocus(e,!0,!1,!1,!0)):(h.index=e.index,c._changeFocus(h,!0,!1,!1,!0))}else{var h={type:b.UI.ObjectType.groupHeader};e.type!==b.UI.ObjectType.groupHeader?(h.index=c._groups.groupFromItem(e.index),d(c._element,e,h)?c._changeFocus(h,!0,!1,!1,!0):c._changeFocus(e,!0,!1,!1,!0)):(h.index=e.index,c._changeFocus(h,!0,!1,!1,!0))}}},onTabExit:function(a){if(this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var c=this.site,e=c._selection._getFocused(),f=a.detail;if(f&&e.type!==b.UI.ObjectType.groupHeader){var g={type:b.UI.ObjectType.groupHeader,index:c._groups.groupFromItem(e.index)};d(c._element,e,g)&&c._changeFocus(g,!0,!1,!1,!0)}else if(!f&&e.type===b.UI.ObjectType.groupHeader){var g={type:b.UI.ObjectType.item,index:c._groupFocusCache.getIndexForGroup(e.index)};d(c._element,e,g)&&c._changeFocus(g,!0,!1,!1,!0)}}}},g})})}(this,WinJS),function(a,b){"use strict";var c=b.UI;c._listViewClass="win-listview",c._viewportClass="win-viewport",c._rtlListViewClass="win-rtl",c._horizontalClass="win-horizontal",c._verticalClass="win-vertical",c._scrollableClass="win-surface",c._itemsContainerClass="win-itemscontainer",c._padderClass="win-itemscontainer-padder",c._proxyClass="_win-proxy",c._itemClass="win-item",c._itemBoxClass="win-itembox",c._itemsBlockClass="win-itemsblock",c._containerClass="win-container",c._backdropClass="win-backdrop",c._footprintClass="win-footprint",c._groupsClass="win-groups",c._selectedClass="win-selected",c._swipeableClass="win-swipeable",c._swipeClass="win-swipe",c._selectionBorderClass="win-selectionborder",c._selectionBackgroundClass="win-selectionbackground",c._selectionCheckmarkClass="win-selectioncheckmark",c._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",c._selectionPartsSelector=".win-selectionborder, .win-selectionbackground, .win-selectioncheckmark, .win-selectioncheckmarkbackground",c._pressedClass="win-pressed",c._headerClass="win-groupheader",c._headerContainerClass="win-groupheadercontainer",c._groupLeaderClass="win-groupleader",c._progressClass="win-progress",c._selectionHintClass="win-selectionhint",c._revealedClass="win-revealed",c._itemFocusClass="win-focused",c._itemFocusOutlineClass="win-focusedoutline",c._zoomingXClass="win-zooming-x",c._zoomingYClass="win-zooming-y",c._listLayoutClass="win-listlayout",c._gridLayoutClass="win-gridlayout",c._headerPositionTopClass="win-headerpositiontop",c._headerPositionLeftClass="win-headerpositionleft",c._structuralNodesClass="win-structuralnodes",c._uniformGridLayoutClass="win-uniformgridlayout",c._uniformListLayoutClass="win-uniformlistlayout",c._cellSpanningGridLayoutClass="win-cellspanninggridlayout",c._laidOutClass="win-laidout",c._nonDraggableClass="win-nondraggable",c._nonSelectableClass="win-nonselectable",c._nonSwipeableClass="win-nonswipeable",c._dragOverClass="win-dragover",c._dragSourceClass="win-dragsource",c._clipClass="win-clip",c._selectionModeClass="win-selectionmode",c._noCSSGrid="win-nocssgrid",c._INVALID_INDEX=-1,c._UNINITIALIZED=-1,c._LEFT_MSPOINTER_BUTTON=0,c._RIGHT_MSPOINTER_BUTTON=2,c._TAP_END_THRESHOLD=10,c._DEFAULT_PAGES_TO_LOAD=5,c._DEFAULT_PAGE_LOAD_THRESHOLD=2,c._MIN_AUTOSCROLL_RATE=150,c._MAX_AUTOSCROLL_RATE=1500,c._AUTOSCROLL_THRESHOLD=100,c._AUTOSCROLL_DELAY=50,c._DEFERRED_ACTION=250,c._DEFERRED_SCROLL_END=250,c._VERTICAL_SWIPE_SELECTION_THRESHOLD=39,c._VERTICAL_SWIPE_SPEED_BUMP_START=0,c._VERTICAL_SWIPE_SPEED_BUMP_END=127,c._VERTICAL_SWIPE_SELF_REVEAL_GESTURE=15,c._HORIZONTAL_SWIPE_SELECTION_THRESHOLD=27,c._HORIZONTAL_SWIPE_SPEED_BUMP_START=0,c._HORIZONTAL_SWIPE_SPEED_BUMP_END=150,c._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE=23,c._SELECTION_CHECKMARK="",c._LISTVIEW_PROGRESS_DELAY=2e3}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI._strings",{modeIsInvalid:{get:function(){return b.Resources._getWinJSString("ui/modeIsInvalid").value}},loadingBehaviorIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/loadingBehaviorIsDeprecated").value}},pagesToLoadIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/pagesToLoadIsDeprecated").value}},pagesToLoadThresholdIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/pagesToLoadThresholdIsDeprecated").value}},automaticallyLoadPagesIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/automaticallyLoadPagesIsDeprecated").value}},invalidTemplate:{get:function(){return b.Resources._getWinJSString("ui/invalidTemplate").value}},loadMorePagesIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/loadMorePagesIsDeprecated").value}},disableBackdropIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/disableBackdropIsDeprecated").value}},backdropColorIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/backdropColorIsDeprecated").value}},itemInfoIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/itemInfoIsDeprecated").value}},groupInfoIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/groupInfoIsDeprecated").value}},resetItemIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/resetItemIsDeprecated").value}},resetGroupHeaderIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/resetGroupHeaderIsDeprecated").value}},maxRowsIsDeprecated:{get:function(){return b.Resources._getWinJSString("ui/maxRowsIsDeprecated").value}}})}(this,WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{_GroupFocusCache:WinJS.Namespace._lazy(function(){return WinJS.Class.define(function(a){this._listView=a,this.clear()},{updateCache:function(a,b,c){c=""+c,this._itemToIndex[b]=c,this._groupToItem[a]=b},deleteItem:function(a){if(this._itemToIndex[a])for(var b=this,c=Object.keys(this._groupToItem),d=0,e=c.length;e>d;d++){var f=c[d];if(b._groupToItem[f]===a){b.deleteGroup(f);break}}},deleteGroup:function(a){var b=this._groupToItem[a];b&&delete this._itemToIndex[b],delete this._groupToItem[a]},updateItemIndex:function(a,b){this._itemToIndex[a]&&(this._itemToIndex[a]=""+b)},getIndexForGroup:function(a){var b=this._listView._groups.group(a).key,c=this._groupToItem[b];return c&&this._itemToIndex[c]?+this._itemToIndex[c]:this._listView._groups.fromKey(b).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={}}})}),_UnsupportedGroupFocusCache:WinJS.Namespace._lazy(function(){return WinJS.Class.define(null,{updateCache:function(){},deleteItem:function(){},deleteGroup:function(){},updateItemIndex:function(){},getIndexForGroup:function(){return 0},clear:function(){}})})})}(),function(a,b){"use strict";var c=b.Utilities,d=b.Promise;b.Namespace.define("WinJS.UI",{_GroupsContainerBase:b.Namespace._lazy(function(){return b.Class.define(function(){},{index:function(a){var c=this.headerFrom(a);if(c)for(var d=0,e=this.groups.length;e>d;d++)if(c===this.groups[d].header)return d;return b.UI._INVALID_INDEX},headerFrom:function(a){for(;a&&!c.hasClass(a,b.UI._headerClass);)a=a.parentNode;return a},requestHeader:function(a){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[a]||(this._waitingHeaderRequests[a]=[]);var b=this;return new d(function(c){var d=b.groups[a];d&&d.header?c(d.header):b._waitingHeaderRequests[a].push(c)})},notify:function(a,b){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[a]){for(var c=this._waitingHeaderRequests[a],d=0,e=c.length;e>d;d++)c[d](b);this._waitingHeaderRequests[a]=[]}},groupFromImpl:function(a,b,c){if(a>b)return null;var d=a+Math.floor((b-a)/2),e=this.groups[d];return c(e,d)?this.groupFromImpl(a,d-1,c):b>d&&!c(this.groups[d+1],d+1)?this.groupFromImpl(d+1,b,c):d},groupFrom:function(a){if(this.groups.length>0){var b=this.groups.length-1,c=this.groups[b];return a(c,b)?this.groupFromImpl(0,this.groups.length-1,a):b}return null},groupFromItem:function(a){return this.groupFrom(function(b){return a<b.startIndex})},groupFromOffset:function(a){return this.groupFrom(function(b){return a<b.offset})},group:function(a){return this.groups[a]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var a=0,b=this.groups.length;b>a;a++){var c=this.groups[a];c.userData&&this.listBinding.releaseItem(c.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var a=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return d.join(a.pendingChanges)}).then(function(){return a._listView._ifZombieDispose()?b.Promise.cancel:void 0}).then(function(){a.ignoreChanges=!1},function(c){return a.ignoreChanges=!1,b.Promise.wrapError(c)})},fromKey:function(a){for(var b=0,c=this.groups.length;c>b;b++){var d=this.groups[b];if(d.key===a)return{group:d,index:b}}return null},fromHandle:function(a){for(var b=0,c=this.groups.length;c>b;b++){var d=this.groups[b];if(d.handle===a)return{group:d,index:b}}return null}})}),_UnvirtualizedGroupsContainer:b.Namespace._lazy(function(){return b.Class.derive(b.UI._GroupsContainerBase,function(a,c){this._listView=a,this.groupDataSource=c,this.groups=[],this.pendingChanges=[],this.dirty=!0;var d=this,e={beginNotifications:function(){d._listView._versionManager.beginNotifications()},endNotifications:function(){d._listView._versionManager.endNotifications(),d._listView._ifZombieDispose()||!d.ignoreChanges&&d._listView._groupsChanged&&d._listView._scheduleUpdate()},indexChanged:function(){d._listView._versionManager.receivedNotification(),d._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(a){d._listView._versionManager.receivedNotification(),d._listView._writeProfilerMark("groupCountChanged("+a+"),info"),d._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(a){if(d._listView._versionManager.receivedNotification(),!d._listView._ifZombieDispose()){var b=d.fromKey(a.key);b&&(d._listView._writeProfilerMark("groupChanged("+b.index+"),info"),b.group.userData=a,b.group.startIndex=a.firstItemIndexHint,this.markToRemove(b.group)),this.scheduleUpdate()}},removed:function(a){if(d._listView._versionManager.receivedNotification(),d._listView._groupRemoved(a),!d._listView._ifZombieDispose()){var b=d.fromHandle(a);if(b){d._listView._writeProfilerMark("groupRemoved("+b.index+"),info"),d.groups.splice(b.index,1);var c=d.groups.indexOf(b.group,b.index);c>-1&&d.groups.splice(c,1),this.markToRemove(b.group)}this.scheduleUpdate()}},inserted:function(a,b,c){if(d._listView._versionManager.receivedNotification(),!d._listView._ifZombieDispose()){d._listView._writeProfilerMark("groupInserted,info");var e=this;a.retain().then(function(f){var g;if(g=b||c||d.groups.length?e.findIndex(b,c):0,-1!==g){var h={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:a.handle};d.groups.splice(g,0,h)}e.scheduleUpdate()}),d.pendingChanges.push(a)}},moved:function(a,b,c){if(d._listView._versionManager.receivedNotification(),!d._listView._ifZombieDispose()){d._listView._writeProfilerMark("groupMoved,info");var e=this;a.then(function(f){var g=e.findIndex(b,c),h=d.fromKey(f.key);if(h)d.groups.splice(h.index,1),-1!==g&&(h.index<g&&g--,h.group.key=f.key,h.group.userData=f,h.group.startIndex=f.firstItemIndexHint,d.groups.splice(g,0,h.group));else if(-1!==g){var i={key:f.key,startIndex:f.firstItemIndexHint,userData:f,handle:a.handle};d.groups.splice(g,0,i),a.retain()}e.scheduleUpdate()}),d.pendingChanges.push(a)}},reload:function(){d._listView._versionManager.receivedNotification(),d._listView._ifZombieDispose()||d._listView._processReload()},markToRemove:function(a){if(a.header){var c=a.header;a.header=null,a.left=-1,a.width=-1,a.decorator=null,a.tabIndex=-1,c.tabIndex=-1,d._listView._groupsToRemove[b.Utilities._uniqueID(c)]={group:a,header:c}}},scheduleUpdate:function(){d.dirty=!0,d.ignoreChanges||(d._listView._groupsChanged=!0)},findIndex:function(a,b){var c,e=-1;return a&&(c=d.fromHandle(a),c&&(e=c.index+1)),-1===e&&b&&(c=d.fromHandle(b),c&&(e=c.index)),e},removeElements:function(a){if(a.header){var c=a.header.parentNode;c&&(b.Utilities.disposeSubTree(a.header),c.removeChild(a.header)),a.header=null,a.left=-1,a.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(e)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var a=this;return this.initializePromise=this.groupDataSource.getCount().then(function(b){for(var c=[],e=0;b>e;e++)c.push(a.listBinding.fromIndex(e).retain());return d.join(c)}).then(function(b){a.groups=[];for(var c=0,d=b.length;d>c;c++){var e=b[c];a.groups.push({key:e.key,startIndex:e.firstItemIndexHint,handle:e.handle,userData:e})}a._listView._writeProfilerMark("GroupsContainer_initialize groups("+b.length+"),info"),a._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(c){return a._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),b.Promise.wrapError(c)}),this.initializePromise},renderGroup:function(a){if(this._listView.groupHeaderTemplate){var c=this.groups[a];return d.wrap(this._listView._groupHeaderRenderer(d.wrap(c.userData))).then(b.UI._normalizeRendererReturn)}return d.wrap(null)},setDomElement:function(a,b){this.groups[a].header=b,this.notify(a,b)},removeElements:function(){for(var a=this._listView._groupsToRemove||{},c=Object.keys(a),d=!1,e=this._listView._selection._getFocused(),f=0,g=c.length;g>f;f++){var h=a[c[f]],i=h.header,j=h.group;if(d||e.type!==b.UI.ObjectType.groupHeader||j.userData.index!==e.index||(this._listView._unsetFocusOnItem(),d=!0),i){var k=i.parentNode;k&&(b.Utilities._disposeElement(i),k.removeChild(i))}}d&&this._listView._setFocusOnItem(e),this._listView._groupsToRemove={}},resetGroups:function(){for(var a=this.groups.slice(0),b=0,c=a.length;c>b;b++){var d=a[b];this.listBinding&&d.userData&&this.listBinding.releaseItem(d.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:b.Namespace._lazy(function(){return b.Class.derive(b.UI._GroupsContainerBase,function(a){this._listView=a,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return b.Promise.wrap()},addItem:function(){return b.Promise.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return b.Promise.wrap(null)},ensureFirstGroup:function(){return b.Promise.wrap(this.groups[0])},groupOf:function(){return b.Promise.wrap(this.groups[0])},removeElements:function(){}})})})}(this,WinJS),function(a,b){"use strict";function c(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return{x:a.x/b,y:a.y/b,z:a.z/b}}function d(a,b){var d=c(b),e=Math.cos(a),f=Math.sin(a),g=[e+d.x*d.x*(1-e),d.x*d.y*(1-e)-d.z*f,d.x*d.z*(1-e)+d.y*f,0,d.y*d.x*(1-e)+d.z*f,e+d.y*d.y*(1-e),d.y*d.z*(1-e)-d.x*f,0,d.z*d.x*(1-e)-d.y*f,d.z*d.y*(1-e)+d.x*f,e+d.z*d.z*(1-e),0,0,0,0,1];return g=g.map(function(a){return a.toFixed(8)}),"matrix3d("+g.join(",")+")"}function e(a,c,e){var f=b.Utilities._clamp((a-e.left)/e.width,0,1),i=b.Utilities._clamp((c-e.top)/e.height,0,1),j={x:i-.5,y:-(f-.5),z:1e-4},k=Math.abs(f-.5)+Math.abs(i-.5),l=k*g,m=1-(1-k)*h,n="perspective(800px) scale("+m+", "+m+") "+d(l,j);return n}var f=b.Utilities._browserStyleEquivalents.transform,g=.15,h=.025,i=b.Utilities._uniqueID,j=b.Utilities._MSManipulationEvent;b.Namespace.define("WinJS.UI",{_rotationTransform3d:d,_tiltTransform:e,_ItemEventsHandler:b.Namespace._lazy(function(){function a(a,b){return a.querySelector("."+b)}function c(a,b){var c=document.createElement("div");return c.className=a,b||c.setAttribute("aria-hidden",!0),c}var d=b.Utilities,g=b.Promise,h=(b.UI.Animation,b.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch");return b.Class.define(function(a){if(this._site=a,this._work=[],this._animations={},this._selectionHintTracker={},this._swipeClassTracker={},!d.isPhone&&this._selectionAllowed()){var b=this;setTimeout(function(){b._gestureRecognizer||a.isZombie()||(b._gestureRecognizer=b._createGestureRecognizer())},500)}},{dispose:function(){this._disposed||(this._disposed=!0,this._gestureRecognizer=null,window.removeEventListener("pointerup",this._resetPointerDownStateBound),window.removeEventListener("pointercancel",this._resetPointerDownStateBound))},onMSManipulationStateChanged:function(a){var c=a.currentState;if(c===j.MS_MANIPULATION_STATE_PRESELECT&&!this._site.pressedItemBox){var e=this._site.indexForItemElement(a.target);if(this._site.pressedEntity={type:b.UI.ObjectType.item,index:e},this._site.pressedEntity.index!==b.UI._INVALID_INDEX){this._site.pressedItemBox=this._site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=this._site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=d.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null;var f=this._site.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=f.canSelect,this._canTapSelect=f.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._canSelect&&this._addSelectionHint()}}!this._canSelect||c!==j.MS_MANIPULATION_STATE_PRESELECT&&c!==j.MS_MANIPULATION_STATE_COMMITTED&&c!==j.MS_MANIPULATION_STATE_CANCELLED&&c!==j.MS_MANIPULATION_STATE_SELECTING&&c!==j.MS_MANIPULATION_STATE_DRAGGING||this._dispatchSwipeBehavior(c),(c===j.MS_MANIPULATION_STATE_COMMITTED||c===j.MS_MANIPULATION_STATE_CANCELLED||c===j.MS_MANIPULATION_STATE_STOPPED)&&this.resetPointerDownState()},onPointerDown:function(a){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var c,e,f=this._site,g=a.pointerType===h;if(f.pressedElement=a.target,d.hasWinRT){var i=this._getCurrentPoint(a),k=i.properties;g||k.isInverted||k.isEraser||k.isMiddleButtonPressed?c=e=!1:(e=k.isRightButtonPressed,c=!e&&k.isLeftButtonPressed)}else c=a.button===b.UI._LEFT_MSPOINTER_BUTTON,e=a.button===b.UI._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this),this._swipeBehaviorState=j.MS_MANIPULATION_STATE_STOPPED;var l=f.swipeBehavior===b.UI.SwipeBehavior.select,m=this._isInteractive(a.target),n=f.indexForItemElement(a.target),o=f.indexForHeaderElement(a.target),p=!m&&n!==b.UI._INVALID_INDEX;if((g||c||this._selectionAllowed()&&l&&e)&&this._site.pressedEntity.index===b.UI._INVALID_INDEX&&!m&&(this._site.pressedEntity=o===b.UI._INVALID_INDEX?{type:b.UI.ObjectType.item,index:n}:{type:b.UI.ObjectType.groupHeader,index:o},this._site.pressedEntity.index!==b.UI._INVALID_INDEX)){this._site.pressedPosition=b.UI._getCursorPos(a);var q=f.verifySelectionAllowed(this._site.pressedEntity);if(this._canSelect=q.canSelect,this._canTapSelect=q.canTapSelect,this._swipeBehaviorSelectionChanged=!1,this._selectionHint=null,this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader?(this._site.pressedItemBox=f.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=f.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=d.isPhone?this._site.pressedItemBox:this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,!1,a),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),g||(b.Utilities._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),b.Utilities._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(a.target),d.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,!1,a)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),g||(b.Utilities._addEventListener(window,"pointerup",this._resetPointerDownStateBound,!1),b.Utilities._addEventListener(window,"pointercancel",this._resetPointerDownStateBound,!1)),this._canSelect&&!d.isPhone&&(this._gestureRecognizer||(this._gestureRecognizer=this._createGestureRecognizer()),this._addSelectionHint()),this._pointerId=a.pointerId,this._pointerRightButton=e,this._pointerTriggeredSRG=!1,this._gestureRecognizer&&g)try{this._gestureRecognizer.addPointer(this._pointerId)}catch(r){this._gestureRecognizer.stop()}}if(p&&g)try{b.Utilities._setPointerCapture(f.canvasProxy,a.pointerId)}catch(r){return void b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==b.UI._INVALID_INDEX&&f.selection._getFocused().index!==b.UI._INVALID_INDEX&&f.selection._pivot===b.UI._INVALID_INDEX&&(f.selection._pivot=f.selection._getFocused().index),b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(a){this._site.pressedContainer&&this._pointerId===a.pointerId&&this._togglePressed(!0,!1,a)},onPointerLeave:function(a){this._site.pressedContainer&&this._pointerId===a.pointerId&&this._togglePressed(!1,!0,a)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),b.Utilities._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),b.Utilities._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(a){if(!this._skipClick){var c={type:b.UI.ObjectType.item,index:this._site.indexForItemElement(a.target)};if(c.index===b.UI._INVALID_INDEX&&(c.index=this._site.indexForHeaderElement(a.target),c.index!==b.UI._INVALID_INDEX&&(c.type=b.UI.ObjectType.groupHeader)),c.index!==b.UI._INVALID_INDEX&&(d.hasClass(a.target,this._site.accessibleItemClass)||d.hasClass(a.target,b.UI._headerClass))){var e=this._site.verifySelectionAllowed(c);e.canTapSelect&&this.handleTap(c),this._site.fireInvokeEvent(c,a.target)}}},onPointerUp:function(a){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var c=this._site;this._skipClick=!0;var e=this,f=this._site.swipeBehavior===b.UI.SwipeBehavior.select;b.Utilities._yieldForEvents(function(){e._skipClick=!1});try{b.Utilities._releasePointerCapture(c.canvasProxy,a.pointerId)}catch(g){}var i=a.pointerType===h,k=this._releasedElement(a),l=c.indexForItemElement(k),m=c.indexForHeaderElement(k&&d.hasClass(k,b.UI._headerContainerClass)?c.pressedHeader:k);if(this._pointerId===a.pointerId){var n;if(n=m===b.UI._INVALID_INDEX?{type:b.UI.ObjectType.item,index:l}:{type:b.UI.ObjectType.groupHeader,index:m},this._resetPressedContainer(),this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader&&n.type!==b.UI.ObjectType.groupHeader&&this._site.pressedContainer&&this._site.pressedEntity.index===n.index)if(a.shiftKey||(c.selection._pivot=b.UI._INVALID_INDEX),a.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&c.selection._pivot!==b.UI._INVALID_INDEX){var o=Math.min(this._site.pressedEntity.index,c.selection._pivot),p=Math.max(this._site.pressedEntity.index,c.selection._pivot),q=this._pointerRightButton||a.ctrlKey||c.tapBehavior===b.UI.TapBehavior.toggleSelect;c.selectRange(o,p,q)}}else(a.ctrlKey||this._selectionAllowed()&&f&&this._pointerRightButton)&&this.handleSwipeBehavior(this._site.pressedEntity.index);if((this._site.pressedHeader||this._site.pressedContainer)&&this._swipeBehaviorState!==j.MS_MANIPULATION_STATE_COMMITTED){var r=b.UI._getCursorPos(a),s=Math.abs(r.left-this._site.pressedPosition.left)<=b.UI._TAP_END_THRESHOLD&&Math.abs(r.top-this._site.pressedPosition.top)<=b.UI._TAP_END_THRESHOLD;this._endSelfRevealGesture(),this._clearItem(this._site.pressedEntity,this._isSelected(this._site.pressedEntity.index)),this._pointerRightButton||this._pointerTriggeredSRG||a.ctrlKey||a.shiftKey||!(i&&s||!i&&this._site.pressedEntity.index===n.index&&this._site.pressedEntity.type===n.type)||(n.type===b.UI.ObjectType.groupHeader?(this._site.pressedHeader=c.headerAtIndex(n.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=c.itemBoxAtIndex(n.index),this._site.pressedContainer=c.containerAtIndex(n.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==b.UI._INVALID_INDEX&&c.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(a){this._pointerId===a.pointerId&&this._swipeBehaviorState!==j.MS_MANIPULATION_STATE_PRESELECT&&(b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(a){this._pointerId===a.pointerId&&this._swipeBehaviorState!==j.MS_MANIPULATION_STATE_PRESELECT&&(b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(a){var b=this._site.containerFromElement(a.target);this._selectionAllowed()&&b&&!this._isInteractive(a.target)&&a.preventDefault()},onMSHoldVisual:function(a){this._isInteractive(a.target)||a.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},handleSwipeBehavior:function(a){this._selectionAllowed(a)&&this._toggleItemSelection(a)},handleTap:function(a){if(a.type!==b.UI.ObjectType.groupHeader){var c=this._site,d=c.selection;this._selectionAllowed(a.index)&&this._selectOnTap()&&(c.tapBehavior===b.UI.TapBehavior.toggleSelect?this._toggleItemSelection(a.index):c.selectionMode!==b.UI.SelectionMode.multi&&d._isIncluded(a.index)||d.set(a.index))}},_toggleItemSelection:function(a){var c=this._site,d=c.selection,e=d._isIncluded(a);c.selectionMode===b.UI.SelectionMode.single?e?d.clear():d.set(a):e?d.remove(a):d.add(a)},_getCurrentPoint:function(a){return Windows.UI.Input.PointerPoint.getCurrentPoint(a.pointerId)},_containedInElementWithClass:function(a,b){if(a.parentNode)for(var c=a.parentNode.querySelectorAll("."+b+", ."+b+" *"),d=0,e=c.length;e>d;d++)if(c[d]===a)return!0;return!1},_isSelected:function(a){return!this._swipeBehaviorSelectionChanged&&this._site.selection._isIncluded(a)||this._swipeBehaviorSelectionChanged&&this.swipeBehaviorSelected},_isInteractive:function(a){return this._containedInElementWithClass(a,"win-interactive")},_togglePressed:function(a,c,g){function h(a){""===j._site.animatedElement.style[f.scriptName]?(j._site.animatedElement.style[f.scriptName]=a,j._site.animatedElementScaleTransform=j._site.animatedElement.style[f.scriptName]):j._site.animatedElementScaleTransform=""}function i(a,c){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:removePressedUI,info"),d.removeClass(a,b.UI._pressedClass),d.isPhone?j._containsTransform(a,c)&&b.UI.executeTransition(a,{property:f.cssName,delay:0,duration:500,timing:"cubic-bezier(0.7025,0,0.9225,-0.115)",to:a.style[f.scriptName].replace(c,"")}):j._removeTransform(a,c)}var j=this,k=this._site.pressedEntity.type===b.UI.ObjectType.groupHeader;if(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),!(d.isPhone&&!k&&d.hasClass(this._site.pressedItemBox,b.UI._nonSelectableClass)||this._staticMode(k)))if(a){if(!d.hasClass(this._site.animatedElement,b.UI._pressedClass))if(b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:applyPressedUI,info"),d.addClass(this._site.animatedElement,b.UI._pressedClass),g&&d.isPhone){var l=k?j._site.pressedHeader:j._site.pressedContainer,m=e(g.clientX,g.clientY,l.getBoundingClientRect());this._site.animatedDownPromise=b.Promise.timeout(50).then(function(){h(m)})}else{var n=.975,o=7;this._site.getItemPosition(this._site.pressedEntity).then(function(a){a.contentWidth>0&&(n=Math.max(n,1-o/a.contentWidth)),a.contentHeight>0&&(n=Math.max(n,1-o/a.contentHeight))},function(){}),h("scale("+n+","+n+")")}}else if(d.hasClass(this._site.animatedElement,b.UI._pressedClass)){var p=this._site.animatedElement,q=this._site.animatedElementScaleTransform;c?i(p,q):b.Utilities._setImmediate(function(){d.hasClass(p,b.UI._pressedClass)&&i(p,q)})}},_containsTransform:function(a,b){return b&&-1!==a.style[f.scriptName].indexOf(b)},_removeTransform:function(a,b){this._containsTransform(a,b)&&(a.style[f.scriptName]=a.style[f.scriptName].replace(b,""))},_endSwipeBehavior:function(){if((this._swipeBehaviorState===j.MS_MANIPULATION_STATE_PRESELECT||this._swipeBehaviorState===j.MS_MANIPULATION_STATE_SELECTING||this._swipeBehaviorState===j.MS_MANIPULATION_STATE_DRAGGING||this._swipeBehaviorState===j.MS_MANIPULATION_STATE_COMMITTED||this._swipeBehaviorState===j.MS_MANIPULATION_STATE_CANCELLED)&&this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader){this._flushUIBatches();var a=this._selectionHint;if(this._selectionHint=null,this._site.pressedItemBox){var c=this._site.pressedEntity.index,d=this._site.selection._isIncluded(c);if(d)for(var e=b.UI._getElementsByClasses(this._site.pressedItemBox,[b.UI._selectionCheckmarkClass,b.UI._selectionCheckmarkBackgroundClass]),f=0;f<e.length;f++)e[f].style.opacity=1;this._clearItem(this._site.pressedEntity,d),a&&this._removeSelectionHint(a),delete this._animations[c]}}},_createGestureRecognizer:function(){var a=this._site.eventHandlerRoot,c=b.Utilities._createGestureRecognizer();c.target=a;var d=this;return a.addEventListener("MSGestureHold",function(a){-1!==d._site.pressedEntity.index&&a.detail===b.Utilities._MSGestureEvent.MSGESTURE_FLAG_BEGIN&&d._startSelfRevealGesture()}),c},_dispatchSwipeBehavior:function(a){if(this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader){if(this._site.selection._pivot=b.UI._INVALID_INDEX,this._site.pressedItemBox){var c=this._site.pressedEntity.index;if(this._swipeBehaviorState!==a)if(a===j.MS_MANIPULATION_STATE_DRAGGING&&this._canSelect)this._animateSelectionChange(this._site.selection._isIncluded(c)),this._removeSelectionHint(this._selectionHint);else if(a===j.MS_MANIPULATION_STATE_PRESELECT){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:crossSlidingStarted,info");var e=this._site,f=e.itemAtIndex(c),g=e.selection._isIncluded(c);this._selfRevealGesture?(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null):this._canSelect&&this._prepareItem(this._site.pressedEntity,f,g),this._swipeBehaviorState!==j.MS_MANIPULATION_STATE_SELECTING?(this._site.animatedElement&&d.hasClass(this._site.animatedElement,b.UI._pressedClass)&&(this._site.animatedDownPromise&&this._site.animatedDownPromise.cancel(),d.removeClass(this._site.animatedElement,b.UI._pressedClass),this._removeTransform(this._site.animatedElement,this._site.animatedElementScaleTransform)),this._showSelectionHintCheckmark()):this._animateSelectionChange(this._site.selection._isIncluded(c))}else if(a===j.MS_MANIPULATION_STATE_COMMITTED){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:crossSlidingCompleted,info");var e=this._site,h=e.selection,i=this._swipeBehaviorSelectionChanged,k=this.swipeBehaviorSelected;this._swipeBehaviorState===j.MS_MANIPULATION_STATE_SELECTING&&i&&this._selectionAllowed()&&e.swipeBehavior===b.UI.SwipeBehavior.select&&(e.selectionMode===b.UI.SelectionMode.single?k?h.set(c):h._isIncluded(c)&&h.remove(c):k?h.add(c):h._isIncluded(c)&&h.remove(c)),this._endSwipeBehavior()}else a===j.MS_MANIPULATION_STATE_SELECTING&&this._canSelect?this._animateSelectionChange(!this._site.selection._isIncluded(c)):this._swipeBehaviorState===j.MS_MANIPULATION_STATE_SELECTING&&this._canSelect&&this._animateSelectionChange(this._site.selection._isIncluded(c),a===j.MS_MANIPULATION_STATE_CANCELLED)
}this._swipeBehaviorState=a}},_resetPointerDownStateForPointerId:function(a){this._pointerId===a.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._gestureRecognizer&&(this._endSelfRevealGesture(),this._endSwipeBehavior()),this._site.pressedElement=null,window.removeEventListener("pointerup",this._resetPointerDownStateBound),window.removeEventListener("pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._removeSelectionHint(this._selectionHint),this._selectionHint=null,this._site.pressedEntity={type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},this._pointerId=null},_startSelfRevealGesture:function(){if(this._canSelect&&this._site.swipeBehavior===b.UI.SwipeBehavior.select){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:playSelfRevealGesture,info");var a=this,c=this._site,d=b.UI.Animation,e=this._site.pressedEntity.index,g=c.itemBoxAtIndex(e),h=c.selection._isIncluded(e),i=!1,j=function(){var a,e;return c.horizontal?(a=b.UI._VERTICAL_SWIPE_SELF_REVEAL_GESTURE+"px",e="0px"):(a="0px",e=(c.rtl()?"":"-")+b.UI._HORIZONTAL_SWIPE_SELF_REVEAL_GESTURE+"px"),d.swipeReveal(g,{top:a,left:e})},k=function(){return i?b.Promise.wrap():d.swipeReveal(g,{top:"0px",left:"0px"})},l=function(b){c.isZombie()||(b&&a._removeSelectionHint(b),a._clearItem(c.pressedEntity,c.selection._isIncluded(e)))},m=function(){a._selfRevealGesture._promise.cancel(),i=!0;var b=a._selectionHint;return a._selectionHint=null,k().then(function(){g.style[f.scriptName]="",l(b)})};this._prepareItem(this._site.pressedEntity,g,h),this._showSelectionHintCheckmark(),this._pointerTriggeredSRG=!0,this._selfRevealGesture={finishAnimation:m,_promise:j().then(k).then(function(){i||(a._hideSelectionHintCheckmark(),l(),a._selfRevealGesture=null)})}}},_endSelfRevealGesture:function(){this._selfRevealGesture&&(this._selfRevealGesture.finishAnimation(),this._selfRevealGesture=null)},_prepareItem:function(a,c,e){function f(a){h._swipeClassTracker[i(a)]?h._swipeClassTracker[i(a)]++:(d.addClass(a,b.UI._swipeClass),h._swipeClassTracker[i(a)]=1)}if(a.type!==b.UI.ObjectType.groupHeader){var h=this,j=this._site,k=a.index;if(e){var l=j.containerAtIndex(k);f(l)}else(this._animations[k]||g.wrap()).then(function(){if(!j.isZombie()&&a.type!==b.UI.ObjectType.groupHeader&&-1!==j.pressedEntity.index){k=j.pressedEntity.index;var c=j.itemAtIndex(k),e=j.itemBoxAtIndex(k),g=j.containerAtIndex(k);if(f(g),!b.UI._isSelectionRendered(e)){b.UI._ItemEventsHandler.renderSelection(e,c,!0,g),d.removeClass(e,b.UI._selectedClass),d.removeClass(g,b.UI._selectedClass);for(var h=e.querySelectorAll(b.UI._selectionPartsSelector),i=0,l=h.length;l>i;i++)h[i].style.opacity=0}}})}},_clearItem:function(a,c){function e(a){var c=--g._swipeClassTracker[i(a)];return c?!1:(delete g._swipeClassTracker[i(a)],d.removeClass(a,b.UI._swipeClass),!0)}function f(a){var c=a.parentNode;c&&b.Utilities.hasClass(c,b.UI._itemsBlockClass)&&e(c)}if(a.type===b.UI.ObjectType.item){var g=this,h=this._site,j=h.containerAtIndex(a.index),k=h.itemBoxAtIndex(a.index),l=h.itemAtIndex(a.index);if(j&&k&&l){var m=e(j);f(j),m&&b.UI._ItemEventsHandler.renderSelection(k,l,c,!0,j)}}},_animateSelectionChange:function(c,e){function f(){var e=c?"addClass":"removeClass";if(d[e](i,b.UI._selectedClass),d[e](h,b.UI._selectedClass),g._selectionHint){var f=a(g._selectionHint,b.UI._selectionHintClass);f&&d[e](f,b.UI._revealedClass)}}var g=this,h=this._site.pressedContainer,i=this._site.pressedItemBox;this._swipeBehaviorSelectionChanged=!0,this.swipeBehaviorSelected=c;var j=b.UI._getElementsByClasses(this._site.pressedItemBox,[b.UI._selectionBorderClass,b.UI._selectionBackgroundClass]);(!c||e)&&(j=j.concat(b.UI._getElementsByClasses(this._site.pressedItemBox,[b.UI._selectionCheckmarkBackgroundClass,b.UI._selectionCheckmarkClass]))),b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:"+(c?"hitSelectThreshold":"hitUnselectThreshold")+",info"),this._applyUIInBatches(function(){b.Utilities._writeProfilerMark("WinJS.UI._ItemEventsHandler:"+(c?"apply":"remove")+"SelectionVisual,info");for(var a=c?1:0,d=0;d<j.length;d++)j[d].style.opacity=a;f()})},_showSelectionHintCheckmark:function(){if(this._selectionHint){var c=a(this._selectionHint,b.UI._selectionHintClass);c&&(c.style.display="block")}},_hideSelectionHintCheckmark:function(){if(this._selectionHint){var c=a(this._selectionHint,b.UI._selectionHintClass);c&&(c.style.display="none")}},_addSelectionHint:function(){if(this._site.pressedEntity.type!==b.UI.ObjectType.groupHeader){var a,c=this._site;if(c.customFootprintParent){a=this._selectionHint=document.createElement("div"),a.className=b.UI._containerClass;var e=this;c.getItemPosition(this._site.pressedEntity).then(function(b){if(!c.isZombie()&&e._selectionHint&&e._selectionHint===a){var d=a.style,f=";position:absolute;"+(c.rtl()?"right:":"left:")+b.left+"px;top:"+b.top+"px;width:"+b.contentWidth+"px;height:"+b.contentHeight+"px";d.cssText+=f,c.customFootprintParent.insertBefore(e._selectionHint,e._site.pressedItemBox)}},function(){})}else a=this._selectionHint=this._site.pressedContainer;if(this._selectionHintTracker[i(a)])this._selectionHintTracker[i(a)]++;else{if(d.addClass(a,b.UI._footprintClass),!c.selection._isIncluded(this._site.pressedEntity.index)){var f=document.createElement("div");f.className=b.UI._selectionHintClass,f.textContent=b.UI._SELECTION_CHECKMARK,f.style.display="none",this._selectionHint.insertBefore(f,this._selectionHint.firstElementChild)}this._selectionHintTracker[i(a)]=1}}},_removeSelectionHint:function(c){if(c){var e=--this._selectionHintTracker[i(c)];if(!e)if(delete this._selectionHintTracker[i(c)],this._site.customFootprintParent)c.parentNode&&c.parentNode.removeChild(c);else{d.removeClass(c,b.UI._footprintClass);var f=a(c,b.UI._selectionHintClass);f&&f.parentNode.removeChild(f)}}},_releasedElement:function(a){return document.elementFromPoint(a.clientX,a.clientY)},_applyUIInBatches:function(a){function b(){c._work.length>0?(c._flushUIBatches(),c._paintedThisFrame=requestAnimationFrame(b.bind(c))):c._paintedThisFrame=null}var c=this;this._work.push(a),this._paintedThisFrame||b()},_flushUIBatches:function(){if(this._work.length>0){var a=this._work;this._work=[];for(var b=0;b<a.length;b++)a[b]()}},_selectionAllowed:function(a){var c=void 0!==a?this._site.itemAtIndex(a):null,e=!(c&&d.hasClass(c,b.UI._nonSelectableClass));return e&&this._site.selectionMode!==b.UI.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===b.UI.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===b.UI.TapBehavior.toggleSelect||this._site.tapBehavior===b.UI.TapBehavior.directSelect},_staticMode:function(a){return a?this._site.headerTapBehavior===b.UI.GroupHeaderTapBehavior.none:this._site.tapBehavior===b.UI.TapBehavior.none&&this._site.selectionMode===b.UI.SelectionMode.none}},{setAriaSelected:function(a,b){var c="true"===a.getAttribute("aria-selected");b!==c&&a.setAttribute("aria-selected",b)},renderSelection:function(a,e,f,g,h){if(!b.UI._ItemEventsHandler._selectionTemplate){b.UI._ItemEventsHandler._selectionTemplate=[],b.UI._ItemEventsHandler._selectionTemplate.push(c(b.UI._selectionBackgroundClass)),b.UI._ItemEventsHandler._selectionTemplate.push(c(b.UI._selectionBorderClass)),b.UI._ItemEventsHandler._selectionTemplate.push(c(b.UI._selectionCheckmarkBackgroundClass));var i=c(b.UI._selectionCheckmarkClass);i.textContent=b.UI._SELECTION_CHECKMARK,b.UI._ItemEventsHandler._selectionTemplate.push(i)}if(f!==b.UI._isSelectionRendered(a)){if(f){a.insertBefore(b.UI._ItemEventsHandler._selectionTemplate[0].cloneNode(!0),a.firstElementChild);for(var j=1,k=b.UI._ItemEventsHandler._selectionTemplate.length;k>j;j++)a.appendChild(b.UI._ItemEventsHandler._selectionTemplate[j].cloneNode(!0))}else for(var l=a.querySelectorAll(b.UI._selectionPartsSelector),j=0,k=l.length;k>j;j++)a.removeChild(l[j]);d[f?"addClass":"removeClass"](a,b.UI._selectedClass),h&&d[f?"addClass":"removeClass"](h,b.UI._selectedClass)}g&&b.UI._ItemEventsHandler.setAriaSelected(e,f)}})})})}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{_ItemsContainer:b.Namespace._lazy(function(){var a=b.Utilities,c=b.Promise,d=function(a){this.site=a,this._itemData={},this.waitingItemRequests={}};return d.prototype={requestItem:function(a){this.waitingItemRequests[a]||(this.waitingItemRequests[a]=[]);var b=this,d=new c(function(c){var d=b._itemData[a];d&&!d.detached&&d.element?c(d.element):b.waitingItemRequests[a].push(c)});return d},removeItem:function(a){delete this._itemData[a]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(a,b){this._itemData[a]=b,b.detached||this.notify(a,b)},notify:function(a,b){if(this.waitingItemRequests[a]){for(var c=this.waitingItemRequests[a],d=0;d<c.length;d++)c[d](b.element);this.waitingItemRequests[a]=[]}},elementAvailable:function(a){var b=this._itemData[a];b.detached=!1,this.notify(a,b)},itemAt:function(a){var b=this._itemData[a];return b?b.element:null},itemDataAt:function(a){return this._itemData[a]},containerAt:function(a){var b=this._itemData[a];return b?b.container:null},itemBoxAt:function(a){var b=this._itemData[a];return b?b.itemBox:null},itemBoxFrom:function(c){for(;c&&!a.hasClass(c,b.UI._itemBoxClass);)c=c.parentNode;return c},containerFrom:function(c){for(;c&&!a.hasClass(c,b.UI._containerClass);)c=c.parentNode;return c},index:function(a){var c=this.containerFrom(a);if(c)for(var d in this._itemData)if(this._itemData[d].container===c)return parseInt(d,10);return b.UI._INVALID_INDEX},each:function(a){for(var b in this._itemData)if(this._itemData.hasOwnProperty(b)){var c=this._itemData[b];a(parseInt(b,10),c.element,c)}},eachIndex:function(a){for(var b in this._itemData)if(a(parseInt(b,10)))break},count:function(){return Object.keys(this._itemData).length}},d})})}(this,WinJS),function(a,b,c){"use strict";function d(a){return"_win-dynamic-"+a+"-"+z++}function e(){var a,b,c,d=y.sheet.cssRules,e=A.length;for(a=0;e>a;a++)for(c="."+A[a]+" ",b=d.length-1;b>=0;b--)-1!==d[b].selectorText.indexOf(c)&&y.sheet.deleteRule(b);A=[]}function f(a,c,d,f){e();var g="."+b.UI._listViewClass+" ."+a+" "+d+" { "+f+"}",h="_addDynamicCssRule:"+a+",info";c?c._writeProfilerMark(h):b.Utilities._writeProfilerMark("WinJS.UI.ListView:Layout"+h),y.sheet.insertRule(g,0)}function g(a){A.push(a)}function h(a,b,c){return Math.max(a,Math.min(b,c))}function i(a,c){return b.Utilities.convertToPixels(a,window.getComputedStyle(a,null)[c])}function j(a,b){return i(b,"margin"+a)+i(b,"border"+a+"Width")+i(b,"padding"+a)}function k(a){return j("Top",a)+j("Bottom",a)}function l(a){return j("Left",a)+j("Right",a)}function m(a,b){if(a.items)for(var c=0,d=a.items.length;d>c;c++)b(a.items[c],c);else for(var e=0,f=0;e<a.itemsBlocks.length;e++)for(var g=a.itemsBlocks[e],c=0,d=g.items.length;d>c;c++)b(g.items[c],f++)}function n(a,b){if(0>b)return null;if(a.items)return b<a.items.length?a.items[b]:null;var c=a.itemsBlocks[0].items.length,d=Math.floor(b/c),e=b%c;return d<a.itemsBlocks.length&&e<a.itemsBlocks[d].items.length?a.itemsBlocks[d].items[e]:null}function o(a,b){for(var c,d=0,e=b.length;e>d;d++)if(b[d].itemsContainer.element===a){c=b[d].itemsContainer;break}return c}function p(a){var b,c;return a.itemsBlocks?(b=a.itemsBlocks.length,c=b>0?a.itemsBlocks[0].items.length*(b-1)+a.itemsBlocks[b-1].items.length:0):c=a.items.length,c}function q(a){if(!G){var b=document.createElement("div");b.style.width="500px",b.style.visibility="hidden";var c=document.createElement("div");c.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",c.innerHTML="<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>",b.appendChild(c),a.viewport.insertBefore(b,a.viewport.firstChild);var d=b.offsetWidth>0,e=200;d&&(G={supportsCSSGrid:!!(B["grid-row"]&&B["grid-rows"]&&B["grid-row-span"]&&B["grid-column"]&&B["grid-columns"]&&B["grid-column-span"]),nestedFlexTooLarge:c.firstElementChild.offsetWidth>e,nestedFlexTooSmall:c.firstElementChild.offsetWidth<e}),a.viewport.removeChild(b)}return G}function r(a){return b.Promise.is(a)?{realizedRangeComplete:a,layoutComplete:a}:"object"==typeof a&&a&&a.layoutComplete?a:{realizedRangeComplete:b.Promise.wrap(),layoutComplete:b.Promise.wrap()}}function s(a){return{left:i(a,"marginLeft"),right:i(a,"marginRight"),top:i(a,"marginTop"),bottom:i(a,"marginBottom")}}var t=b.Utilities,u=t.Key,v=t.Scheduler,w=b.Utilities._uniqueID,x={get itemInfoIsInvalid(){return b.Resources._getWinJSString("ui/itemInfoIsInvalid").value},get groupInfoResultIsInvalid(){return b.Resources._getWinJSString("ui/groupInfoResultIsInvalid").value}},y=document.createElement("style");document.head.appendChild(y);var z=0,A=[],B=b.Utilities._browserStyleEquivalents,C=B.transform,D=b.Utilities._browserStyleEquivalents.transition.scriptName,E=C.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",F=12,G=null;b.Namespace.define("WinJS.UI",{Layout:b.Class.define(function(){}),_LayoutCommon:b.Namespace._lazy(function(){return b.Class.derive(b.UI.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(a){this._groupHeaderPosition=a,this._invalidateLayout()}},initialize:function(a,c){a._writeProfilerMark("Layout:initialize,info"),this._inListMode||t.addClass(a.surface,b.UI._gridLayoutClass),this._envInfo=q(a)||{},this._envInfo.supportsCSSGrid||t.addClass(a.surface,b.UI._noCSSGrid),this._backdropColorClassName&&t.addClass(a.surface,this._backdropColorClassName),this._disableBackdropClassName&&t.addClass(a.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=a,this._groupsEnabled=c,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(a){this._orientation=a,this._horizontal="horizontal"===a,this._invalidateLayout()}},uninitialize:function(){function a(a){var b,c=a.length;for(b=0;c>b;b++)a[b].cleanUp(!0)}var c="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(c),t.removeClass(this._site.surface,b.UI._gridLayoutClass),t.removeClass(this._site.surface,b.UI._headerPositionTopClass),t.removeClass(this._site.surface,b.UI._headerPositionLeftClass),b.Utilities.removeClass(this._site.surface,b.UI._structuralNodesClass),this._site.surface.style.cssText="",this._groups&&(a(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=null,this._backdropColorClassName&&(t.removeClass(this._site.surface,this._backdropColorClassName),g(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(t.removeClass(this._site.surface,this._disableBackdropClassName),g(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):b.Utilities._writeProfilerMark("WinJS.UI.ListView:"+c)},numberOfItemsPerItemsBlock:{get:function(){function a(){var a,b=c._site.groupCount;for(a=0;b>a;a++)if(c._isCellSpanning(a))return!1;return!0}var c=this;return c._measureItem(0).then(function(){return c._sizes.viewportContentSize!==c._getViewportCrossSize()&&c._viewportSizeChanged(c._getViewportCrossSize()),c._envInfo.nestedFlexTooLarge||c._envInfo.nestedFlexTooSmall||!a()?(c._usingStructuralNodes=!1,null):(c._usingStructuralNodes=b.UI._LayoutCommon._barsPerItemsBlock>0,b.UI._LayoutCommon._barsPerItemsBlock*c._itemsPerBar)})}},layout:function(a,c,d,e){function f(a){function b(a){if(l._usingStructuralNodes){var b=[];return a.itemsBlocks.forEach(function(a){b=b.concat(a.items.slice(0))}),b}return a.items.slice(0)}return{element:a.element,items:b(a)}}function g(){function d(a,b){var c=a.enableCellSpanning?H.CellSpanningGroup:H.UniformGroup;return new c(l,b)}var e,g=l._groups.length>0?l._getRealizationRange():null,h=[],i=[],j={},k={},m=0,n=a.length;for(e=0;n>e;e++){var o=null,q=l._getGroupInfo(e),r=l._site.groupFromIndex(e).key,s=l._groupMap[r],t=s instanceof H.CellSpanningGroup,u=q.enableCellSpanning;if(s)if(t!==u)j[r]=!0;else{var v=Math.max(0,c.firstIndex-s.startIndex),w=l._rangeForGroup(s,g);w&&v<=w.lastIndex&&(o={firstIndex:Math.max(v,w.firstIndex),lastIndex:w.lastIndex})}var x,y=d(q,a[e].itemsContainer.element);x=y.prepareLayoutWithCopyOfTree?y.prepareLayoutWithCopyOfTree(f(a[e].itemsContainer),o,s,{groupInfo:q,startIndex:m}):y.prepareLayout(p(a[e].itemsContainer),o,s,{groupInfo:q,startIndex:m}),i.push(x),m+=y.count,h.push(y),k[r]=y}return b.Promise.join(i).then(function(){for(var a=0,b=0,c=h.length;c>b;b++){var d=h[b];d.offset=a,a+=l._getGroupSize(d)}Object.keys(l._groupMap).forEach(function(a){var b=!j[a];l._groupMap[a].cleanUp(b)}),l._groups=h,l._groupMap=k})}function h(a,b,d){var e,f=l._groups[a],g=Math.max(0,c.firstIndex-f.startIndex),h=l._rangeForGroup(f,b);return d?void f.layoutRealizedRange(g,h):(h||(e=f.startIndex+f.count-1<b.firstIndex),f.layoutUnrealizedRange(g,h,e))}function i(){if(0!==l._groups.length){var b,d=l._getRealizationRange(),e=a.length,f=m.groupIndexFromItemIndex(c.firstIndex);for(b=f;e>b;b++)h(b,d,!0),l._layoutGroup(b)}}function j(){if(0===l._groups.length)return b.Promise.wrap();var a=l._getRealizationRange(),d=m.groupIndexFromItemIndex(a.firstIndex-1),e=m.groupIndexFromItemIndex(a.lastIndex+1),f=m.groupIndexFromItemIndex(c.firstIndex),g=[],i=l._groups.length,j=!1,k=d,n=Math.max(f,e);for(n=Math.max(k+1,n);!j;)j=!0,k>=f&&(g.push(h(k,a,!1)),j=!1,k--),i>n&&(g.push(h(n,a,!1)),j=!1,n++);return b.Promise.join(g)}var k,l=this,m=l._site,n="Layout.layout",o=n+":realizedRange";return l._site._writeProfilerMark(n+",StartTM"),l._site._writeProfilerMark(o+",StartTM"),k=l._measureItem(0).then(function(){return b.Utilities[l._usingStructuralNodes?"addClass":"removeClass"](l._site.surface,b.UI._structuralNodesClass),l._sizes.viewportContentSize!==l._getViewportCrossSize()&&l._viewportSizeChanged(l._getViewportCrossSize()),l._cacheRemovedElements(d,l._cachedItemRecords,l._cachedInsertedItemRecords,l._cachedRemovedItems,!1),l._cacheRemovedElements(e,l._cachedHeaderRecords,l._cachedInsertedHeaderRecords,l._cachedRemovedHeaders,!0),g()}).then(function(){l._syncDomWithGroupHeaderPosition(a),l._horizontal?l._groupsEnabled&&l._groupHeaderPosition===b.UI.HeaderPosition.left?m.surface.style.cssText+=";height:"+l._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+l._sizes.headerContainerWidth+"px auto)["+a.length+"]":m.surface.style.height=l._sizes.surfaceContentSize+"px":l._groupsEnabled&&l._groupHeaderPosition===b.UI.HeaderPosition.top?m.surface.style.cssText+=";width:"+l._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+l._sizes.headerContainerHeight+"px auto)["+a.length+"]":m.surface.style.width=l._sizes.surfaceContentSize+"px",i(),l._layoutAnimations(d,e),l._site._writeProfilerMark(o+":complete,info"),l._site._writeProfilerMark(o+",StopTM")},function(a){return l._site._writeProfilerMark(o+":canceled,info"),l._site._writeProfilerMark(o+",StopTM"),b.Promise.wrapError(a)}),l._layoutPromise=k.then(function(){return j().then(function(){l._site._writeProfilerMark(n+":complete,info"),l._site._writeProfilerMark(n+",StopTM")},function(a){return l._site._writeProfilerMark(n+":canceled,info"),l._site._writeProfilerMark(n+",StopTM"),b.Promise.wrapError(a)})}),{realizedRangeComplete:k,layoutComplete:l._layoutPromise}},itemsFromRange:function(a,b){return this._rangeContainsItems(a,b)?{firstIndex:this._firstItemFromRange(a),lastIndex:this._lastItemFromRange(b)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(a,c){function d(){var c={type:a.type,index:a.index-g.startIndex},d=g.getAdjacent(c,h);if("boundary"===d){var i=e._groups[f-1],j=e._groups[f+1],k=e._groups.length-1;if(h===u.leftArrow){if(0===f)return a;if(i instanceof H.UniformGroup&&g instanceof H.UniformGroup){var l=e._indexToCoordinate(c.index),m=e._horizontal?l.row:l.column,n=Math.floor((i.count-1)/e._itemsPerBar),o=n*e._itemsPerBar;return{type:b.UI.ObjectType.item,index:i.startIndex+Math.min(i.count-1,o+m)}}return{type:b.UI.ObjectType.item,index:g.startIndex-1}}if(h===u.rightArrow){if(f===k)return a;if(g instanceof H.UniformGroup&&j instanceof H.UniformGroup){var l=e._indexToCoordinate(c.index),m=e._horizontal?l.row:l.column;return{type:b.UI.ObjectType.item,index:j.startIndex+Math.min(j.count-1,m)}}return{type:b.UI.ObjectType.item,index:j.startIndex}}return a}return d.index+=g.startIndex,d}var e=this,f=e._site.groupIndexFromItemIndex(a.index),g=e._groups[f],h=e._adjustedKeyForOrientationAndBars(e._adjustedKeyForRTL(c),g instanceof H.CellSpanningGroup);if(a.type===b.UI.ObjectType.groupHeader){if(c!==u.pageUp&&c!==u.pageDown){switch(h){case u.leftArrow:return{type:b.UI.ObjectType.groupHeader,index:Math.max(0,a.index-1)};case u.rightArrow:return{type:b.UI.ObjectType.groupHeader,index:Math.min(e._groups.length-1,a.index+1)}}return a}a={type:b.UI.ObjectType.item,index:this._groups[a.index].startIndex}}switch(e._adjustedKeyForRTL(c)){case u.upArrow:case u.leftArrow:case u.downArrow:case u.rightArrow:return d();default:return b.UI._LayoutCommon.prototype._getAdjacentForPageKeys.call(e,a,c)}},hitTest:function(a,c){var d,e=this._sizes;a-=e.layoutOriginX,c-=e.layoutOriginY;var f=this._groupFromOffset(this._horizontal?a:c),g=this._groups[f];return this._horizontal?a-=g.offset:c-=g.offset,this._groupsEnabled&&(this._groupHeaderPosition===b.UI.HeaderPosition.left?a-=e.headerContainerWidth:c-=e.headerContainerHeight),d=g.hitTest(a,c),d.index+=g.startIndex,d.insertAfterIndex+=g.startIndex,d},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var a=this._getRealizationRange(),b=this._site.tree,c=0,d="horizontal"===this.orientation,e=0,f=b.length;f>e;e++){var g=b[e],h=!1,i=this._groups[e],j=i instanceof H.CellSpanningGroup,k=i?i.offset:0;if(m(g.itemsContainer,function(b,d){if(a.firstIndex<=c&&a.lastIndex>=c&&(h=!0,!this._cachedItemRecords[c])){var f=this._getItemPositionForAnimations(c,e,d),g=f.row,i=f.column,k=f.left,l=f.top;this._cachedItemRecords[c]={oldRow:g,oldColumn:i,oldLeft:k,oldTop:l,width:f.width,height:f.height,element:b,inCellSpanningGroup:j}}c++}.bind(this)),h){var l=e;if(!this._cachedHeaderRecords[l]){var n=this._getHeaderPositionForAnimations(l);this._cachedHeaderRecords[l]={oldLeft:n.left,oldTop:n.top,width:n.width,height:n.height,element:g.header}}this._cachedGroupRecords[w(g.itemsContainer.element)]||(this._cachedGroupRecords[w(g.itemsContainer.element)]={oldLeft:d?k:0,left:d?k:0,oldTop:d?0:k,top:d?0:k,element:g.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(a,c){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(a,c);for(var d=this._getRealizationRange(),e=this._site.tree,f=0,g="horizontal"===this.orientation,h=0,i=e.length;i>h;h++){var j=e[h],k=this._groups[h],l=k instanceof H.CellSpanningGroup,n=k?k.offset:0,o=0,p=0,q=this._cachedGroupRecords[w(j.itemsContainer.element)];q&&(g?o=q.oldLeft-n:p=q.oldTop-n),m(j.itemsContainer,function(a,c){if(d.firstIndex<=f&&d.lastIndex>=f){var e=this._cachedItemRecords[f];if(e){var g=this._getItemPositionForAnimations(f,h,c),i=g.row,j=g.column,k=g.left,m=g.top;if(e.inCellSpanningGroup=e.inCellSpanningGroup||l,e.oldRow!==i||e.oldColumn!==j||e.oldTop!==m||e.oldLeft!==k){e.row=i,e.column=j,e.left=k,e.top=m;var n=e.oldLeft-e.left-o,q=e.oldTop-e.top-p;if(n=(this._site.rtl?-1:1)*n,e.xOffset=n,e.yOffset=q,0!==n||0!==q){var r=e.element;e.needsToResetTransform=!0,r.style[D]="",r.style[C.scriptName]="translate("+n+"px,"+q+"px)"}var s=a.parentNode;b.Utilities.hasClass(s,b.UI._itemsBlockClass)&&(this._animatingItemsBlocks[w(s)]=s)}}else this._cachedInsertedItemRecords[f]=a,a.style[D]="",a.style.opacity=0}f++}.bind(this));var r=h,s=this._cachedHeaderRecords[r];if(s){var t=this._getHeaderPositionForAnimations(r);if(s.height=t.height,s.width=t.width,s.oldLeft!==t.left||s.oldTop!==t.top){s.left=t.left,s.top=t.top;var u=s.oldLeft-s.left,v=s.oldTop-s.top;if(u=(this._site.rtl?-1:1)*u,0!==u||0!==v){s.needsToResetTransform=!0;var x=s.element;x.style[D]="",x.style[C.scriptName]="translate("+u+"px,"+v+"px)"}}}if(q&&(g&&q.left!==n||!g&&q.top!==n)){var y=q.element;if(0===o&&0===p)q.needsToResetTransform&&(q.needsToResetTransform=!1,y.style[C.scriptName]="");else{var z=(this._site.rtl?-1:1)*o,A=p;q.needsToResetTransform=!0,y.style[D]="",y.style[C.scriptName]="translate("+z+"px, "+A+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var B=Object.keys(this._animatingItemsBlocks),E=0,F=B.length;F>E;E++)this._animatingItemsBlocks[B[E]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function a(){if(d(),B)e();else{if(W._itemsPerBar>1)for(var a=W._itemsPerBar*W._sizes.containerCrossSize+W._getHeaderSizeContentAdjustment()+W._sizes.containerMargins[N?"top":q.rtl?"right":"left"]+(N?W._sizes.layoutOriginY:W._sizes.layoutOriginX),b=0,c=t.length;c>b;b++){var f=t[b];f[O]>f[P]?(I=Math.max(I,f[Q]+f[N?"height":"width"]),K=Math.max(K,a-f[R]),E=!0,M.push(f)):f[O]<f[P]&&(J=Math.max(J,a-f[Q]),L=Math.max(L,f[R]+f[N?"height":"width"]),M.push(f),E=!0)}q.rtl&&!N&&(I*=-1,K*=-1,J*=-1,L*=-1),E?g(W._itemsPerBar):j()}}function c(a){z=b.Promise.join(A),z.done(function(){A=[],m&&(b.UI.Layout._debugAnimations?requestAnimationFrame(function(){a()}):a())})}function d(){if(s.length){q._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),x+=60,y+=60;var a=120;n&&(a*=10),A.push(b.UI.executeTransition(s,[{property:"opacity",delay:v,duration:a,timing:"linear",to:0,skipStylesReset:!0}])),q._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function e(){q._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var a=[],d=0,e=t.length;e>d;d++){var g=t[d],h=g.element;a.push(h)}for(var d=0,e=u.length;e>d;d++){var g=u[d],h=g.element;a.push(h)}var i=120;n&&(i*=10),A.push(b.UI.executeTransition(a,{property:"opacity",delay:v,duration:i,timing:"linear",to:0})),c(f),q._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function f(){q._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),y=0;for(var a=[],c=0,d=t.length;d>c;c++){var e=t[c],f=e.element;f.style[C.scriptName]="",a.push(f)}for(var c=0,d=u.length;d>c;c++){var e=u[c],f=e.element;f.style[C.scriptName]="",a.push(f)}var g=120;n&&(g*=10),A.push(b.UI.executeTransition(a,{property:"opacity",delay:y,duration:g,timing:"linear",to:1})),q._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),k()}function g(a){q._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var d={},e=0,f=M.length;f>e;e++){var g=M[e],h=g.xOffset,j=g.yOffset;g[O]>g[P]?N?j-=I:h-=I:g[O]<g[P]&&(N?j+=J:h+=J);var k=g.element;F=Math.min(F,N?h:j),G=Math.max(G,N?h:j);var l=k.parentNode;b.Utilities.hasClass(l,"win-itemscontainer")||(l=l.parentNode);var m=d[w(l)];if(!m){var r=p(o(l,q.tree));d[w(l)]=m=Math.ceil(r/a)-1}M[e][N?"column":"row"]===m&&(H[w(l)]=l);var s=80;n&&(s*=10),A.push(b.UI.executeTransition(k,{property:C.cssName,delay:x,duration:s,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+h+"px,"+j+"px)"}))}for(var t=Object.keys(H),e=0,f=t.length;f>e;e++){var u=H[t[e]];q.rtl&&N?(u.style.paddingLeft=-1*F+"px",u.style.marginLeft=F+"px"):(u.style[N?"paddingRight":"paddingBottom"]=G+"px",u.style[N?"marginRight":"marginBottom"]="-"+G+"px")}for(var v=Object.keys(S),e=0,f=v.length;f>e;e++)S[v[e]].classList.add(b.UI._clipClass);c(i),q._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function h(){for(var a=Object.keys(H),c=0,d=a.length;d>c;c++){var e=H[a[c]];q.rtl&&N?(e.style.paddingLeft="",e.style.marginLeft=""):(e.style[N?"paddingRight":"paddingBottom"]="",e.style[N?"marginRight":"marginBottom"]="")}H={};for(var f=Object.keys(S),c=0,d=f.length;d>c;c++){var g=S[f[c]];g.style.overflow="",g.classList.remove(b.UI._clipClass)}}function i(){q._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var a=0,c=M.length;c>a;a++){var d=M[a],e=0,f=0;d[O]>d[P]?N?f=K:e=K:d[O]<d[P]&&(N?f=-1*L:e=-1*L),d.element.style[D]="",d.element.style[C.scriptName]="translate("+e+"px,"+f+"px)"}q._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),b.UI.Layout._debugAnimations?requestAnimationFrame(function(){j(!0)}):j(!0)}function j(a){var c=200;if(a&&(c=150,x=0,y=0),n&&(c*=10),t.length>0||u.length>0){q._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var d=[],e=0,f=u.length;f>e;e++){var g=u[e].element;d.push(g)}for(var e=0,f=t.length;f>e;e++){var g=t[e].element;d.push(g)}A.push(b.UI.executeTransition(d,{property:C.cssName,delay:x,duration:c,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),y+=80,q._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}k()}function k(){if(r.length>0){q._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var a=120;n&&(a*=10),A.push(b.UI.executeTransition(r,[{property:"opacity",delay:y,duration:a,timing:"linear",to:1}])),q._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}c(l)}function l(){q._writeProfilerMark("Animation:cleanupAnimations,StartTM"),h();for(var a=0,c=s.length;c>a;a++){var d=s[a];d.parentNode&&(b.Utilities._disposeElement(d),d.parentNode.removeChild(d))}q._writeProfilerMark("Animation:cleanupAnimations,StopTM"),W._animationsRunning=null,m.complete()}var m=new b._Signal;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),m.complete(),m.promise;this._animationsRunning=m.promise;for(var n=b.UI.Layout._debugAnimations||b.UI.Layout._slowAnimations,q=this._site,r=this._insertedElements,s=this._removedElements,t=this._itemMoveRecords,u=this._moveRecords,v=0,x=0,y=0,z=null,A=[],B=(this._site.surface,!1),E=!1,F=0,G=0,H={},I=0,J=0,K=0,L=0,M=[],N="horizontal"===this.orientation,O=N?"oldColumn":"oldRow",P=N?"column":"row",Q=N?"oldTop":"oldLeft",R=N?"top":"left",S=this._animatingItemsBlocks,T=0,U=t.length;U>T;T++){var V=t[T];if(V.inCellSpanningGroup){B=!0;break}}var W=this;return b.UI.Layout._debugAnimations?requestAnimationFrame(function(){a()}):a(),this._resetAnimationCaches(!0),m.promise.then(null,function(){h();for(var a=0,c=u.length;c>a;a++){var d=u[a].element;d.style[C.scriptName]="",d.style.opacity=1}for(var a=0,c=t.length;c>a;a++){var d=t[a].element;d.style[C.scriptName]="",d.style.opacity=1}for(var a=0,c=r.length;c>a;a++)r[a].style.opacity=1;for(var a=0,c=s.length;c>a;a++){var d=s[a];d.parentNode&&(b.Utilities._disposeElement(d),d.parentNode.removeChild(d))}this._animationsRunning=null,m=null,z&&z.cancel()}.bind(this)),m.promise},dragOver:function(a,b,c){var d=this.hitTest(a,b),e=this._groups?this._site.groupIndexFromItemIndex(d.index):0,f=this._site.tree[e].itemsContainer,g=p(f),h=this._groups?this._groups[e].startIndex:0,i=this._getVisibleRange();d.index-=h,d.insertAfterIndex-=h,i.firstIndex=Math.max(i.firstIndex-h-1,0),i.lastIndex=Math.min(i.lastIndex-h+1,g);var j=Math.max(Math.min(g-1,d.insertAfterIndex),-1),k=Math.min(j+1,g);if(c){for(var l=j;l>=i.firstIndex;l--){if(!c._isIncluded(l+h)){j=l;
break}l===i.firstIndex&&(j=-1)}for(var l=k;l<i.lastIndex;l++){if(!c._isIncluded(l+h)){k=l;break}l===i.lastIndex-1&&(k=g)}}var m=n(f,k),o=n(f,j);if(this._animatedDragItems)for(var l=0,q=this._animatedDragItems.length;q>l;l++){var r=this._animatedDragItems[l];r&&(r.style[D]=this._site.animationsDisabled?"":E,r.style[C.scriptName]="")}this._animatedDragItems=[];var s="horizontal"===this.orientation,t=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[e]instanceof H.CellSpanningGroup&&(t=1===this._groups[e]._slotsPerColumn);var u=0,v=0;!s&&!t||s&&t?u=this._site.rtl?-F:F:v=F,m&&(m.style[D]=this._site.animationsDisabled?"":E,m.style[C.scriptName]="translate("+u+"px, "+v+"px)",this._animatedDragItems.push(m)),o&&(o.style[D]=this._site.animationsDisabled?"":E,o.style[C.scriptName]="translate("+-u+"px, -"+v+"px)",this._animatedDragItems.push(o))},dragLeave:function(){if(this._animatedDragItems)for(var a=0,b=this._animatedDragItems.length;b>a;a++)this._animatedDragItems[a].style[D]=this._site.animationsDisabled?"":E,this._animatedDragItems[a].style[C.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(a){a===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),a&&(this._itemsPerBar=Math.min(this._itemsPerBar,a)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=a,this._invalidateLayout())},_getItemPosition:function(a){if(this._groupsEnabled){var b=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(a)),c=this._groups[b],d=a-c.startIndex;return this._getItemPositionForAnimations(a,b,d)}return this._getItemPositionForAnimations(a,0,a)},_getRealizationRange:function(){var a=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(a.firstPixel),lastIndex:this._lastItemFromRange(a.lastPixel)}},_getVisibleRange:function(){var a=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(a.firstPixel),lastIndex:this._lastItemFromRange(a.lastPixel)}},_resetAnimationCaches:function(a){if(!a){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var c=Object.keys(this._animatingItemsBlocks),d=0,e=c.length;e>d;d++){var f=this._animatingItemsBlocks[c[d]];f.style.overflow="",f.classList.remove(b.UI._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(a,b,c,d,e){var f=(this._sizes.containerMargins,"left");this._site.rtl&&(f="right");var g,h;e?(g=this._sizes.headerContainerOuterX,h=this._sizes.headerContainerOuterY):(g=this._sizes.containerMargins[f],h=this._sizes.containerMargins.top);for(var i=0,j=a.length;j>i;i++){var k=a[i];if(-1===k.newIndex){var l=k.element,m=b[k.oldIndex];m&&(m.element=l,delete b[k.oldIndex],l.style.position="absolute",l.style[D]="",l.style.top=m.oldTop-h+"px",l.style[f]=m.oldLeft-g+"px",l.style.width=m.width+"px",l.style.height=m.height+"px",l.style[C.scriptName]="",this._site.surface.appendChild(l),d.push(m)),c[k.oldIndex]&&delete c[k.oldIndex]}}},_cacheInsertedElements:function(a,b,c){for(var d={},e=0,f=a.length;f>e;e++){var g=a[e],h=b[g.oldIndex];if(h&&delete b[g.oldIndex],h||-1===g.oldIndex||g.moved){var i=c[g.newIndex];i&&delete c[g.newIndex];var j=g.element;d[g.newIndex]=j,j.style[D]="",j.style[C.scriptName]="",j.style.opacity=0}}for(var k=Object.keys(b),e=0,f=k.length;f>e;e++)d[k[e]]=b[k[e]];return d},_resetStylesForRecords:function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++){var e=a[b[c]];e.needsToResetTransform&&(e.element.style[C.scriptName]="",e.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++){var e=a[b[c]];e.style.opacity=1}},_resetStylesForRemovedRecords:function(a){for(var c=0,d=a.length;d>c;c++){var e=a[c].element;e.parentNode&&(b.Utilities._disposeElement(e),e.parentNode.removeChild(e))}},_updateAnimationCache:function(a,b){function c(a,b){for(var c={},e=0,f=a.length;f>e;e++){var g=a[e],h=b[g.oldIndex];h&&(c[g.newIndex]=h,h.element=g.element,delete b[g.oldIndex])}for(var i=Object.keys(b),e=0,f=i.length;f>e;e++){var j=i[e],k=b[j];(!k.element||d[w(k.element)])&&(c[j]=k)}return c}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var d={},e=this._getRealizationRange(),f=this._site.tree,g=0,h=0,i=f.length;i>g;g++)m(f[g].itemsContainer,function(a){e.firstIndex<=h&&e.lastIndex>=h&&(d[w(a)]=!0),h++});this._cachedItemRecords=c(a,this._cachedItemRecords),this._cachedHeaderRecords=c(b,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(a,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(b,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function a(a,h){for(var i=0,j=a.length;j>i;i++){var k=a[i],l=k.element;k[d]+k[e]-1<f||k[d]>g||!c._site.viewport.contains(l)?l.parentNode&&(b.Utilities._disposeElement(l),l.parentNode.removeChild(l)):h.push(l)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var c=this,d="horizontal"===this.orientation?"oldLeft":"oldTop",e="horizontal"===this.orientation?"width":"height",f=this._site.scrollbarPos,g=f+this._site.viewportSize[e]-1;a(this._cachedRemovedItems,this._removedElements),a(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function a(a,d){for(var e=Object.keys(a),f=0,g=e.length;g>f;f++){var h=e[f],i=a[h];h<c.firstIndex||h>c.lastIndex||b._site.viewport.contains(i.element)?i.style.opacity=1:d.push(i)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var b=this,c=this._getVisibleRange();a(this._cachedInsertedItemRecords,this._insertedElements),a(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var a=this,b="horizontal"===this.orientation?"oldLeft":"oldTop",c="horizontal"===this.orientation?"left":"top",d="horizontal"===this.orientation?"width":"height",e=this._getRealizationRange(),f=this._site.scrollbarPos,g=f+this._site.viewportSize[d]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var h=this._site.tree,i=0,j=0,k=h.length;k>j;j++){var l=h[j],n=!1;m(l.itemsContainer,function(){if(e.firstIndex<=i&&e.lastIndex>=i){var h=this._cachedItemRecords[i];if(h){var j=(h[b]+h[d]-1>=f&&h[b]<=g||h[c]+h[d]-1>=f&&h[c]<=g)&&a._site.viewport.contains(h.element);j&&(n=!0,h.needsToResetTransform&&(this._itemMoveRecords.push(h),delete this._cachedItemRecords[i]))}}i++}.bind(this));var o=j,p=this._cachedHeaderRecords[o];p&&n&&p.needsToResetTransform&&(this._moveRecords.push(p),delete this._cachedHeaderRecords[o]);var q=this._cachedGroupRecords[w(l.itemsContainer.element)];q&&n&&q.needsToResetTransform&&(this._moveRecords.push(q),delete this._cachedGroupRecords[w(l.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(a,c,d){var e=this._groups[c],f=e.getItemPositionForAnimations(d),g=this._groups[c]?this._groups[c].offset:0,h=this._groupsEnabled&&this._groupHeaderPosition===b.UI.HeaderPosition.left?this._sizes.headerContainerWidth:0,i=this._groupsEnabled&&this._groupHeaderPosition===b.UI.HeaderPosition.top?this._sizes.headerContainerHeight:0;return f.left+=this._sizes.layoutOriginX+h+this._sizes.itemsContainerOuterX,f.top+=this._sizes.layoutOriginY+i+this._sizes.itemsContainerOuterY,f[this._horizontal?"left":"top"]+=g,f},_getHeaderPositionForAnimations:function(a){var c;if(this._groupsEnabled){var d=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,e=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==b.UI.HeaderPosition.left||this._horizontal?this._groupHeaderPosition===b.UI.HeaderPosition.top&&this._horizontal&&(d=this._groups[a].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):e=this._groups[a].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var f=this._horizontal?this._groups[a].offset:0,g=this._horizontal?0:this._groups[a].offset;c={top:this._sizes.layoutOriginY+g+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+f+this._sizes.headerContainerOuterX,height:e,width:d}}else c={top:0,left:0,height:0,width:0};return c},_rangeContainsItems:function(a,b){if(0===this._groups.length)return!1;var c=this._groups[this._groups.length-1],d=this._sizes.layoutOrigin+c.offset+this._getGroupSize(c)-1;return b>=0&&d>=a},_itemFromOffset:function(a,b){function c(a){if(!b.wholeItem){var c=e._horizontal?e._site.rtl?"right":"left":"top",d=e._horizontal?e._site.rtl?"left":"right":"bottom";return b.last?a-e._sizes.containerMargins[c]:a+e._sizes.containerMargins[d]}return a}function d(a){return b.last?a-e._getHeaderSizeGroupAdjustment()-e._sizes.itemsContainerOuterStart:a}var e=this;if(0===this._groups.length)return 0;b=b||{},a-=this._sizes.layoutOrigin,a=c(a);var f=this._groupFromOffset(d(a)),g=this._groups[f];return a-=g.offset,a-=this._getHeaderSizeGroupAdjustment(),g.startIndex+g.itemFromOffset(a,b)},_firstItemFromRange:function(a,b){return b=b||{},b.last=0,this._itemFromOffset(a,b)},_lastItemFromRange:function(a,b){return b=b||{},b.last=1,this._itemFromOffset(a,b)},_adjustedKeyForRTL:function(a){return this._site.rtl&&(a===u.leftArrow?a=u.rightArrow:a===u.rightArrow&&(a=u.leftArrow)),a},_adjustedKeyForOrientationAndBars:function(a,b){var c=a;if(b)return a;if(!this._horizontal)switch(c){case u.leftArrow:c=u.upArrow;break;case u.rightArrow:c=u.downArrow;break;case u.upArrow:c=u.leftArrow;break;case u.downArrow:c=u.rightArrow}return 1===this._itemsPerBar&&(c===u.upArrow?c=u.leftArrow:c===u.downArrow&&(c=u.rightArrow)),c},_getAdjacentForPageKeys:function(a,c){var d,e=this._sizes.containerMargins,f="horizontal"===this.orientation?e.left+e.right:e.top+e.bottom,g=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],h=this._site.scrollbarPos,i=h+g-1-e["horizontal"===this.orientation?"right":"bottom"],j=this._firstItemFromRange(h,{wholeItem:!0}),k=this._lastItemFromRange(i,{wholeItem:!1}),l=this._getItemPosition(a.index),m=!1;if((a.index<j||a.index>k)&&(m=!0,h="horizontal"===this.orientation?l.left-f:l.top-f,i=h+g-1,j=this._firstItemFromRange(h,{wholeItem:!0}),k=this._lastItemFromRange(i,{wholeItem:!1})),c===u.pageUp){if(!m&&j!==a.index)return{type:b.UI.ObjectType.item,index:j};var n;n="horizontal"===this.orientation?l.left+l.width+f+e.left:l.top+l.height+f+e.bottom;var o=this._firstItemFromRange(n-g,{wholeItem:!0});d=a.index===o?Math.max(0,a.index-this._itemsPerBar):o}else{if(!m&&k!==a.index)return{type:b.UI.ObjectType.item,index:k};var p;p="horizontal"===this.orientation?l.left-f-e.right:l.top-f-e.bottom;var q=Math.max(0,this._lastItemFromRange(p+g-1,{wholeItem:!0}));d=a.index===q?a.index+this._itemsPerBar:q}return{type:b.UI.ObjectType.item,index:d}},_isCellSpanning:function(a){var b=this._site.groupFromIndex(a),c=this._groupInfo;return c?!!("function"==typeof c?c(b):c).enableCellSpanning:!1},_getGroupInfo:function(a){var c=this._site.groupFromIndex(a),d=this._groupInfo,e=this._sizes.containerMargins,f={enableCellSpanning:!1};if(d="function"==typeof d?d(c):d){if(d.enableCellSpanning&&(+d.cellWidth!==d.cellWidth||+d.cellHeight!==d.cellHeight))throw new b.ErrorFromName("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",x.groupInfoResultIsInvalid);f={enableCellSpanning:!!d.enableCellSpanning,cellWidth:d.cellWidth+e.left+e.right,cellHeight:d.cellHeight+e.top+e.bottom}}return f},_getItemInfo:function(a){var c;if(this._itemInfo&&"function"==typeof this._itemInfo)c=this._itemInfo(a);else{if(!this._useDefaultItemInfo)throw new b.ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",x.itemInfoIsInvalid);c=this._defaultItemInfo(a)}return b.Promise.as(c).then(function(a){if(!a||+a.width!==a.width||+a.height!==a.height)throw new b.ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",x.itemInfoIsInvalid);return a})},_defaultItemInfo:function(a){var c=this;return this._site.renderItem(this._site.itemFromIndex(a)).then(function(b){return c._elementsToMeasure[a]={element:b},c._measureElements()}).then(function(){var b=c._elementsToMeasure[a],d={width:b.width,height:b.height};return delete c._elementsToMeasure[a],d},function(d){return delete c._elementsToMeasure[a],b.Promise.wrapError(d)})},_getGroupSize:function(a){var c=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===b.UI.HeaderPosition.top?c=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==b.UI.HeaderPosition.left||(c=this._sizes.headerContainerMinHeight)),Math.max(c,a.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(a){return a<this._groups[0].offset?0:this._groupFrom(function(b){return a<b.offset})},_groupFromImpl:function(a,b,c){if(a>b)return null;var d=a+Math.floor((b-a)/2),e=this._groups[d];return c(e,d)?this._groupFromImpl(a,d-1,c):b>d&&!c(this._groups[d+1],d+1)?this._groupFromImpl(d+1,b,c):d},_groupFrom:function(a){if(this._groups.length>0){var b=this._groups.length-1,c=this._groups[b];return a(c,b)?this._groupFromImpl(0,this._groups.length-1,a):b}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(t.removeClass(this._site.surface,this._containerSizeClassName),g(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var a=this;a._measuringElements=v.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){a._site._writeProfilerMark("_measureElements,StartTM");var c=a._createMeasuringSurface(),d=document.createElement("div"),e=a._site,f=a._measuringElements,g=a._elementsToMeasure,h=!1;d.className=b.UI._itemsContainerClass+" "+b.UI._laidOutClass,d.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var i,j,k=Object.keys(g);for(j=0,i=k.length;i>j;j++){var l=g[k[j]].element;l.style["-ms-grid-column"]=j+1,l.style["-ms-grid-row"]=j+1,d.appendChild(l)}for(c.appendChild(d),e.viewport.insertBefore(c,e.viewport.firstChild),f.then(null,function(){h=!0}),j=0,i=k.length;i>j&&!h;j++){var m=g[k[j]],n=m.element.querySelector("."+b.UI._itemClass);m.width=t.getTotalWidth(n),m.height=t.getTotalHeight(n)}c.parentNode&&c.parentNode.removeChild(c),f===a._measuringElements&&(a._measuringElements=null),e._writeProfilerMark("_measureElements,StopTM")},function(c){return a._measuringElements=null,b.Promise.wrapError(c)})}return this._measuringElements},_createMeasuringSurface:function(){var a=document.createElement("div");return a.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto",a.className=b.UI._scrollableClass+" "+(this._inListMode?b.UI._listLayoutClass:b.UI._gridLayoutClass),this._groupsEnabled&&(this._groupHeaderPosition===b.UI.HeaderPosition.top?t.addClass(a,b.UI._headerPositionTopClass):t.addClass(a,b.UI._headerPositionLeftClass)),a},_measureItem:function(a){function c(a,e){{var e,h=!!e,m={},n=f.rtl?"right":"left";f.rtl?"left":"right"}return f.itemCount.then(function(c){return!c||d._groupsEnabled&&!f.groupCount?b.Promise.cancel:(e=e||f.itemFromIndex(a),m.container=f.renderItem(e),d._groupsEnabled&&(m.headerContainer=f.renderHeader(d._site.groupFromIndex(f.groupIndexFromItemIndex(a)))),b.Promise.join(m))}).then(function(m){function o(){var a=d._horizontal,c=d._groupsEnabled,e=!1;g.then(null,function(){e=!0});var h=b.UI._getMargins(A),o=f.rtl?f.viewport.offsetWidth-(A.offsetLeft+A.offsetWidth):A.offsetLeft,p=A.offsetTop,v={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:k(q),surfaceOuterWidth:l(q),layoutOriginX:o-h[n],layoutOriginY:p-h.top,itemsContainerOuterHeight:k(r),itemsContainerOuterWidth:l(r),itemsContainerOuterX:j(f.rtl?"Right":"Left",r),itemsContainerOuterY:j("Top",r),itemsContainerMargins:b.UI._getMargins(r),itemBoxOuterHeight:k(u),itemBoxOuterWidth:l(u),containerOuterHeight:k(m.container),containerOuterWidth:l(m.container),emptyContainerContentHeight:t.getContentHeight(s),emptyContainerContentWidth:t.getContentWidth(s),containerMargins:b.UI._getMargins(m.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};c&&(v.headerContainerOuterX=j(f.rtl?"Right":"Left",m.headerContainer),v.headerContainerOuterY=j("Top",m.headerContainer),v.headerContainerOuterWidth=l(m.headerContainer),v.headerContainerOuterHeight=k(m.headerContainer),v.headerContainerWidth=t.getTotalWidth(m.headerContainer),v.headerContainerHeight=t.getTotalHeight(m.headerContainer),v.headerContainerMinWidth=i(m.headerContainer,"minWidth")+v.headerContainerOuterWidth,v.headerContainerMinHeight=i(m.headerContainer,"minHeight")+v.headerContainerOuterHeight);var w={sizes:v,viewportContentWidth:t.getContentWidth(f.viewport),viewportContentHeight:t.getContentHeight(f.viewport),containerContentWidth:t.getContentWidth(m.container),containerContentHeight:t.getContentHeight(m.container),containerWidth:t.getTotalWidth(m.container),containerHeight:t.getTotalHeight(m.container)};return w.viewportCrossSize=w[a?"viewportContentHeight":"viewportContentWidth"],f.readyToMeasure(),e?null:w}function p(){q.parentNode&&q.parentNode.removeChild(q)}var q=d._createMeasuringSurface(),r=document.createElement("div"),s=document.createElement("div"),u=m.container.querySelector("."+b.UI._itemBoxClass),v=f.groupIndexFromItemIndex(a);s.className=b.UI._containerClass,r.className=b.UI._itemsContainerClass+" "+b.UI._laidOutClass;var w=1,x=1,y=2,z=2,A=r;d._inListMode&&d._groupsEnabled&&(d._horizontal&&d._groupHeaderPosition===b.UI.HeaderPosition.top?(w=2,z=1,y=1,A=m.headerContainer):d._horizontal||d._groupHeaderPosition!==b.UI.HeaderPosition.left||(x=2,z=1,y=1,A=m.headerContainer)),r.style.cssText+=";display: "+(d._inListMode?(d._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+x+";-ms-grid-row: "+w,d._inListMode||(m.container.style.display="inline-block"),d._groupsEnabled&&(m.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+z+";-ms-grid-row: "+y,b.Utilities.addClass(m.headerContainer,b.UI._laidOutClass+" "+b.UI._groupLeaderClass),(d._groupHeaderPosition===b.UI.HeaderPosition.top&&d._horizontal||d._groupHeaderPosition===b.UI.HeaderPosition.left&&!d._horizontal)&&b.Utilities.addClass(r,b.UI._groupLeaderClass)),r.appendChild(m.container),r.appendChild(s),q.appendChild(r),d._groupsEnabled&&q.appendChild(m.headerContainer),f.viewport.insertBefore(q,f.viewport.firstChild);var B=o();if(!B)return p(),b.Promise.cancel;if(d._horizontal&&0===B.viewportContentHeight||!d._horizontal&&0===B.viewportContentWidth)return p(),b.Promise.cancel;if(!(h||d._isCellSpanning(v)||0!==B.containerContentWidth&&0!==B.containerContentHeight))return p(),e.then(function(){return c(a,e)});var C=d._sizes=B.sizes;if(Object.defineProperties(C,{surfaceOuterCrossSize:{get:function(){return d._horizontal?C.surfaceOuterHeight:C.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return d._horizontal?C.layoutOriginX:C.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return d._horizontal?C.itemsContainerOuterWidth:C.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return d._horizontal?C.itemsContainerOuterHeight:C.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return d._horizontal?C.itemsContainerOuterX:C.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return d._horizontal?C.itemsContainerOuterY:C.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return d._horizontal?C.containerHeight:C.containerWidth},enumerable:!0},containerSize:{get:function(){return d._horizontal?C.containerWidth:C.containerHeight},enumerable:!0}}),!d._isCellSpanning(v)){if(d._inListMode){var D=B.viewportCrossSize-C.surfaceOuterCrossSize-d._getHeaderSizeContentAdjustment()-C.itemsContainerOuterCrossSize;d._horizontal?(C.containerHeight=D,C.containerWidth=B.containerWidth):(C.containerHeight=B.containerHeight,C.containerWidth=D)}else C.containerWidth=B.containerWidth,C.containerHeight=B.containerHeight;C.containerSizeLoaded=!0}d._createContainerStyleRule(),d._viewportSizeChanged(B.viewportCrossSize),p()})}var d=this,e="Layout:measureItem",f=d._site,g=d._measuringPromise;if(!g){f._writeProfilerMark(e+",StartTM");var h=new b._Signal;d._measuringPromise=g=h.promise.then(function(){return c(a)}).then(function(){f._writeProfilerMark(e+":complete,info"),f._writeProfilerMark(e+",StopTM")},function(a){return d._measuringPromise=null,f._writeProfilerMark(e+":canceled,info"),f._writeProfilerMark(e+",StopTM"),b.Promise.wrapError(a)}),h.complete()}return g},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===b.UI.HeaderPosition.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===b.UI.HeaderPosition.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===b.UI.HeaderPosition.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===b.UI.HeaderPosition.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(a){var b=this._sizes;b.viewportContentSize=a,b.surfaceContentSize=a-b.surfaceOuterCrossSize,b.maxItemsContainerContentSize=b.surfaceContentSize-b.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),b.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(b.maxItemsContainerContentSize/b.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(b[this._horizontal?"containerHeight":"containerWidth"]=b.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var a=this._sizes;if(!this._containerSizeClassName&&a.containerSizeLoaded&&(0===a.emptyContainerContentHeight||0===a.emptyContainerContentWidth)){var c=a.containerWidth-a.containerOuterWidth+"px",e=a.containerHeight-a.containerOuterHeight+"px";this._inListMode&&(this._horizontal?e="calc(100% - "+(a.containerMargins.top+a.containerMargins.bottom)+"px)":c="auto"),this._containerSizeClassName||(this._containerSizeClassName=d("containersize"),t.addClass(this._site.surface,this._containerSizeClassName));var g="."+b.UI._containerClass,h="width:"+c+";height:"+e+";";f(this._containerSizeClassName,this._site,g,h)}},_ensureContainerSize:function(a){var c=this._sizes;if(c.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:b.Promise.wrap();var d;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)d=this._getItemInfo();else{var e=c.containerMargins;d=b.Promise.wrap({width:a.groupInfo.cellWidth-e.left-e.right,height:a.groupInfo.cellHeight-e.top-e.bottom})}var f=this;return this._ensuringContainerSize=d.then(function(a){c.containerSizeLoaded=!0,c.containerWidth=a.width+c.itemBoxOuterWidth+c.containerOuterWidth,c.containerHeight=a.height+c.itemBoxOuterHeight+c.containerOuterHeight,f._inListMode?f._itemsPerBar=1:(f._itemsPerBar=Math.floor(c.maxItemsContainerContentSize/c.containerCrossSize),f.maximumRowsOrColumns&&(f._itemsPerBar=Math.min(f._itemsPerBar,f.maximumRowsOrColumns)),f._itemsPerBar=Math.max(1,f._itemsPerBar)),f._createContainerStyleRule()}),d.done(function(){f._ensuringContainerSize=null},function(){f._ensuringContainerSize=null}),d},_indexToCoordinate:function(a,b){b=b||this._itemsPerBar;var c=Math.floor(a/b);return this._horizontal?{column:c,row:a-c*b}:{row:c,column:a-c*b}},_rangeForGroup:function(a,b){var c=a.startIndex,d=c+a.count-1;return!b||b.firstIndex>d||b.lastIndex<c?null:{firstIndex:Math.max(0,b.firstIndex-c),lastIndex:Math.min(a.count-1,b.lastIndex-c)}},_syncDomWithGroupHeaderPosition:function(a){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var c,d=a.length;if(this._oldGroupHeaderPosition===b.UI.HeaderPosition.top)if(t.removeClass(this._site.surface,b.UI._headerPositionTopClass),this._horizontal)for(c=0;d>c;c++)a[c].header.style.maxWidth="",b.Utilities.removeClass(a[c].itemsContainer.element,b.UI._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===b.UI.HeaderPosition.left){if(t.removeClass(this._site.surface,b.UI._headerPositionLeftClass),!this._horizontal)for(c=0;d>c;c++)a[c].header.style.maxHeight="",b.Utilities.removeClass(a[c].itemsContainer.element,b.UI._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===b.UI.HeaderPosition.top){if(t.addClass(this._site.surface,b.UI._headerPositionTopClass),this._horizontal)for(c=0;d>c;c++)b.Utilities.addClass(a[c].itemsContainer.element,b.UI._groupLeaderClass)}else if(t.addClass(this._site.surface,b.UI._headerPositionLeftClass),!this._horizontal)for(c=0;d>c;c++)b.Utilities.addClass(a[c].itemsContainer.element,b.UI._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(a){var c=this._groups[a],d=this._site.tree[a],e=d.header,f=d.itemsContainer.element,g=this._sizes,h=c.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===b.UI.HeaderPosition.top){var i=g.headerContainerMinWidth-g.headerContainerOuterWidth,j=c.getItemsContainerSize()-g.headerContainerOuterWidth;e.style.maxWidth=Math.max(i,j)+"px",this._envInfo.supportsCSSGrid?(e.style.msGridColumn=a+1,f.style.msGridColumn=a+1):(e.style.height=g.headerContainerHeight-g.headerContainerOuterHeight+"px",f.style.height=h-g.itemsContainerOuterHeight+"px",f.style.marginBottom=g.itemsContainerMargins.bottom+(g.maxItemsContainerContentSize-h+g.itemsContainerOuterHeight)+"px"),t.addClass(f,b.UI._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(e.style.msGridColumn=2*a+1,f.style.msGridColumn=2*a+2):(e.style.height=h-g.headerContainerOuterHeight+"px",f.style.height=h-g.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===b.UI.HeaderPosition.left){var k=g.headerContainerMinHeight-g.headerContainerOuterHeight,l=c.getItemsContainerSize()-g.headerContainerOuterHeight;e.style.maxHeight=Math.max(k,l)+"px",this._envInfo.supportsCSSGrid?(e.style.msGridRow=a+1,f.style.msGridRow=a+1):(e.style.width=g.headerContainerWidth-g.headerContainerOuterWidth+"px",f.style.width=h-g.itemsContainerOuterWidth+"px",f.style["margin"+(this._site.rtl?"Left":"Right")]=g.itemsContainerMargins[this._site.rtl?"left":"right"]+(g.maxItemsContainerContentSize-h+g.itemsContainerOuterWidth)+"px"),t.addClass(f,b.UI._groupLeaderClass)}else e.style.msGridRow=2*a+1,this._inListMode?e.style.height=g.headerContainerHeight-g.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?f.style.msGridRow=2*a+2:(e.style.width=h-g.headerContainerOuterWidth+"px",f.style.width=h-g.itemsContainerOuterWidth+"px");t.addClass(e,b.UI._laidOutClass+" "+b.UI._groupLeaderClass)}t.addClass(f,b.UI._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:b.Namespace._lazy(function(){return b.Class.derive(b.UI._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(a){if(t._deprecated(b.UI._strings.disableBackdropIsDeprecated),a=!!a,this._backdropDisabled!==a&&(this._backdropDisabled=a,this._disableBackdropClassName&&(g(this._disableBackdropClassName),this._site&&t.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=d("disablebackdrop"),this._site&&t.addClass(this._site.surface,this._disableBackdropClassName),a)){var c=".win-container.win-backdrop",e="background-color:transparent;";f(this._disableBackdropClassName,this._site,c,e)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(a){if(t._deprecated(b.UI._strings.backdropColorIsDeprecated),a&&this._backdropColor!==a){this._backdropColor=a,this._backdropColorClassName&&(g(this._backdropColorClassName),this._site&&t.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=d("backdropcolor"),this._site&&t.addClass(this._site.surface,this._backdropColorClassName);var c=".win-container.win-backdrop",e="background-color:"+a+";";f(this._backdropColorClassName,this._site,c,e)}}}})}),GridLayout:b.Namespace._lazy(function(){return b.Class.derive(b.UI._LegacyLayout,function(a){a=a||{},this.itemInfo=a.itemInfo,this.groupInfo=a.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=a.groupHeaderPosition||b.UI.HeaderPosition.top,this.orientation=a.orientation||"horizontal",a.maxRows&&(this.maxRows=+a.maxRows),a.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+a.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(a){this._setMaxRowsOrColumns(a)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(a){t._deprecated(b.UI._strings.maxRowsIsDeprecated),this.maximumRowsOrColumns=a}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(a){a&&t._deprecated(b.UI._strings.itemInfoIsDeprecated),this._itemInfo=a,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(a){a&&t._deprecated(b.UI._strings.groupInfoIsDeprecated),this._groupInfo=a,this._invalidateLayout()}}})})});var H=b.Namespace.defineWithParent(null,null,{UniformGroupBase:b.Namespace._lazy(function(){return b.Class.define(null,{cleanUp:function(){},itemFromOffset:function(a,b){b=b||{};var c=this._layout._sizes;a-=c.itemsContainerOuterStart,b.wholeItem&&(a+=(b.last?-1:1)*(c.containerSize-1));var d=this.count-1,e=Math.floor(d/this._layout._itemsPerBar),f=h(0,e,Math.floor(a/c.containerSize)),g=(f+b.last)*this._layout._itemsPerBar-b.last;return h(0,this.count-1,g)},hitTest:function(a,b){var c=this._layout._horizontal,d=this._layout._itemsPerBar,e=this._layout._inListMode||1===d,f=c?a:b,g=c?b:a,i=this._layout._sizes;f-=i.itemsContainerOuterStart,g-=i.itemsContainerOuterCrossStart;var j,k=Math.floor(f/i.containerSize),l=h(0,d-1,Math.floor(g/i.containerCrossSize)),m=Math.max(-1,k*d+l);if(j=!c&&e||c&&!e?(b-i.containerHeight/2)/i.containerHeight:(a-i.containerWidth/2)/i.containerWidth,e)return j=Math.floor(j),{index:m,insertAfterIndex:j>=0&&m>=0?j:-1};
j=h(-1,d-1,j);var n;return n=0>j?k*d-1:k*d+Math.floor(j),{index:h(-1,this.count-1,m),insertAfterIndex:h(-1,this.count-1,n)}},getAdjacent:function(a,c){var d,e=a.index,f=Math.floor(e/this._layout._itemsPerBar),g=e%this._layout._itemsPerBar;switch(c){case u.upArrow:d=0===g?"boundary":e-1;break;case u.downArrow:var h=e===this.count-1,i=this._layout._itemsPerBar>1&&g===this._layout._itemsPerBar-1;d=h||i?"boundary":e+1;break;case u.leftArrow:d=0===f&&this._layout._itemsPerBar>1?"boundary":e-this._layout._itemsPerBar;break;case u.rightArrow:var j=this.count-1,k=Math.floor(j/this._layout._itemsPerBar);d=f===k?"boundary":Math.min(e+this._layout._itemsPerBar,this.count-1)}return"boundary"===d?d:{type:b.UI.ObjectType.item,index:d}},getItemsContainerSize:function(){var a=this._layout._sizes,b=Math.ceil(this.count/this._layout._itemsPerBar);return b*a.containerSize+a.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var a=this._layout._sizes;return this._layout._itemsPerBar*a.containerCrossSize+a.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(a){var b=this._layout._sizes,c=this._layout._site.rtl?"right":"left",d=this._layout._sizes.containerMargins,e=this._layout._indexToCoordinate(a),f={row:e.row,column:e.column,top:d.top+e.row*b.containerHeight,left:d[c]+e.column*b.containerWidth,height:b.containerHeight-b.containerMargins.top-b.containerMargins.bottom,width:b.containerWidth-b.containerMargins.left-b.containerMargins.right};return f}})}),UniformGroup:b.Namespace._lazy(function(){return b.Class.derive(H.UniformGroupBase,function(a,c){this._layout=a,this._itemsContainer=c,t.addClass(this._itemsContainer,a._inListMode?b.UI._uniformListLayoutClass:b.UI._uniformGridLayoutClass)},{cleanUp:function(a){a||(t.removeClass(this._itemsContainer,b.UI._uniformGridLayoutClass),t.removeClass(this._itemsContainer,b.UI._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(a,b,c,d){return this.groupInfo=d.groupInfo,this.startIndex=d.startIndex,this.count=a,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var a=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-a.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?a.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*a.containerCrossSize+"px"},layoutUnrealizedRange:function(){return b.Promise.wrap()}})}),UniformFlowGroup:b.Namespace._lazy(function(){return b.Class.derive(H.UniformGroupBase,function(a,c){this._layout=a,this._itemsContainer=c.element,t.addClass(this._itemsContainer,a._inListMode?b.UI._uniformListLayoutClass:b.UI._uniformGridLayoutClass)},{cleanUp:function(a){a||(t.removeClass(this._itemsContainer,b.UI._uniformListLayoutClass),t.removeClass(this._itemsContainer,b.UI._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:b.Namespace._lazy(function(){return b.Class.define(function(a,c){this._layout=a,this._itemsContainer=c,t.addClass(this._itemsContainer,b.UI._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(a){a||(this._cleanContainers(),t.removeClass(this._itemsContainer,b.UI._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(a,c,d,e){var f,g=this;if(this._containersToHide={},c)for(f=c.firstIndex;f<=c.lastIndex;f++)this._containersToHide[w(d._items[f])]=d._items[f];this.groupInfo=e.groupInfo,this.startIndex=e.startIndex,this.count=a.items.length,this._items=a.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var h=new Array(this.count);for(f=0;f<this.count;f++)h[f]=this._layout._getItemInfo(this.startIndex+f);return b.Promise.join(h).then(function(a){a.forEach(function(a,b){g.addItemToMap(b,a)})})},layoutRealizedRange:function(a,c){if(c){var d,e=Math.max(a,c.firstIndex);for(d=e;d<=c.lastIndex;d++)this._layoutItem(d),delete this._containersToHide[w(this._items[d])]}Object.keys(this._containersToHide).forEach(function(a){b.Utilities.removeClass(this._containersToHide[a],b.UI._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(a,c,d){var e,f=this;return f._layoutPromise=new b.Promise(function(b){function g(){e=null,b()}function h(a){return v.schedule(a,v.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(c){var i=!1,j=c.firstIndex-1,k=Math.max(a,c.lastIndex+1);k=Math.max(j+1,k),e=h(function m(b){for(;!i;){if(b.shouldYield)return void b.setWork(m);i=!0,j>=a&&(f._layoutItem(j),j--,i=!1),k<f.count&&(f._layoutItem(k),k++,i=!1)}g()})}else if(d){var l=f.count-1;e=h(function n(b){for(;l>=a;l--){if(b.shouldYield)return void b.setWork(n);f._layoutItem(l)}g()})}else{var l=a;e=h(function o(a){for(;l<f.count;l++){if(a.shouldYield)return void a.setWork(o);f._layoutItem(l)}g()})}},function(){e&&e.cancel(),e=null}),f._layoutPromise},itemFromOffset:function(a,b){b=b||{};var c=this._layout._sizes,d=c.containerMargins;a-=c.itemsContainerOuterX,a-=(b.last?1:-1)*d[b.last?"left":"right"];var e=this.indexFromOffset(a,b.wholeItem,b.last).item;return h(0,this.count-1,e)},getAdjacent:function(a,d){var e,f;e=f=a.index;var g,h,i;i=this.lastAdjacent===e?this.lastInMapIndex:this.findItem(e);do{var j=Math.floor(i/this._slotsPerColumn),k=i-j*this._slotsPerColumn,l=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(d){case u.upArrow:if(!(k>0))return{type:b.UI.ObjectType.item,index:f};i--;break;case u.downArrow:if(!(k+1<this._slotsPerColumn))return{type:b.UI.ObjectType.item,index:f};i++;break;case u.leftArrow:i=j>0?i-this._slotsPerColumn:-1;break;case u.rightArrow:i=l>j?i+this._slotsPerColumn:this.occupancyMap.length}h=i>=0&&i<this.occupancyMap.length,h&&(g=this.occupancyMap[i]?this.occupancyMap[i].index:c)}while(h&&(e===g||g===c));return this.lastAdjacent=g,this.lastInMapIndex=i,h?{type:b.UI.ObjectType.item,index:g}:"boundary"},hitTest:function(a,c){var d=this._layout._sizes,e=0;if(a-=d.itemsContainerOuterX,c-=d.itemsContainerOuterY,this.occupancyMap.length>0){for(var f=this.indexFromOffset(a,!1,0),g=Math.min(this._slotsPerColumn-1,Math.floor(c/this.groupInfo.cellHeight)),i=f.index,j=i;g-->0;)i++,this.occupancyMap[i]&&(j=i);this.occupancyMap[j]||j--,e=this.occupancyMap[j].index}var k=this.getItemSize(e),l=k.column*this.groupInfo.cellWidth,m=k.row*this.groupInfo.cellHeight,n=1===this._slotsPerColumn,o=e;return(n&&a<l+k.contentWidth/2||!n&&c<m+k.contentHeight/2)&&o--,{type:b.UI.ObjectType.item,index:h(0,this.count-1,e),insertAfterIndex:h(-1,this.count-1,o)}},getItemsContainerSize:function(){var a=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+a.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var a=this._layout._sizes;return a.maxItemsContainerContentSize+a.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(a){var b=(this._layout._sizes,this._layout._site.rtl?"right":"left"),c=this._layout._sizes.containerMargins,d=this.getItemSize(a),e=this.groupInfo,f={row:d.row,column:d.column,top:c.top+d.row*e.cellHeight,left:c[b]+d.column*e.cellWidth,height:d.contentHeight,width:d.contentWidth};return f},_layoutItem:function(a){var c=(this.groupInfo,this._layout._sizes.containerMargins,this.getItemSize(a));return this._items[a].style.cssText+=";-ms-grid-row:"+(c.row+1)+";-ms-grid-column:"+(c.column+1)+";-ms-grid-row-span:"+c.rows+";-ms-grid-column-span:"+c.columns+";height:"+c.contentHeight+"px;width:"+c.contentWidth+"px",t.addClass(this._items[a],b.UI._laidOutClass),this._items[a]},_cleanContainers:function(){var a,c=this._items,d=c.length;for(a=0;d>a;a++)c[a].style.cssText="",t.removeClass(c[a],b.UI._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var a=-1;return this.occupancyMap.forEach(function(b){b.index>a&&(a=b.index)}),a+1},coordinateToIndex:function(a,b){return a*this._slotsPerColumn+b},markSlotAsFull:function(a,b){for(var c=this._layout._indexToCoordinate(a,this._slotsPerColumn),d=c.row+b.rows,e=c.row;d>e&&e<this._slotsPerColumn;e++)for(var f=c.column,g=c.column+b.columns;g>f;f++)this.occupancyMap[this.coordinateToIndex(f,e)]=b;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,d-this._slotsPerColumn)},isSlotEmpty:function(a,b,d){for(var e=b,f=b+a.rows;f>e;e++)for(var g=d,h=d+a.columns;h>g;g++)if(e>=this._slotsPerColumn||this.occupancyMap[this.coordinateToIndex(g,e)]!==c)return!1;return!0},findEmptySlot:function(a,b,c){var d=this._layout._indexToCoordinate(a,this._slotsPerColumn),e=d.row,f=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(c){for(var g=d.column+1;f>=g;g++)if(this.isSlotEmpty(b,0,g))return this.coordinateToIndex(g,0)}else for(var g=d.column;f>=g;g++){for(var h=e;h<this._slotsPerColumn;h++)if(this.isSlotEmpty(b,h,g))return this.coordinateToIndex(g,h);e=0}return(f+1)*this._slotsPerColumn},findItem:function(a){for(var b=a,c=this.occupancyMap.length;c>b;b++){var d=this.occupancyMap[b];if(d&&d.index===a)return b}return b},getItemSize:function(a){var b=this.findItem(a),c=this.occupancyMap[b],d=this._layout._indexToCoordinate(b,this._slotsPerColumn);return a===c.index?{row:d.row,column:d.column,contentWidth:c.contentWidth,contentHeight:c.contentHeight,columns:c.columns,rows:c.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(a,b){function c(a,b){var c=d.findEmptySlot(d.lastAdded,a,b);d.lastAdded=c,d.markSlotAsFull(c,a)}var d=this,e=d.groupInfo,f=d._layout._sizes.containerMargins,g={index:a,contentWidth:b.width,contentHeight:b.height,columns:Math.max(1,Math.ceil((b.width+f.left+f.right)/e.cellWidth)),rows:Math.max(1,Math.ceil((b.height+f.top+f.bottom)/e.cellHeight))};c(g,b.newColumn)},indexFromOffset:function(a,b,c){var d=0,e=0,f=this.groupInfo,g=0;if(this.occupancyMap.length>0){if(e=this.getOccupancyMapItemCount()-1,d=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*f.cellWidth,d>a){for(var h=this._slotsPerColumn,g=(Math.max(0,Math.floor(a/f.cellWidth))+c)*this._slotsPerColumn-c;!this.occupancyMap[g]&&h-->0;)g+=c>0?-1:1;return{index:g,item:this.occupancyMap[g].index}}g=this.occupancyMap.length-1}return{index:g,item:e+(Math.max(0,Math.floor((a-d)/f.cellWidth))+c)*this._slotsPerColumn-c}}})})});b.Namespace.define("WinJS.UI",{ListLayout:b.Namespace._lazy(function(){return b.Class.derive(b.UI._LegacyLayout,function(a){a=a||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=a.groupHeaderPosition||b.UI.HeaderPosition.top,this._inListMode=!0,this.orientation=a.orientation||"vertical"},{initialize:function(a,c){t.addClass(a.surface,b.UI._listLayoutClass),b.UI._LegacyLayout.prototype.initialize.call(this,a,c)},uninitialize:function(){this._site&&t.removeClass(this._site.surface,b.UI._listLayoutClass),b.UI._LegacyLayout.prototype.uninitialize.call(this)},layout:function(a,c,d,e){return this._groupsEnabled||this._horizontal?b.UI._LegacyLayout.prototype.layout.call(this,a,c,d,e):this._layoutNonGroupedVerticalList(a,c,d,e)},_layoutNonGroupedVerticalList:function(a,c,d,e){var f=this,g="Layout:_layoutNonGroupedVerticalList";return f._site._writeProfilerMark(g+",StartTM"),this._layoutPromise=f._measureItem(0).then(function(){b.Utilities[f._usingStructuralNodes?"addClass":"removeClass"](f._site.surface,b.UI._structuralNodesClass),f._sizes.viewportContentSize!==f._getViewportCrossSize()&&f._viewportSizeChanged(f._getViewportCrossSize()),f._cacheRemovedElements(d,f._cachedItemRecords,f._cachedInsertedItemRecords,f._cachedRemovedItems,!1),f._cacheRemovedElements(e,f._cachedHeaderRecords,f._cachedInsertedHeaderRecords,f._cachedRemovedHeaders,!0);var c=a[0].itemsContainer,h=new H.UniformFlowGroup(f,c);f._groups=[h],h.groupInfo={enableCellSpanning:!1},h.startIndex=0,h.count=p(c),h.offset=0,h.layout(),f._site._writeProfilerMark(g+":setSurfaceWidth,info"),f._site.surface.style.width=f._sizes.surfaceContentSize+"px",f._layoutAnimations(d,e),f._site._writeProfilerMark(g+":complete,info"),f._site._writeProfilerMark(g+",StopTM")},function(a){return f._site._writeProfilerMark(g+":canceled,info"),f._site._writeProfilerMark(g+",StopTM"),b.Promise.wrapError(a)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){return this._usingStructuralNodes=b.UI.ListLayout._numberOfItemsPerItemsBlock>0,this._measureItem(0).then(function(){return b.UI.ListLayout._numberOfItemsPerItemsBlock})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:b.Namespace._lazy(function(){return b.Class.derive(b.UI._LayoutCommon,function(a){a=a||{},this._itemInfo=a.itemInfo,this._groupInfo=a.groupInfo,this._groupHeaderPosition=a.groupHeaderPosition||b.UI.HeaderPosition.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(a){this._setMaxRowsOrColumns(a)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(a){this._itemInfo=a,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(a){this._groupInfo=a,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:b.Namespace._lazy(function(){return b.Class.define(function(a){this.defaultAnimations=!0,this.initialize=function(b,c){a.initialize(b,c)},this.hitTest=function(b,c){return a.hitTest(b,c)},a.uninitialize&&(this.uninitialize=function(){a.uninitialize()}),"numberOfItemsPerItemsBlock"in a&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return a.numberOfItemsPerItemsBlock}}),a._getItemPosition&&(this._getItemPosition=function(b){return a._getItemPosition(b)}),a.itemsFromRange&&(this.itemsFromRange=function(b,c){return a.itemsFromRange(b,c)}),a.getAdjacent&&(this.getAdjacent=function(b,c){return a.getAdjacent(b,c)}),a.dragOver&&(this.dragOver=function(b,c,d){return a.dragOver(b,c,d)}),a.dragLeave&&(this.dragLeave=function(){return a.dragLeave()});var b={enumerable:!0,get:function(){return"vertical"}};if(a.orientation!==c&&(b.get=function(){return a.orientation},b.set=function(b){a.orientation=b}),Object.defineProperty(this,"orientation",b),(a.setupAnimations||a.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return a.setupAnimations()},this.executeAnimations=function(){return a.executeAnimations()}),a.layout)if(this.defaultAnimations){var d=this;this.layout=function(b,c,e,f){var g,h=r(a.layout(b,c,[],[]));return h.realizedRangeComplete.then(function(){g=!0}),g&&d._layoutAnimations(e,f),h}}else this.layout=function(b,c,d,e){return r(a.layout(b,c,d,e))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(a,b,c,d){return this.defaultAnimations&&this._layoutAnimations(c,d),r()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(a,c){var d=b.Utilities.Key;switch(c){case d.pageUp:case d.upArrow:case d.leftArrow:return{type:a.type,index:a.index-1};case d.downArrow:case d.rightArrow:case d.pageDown:return{type:a.type,index:a.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})}),b.Namespace.define("WinJS.UI",{HeaderPosition:{left:"left",top:"top"},_getMargins:s})}(this,WinJS),function(a,b,c){"use strict";function d(){var a=o;o=[],a=a.filter(function(a){return a._isZombie()?(a._dispose(),!1):!0}),o=o.concat(a)}function e(a){o.push(a),l&&l.cancel(),l=b.Promise.timeout(n).then(d)}function f(a){a.id||(a.id=p(a))}function g(a,c){b.UI._setAttribute(a,"aria-flowto",c.id),b.UI._setAttribute(c,"x-ms-aria-flowfrom",a.id)}function h(a,b,c){a.getAttribute(b)!==""+c&&a.setAttribute(b,c)}function i(a){return Array.prototype.slice.call(a)}function j(a,b){return new Array(b+1).join(a)}function k(a){return a.offsetParent?a.offsetParent.offsetWidth-a.offsetLeft-a.offsetWidth:0}var l,m=b.Utilities._browserStyleEquivalents.transform,n=1e3,o=[],p=b.Utilities._uniqueID,q=b.UI.simpleItemRenderer(function(a){if(u._isDOMElement(a.data))return a.data;var b=a.data;b===c?b="undefined":null===b?b="null":"object"==typeof b&&(b=JSON.stringify(b));var d=document.createElement("span");return d.textContent=b.toString(),d});b.Namespace.define("WinJS.UI",{_trivialHtmlRenderer:q,_disposeControls:d,_ensureId:f,_setFlow:g,_setAttribute:h,_nodeListToArray:i,_repeat:j,_ListViewAnimationHelper:{fadeInElement:function(a){return b.UI.Animation.fadeIn(a)},fadeOutElement:function(a){return b.UI.Animation.fadeOut(a)},animateEntrance:function(a,c){return b.UI.Animation.enterContent(a,[{left:c?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"})}}});var r={uninitialized:0,low:1,medium:2,high:3},s={rebuild:0,remeasure:1,relayout:2,realize:3},t=b.UI,u=b.Utilities,v=b.Promise,w=u.Scheduler,x=b.UI._ListViewAnimationHelper,y={get notCompatibleWithSemanticZoom(){return b.Resources._getWinJSString("ui/notCompatibleWithSemanticZoom").value},get listViewInvalidItem(){return b.Resources._getWinJSString("ui/listViewInvalidItem").value},get listViewViewportAriaLabel(){return b.Resources._getWinJSString("ui/listViewViewportAriaLabel").value}},z=b.Utilities.requireSupportedForProcessing;b.Namespace.define("WinJS.UI",{_ScrollToPriority:r,_ViewChange:s,ObjectType:{item:"item",groupHeader:"groupHeader"},SelectionMode:{none:"none",single:"single",multi:"multi"},TapBehavior:{directSelect:"directSelect",toggleSelect:"toggleSelect",invokeOnly:"invokeOnly",none:"none"},GroupHeaderTapBehavior:{invoke:"invoke",none:"none"},SwipeBehavior:{select:"select",none:"none"},ListViewAnimationType:{entrance:"entrance",contentTransition:"contentTransition"},ListView:b.Namespace._lazy(function(){var a=b.Class.define(function(){this.clear()},{add:function(a,b){if(a._lastKnownSizeOfData=b,this._range){this._range.start=Math.min(this._range.start,a.start);var c=this._range._lastKnownSizeOfData-this._range.end,d=a._lastKnownSizeOfData-a.end,e=Math.min(c,d);this._range._lastKnownSizeOfData=a._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-e}else this._range=a},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),d=b.Class.define(function(a){this._listView=a},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(a,b,c,d){this._listView._configureForZoom(a,b,c,d)},setCurrentItem:function(a,b){this._listView._setCurrentItem(a,b)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(a,b){return this._listView._positionItem(a,b)},endZoom:function(a){this._listView._endZoom(a)}}),f=b.Class.define(function(d,e){d=d||document.createElement("div"),this._id=d.id||"",this._writeProfilerMark("constructor,StartTM"),e=e||{},d.winControl=this,b.Utilities.addClass(d,"win-disposable"),this._affectedRange=new a,this._mutationObserver=new b.Utilities._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=d,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=b.UI._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._viewportWidth=b.UI._UNINITIALIZED,this._viewportHeight=b.UI._UNINITIALIZED,this._manipulationState=b.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new b.UI._UnsupportedGroupFocusCache,this._viewChange=s.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new b.UI._VirtualizeContentsView(this),this._selection=new b.UI._SelectionManager(this),this._createTemplates();if(this._groupHeaderRenderer=b.UI._trivialHtmlRenderer,this._itemRenderer=b.UI._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,e.itemDataSource)this._dataSource=e.itemDataSource;else{var f=new b.Binding.List;this._dataSource=f.dataSource}this._selectionMode=b.UI.SelectionMode.multi,this._tap=b.UI.TapBehavior.invokeOnly,this._groupHeaderTap=b.UI.GroupHeaderTapBehavior.invoke,this._swipeBehavior=b.UI.SwipeBehavior.select,this._mode=new b.UI._SelectionMode(this),this._setSwipeClass(),this._groups=new b.UI._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._tabIndex=this._element.tabIndex!==c&&this._element.tabIndex>=0?this._element.tabIndex:0,this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),e.layout||this._updateLayout(new b.UI.GridLayout),this._attachEvents(),this._runningInit=!0,b.UI.setOptions(this,e),this._runningInit=!1,this._batchViewUpdates(s.rebuild,r.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(a){this._updateLayout(a),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(s.rebuild,r.medium,0,!0))}},pagesToLoad:{get:function(){return 2*b.UI._VirtualizeContentsView._pagesToPrefetch+1},set:function(){u._deprecated(b.UI._strings.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){u._deprecated(b.UI._strings.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(a){function c(a){a.detail===t.DataSourceStatus.failure&&(d.itemDataSource=null,d.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var d=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",c,!1),this._groupDataSource=a,this._groupFocusCache=a&&this._supportsGroupHeaderKeyboarding?new b.UI._GroupFocusCache(this):new b.UI._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",c,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(s.rebuild,r.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?u.addClass(this._element,b.UI._groupsClass):u.removeClass(this._element,b.UI._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){u._deprecated(b.UI._strings.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){u._deprecated(b.UI._strings.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(a){if("string"==typeof a&&a.match(/^(none|single|multi)$/)){if(u.isPhone&&a===b.UI.SelectionMode.single)return;return this._selectionMode=a,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),this._setSwipeClass(),void this._configureSelectionMode()}throw new b.ErrorFromName("WinJS.UI.ListView.ModeIsInvalid",b.UI._strings.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(a){u.isPhone&&a===b.UI.TapBehavior.directSelect||(this._tap=a,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(a){this._groupHeaderTap=a,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(a){this._swipeBehavior=a,this._setSwipeClass()}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(a){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=a||(new b.Binding.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(s.rebuild,r.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(a){this._setRenderer(a,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(s.rebuild,r.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(a){u._deprecated(b.UI._strings.resetItemIsDeprecated),this._itemRelease=a}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(a){this._setRenderer(a,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(s.rebuild,r.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(a){u._deprecated(b.UI._strings.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=a}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(a){if(!(0>a)){this._writeProfilerMark("set_indexOfFirstVisible("+a+"),info"),this._raiseViewLoading(!0);var c=this;this._batchViewUpdates(s.realize,r.high,function(){var d;return c._entityInRange({type:b.UI.ObjectType.item,index:a}).then(function(a){return a.inRange?c._getItemOffset({type:b.UI.ObjectType.item,index:a.index}).then(function(a){return d=a,c._ensureFirstColumnRange(b.UI.ObjectType.item)}).then(function(){return d=c._correctRangeInFirstColumn(d,b.UI.ObjectType.item),d=c._convertFromCanvasCoordinates(d),c._view.waitForValidScrollPosition(d.begin)}).then(function(a){var b=a<c._lastScrollPosition?"left":"right",d=c._viewport[c._scrollLength]-c._getViewportLength();return a=u._clamp(a,0,d),{position:a,direction:b}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var a=this._selection._getFocused(),c={index:a.index,type:a.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(a.type===b.UI.ObjectType.groupHeader){var d=this._groups.group(a.index);d&&(c.key=d.key,c.showFocus=!(!d.header||!b.Utilities.hasClass(d.header,b.UI._itemFocusClass)))}else{var e=this._view.items.itemAt(a.index);if(e){var f=this._itemsManager._recordFromElement(e);c.key=f.item&&f.item.key,c.showFocus=!!e.parentNode.querySelector("."+t._itemFocusOutlineClass)}}return c},set:function(a){function d(c,d,f){var g=!!a.showFocus&&e._hasKeyboardFocus;e._unsetFocusOnItem(d),e._selection._setFocused(f,g),e._hasKeyboardFocus?(e._keyboardFocusInbound=g,e._setFocusOnItem(f)):e._tabManager.childFocus=d?c:null,f.type!==b.UI.ObjectType.groupHeader&&(e._updateFocusCache(f.index),e._updater&&(e._updater.newSelectionPivot=f.index,e._updater.oldSelectionPivot=-1),e._selection._pivot=f.index)}this._hasKeyboardFocus=a.hasFocus||this._hasKeyboardFocus;var e=this;if(a.key&&(a.type!==b.UI.ObjectType.groupHeader&&this._dataSource.itemFromKey||a.type===b.UI.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var f=a.type===b.UI.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=f.itemFromKey(a.key).then(function(c){if(e.oldCurrentItemKeyFetch=null,c){var f=a.type===b.UI.ObjectType.groupHeader?e._groups.group(c.index).header:e._view.items.itemAt(c.index);d(f,!!f,{type:a.type||b.UI.ObjectType.item,index:c.index})}})}else if(a.index!==c){var g;if(a.type===b.UI.ObjectType.groupHeader){var h=e._groups.group(a.index);g=h&&h.header}else g=e._view.items.itemAt(a.index);d(g,!!g,{type:a.type||b.UI.ObjectType.item,index:a.index})}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new d(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(a){u.isPhone||this._dragSource!==a&&(this._dragSource=a,this._setSwipeClass())}},itemsReorderable:{get:function(){return this._reorderable},set:function(a){u.isPhone||this._reorderable!==a&&(this._reorderable=a,this._setSwipeClass())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(a){this._maxDeferredItemCleanup=Math.max(0,+a||0)}},dispose:function(){this._dispose()},elementFromIndex:function(a){return this._view.items.itemAt(a)},indexOfElement:function(a){return this._view.items.index(a)},ensureVisible:function(a){var c=b.UI.ObjectType.item,d=a;if(+a!==a&&(c=a.type,d=a.index),this._writeProfilerMark("ensureVisible("+c+": "+d+"),info"),!(0>d)){this._raiseViewLoading(!0);var e=this;this._batchViewUpdates(s.realize,r.high,function(){var a;return e._entityInRange({type:c,index:d}).then(function(d){return d.inRange?e._getItemOffset({type:c,index:d.index}).then(function(b){return a=b,e._ensureFirstColumnRange(c)}).then(function(){a=e._correctRangeInFirstColumn(a,c);var f=e._getViewportLength(),g=e._viewportScrollPosition,h=g+f,i=e._viewportScrollPosition,j=a.end-a.begin;a=e._convertFromCanvasCoordinates(a);var l=!1;if(c===b.UI.ObjectType.groupHeader&&g<=a.begin){var m=e._groups.group(d.index).header;if(m){var n,o=b.UI._getMargins(m);if(e._horizontalLayout){var p=e._rtl(),q=p?k(m)-o.right:m.offsetLeft-o.left;n=q+m.offsetWidth+(p?o.left:o.right)}else n=m.offsetTop+m.offsetHeight+o.top;l=h>=n}}l||(j>=h-g?i=a.begin:a.begin<g?i=a.begin:a.end>h&&(i=a.end-f));var r=i<e._lastScrollPosition?"left":"right",s=e._viewport[e._scrollLength]-f;return i=u._clamp(i,0,s),{position:i,direction:r}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){u._deprecated(b.UI._strings.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(s.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(s.remeasure)},_entityInRange:function(a){if(a.type===b.UI.ObjectType.item)return this._itemsCount().then(function(b){var c=u._clamp(a.index,0,b-1);return{inRange:c>=0&&b>c,index:c}});var c=u._clamp(a.index,0,this._groups.length()-1);
return v.wrap({inRange:c>=0&&c<this._groups.length(),index:c})},_forceLayoutImpl:function(a){var b=this;this._versionManager.unlocked.then(function(){b._writeProfilerMark("_forceLayoutImpl viewChange("+a+"),info"),b._cancelAsyncViewWork(),b._pendingLayoutReset=!0,b._resizeViewport(),b._batchViewUpdates(a,r.low,function(){return{position:b._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){u.isPhone&&(this.tapBehavior===b.UI.TapBehavior.toggleSelect&&this.selectionMode===b.UI.SelectionMode.multi?u.addClass(this._canvas,b.UI._selectionModeClass):u.removeClass(this._canvas,b.UI._selectionModeClass))},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=this._viewport[this._scrollProperty],this._currentScrollPosition},set:function(a){this._viewport[this._scrollProperty]=a,this._currentScrollPosition=a}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(a){var b=this._horizontal()?this._rtl()?-a:a:0,c=this._horizontal()?0:a;this._canvas.style[m.scriptName]=0!==a?"translate( "+b+"px, "+c+"px)":"",this._canvasStartValue=a}},scrollPosition:{get:function(){return this._currentScrollPosition},set:function(a){var b=this;this._batchViewUpdates(s.realize,r.high,function(){return b._view.waitForValidScrollPosition(a).then(function(){var c=b._viewport[b._scrollLength]-b._getViewportLength();a=u._clamp(a,0,c);var d=a<b._lastScrollPosition?"left":"right";return{position:a,direction:d}})},!0)}},_setRenderer:function(a,c){var d;if(a){if("function"==typeof a)d=a;else if("object"==typeof a){if(b.validation&&!a.renderItem)throw new b.ErrorFromName("WinJS.UI.ListView.invalidTemplate",b.UI._strings.invalidTemplate);d=a.renderItem}}else{if(b.validation)throw new b.ErrorFromName("WinJS.UI.ListView.invalidTemplate",b.UI._strings.invalidTemplate);d=q}d&&(c?this._groupHeaderRenderer=d:this._itemRenderer=d)},_renderWithoutReuse:function(a,c){return c&&b.Utilities._disposeElement(c),this._itemRenderer(a)},_isInsertedItem:function(a){return!!this._insertedItems[a.handle]},_clearInsertedItems:function(){for(var a=Object.keys(this._insertedItems),b=0,c=a.length;c>b;b++)this._insertedItems[a[b]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(a){this._view.stopWork(a)},_updateView:function(){function a(){c._itemsBlockExtent=-1,c._firstItemRange=null,c._firstHeaderRange=null,c._itemMargins=null,c._headerMargins=null,c._canvasMargins=null,c._cachedRTL=null,c._rtl()}function b(){c._scrollToPriority=r.uninitialized;var a=c._setScrollbarPosition;c._setScrollbarPosition=!1;var b="number"==typeof c._scrollToFunctor?{position:c._scrollToFunctor}:c._scrollToFunctor();return v.as(b).then(function(b){return b=b||{},a&&+b.position===b.position&&(c._lastScrollPosition=b.position,c._viewportScrollPosition=b.position),b},function(b){return c._setScrollbarPosition|=a,v.wrapError(b)})}if(!this._isZombie()){var c=this,d=this._viewChange;this._viewChange=s.realize,d===s.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),a(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(b,!0),this._setFocusOnItem(this._selection._getFocused())):d===s.remeasure?(this._view.resetItems(!0),this._resetLayout(),a(),this._view.refresh(b),this._setFocusOnItem(this._selection._getFocused())):d===s.relayout?(this._pendingLayoutReset&&(this._resetLayout(),a()),this._view.refresh(b)):this._view.onScroll(b)}},_batchViewUpdates:function(a,c,d,e,f){if(this._viewChange=Math.min(this._viewChange,a),(null===this._scrollToFunctor||c>=this._scrollToPriority)&&(this._scrollToPriority=c,this._scrollToFunctor=d),this._setScrollbarPosition|=!!e,!this._batchingViewUpdates){this._raiseViewLoading();var g=this;this._batchingViewUpdatesSignal=new b._Signal,this._batchingViewUpdates=v.any([this._batchingViewUpdatesSignal.promise,w.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){return g._isZombie()?void 0:g._viewChange!==s.rebuild||g._firstTimeDisplayed||0===Object.keys(g._view.items._itemData).length||f?void 0:g._fadeOutViewport()}).then(function(){g._batchingViewUpdates=null,g._batchingViewUpdatesSignal=null,g._updateView(),g._firstTimeDisplayed=!1},function(){g._batchingViewUpdates=null,g._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetItemCanvas:function(){function a(a){return{name:a,handler:function(b){e["_"+a](b),e._mode[a](b)},capture:!1}}var c=this._canvas;this._tabManager&&this._tabManager.dispose(),this._tabManager=new b.UI.TabContainer(c);var d=[a("onTabEnter"),a("onTabExit")],e=this;d.forEach(function(a){c.addEventListener(a.name,a.handler,!1)}),this._tabManager.tabIndex=this._tabIndex},_resetCanvas:function(){if(!this._disposed){var a=document.createElement("div");a.className=this._canvas.className,this._viewport.replaceChild(a,this._canvas),this._canvas=a,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy),this._resetItemCanvas()}},_setupInternalTree:function(){u.addClass(this._element,b.UI._listViewClass),u[this._rtl()?"addClass":"removeClass"](this._element,b.UI._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+b.UI._viewportClass+" "+b.UI._horizontalClass+'"><div class="'+b.UI._scrollableClass+'"><div class="'+b.UI._proxyClass+'"></div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;"><div aria-hidden="true" style="width:0px; height:0px;"></div></div>',this._viewport=this._element.firstElementChild,this._canvas=this._viewport.firstElementChild,this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling.firstElementChild,this._tabIndex=this._element.tabIndex!==c?this._element.tabIndex:0,this._tabEventsHelper=new b.UI.TabContainer(this._keyboardEventsHelper.parentNode),this._tabEventsHelper.tabIndex=this._tabIndex,this._resetItemCanvas(),this._progressBar=document.createElement("progress"),u.addClass(this._progressBar,b.UI._progressClass),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(a){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(a||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,this._tabEventsHelper.childFocus=this._keyboardEventsHelper,document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,b.Utilities._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(a){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var c=this,d=function(d){c._isZombie()||(c._tabEventsHelper.childFocus=null,c._tabManager.childFocus!==d&&(c._tabManager.childFocus=d),c._focusRequest=null,c._hasKeyboardFocus&&!c._itemFocused&&(c._selection._keyboardFocused()&&c._drawFocusRectangle(d),c._view.updateAriaForAnnouncement(d,a.type===b.UI.ObjectType.groupHeader?c._groups.length():c._cachedCount),c._itemFocused=!0,b.Utilities._setActive(d)))};this._focusRequest=a.type!==b.UI.ObjectType.groupHeader?this._view.items.requestItem(a.index).then(d):this._groups.requestHeader(a.index).then(d)}},_attachEvents:function(){function a(a,b,c){return{name:b?a:a.toLowerCase(),handler:function(b){e["_on"+a](b)},capture:c}}function c(a,b,c){return{capture:c,name:b?a:a.toLowerCase(),handler:function(b){var c=e._mode,d="on"+a;!e._disposed&&c[d]&&c[d](b)}}}function d(a,b){return{handler:function(b){e["_on"+a](b)},filter:b}}var e=this,f=[d("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,f.forEach(function(a){new b.Utilities._MutationObserver(a.handler).observe(e._element,{attributes:!0,attributeFilter:a.filter})});var g=[c("PointerDown"),c("click",!1),c("PointerUp"),c("LostPointerCapture"),c("MSHoldVisual",!0),c("PointerCancel",!0),c("DragStart"),c("DragOver"),c("DragEnter"),c("DragLeave"),c("Drop"),c("ContextMenu"),c("MSManipulationStateChanged",!0,!0)];g.forEach(function(a){b.Utilities._addEventListener(e._viewport,a.name,a.handler,!!a.capture)});var h=[a("FocusIn",!1,!1),a("FocusOut",!1,!1),c("KeyDown"),c("KeyUp"),a("MSElementResize",!1,!1)];h.forEach(function(a){b.Utilities._addEventListener(e._element,a.name,a.handler,!!a.capture)});var i=[a("MSManipulationStateChanged",!0),a("Scroll")];i.forEach(function(a){e._viewport.addEventListener(a.name,a.handler,!1)}),this._keyboardEventsHelper.parentNode.addEventListener("onTabEnter",this._onTabEnter.bind(this),!1),this._keyboardEventsHelper.parentNode.addEventListener("onTabExit",this._onTabExit.bind(this),!1)},_updateItemsManager:function(){function a(a){a.detail===t.DataSourceStatus.failure&&(c.itemDataSource=null,c.groupDataSource=null)}var c=this,d={beginNotifications:function(){},changed:function(a,d){if(!c._ifZombieDispose()){c._createUpdater();var e=c._updater.elements[p(d)];if(e){var f=c.selection._isIncluded(e.index);if(f&&(c._updater.updateDrag=!0),d!==a){if((c._tabManager.childFocus===d||c._updater.newFocusedItem===d)&&(c._updater.newFocusedItem=a,c._tabManager.childFocus=null),e.itemBox){u.addClass(a,b.UI._itemClass),c._setupAriaSelectionObserver(a);var g=d.nextElementSibling;e.itemBox.removeChild(d),e.itemBox.insertBefore(a,g)}c._setAriaSelected(a,f),c._view.items.setItemAt(e.newIndex,{element:a,itemBox:e.itemBox,container:e.container,itemsManagerRecord:e.itemsManagerRecord}),delete c._updater.elements[p(d)],b.Utilities._disposeElement(d),c._updater.elements[p(a)]={item:a,container:e.container,itemBox:e.itemBox,index:e.index,newIndex:e.newIndex,itemsManagerRecord:e.itemsManagerRecord}}else e.itemBox&&e.container&&(b.UI._ItemEventsHandler.renderSelection(e.itemBox,a,f,!0),u[f?"addClass":"removeClass"](e.container,b.UI._selectedClass));c._updater.changed=!0}for(var h=0,i=c._notificationHandlers.length;i>h;h++)c._notificationHandlers[h].changed(a,d);c._writeProfilerMark("changed,info")}},removed:function(a,d,e){function f(a){c._updater.updateDrag=!0,c._currentMode()._dragging&&c._currentMode()._draggingUnselectedItem&&c._currentMode()._dragInfo._isIncluded(a)&&(c._updater.newDragInfo=new b.UI._Selection(c,[]));var d=c._updater.selectionFirst[a],e=c._updater.selectionLast[a],f=d||e;f&&(delete c._updater.selectionFirst[f.oldFirstIndex],delete c._updater.selectionLast[f.oldLastIndex],c._updater.selectionChanged=!0)}if(!c._ifZombieDispose()){c._createUpdater();var g=c._insertedItems[e];g&&delete c._insertedItems[e];var h;if(a){var i=c._updater.elements[p(a)],j=c._itemsManager.itemObject(a);if(j&&c._groupFocusCache.deleteItem(j.key),i){h=i.index,i.itemBox&&c._updater.removed.push({index:h,itemBox:i.itemBox}),c._updater.deletesCount++;var k=c._view.items.itemDataAt(h);k.removed=!0,delete c._updater.elements[p(a)]}else h=j&&j.index;c._updater.oldFocus.type!==b.UI.ObjectType.groupHeader&&c._updater.oldFocus.index===h&&(c._updater.newFocus.index=h,c._updater.focusedItemRemoved=!0),f(h)}else h=c._updater.selectionHandles[e],h===+h&&f(h);c._writeProfilerMark("removed("+h+"),info"),c._updater.changed=!0}},updateAffectedRange:function(a){c._itemsCount().then(function(b){var d=c._view.containers?c._view.containers.length:0;a.start=Math.min(a.start,d),c._affectedRange.add(a,b)}),c._createUpdater(),c._updater.changed=!0},indexChanged:function(a,d,e){if(!c._ifZombieDispose()){if(c._createUpdater(),a){var f=c._itemsManager.itemObject(a);f&&c._groupFocusCache.updateItemIndex(f.key,d);var g=c._updater.elements[p(a)];g&&(g.newIndex=d,c._updater.changed=!0),c._updater.itemsMoved=!0}c._currentMode()._dragging&&c._currentMode()._draggingUnselectedItem&&c._currentMode()._dragInfo._isIncluded(e)&&(c._updater.newDragInfo=new b.UI._Selection(c,[{firstIndex:d,lastIndex:d}]),c._updater.updateDrag=!0),c._updater.oldFocus.type!==b.UI.ObjectType.groupHeader&&c._updater.oldFocus.index===e&&(c._updater.newFocus.index=d,c._updater.changed=!0),c._updater.oldSelectionPivot===e&&(c._updater.newSelectionPivot=d,c._updater.changed=!0);var h=c._updater.selectionFirst[e];h&&(h.newFirstIndex=d,c._updater.changed=!0,c._updater.updateDrag=!0),h=c._updater.selectionLast[e],h&&(h.newLastIndex=d,c._updater.changed=!0,c._updater.updateDrag=!0)}},endNotifications:function(){c._update()},inserted:function(a){c._ifZombieDispose()||(c._writeProfilerMark("inserted,info"),c._createUpdater(),c._updater.changed=!0,a.retain(),c._updater.insertsCount++,c._insertedItems[a.handle]=a)},moved:function(a,b,d,e){if(!c._ifZombieDispose()){if(c._createUpdater(),c._updater.movesCount++,a){c._updater.itemsMoved=!0;var f=c._updater.elements[p(a)];f&&(f.moved=!0)}var g=c._updater.selectionHandles[e.handle];if(g===+g){c._updater.updateDrag=!0;var h=c._updater.selectionFirst[g],i=c._updater.selectionLast[g],j=h||i;j&&j.oldFirstIndex!==j.oldLastIndex&&(delete c._updater.selectionFirst[j.oldFirstIndex],delete c._updater.selectionLast[j.oldLastIndex],c._updater.selectionChanged=!0,c._updater.changed=!0)}c._writeProfilerMark("moved("+g+"),info")}},countChanged:function(a,b){c._ifZombieDispose()||(c._writeProfilerMark("countChanged("+a+"),info"),c._cachedCount=a,c._createUpdater(),c._view.lastIndexDisplayed+1===b&&(c._updater.changed=!0),c._updater.countDifference+=a-b)},reload:function(){c._ifZombieDispose()||(c._writeProfilerMark("reload,info"),c._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new b.UI._VersionManager,this._updater=null;var e=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",a,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=b.UI._UNINITIALIZED,this._itemsManager=t._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),d,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(a){return a>=c.indexOfFirstVisible&&a<=c.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",a,!1),this._selection._selected.set(e)},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(s.rebuild,r.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource instanceof b.UI.VirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var a={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},newSelectionPivot:{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},newFocus:{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(b,c,d){a.elements[p(c)]={item:c,container:d.container,itemBox:d.itemBox,index:b,newIndex:b,itemsManagerRecord:d.itemsManagerRecord,detached:d.detached}});for(var c=this._selection._selected._ranges,d=0,e=c.length;e>d;d++){var f=c[d],g={newFirstIndex:c[d].firstIndex,oldFirstIndex:c[d].firstIndex,newLastIndex:c[d].lastIndex,oldLastIndex:c[d].lastIndex};a.selectionFirst[g.oldFirstIndex]=g,a.selectionLast[g.oldLastIndex]=g,a.selectionHandles[f.firstPromise.handle]=g.oldFirstIndex,a.selectionHandles[f.lastPromise.handle]=g.oldLastIndex}a.oldSelectionPivot=this._selection._pivot,a.newSelectionPivot=a.oldSelectionPivot,a.oldFocus=this._selection._getFocused(),a.newFocus=this._selection._getFocused(),this._updater=a}},_synchronize:function(){var a=this._updater;this._updater=null;this._groupsChanged;if(this._groupsChanged=!1,this._countDifference=this._countDifference||0,a&&a.changed){a.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),a.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(a.removed.map(function(a){return a.itemBox})),(a.itemsMoved||a.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var c=[];for(var d in a.selectionFirst)if(a.selectionFirst.hasOwnProperty(d)){var e=a.selectionFirst[d];a.selectionChanged=a.selectionChanged||e.newLastIndex-e.newFirstIndex!=e.oldLastIndex-e.oldFirstIndex,e.newFirstIndex<=e.newLastIndex&&c.push({firstIndex:e.newFirstIndex,lastIndex:e.newLastIndex})}if(a.selectionChanged){var f=new b.UI._Selection(this,c);this._selection._fireSelectionChanging(f),this._selection._selected.set(c),this._selection._fireSelectionChanged(),f.clear()}else this._selection._selected.set(c);this._selection._updateCount(this._cachedCount),a.newSelectionPivot=Math.min(this._cachedCount-1,a.newSelectionPivot),this._selection._pivot=a.newSelectionPivot>=0?a.newSelectionPivot:b.UI._INVALID_INDEX,a.newFocus.type!==b.UI.ObjectType.groupHeader&&(a.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,a.newFocus.index))),this._selection._setFocused(a.newFocus,this._selection._keyboardFocused());var g=this._modifiedElements||[],h={};for(this._modifiedElements=[],this._countDifference+=a.countDifference,d=0;d<g.length;d++){var i=g[d];-1===i.newIndex?this._modifiedElements.push(i):h[i.newIndex]=i}for(d=0;d<a.removed.length;d++){var j=a.removed[d],i=h[j.index];i?delete h[j.index]:i={oldIndex:j.index},i.newIndex=-1,i._removalHandled||(i._itemBox=j.itemBox),this._modifiedElements.push(i)}var k=Object.keys(this._insertedItems);for(d=0;d<k.length;d++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[k[d]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var l={};for(d in a.elements)if(a.elements.hasOwnProperty(d)){var m=a.elements[d];l[m.newIndex]={element:m.item,container:m.container,itemBox:m.itemBox,itemsManagerRecord:m.itemsManagerRecord,detached:m.detached};var i=h[m.index];i?(delete h[m.index],i.newIndex=m.newIndex):i={oldIndex:m.index,newIndex:m.newIndex},i.moved=m.moved,this._modifiedElements.push(i)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var n=Object.keys(h);for(d=0;d<n.length;d++){var o=n[d],i=h[o];-1!==i.oldIndex&&this._modifiedElements.push(i)}this._view.items._itemData=l,a.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?a.newDragInfo&&(this._currentMode()._dragInfo=a.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),a.focusedItemRemoved||this._focusRequest&&a.oldFocus.index!==a.newFocus.index||a.oldFocus.type!==a.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):a.newFocusedItem&&(this._hasKeyboardFocus=a.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var p=this;return this._groups.synchronizeGroups().then(function(){return a.newFocus.type===b.UI.ObjectType.groupHeader&&(a.newFocus.index=Math.min(p._groups.length()-1,a.newFocus.index),a.newFocus.index<0&&(a.newFocus={type:b.UI.ObjectType.item,index:0}),p._selection._setFocused(a.newFocus,p._selection._keyboardFocused())),p._versionManager.endUpdating(),a.deletesCount>0&&p._updateDeleteWrapperSize(),p._view.updateTree(p._cachedCount,p._countDifference,p._modifiedElements)}).then(function(){return p._lastScrollPosition})}this._countDifference+=a?a.countDifference:0;var p=this;return this._groups.synchronizeGroups().then(function(){return a&&p._versionManager.endUpdating(),p._view.updateTree(p._cachedCount,p._countDifference,p._modifiedElements)}).then(function(){return p.scrollPosition})},_updateDeleteWrapperSize:function(a){var b=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+b]=(a?0:this.scrollPosition+this._getViewportSize()[b])+"px"},_verifyRealizationNeededForChange:function(){var a=!1,b=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),c=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(c&&this._updater.elements)for(var d=Object.keys(this._updater.elements),e=0,f=d.length;f>e;e++){var g=this._updater.elements[d[e]],h=g.index-g.newIndex;if(0>h||h>this._updater.deletesCount){c=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,c&&this._view.lastIndexDisplayed<this._view.end-b&&this._updater.deletesCount+this._view.deletesWithoutRealize<b?(a=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(a)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var a=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(b){a._writeProfilerMark("update,StopTM"),a._batchViewUpdates(s.relayout,r.low,b).complete()})):this._batchViewUpdates(s.relayout,r.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var a=this;this._updateJob=w.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){a._updateJob&&a._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groups=this._groupDataSource?new b.UI._UnvirtualizedGroupsContainer(this,this._groupDataSource):new b.UI._NoGroups(this)},_createLayoutSite:function(){var a=this;return Object.create({invalidateLayout:function(){a._pendingLayoutReset=!0;var b="horizontal"===a._layout.orientation!==a._horizontalLayout;a._affectedRange.addAll(),a._batchViewUpdates(s.rebuild,r.low,b?0:a.scrollPosition,!1,!0)},itemFromIndex:function(b){return a._itemsManager._itemPromiseAtIndex(b)},groupFromIndex:function(b){return a._groupsEnabled()?b<a._groups.length()?a._groups.group(b).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(b){return b=Math.max(0,b),a._groups.groupFromItem(b)},renderItem:function(c){return b.Promise._cancelBlocker(a._itemsManager._itemFromItemPromise(c)).then(function(c){if(c){var d=a._itemsManager._recordFromElement(c);d.pendingReady&&d.pendingReady(),c=c.cloneNode(!0),u.addClass(c,b.UI._itemClass);var e=document.createElement("div");u.addClass(e,t._itemBoxClass),e.appendChild(c);var f=document.createElement("div");return u.addClass(f,t._containerClass),f.appendChild(e),f}return b.Promise.cancel})},renderHeader:function(c){var d=b.UI._normalizeRendererReturn(a.groupHeaderTemplate(v.wrap(c)));return d.then(function(a){u.addClass(a.element,t._headerClass);var b=document.createElement("div");return u.addClass(b,t._headerContainerClass),b.appendChild(a.element),b})},readyToMeasure:function(){a._getViewportLength(),a._getCanvasMargins()},_isZombie:function(){return a._isZombie()},_writeProfilerMark:function(b){a._writeProfilerMark(b)}},{_itemsManager:{enumerable:!0,get:function(){return a._itemsManager}},rtl:{enumerable:!0,get:function(){return a._rtl()}},surface:{enumerable:!0,get:function(){return a._canvas}},viewport:{enumerable:!0,get:function(){return a._viewport}},scrollbarPos:{enumerable:!0,get:function(){return a.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return a._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return a.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return a._animationsDisabled()}},tree:{enumerable:!0,get:function(){return a._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,a.scrollPosition-2*a._getViewportLength()),lastPixel:a.scrollPosition+3*a._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:a.scrollPosition,lastPixel:a.scrollPosition+a._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return a._itemsCount()}},groupCount:{enumerable:!0,get:function(){return a._groups.length()}}})},_initializeLayout:function(){this._affectedRange.addAll();var a=this._createLayoutSite();return this._layout.initialize(a,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(a){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",u.addClass(this._viewport,b.UI._horizontalClass),u.removeClass(this._viewport,b.UI._verticalClass),a&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",u.addClass(this._viewport,b.UI._verticalClass),u.removeClass(this._viewport,b.UI._horizontalClass),a&&(this._viewport.scrollLeft=0))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(a){var c=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),c=!0);var d;if(a&&"function"==typeof a.type){var e=z(a.type);d=new e(a)}else d=a&&a.initialize?a:new b.UI.GridLayout(a);c&&this._resetCanvas(),this._layoutImpl=d,this._layout=new b.UI._LayoutWrapper(d),c&&this._unsetFocusOnItem(),this._setFocusOnItem({type:b.UI.ObjectType.item,index:0}),this._selection._setFocused({type:b.UI.ObjectType.item,index:0}),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(c),c&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setSwipeClass:function(){!u.isPhone&&(this._currentMode()instanceof b.UI._SelectionMode&&this._selectionAllowed()&&this._swipeBehavior===b.UI.SwipeBehavior.select||this._dragSource||this._reorderable)?(this._swipeable=!0,u.addClass(this._element,b.UI._swipeableClass)):(this._swipeable=!1,u.removeClass(this._element,b.UI._swipeableClass));var a=this.itemsDraggable||this.itemsReorderable,c=this._selectionAllowed()&&this._swipeBehavior===b.UI.SwipeBehavior.select,d=this._swipeable;this._view.items.each(function(e,f,g){if(g.itemBox){var h=u.hasClass(f,b.UI._nonDraggableClass),i=u.hasClass(f,b.UI._nonSelectableClass),j=u.hasClass(g.itemBox,b.UI._nonSwipeableClass);if(g.itemBox.draggable=a&&!h,!d&&j)u.removeClass(g.itemBox,b.UI._nonSwipeableClass);else if(d){var k=a&&!c&&h||c&&!a&&i||h&&i;k&&!j?u.addClass(g.itemBox,b.UI._nonSwipeableClass):!k&&j&&u.removeClass(g.itemBox,b.UI._nonSwipeableClass)}var l=u.isPhone&&i;u[l?"addClass":"removeClass"](g.itemBox,b.UI._nonSelectableClass)}})},_resizeViewport:function(){this._viewportWidth=b.UI._UNINITIALIZED,this._viewportHeight=b.UI._UNINITIALIZED},_onMSElementResize:function(){this._writeProfilerMark("_onMSElementResize,info"),w.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==b.UI._UNINITIALIZED&&this._viewportHeight!==b.UI._UNINITIALIZED){var a=this._element.offsetWidth,c=this._element.offsetHeight;if(this._previousWidth!==a||this._previousHeight!==c){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+a+"x"+c+"),info"),this._previousWidth=a,this._previousHeight=c,this._resizeViewport();var d=this;this._affectedRange.addAll(),this._batchViewUpdates(s.relayout,r.low,function(){return{position:d.scrollPosition,direction:"right"}})}}},w.Priority.max,this,"WinJS.UI.ListView._onMSElementResize")},_onFocusIn:function(a){function c(a){d._changeFocus(d._selection._getFocused(),!0,!1,!1,a)}this._hasKeyboardFocus=!0;var d=this;if(a.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?c(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(a.target===this._element)c();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);this._tabEventsHelper.childFocus=null;var e=this._view.items,f={},g=this._groups.headerFrom(a.target),h=null;if(g?(f.type=b.UI.ObjectType.groupHeader,f.index=this._groups.index(g)):(f.index=e.index(a.target),f.type=b.UI.ObjectType.item,g=e.itemBoxAt(f.index),h=e.itemAt(f.index)),f.index!==b.UI._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(f.type===b.UI.ObjectType.groupHeader&&a.target===g||f.type===b.UI.ObjectType.item&&a.target.parentNode===g)&&this._drawFocusRectangle(g),this._tabManager.childFocus!==g&&this._tabManager.childFocus!==h&&(this._selection._setFocused(f,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,g=f.type===b.UI.ObjectType.groupHeader?g:e.itemAt(f.index),this._tabManager.childFocus=g,d._updater))){var i=d._updater.elements[p(g)],j=f.index;i&&i.newIndex&&(j=i.newIndex),d._updater.oldFocus={type:f.type,index:j},d._updater.newFocus={type:f.type,index:j}}}},_onFocusOut:function(a){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var b=this._view.items.itemBoxFrom(a.target)||this._groups.headerFrom(a.target);b&&this._clearFocusRectangle(b),this._focusRequest&&(this._tabEventsHelper.childFocus=this._keyboardEventsHelper)}},_onMSManipulationStateChanged:function(a){function c(){d._manipulationEndSignal=null}var d=this;this._manipulationState=a.currentState,d._writeProfilerMark("_onMSManipulationStateChanged state("+a.currentState+"),info"),this._manipulationState===b.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new b._Signal,this._manipulationEndSignal.promise.done(c,c)),this._manipulationState===b.Utilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var a=this._viewportScrollPosition;if(a!==this._lastScrollPosition){this._pendingScroll=requestAnimationFrame(this._checkScroller.bind(this));var c=a<this._lastScrollPosition?"left":"right";a=Math.max(0,a),this._lastScrollPosition=a,this._raiseViewLoading(!0);var d=this;this._view.onScroll(function(){return{position:d._lastScrollPosition,direction:c}},this._manipulationEndSignal?this._manipulationEndSignal.promise:v.timeout(b.UI._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(a){var c=this;a.forEach(function(a){var d=!1;if("dir"===a.attributeName?d=!0:"style"===a.attributeName&&(d=c._cachedStyleDir!=a.target.style.direction),d&&(c._cachedStyleDir=a.target.style.direction,c._cachedRTL=null,u[c._rtl()?"addClass":"removeClass"](c._element,b.UI._rtlListViewClass),c._lastScrollPosition=0,c._viewportScrollPosition=0,c.forceLayout()),"tabIndex"===a.attributeName){var e=c._element.tabIndex;e>=0&&(c._view.items.each(function(a,b){b.tabIndex=e}),c._tabIndex=e,c._tabManager.tabIndex=e,c._tabEventsHelper.tabIndex=e,c._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=b.UI._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(a,b){function d(d,e){a[d]!==c&&(a[d]=b(a[d],e))
}var e;return this._horizontal()?(e=this._getCanvasMargins()[this._rtl()?"right":"left"],d("left",e)):(e=this._getCanvasMargins().top,d("top",e)),d("begin",e),d("end",e),a},_convertFromCanvasCoordinates:function(a){return this._convertCoordinatesByCanvasMargins(a,function(a,b){return a+b})},_convertToCanvasCoordinates:function(a){return this._convertCoordinatesByCanvasMargins(a,function(a,b){return a-b})},_getViewportSize:function(){return(this._viewportWidth===b.UI._UNINITIALIZED||this._viewportHeight===b.UI._UNINITIALIZED)&&(this._viewportWidth=Math.max(0,u.getContentWidth(this._element)),this._viewportHeight=Math.max(0,u.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function a(){c._itemsCountPromise=null}var c=this;if(this._cachedCount!==b.UI._UNINITIALIZED)return v.wrap(this._cachedCount);var d;return this._itemsCountPromise?d=this._itemsCountPromise:(d=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(a){return a===t.CountResult.unknown&&(a=0),c._cachedCount=a,c._selection._updateCount(c._cachedCount),a},function(){return b.Promise.cancel}),this._itemsCountPromise.then(a,a)),d},_isSelected:function(a){return this._selection._isIncluded(a)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(a){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!a),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_setViewState:function(a){if(a!==this._loadingState){var b=null;switch(a){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(e(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:b={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+a+",info"),this._loadingState=a;var c=document.createEvent("CustomEvent");c.initCustomEvent("loadingstatechanged",!0,!1,b),this._element.dispatchEvent(c)}},_createTemplates:function(){function a(a,b){var c=document.createElement("div");return c.className=a,b||c.setAttribute("aria-hidden",!0),c}this._itemBoxTemplate=a(b.UI._itemBoxClass,!0)},_updateSelection:function(){var a=this._selection.getIndices(),c=this._selection.isEverything(),d={};if(!c)for(var e=0,f=a.length;f>e;e++){var g=a[e];d[g]=!0}this._view.items.each(function(a,e,f){if(f.itemBox&&!u.hasClass(f.itemBox,t._swipeClass)){var g=c||!!d[a];b.UI._ItemEventsHandler.renderSelection(f.itemBox,e,g,!0),f.container&&u[g?"addClass":"removeClass"](f.container,b.UI._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===window.getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(a,c,d){var e=this._progressBar,f=e.style;if(!e.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var g=this;this._progressIndicatorDelayTimer=v.timeout(b.UI._LISTVIEW_PROGRESS_DELAY).then(function(){g._isZombie()||(a.appendChild(e),x.fadeInElement(e),g._progressIndicatorDelayTimer=null)})}f[this._rtl()?"right":"left"]=c,f.top=d},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var a=this._progressBar;if(a.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var b=this;x.fadeOutElement(a).then(function(){a.parentNode&&a.parentNode.removeChild(a),b._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(a,c,d){if(b.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new b.ErrorFromName("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",y.notCompatibleWithSemanticZoom);this._isZoomedOut=a,this._disableEntranceAnimation=!c,this._isCurrentZoomView=c,this._triggerZoom=d},_setCurrentItem:function(a,c){this._rtl()&&(a=this._viewportWidth-a),this._horizontal()?a+=this.scrollPosition:c+=this.scrollPosition;var d=this._view.hitTest(a,c),e={type:d.type?d.type:b.UI.ObjectType.item,index:d.index};e.index>=0&&(this._hasKeyboardFocus?this._changeFocus(e,!0,!1,!0):this._changeFocusPassively(e))},_getCurrentItem:function(){var a=this._selection._getFocused();a.type===b.UI.ObjectType.groupHeader&&(a={type:b.UI.ObjectType.item,index:this._groups.group(a.index).startIndex}),"number"!=typeof a.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),a=this._selection._getFocused());var c=this,d=this._getItemOffsetPosition(a.index).then(function(a){var b=c._canvasStart;return a[c._startProperty]+=b,a});return v.join({item:this._dataSource.itemFromIndex(a.index),position:d})},_animateItemsForPhoneZoom:function(){function a(a,b,c){return function(d){return(b[d]-a)*c}}function c(){for(var a=0,b=d.length;b>a;a++)d[a].style[m.scriptName]=""}for(var d=[],e=[],f=[],g=Number.MAX_VALUE,h=this,i=this._view.firstIndexDisplayed,j=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);j>i;i++)f.push(this._view.waitForEntityPosition({type:b.UI.ObjectType.item,index:i}).then(function(){d.push(h._view.items.containerAt(i));var a=0;if(h.layout._getItemPosition){var b=h.layout._getItemPosition(i);b.row&&(a=b.row)}e.push(a),g=Math.min(a,g)}));return b.Promise.join(f).then(function(){return(0===d.length?b.Promise.wrap():b.UI.executeTransition(d,{property:m.cssName,delay:a(g,e,30),duration:100,timing:"ease-in-out",from:h._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:h._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(c,c)}).then(c,c)},_beginZoom:function(){this._zooming=!0;var a=null;if(b.Utilities.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var c=this,d=function(){c._zoomAnimationPromise=null};this._zoomAnimationPromise=a=this._animateItemsForPhoneZoom().then(d,d)}else this._zoomAnimationPromise=new b._Signal,a=this._zoomAnimationPromise.promise}else{var e=this._horizontal(),f=-this.scrollPosition;u.addClass(this._viewport,e?b.UI._zoomingXClass:b.UI._zoomingYClass),this._canvasStart=f,u.addClass(this._viewport,e?b.UI._zoomingYClass:b.UI._zoomingXClass)}return a},_positionItem:function(a,d){function e(a){return f._getItemOffsetPosition(a).then(function(c){var e,g=f._horizontal(),h=f._getCanvasMargins(),i=f._canvas[g?"offsetWidth":"offsetHeight"]+h[g?f._rtl()?"right":"left":"top"],j=g?f._viewportWidth:f._viewportHeight,k=g?"headerContainerWidth":"headerContainerHeight",l=f.layout._sizes,m=0;l&&l[k]&&(m=l[k]);var n=b.Utilities.isPhone?m:d[f._startProperty],o=j-(g?c.width:c.height);n=Math.max(0,Math.min(o,n)),e=c[f._startProperty]-n;var p=Math.max(0,Math.min(i-j,e)),q=p-e;e=p;var r={type:b.UI.ObjectType.item,index:a};if(f._hasKeyboardFocus?f._changeFocus(r,!0):f._changeFocusPassively(r),f._raiseViewLoading(!0),b.Utilities.isPhone)f._viewportScrollPosition=e;else{var s=-e;f._canvasStart=s}if(f._view.realizePage(e,!0),b.Utilities.isPhone&&f._isZoomedOut){var t=function(){f._zoomAnimationPromise&&f._zoomAnimationPromise.complete&&f._zoomAnimationPromise.complete(),f._zoomAnimationPromise=null};f._animateItemsForPhoneZoom().then(t,t)}return g?{x:q,y:0}:{x:0,y:q}})}var f=this,g=0;if(a&&(g=this._isZoomedOut?a.groupIndexHint:a.firstItemIndexHint),"number"==typeof g)return e(g);var h,i=this._isZoomedOut?a.groupKey:a.firstItemKey;if("string"==typeof i&&this._dataSource.itemFromKey)h=this._dataSource.itemFromKey(i,this._isZoomedOut?{groupMemberKey:a.key,groupMemberIndex:a.index}:null);else{var j=this._isZoomedOut?a.groupDescription:a.firstItemDescription;if(b.validation&&j===c)throw new b.ErrorFromName("WinJS.UI.ListView.InvalidItem",y.listViewInvalidItem);h=this._dataSource.itemFromDescription(j)}return h.then(function(a){return e(a.index)})},_endZoom:function(a){if(!this._isZombie()){if(!b.Utilities.isPhone){var c=(this._horizontal(),this._canvasStart);u.removeClass(this._viewport,b.UI._zoomingYClass),u.removeClass(this._viewport,b.UI._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-c}this._disableEntranceAnimation=!a,this._isCurrentZoomView=a,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(a){var c=this;return this._getItemOffset({type:b.UI.ObjectType.item,index:a}).then(function(a){return c._ensureFirstColumnRange(b.UI.ObjectType.item).then(function(){return a=c._correctRangeInFirstColumn(a,b.UI.ObjectType.item),a=c._convertFromCanvasCoordinates(a),c._horizontal()?(a.left=a.begin,a.width=a.end-a.begin,a.height=a.totalHeight):(a.top=a.begin,a.height=a.end-a.begin,a.width=a.totalWidth),a})})},_groupRemoved:function(a){this._groupFocusCache.deleteGroup(a)},_updateFocusCache:function(a){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var b=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(a).then(function(){b._updateFocusCacheItemRequest=null;var c=b._view.items.itemDataAt(a),d=b._groups.groupFromItem(a),e=b._groups.group(d).key;c.itemsManagerRecord.item&&b._groupFocusCache.updateCache(e,c.itemsManagerRecord.item.key,a)})},_changeFocus:function(a,c,d,e,f){if(!this._isZombie()){var g;if(a.type!==b.UI.ObjectType.groupHeader)g=this._view.items.itemAt(a.index),!c&&g&&u.hasClass(g,b.UI._nonSelectableClass)&&(c=!0),this._updateFocusCache(a.index);else{var h=this._groups.group(a.index);g=h&&h.header}this._unsetFocusOnItem(!!g),this._hasKeyboardFocus=!0,this._selection._setFocused(a,f),e||this.ensureVisible(a),!c&&this._selectFocused(d)&&this._selection.set(a.index),this._setFocusOnItem(a)}},_changeFocusPassively:function(a){var c;if(a.type!==b.UI.ObjectType.groupHeader)c=this._view.items.itemAt(a.index),this._updateFocusCache(a.index);else{var d=this._groups.group(a.index);c=d&&d.header}this._unsetFocusOnItem(!!c),this._selection._setFocused(a),this._setFocusOnItem(a)},_drawFocusRectangle:function(a){if(b.Utilities.hasClass(a,t._headerClass))b.Utilities.addClass(a,t._itemFocusClass);else{var c=this._view.items.itemBoxFrom(a);if(c.querySelector("."+t._itemFocusOutlineClass))return;u.addClass(c,t._itemFocusClass);var d=document.createElement("div");d.className=t._itemFocusOutlineClass,c.appendChild(d)}},_clearFocusRectangle:function(a){if(a&&!this._isZombie()){var b=this._view.items.itemBoxFrom(a);if(b){u.removeClass(b,t._itemFocusClass);var c=b.querySelector("."+t._itemFocusOutlineClass);c&&c.parentNode.removeChild(c)}else{var d=this._groups.headerFrom(a);d&&u.removeClass(d,t._itemFocusClass)}}},_defaultInvoke:function(a){(this._isZoomedOut||b.Utilities.isPhone&&this._triggerZoom&&a.type===b.UI.ObjectType.groupHeader)&&(this._changeFocusPassively(a),this._triggerZoom())},_selectionAllowed:function(a){var d=a!==c?this.elementFromIndex(a):null,e=!(d&&u.hasClass(d,b.UI._nonSelectableClass));return e&&this._selectionMode!==b.UI.SelectionMode.none},_multiSelection:function(){return this._selectionMode===b.UI.SelectionMode.multi},_selectOnTap:function(){return this._tap===b.UI.TapBehavior.toggleSelect||this._tap===b.UI.TapBehavior.directSelect},_selectFocused:function(a){return this._tap===b.UI.TapBehavior.directSelect&&this._selectionMode===b.UI.SelectionMode.multi&&!a},_dispose:function(){if(!this._disposed){this._disposed=!0;var a=function(a){a&&(a.textContent="")};this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),a(this._viewport),a(this._canvas),a(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var b=o.indexOf(this);b>=0&&o.splice(b,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&document.body.contains(this.element))},_ifZombieDispose:function(){var a=this._isZombie();return a&&!this._disposed&&e(this),a},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight?!0:!b.UI.isAnimationEnabled()},_fadeOutViewport:function(){var a=this;return new v(function(c){if(a._animationsDisabled())return void c();if(!a._fadingViewportOut){a._waitingEntranceAnimationPromise&&(a._waitingEntranceAnimationPromise.cancel(),a._waitingEntranceAnimationPromise=null);var d=a._fireAnimationEvent(b.UI.ListViewAnimationType.contentTransition);a._firedAnimationEvent=!0;var e=b.Utilities._browserStyleEquivalents["overflow-style"],f=e?a._viewport:a._canvas;d.prevented?(a._disableEntranceAnimation=!0,f.style.opacity=1,c()):(a._fadingViewportOut=!0,e&&(f.style[e.scriptName]="none"),x.fadeOutElement(f).then(function(){a._isZombie()||(a._fadingViewportOut=!1,f.style.opacity=1,c())}))}})},_animateListEntrance:function(a){function c(){e._canvas.style.opacity=1,f&&(g.style[f.scriptName]="")}var d={prevented:!1,animationPromise:v.wrap()},e=this,f=b.Utilities._browserStyleEquivalents["overflow-style"],g=f?this._viewport:this._canvas;return this._disableEntranceAnimation||this._animationsDisabled()?(c(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),v.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:d=this._fireAnimationEvent(b.UI.ListViewAnimationType.entrance),d.prevented||b.Utilities.isPhone?(c(),v.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,f&&(g.style[f.scriptName]="none"),this._waitingEntranceAnimationPromise=d.animationPromise.then(function(){return e._isZombie()?void 0:(e._canvas.style.opacity=1,x.animateEntrance(g,a).then(function(){e._isZombie()||(f&&(g.style[f.scriptName]=""),e._waitingEntranceAnimationPromise=null)}))}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(a){var c=document.createEvent("CustomEvent"),d=v.wrap();c.initCustomEvent("contentanimating",!0,!0,{type:a}),a===b.UI.ListViewAnimationType.entrance&&(c.detail.setPromise=function(a){d=a});var e=!this._element.dispatchEvent(c);return{prevented:e,animationPromise:d}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",y.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=document.createElement("div"),this._ariaStartMarker.id=p(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=document.createElement("div"),this._ariaEndMarker.id=p(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var a,b,c=this,d=this._element.getAttribute("role");this._currentMode().staticMode()?(a="list",b="listitem"):(a="listbox",b="option"),(d!==a||this._itemRole!==b)&&(this._element.setAttribute("role",a),this._itemRole=b,this._view.items.each(function(a,b){b.setAttribute("role",c._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var a=this.groupHeaderTapBehavior===b.UI.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==a){this._headerRole=a;for(var c=0,d=this._groups.length();d>c;c++){var e=this._groups.group(c).header;e&&e.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(a,b){var c="true"===a.getAttribute("aria-selected");b!==c&&a.setAttribute("aria-selected",b)},_setupAriaSelectionObserver:function(a){a._mutationObserver||(this._mutationObserver.observe(a,{attributes:!0,attributeFilter:["aria-selected"]}),a._mutationObserver=!0)},_itemPropertyChange:function(a){function c(a){a.forEach(function(a){a.item.setAttribute("aria-selected",!a.selected)})}if(!this._isZombie()){for(var d=this,e=d._selectionMode===b.UI.SelectionMode.single,f=[],g=[],h=0,i=a.length;i>h;h++){var j=a[h].target,k=d._view.items.itemBoxFrom(j),l="true"===j.getAttribute("aria-selected");if(k&&l!==b.UI._isSelectionRendered(k)){var m=d._view.items.index(k),n={index:m,item:j,selected:l};(d._selectionAllowed(m)?f:g).push(n)}}if(f.length>0){var o=new b._Signal;d.selection._synchronize(o).then(function(){var a=d.selection._cloneSelection();return f.forEach(function(b){b.selected?a[e?"set":"add"](b.index):a.remove(b.index)}),d.selection._set(a)}).then(function(a){d._isZombie()||a||c(f),o.complete()})}c(g)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(a,c){var d=this;return this._view.waitForEntityPosition(a).then(function(){var e=a.type===b.UI.ObjectType.groupHeader?d._view._getHeaderContainer(a.index):d._view.getContainer(a.index);if(e){if(d._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info"),d._view._expandedRange)var f=d._view._expandedRange.first.index,g=d._view._expandedRange.last.index;else c=!1;a.type===b.UI.ObjectType.item?(c=!!c,c&=d._view._ensureContainerInDOM(a.index)):c=!1;var h=d._getItemMargins(a.type),i={left:d._rtl()?k(e)-h.right:e.offsetLeft-h.left,top:e.offsetTop-h.top,totalWidth:u.getTotalWidth(e),totalHeight:u.getTotalHeight(e),contentWidth:u.getContentWidth(e),contentHeight:u.getContentHeight(e)};return c&&d._view._forceItemsBlocksInDOM(f,g+1),d._zooming&&0!==d._canvasStart?i:d._convertToCanvasCoordinates(i)}return b.Promise.cancel})},_getItemOffset:function(a,b){var c=this;return this._getItemPosition(a,b).then(function(b){var d=c._getItemMargins(a.type);if(c._horizontal()){var e=c._rtl();b.begin=b.left-d[e?"left":"right"],b.end=b.left+b.totalWidth+d[e?"right":"left"]}else b.begin=b.top-d.bottom,b.end=b.top+b.totalHeight+d.top;return b})},_getItemMargins:function(a){a=a||b.UI.ObjectType.item;var c=this,d=function(a){var d,e=c._canvas.querySelector("."+a);e||(e=document.createElement("div"),u.addClass(e,a),c._viewport.appendChild(e),d=!0);var f=b.UI._getMargins(e);return d&&c._viewport.removeChild(e),f};return a!==b.UI.ObjectType.groupHeader?this._itemMargins?this._itemMargins:this._itemMargins=d(b.UI._containerClass):this._headerMargins?this._headerMargins:this._headerMargins=d(b.UI._headerContainerClass)},_fireAccessibilityAnnotationCompleteEvent:function(a,b,c,d){var e={firstIndex:a,lastIndex:b,firstHeaderIndex:+c||-1,lastHeaderIndex:+d||-1},f=document.createEvent("CustomEvent");f.initCustomEvent("accessibilityannotationcomplete",!0,!1,e),this._element.dispatchEvent(f)},_ensureFirstColumnRange:function(a){var c=a===b.UI.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[c])return v.wrap();var d=this;return this._getItemOffset({type:a,index:0},!0).then(function(a){d[c]=a})},_correctRangeInFirstColumn:function(a,c){var d=c===b.UI.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return d.begin===a.begin&&(a.begin=this._horizontal()?-this._getCanvasMargins()[this._rtl()?"right":"left"]:-this._getCanvasMargins().top),a},_updateContainers:function(a,c,d,e){function f(){var a=document.createElement("div");return a.className=b.UI._containerClass,a}function g(a,c,d){c+d>n&&(d=n-c);var e,f,g=a.itemsContainer,h=g.itemsBlocks,i=h.length?h[h.length-1]:null,j=h.length?(h.length-1)*m._view._blockSize+i.items.length:0,k=d-j;if(k>0){if(i&&i.items.length<m._view._blockSize){var l=Math.min(k,m._view._blockSize-i.items.length);u.insertAdjacentHTMLUnsafe(i.element,"beforeend",b.UI._repeat("<div class='win-container win-backdrop'></div>",l)),e=i.items.length,f=i.element.children;for(var o=0;l>o;o++)i.items.push(f[e+o]);k-=l}var p=Math.floor(k/m._view._blockSize),s=k%m._view._blockSize,t="<div class='win-itemsblock'>"+b.UI._repeat("<div class='win-container win-backdrop'></div>",m._view._blockSize)+"</div>",v=b.UI._repeat(t,p);s&&(v+="<div class='win-itemsblock'>"+b.UI._repeat("<div class='win-container win-backdrop'></div>",s)+"</div>",p++);var w=document.createElement("div");u.setInnerHTMLUnsafe(w,v);for(var f=w.children,o=0;p>o;o++){var x=f[o],y={element:x,items:b.UI._nodeListToArray(x.children)};g.itemsBlocks.push(y)}}else if(0>k)for(var z=k;0>z;z++){var A=i.items.pop();!m._view._requireFocusRestore&&A.contains(document.activeElement)&&(m._view._requireFocusRestore=document.activeElement,m._unsetFocusOnItem()),i.element.removeChild(A),r.push(A),i.items.length||(g.element===i.element.parentNode&&g.element.removeChild(i.element),h.pop(),i=h[h.length-1])}for(var o=0,B=h.length;B>o;o++)for(var x=h[o],z=0;z<x.items.length;z++)q.push(x.items[z])}function h(a,b,c){for(var d=e.filter(function(a){return-1===a.oldIndex&&a.newIndex>=b&&a.newIndex<b+c}).sort(function(a,b){return a.newIndex-b.newIndex}),g=a.itemsContainer,h=0,i=d.length;i>h;h++){var j=d[h],k=j.newIndex-b,l=f(),m=k<g.items.length?g.items[k]:null;g.items.splice(k,0,l),g.element.insertBefore(l,m)}}function i(a,c,d){c+d>n&&(d=n-c);var e=a.itemsContainer,f=d-e.items.length;if(f>0){var g=e.element.children,h=g.length;u.insertAdjacentHTMLUnsafe(e.element,"beforeend",b.UI._repeat("<div class='win-container win-backdrop'></div>",f));for(var i=0;f>i;i++){var j=g[h+i];e.items.push(j)}}for(var i=f;0>i;i++){var j=e.items.pop();e.element.removeChild(j),r.push(j)}for(var i=0,k=e.items.length;k>i;i++)q.push(e.items[i])}function j(a,b){var c=m._view._createHeaderContainer(D),d={header:c,itemsContainer:{element:m._view._createItemsContainer(c)}};return d.itemsContainer[m._view._blockSize?"itemsBlocks":"items"]=[],m._view._blockSize?g(d,b,a.size):i(d,b,a.size),d}function k(a,d,f,g){for(var h,i,j=f+g-1,k=0,l=e.length;l>k;k++){var n=e[k];n.newIndex>=f&&n.newIndex<=j&&-1!==n.oldIndex&&(h!==+h||n.newIndex<h)&&(h=n.newIndex,i=n.newIndex-n.oldIndex)}if(h===+h){var o=0;for(k=0,l=e.length;l>k;k++){var n=e[k];n.newIndex>=f&&n.newIndex<h&&-1===n.oldIndex&&o++}var p=0,q=h-i;for(k=0,l=e.length;l>k;k++){var n=e[k];n.oldIndex>=d&&n.oldIndex<q&&-1===n.newIndex&&p++}i+=p,i-=o,i-=f-d;var r=a.itemsContainer;if(i>0){{var s=r.element.children;s.length}u.insertAdjacentHTMLUnsafe(r.element,"afterBegin",b.UI._repeat("<div class='win-container win-backdrop'></div>",i));for(var t=0;i>t;t++){var v=s[t];r.items.splice(t,0,v)}}for(var t=i;0>t;t++){var v=r.items.shift();r.element.removeChild(v)}i&&m._affectedRange.add({start:f,end:f+g},c)}}function l(a){for(var b=0,c=0,d=m._view.tree.length;d>c;c++){var e=m._view.tree[c],f=e.itemsContainer.items.length,g=b+f-1;if(a>=b&&g>=a)return{group:c,item:a-b};b+=f}}var m=this,n=this._view.containers.length+(d>0?d:0),o=[],p={},q=[],r=[],s=[],t=0;if(!m._view._blockSize)for(var v=0,w=this._view.tree.length;w>v;v++)s.push(t),t+=this._view.tree[v].itemsContainer.items.length;if(!m._view._blockSize)for(var x=e.filter(function(a){return-1===a.newIndex&&!a._removalHandled}).sort(function(a,b){return b.oldIndex-a.oldIndex}),v=0,w=x.length;w>v;v++){var y=x[v];y._removalHandled=!0;var z=y._itemBox;y._itemBox=null;var A=l(y.oldIndex),B=this._view.tree[A.group],C=B.itemsContainer.items[A.item];C.parentNode.removeChild(C),u.hasClass(z,b.UI._selectedClass)&&u.addClass(C,b.UI._selectedClass),B.itemsContainer.items.splice(A.item,1),y.element=C}this._view._modifiedGroups=[];var D=this._canvasProxy;t=0;for(var v=0,w=a.length;w>v&&(!this._groupsEnabled()||n>t);v++){var E=a[v],F=this._view.keyToGroupIndex[E.key],G=this._view.tree[F];if(G)m._view._blockSize?g(G,t,E.size):(k(G,s[F],t,E.size),h(G,t,E.size),i(G,t,E.size)),o.push(G),p[E.key]=o.length-1,delete this._view.keyToGroupIndex[E.key],D=G.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:F,newIndex:o.length-1,element:G.header});else{var H=j(E,t);o.push(H),p[E.key]=o.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:o.length-1,element:H.header}),D=H.itemsContainer.element}t+=E.size}for(var I=[],J=[],K=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],v=0,w=K.length;w>v;v++){var A=this._view.keyToGroupIndex[K[v]],L=this._view.tree[A];if(J.push(L.header),I.push(L.itemsContainer.element),this._view._blockSize)for(var M=0;M<L.itemsContainer.itemsBlocks.length;M++)for(var N=L.itemsContainer.itemsBlocks[M],O=0;O<N.items.length;O++)r.push(N.items[O]);else for(var O=0;O<L.itemsContainer.items.length;O++)r.push(L.itemsContainer.items[O]);this._view._modifiedGroups.push({oldIndex:A,newIndex:-1,element:L.header})}for(var v=0,w=e.length;w>v;v++)if(-1===e[v].newIndex&&!e[v]._removalHandled){e[v]._removalHandled=!0;var z=e[v]._itemBox;e[v]._itemBox=null;var C;r.length?(C=r.pop(),u.empty(C)):C=f(),u.hasClass(z,b.UI._selectedClass)&&u.addClass(C,b.UI._selectedClass),C.appendChild(z),e[v].element=C}return this._view.tree=o,this._view.keyToGroupIndex=p,this._view.containers=q,{removedHeaders:J,removedItemsContainers:I}},_writeProfilerMark:function(a){var c="WinJS.UI.ListView:"+this._id+":"+a;b.Utilities._writeProfilerMark(c),b.log&&b.log(c,null,"listviewprofiler")}},{triggerDispose:function(){b.UI._disposeControls()}});return b.Class.mix(f,b.Utilities.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","accessibilityannotationcomplete")),b.Class.mix(f,b.UI.DOMEventMixin),f}),_isSelectionRendered:function(a){return a.querySelectorAll(b.UI._selectionPartsSelector).length>0}})}(this,WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{Repeater:a.Namespace._lazy(function(){function b(a){var b=document.createElement("div");return b.textContent=JSON.stringify(a),b}var c=a.UI,d=a.Utilities,e="itemsloaded",f="itemchanging",g="itemchanged",h="iteminserting",i="iteminserted",j="itemmoving",k="itemmoved",l="itemremoving",m="itemremoved",n="itemsreloading",o="itemsreloaded",p=d._createEventProperty,q={get duplicateConstruction(){return a.Resources._getWinJSString("ui/duplicateConstruction").value},get asynchronousRender(){return a.Resources._getWinJSString("ui/asynchronousRender").value},get repeaterReentrancy(){return a.Resources._getWinJSString("ui/repeaterReentrancy").value}},r=a.Class.define(function(b,f){if(b&&b.winControl)throw new a.ErrorFromName("WinJS.UI.Repeater.DuplicateConstruction",q.duplicateConstruction);this._element=b||document.createElement("div"),this._id=this._element.id||a.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),f=f||{},d.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var g=this._extractInlineTemplate();this._initializing=!0,this.template=f.template||g,this.data=f.data,this._initializing=!1,c._setOptions(this,f,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(e,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(b){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=b||new a.Binding.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(e,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(c){this._writeProfilerMark("template.set,StartTM"),this._template=c||b,this._render=a.Utilities._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(e,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(a){return this._repeatedDOM[a]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var b=0,c=this._repeatedDOM.length;c>b;b++)a.Utilities._disposeElement(this._repeatedDOM[b])}},onitemsloaded:p(e),onitemchanging:p(f),onitemchanged:p(g),oniteminserting:p(h),oniteminserted:p(i),onitemmoving:p(j),onitemmoved:p(k),onitemremoving:p(l),onitemremoved:p(m),onitemsreloading:p(n),onitemsreloaded:p(o),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var b=document.createElement(this._element.tagName);this._element.firstElementChild;)b.appendChild(this._element.firstElementChild);return new a.Binding.Template(b,{extractChild:!0})}},_renderAllItems:function(){for(var b=document.createDocumentFragment(),c=0,d=this._data.length;d>c;c++){var e=this._render(this._data.getAt(c));if(!e)throw new a.ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",q.asynchronousRender);b.appendChild(e),this._repeatedDOM.push(e)}this._element.appendChild(b)},_reloadRepeater:function(a){this._unloadRepeatedDOM(a),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(b){for(var c=0,d=this._repeatedDOM.length;d>c;c++){var e=this._repeatedDOM[c];b&&a.Utilities._disposeElement(e),e.parentElement===this._element&&this._element.removeChild(e)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(a){this._data.addEventListener(a,this._dataListeners[a],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new a.ErrorFromName("WinJS.UI.Repeater.RepeaterModificationReentrancy",q.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(a){this._data.removeEventListener(a,this._dataListeners[a],!1)}.bind(this))},_dataItemChangedHandler:function(b){this._beginModification();var c,d=this._element,e=b.detail.index,h=this._render(b.detail.newValue);if(!h)throw new a.ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",q.asynchronousRender);this._repeatedDOM[e]&&(b.detail.oldElement=this._repeatedDOM[e]),b.detail.newElement=h,b.detail.setPromise=function(a){c=a},this._writeProfilerMark(f+",info"),this.dispatchEvent(f,b.detail);var i=null;e<this._repeatedDOM.length?(i=this._repeatedDOM[e],d.replaceChild(h,i),this._repeatedDOM[e]=h):(d.appendChild(h),this._repeatedDOM.push(h)),this._endModification(),this._writeProfilerMark(g+",info"),this.dispatchEvent(g,b.detail),i&&a.Promise.as(c).done(function(){a.Utilities._disposeElement(i)}.bind(this))},_dataItemInsertedHandler:function(b){this._beginModification();var c=b.detail.index,d=this._render(b.detail.value);if(!d)throw new a.ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",q.asynchronousRender);var e=this._element;if(b.detail.affectedElement=d,this._writeProfilerMark(h+",info"),this.dispatchEvent(h,b.detail),c<this._repeatedDOM.length){var f=this._repeatedDOM[c];e.insertBefore(d,f)}else e.appendChild(d);this._repeatedDOM.splice(c,0,d),this._endModification(),this._writeProfilerMark(i+",info"),this.dispatchEvent(i,b.detail)
},_dataItemMovedHandler:function(a){this._beginModification();var b=this._repeatedDOM[a.detail.oldIndex];if(a.detail.affectedElement=b,this._writeProfilerMark(j+",info"),this.dispatchEvent(j,a.detail),this._repeatedDOM.splice(a.detail.oldIndex,1)[0],b.parentNode.removeChild(b),a.detail.newIndex<this._data.length-1){var c=this._repeatedDOM[a.detail.newIndex];this._element.insertBefore(b,c),this._repeatedDOM.splice(a.detail.newIndex,0,b)}else this._repeatedDOM.push(b),this._element.appendChild(b);this._endModification(),this._writeProfilerMark(k+",info"),this.dispatchEvent(k,a.detail)},_dataItemRemovedHandler:function(b){this._beginModification();var c,d=this._repeatedDOM[b.detail.index],e={affectedElement:d,index:b.detail.index,item:b.detail.item};e.setPromise=function(a){c=a},this._writeProfilerMark(l+",info"),this.dispatchEvent(l,e),d.parentNode.removeChild(d),this._repeatedDOM.splice(b.detail.index,1),this._endModification(),this._writeProfilerMark(m+",info"),this.dispatchEvent(m,e),a.Promise.as(c).done(function(){a.Utilities._disposeElement(d)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var b,c=this._repeatedDOM.slice(0),d={affectedElements:c};d.setPromise=function(a){b=a},this._writeProfilerMark(n+",info"),this.dispatchEvent(n,d),this._reloadRepeater(!1);var e=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(o+",info"),this.dispatchEvent(o,{affectedElements:e}),a.Promise.as(b).done(function(){for(var b=0,d=c.length;d>b;b++)a.Utilities._disposeElement(c[b])}.bind(this))},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI.Repeater:"+this._id+":"+b)}},{isDeclarativeControlContainer:!0});return a.Class.mix(r,c.DOMEventMixin),r})})}(WinJS),function(a,b,c){"use strict";var d=(b.Utilities,b.Promise);b.Namespace.define("WinJS.UI",{_ItemSet:b.Namespace._lazy(function(){var a=b.Class.define(function(a,b,c){this._listView=a,this._ranges=b,this._itemsCount=c});return a.prototype={getRanges:function(){for(var a=[],b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];a.push({firstIndex:d.firstIndex,lastIndex:d.lastIndex,firstKey:d.firstKey,lastKey:d.lastKey})}return a},getItems:function(){return b.UI.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var a=0,b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];a+=d.lastIndex-d.firstIndex+1}return a},getIndices:function(){for(var a=[],b=0,c=this._ranges.length;c>b;b++)for(var d=this._ranges[b],e=d.firstIndex;e<=d.lastIndex;e++)a.push(e);return a}},a}),getItemsFromRanges:function(a,c){function e(){for(var a=[],b=0,e=c.length;e>b;b++)for(var f=c[b],g=f.firstIndex;g<=f.lastIndex;g++)a.push(g);return d.wrap(a)}var f=a.createListBinding(),g=[];return e().then(function(a){for(var c=0;c<a.length;c++)g.push(f.fromIndex(a[c]));return b.Promise.join(g).then(function(a){return f.release(),a})})},_Selection:b.Namespace._lazy(function(){function a(a){return a&&0===a.firstIndex&&a.lastIndex===Number.MAX_VALUE}return b.Class.derive(b.UI._ItemSet,function(a,b){this._listView=a,this._itemsCount=-1,this._ranges=[],b&&this.set(b)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],d.wrap()},set:function(b){if(a(b))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var c=this;return this._execute("_set",b).then(function(){return c._ranges.sort(function(a,b){return a.firstIndex-b.firstIndex}),c._ensureKeys()}).then(function(){return c._ensureCount()})},add:function(b){if(a(b))return this.selectAll();var c=this;return this._execute("_add",b).then(function(){return c._ensureKeys()}).then(function(){return c._ensureCount()})},remove:function(a){var b=this;return this._execute("_remove",a).then(function(){return b._ensureKeys()})},selectAll:function(){var a=this;return a._ensureCount().then(function(){if(a._itemsCount){var b={firstIndex:0,lastIndex:a._itemsCount-1};return a._retainRange(b),a._releaseRanges(a._ranges),a._ranges=[b],a._ensureKeys()}})},_execute:function(a,b){function e(a,b,c){var d={};return d["first"+a]=b,d["last"+a]=c,d}function f(b){var c=g._getListBinding(),e=d.join([c.fromKey(b.firstKey),c.fromKey(b.lastKey)]).then(function(c){return c[0]&&c[1]&&(b.firstIndex=c[0].index,b.lastIndex=c[1].index,g[a](b)),b});j.push(e)}for(var g=this,h=!!g._getListBinding().fromKey,i=Array.isArray(b)?b:[b],j=[d.wrap()],k=0,l=i.length;l>k;k++){var m=i[k];"number"==typeof m?this[a](e("Index",m,m)):m&&(h&&m.key!==c?f(e("Key",m.key,m.key)):h&&m.firstKey!==c&&m.lastKey!==c?f(e("Key",m.firstKey,m.lastKey)):m.index!==c&&"number"==typeof m.index?this[a](e("Index",m.index,m.index)):m.firstIndex!==c&&m.lastIndex!==c&&"number"==typeof m.firstIndex&&"number"==typeof m.lastIndex&&this[a](e("Index",m.firstIndex,m.lastIndex)))}return d.join(j)},_set:function(a){this._retainRange(a),this._ranges.push(a)},_add:function(a){for(var b,d,e=this,f=null,g=function(a,b){b.lastIndex>a.lastIndex&&(a.lastIndex=b.lastIndex,a.lastKey=b.lastKey,a.lastPromise&&a.lastPromise.release(),a.lastPromise=e._getListBinding().fromIndex(a.lastIndex).retain())},h=0,i=this._ranges.length;i>h;h++){if(b=this._ranges[h],a.firstIndex<b.firstIndex){var j=f&&a.firstIndex<f.lastIndex+1;j?(d=h-1,g(f,a)):(this._insertRange(h,a),d=h);break}if(a.firstIndex===b.firstIndex){g(b,a),d=h;break}f=b}if(d===c){var k=this._ranges.length?this._ranges[this._ranges.length-1]:null,l=k&&a.firstIndex<k.lastIndex+1;l?g(k,a):(this._retainRange(a),this._ranges.push(a))}else{for(f=null,h=d+1,i=this._ranges.length;i>h;h++){if(b=this._ranges[h],a.lastIndex<b.firstIndex){j=f&&f.lastIndex>a.lastIndex,j&&g(this._ranges[d],f),this._removeRanges(d+1,h-d-1);break}if(a.lastIndex===b.firstIndex){g(this._ranges[d],b),this._removeRanges(d+1,h-d);break}f=b}h>=i&&(g(this._ranges[d],this._ranges[i-1]),this._removeRanges(d+1,i-d-1))}},_remove:function(a){function b(a){return c._getListBinding().fromIndex(a).retain()}for(var c=this,d=[],e=0,f=this._ranges.length;f>e;e++){var g=this._ranges[e];g.lastIndex<a.firstIndex||g.firstIndex>a.lastIndex?d.push(g):g.firstIndex<a.firstIndex&&g.lastIndex>=a.firstIndex&&g.lastIndex<=a.lastIndex?(d.push({firstIndex:g.firstIndex,firstKey:g.firstKey,firstPromise:g.firstPromise,lastIndex:a.firstIndex-1,lastPromise:b(a.firstIndex-1)}),g.lastPromise.release()):g.lastIndex>a.lastIndex&&g.firstIndex>=a.firstIndex&&g.firstIndex<=a.lastIndex?(d.push({firstIndex:a.lastIndex+1,firstPromise:b(a.lastIndex+1),lastIndex:g.lastIndex,lastKey:g.lastKey,lastPromise:g.lastPromise}),g.firstPromise.release()):g.firstIndex<a.firstIndex&&g.lastIndex>a.lastIndex?(d.push({firstIndex:g.firstIndex,firstKey:g.firstKey,firstPromise:g.firstPromise,lastIndex:a.firstIndex-1,lastPromise:b(a.firstIndex-1)}),d.push({firstIndex:a.lastIndex+1,firstPromise:b(a.lastIndex+1),lastIndex:g.lastIndex,lastKey:g.lastKey,lastPromise:g.lastPromise})):(g.firstPromise.release(),g.lastPromise.release())}this._ranges=d},_ensureKeys:function(){for(var a=[d.wrap()],b=this,c=function(a,b){var c=a+"Key";if(b[c])return d.wrap();var e=b[a+"Promise"];return e.then(function(a){a&&(b[c]=a.key)}),e},e=0,f=this._ranges.length;f>e;e++){var g=this._ranges[e];a.push(c("first",g)),a.push(c("last",g))}return d.join(a).then(function(){b._ranges=b._ranges.filter(function(a){return a.firstKey&&a.lastKey})}),d.join(a)},_mergeRanges:function(a,b){a.lastIndex=b.lastIndex,a.lastKey=b.lastKey},_isIncluded:function(a){if(this.isEverything())return!0;for(var b=0,c=this._ranges.length;c>b;b++){var d=this._ranges[b];if(d.firstIndex<=a&&a<=d.lastIndex)return!0}return!1},_ensureCount:function(){var a=this;return this._listView._itemsCount().then(function(b){a._itemsCount=b})},_insertRange:function(a,b){this._retainRange(b),this._ranges.splice(a,0,b)},_removeRanges:function(a,b){for(var c=0;b>c;c++)this._releaseRange(this._ranges[a+c]);this._ranges.splice(a,b)},_retainRange:function(a){a.firstPromise||(a.firstPromise=this._getListBinding().fromIndex(a.firstIndex).retain()),a.lastPromise||(a.lastPromise=this._getListBinding().fromIndex(a.lastIndex).retain())},_retainRanges:function(){for(var a=0,b=this._ranges.length;b>a;a++)this._retainRange(this._ranges[a])},_releaseRange:function(a){a.firstPromise.release(),a.lastPromise.release()},_releaseRanges:function(a){for(var b=0,c=a.length;c>b;++b)this._releaseRange(a[b])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:b.Namespace._lazy(function(){var a=function(a){this._listView=a,this._selected=new b.UI._Selection(this._listView),this._pivot=b.UI._INVALID_INDEX,this._focused={type:b.UI.ObjectType.item,index:0},this._pendingChange=d.wrap()};return a.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(a){var c=this,d=new b._Signal;return this._synchronize(d).then(function(){var e=new b.UI._Selection(c._listView);return e.set(a).then(function(){c._set(e),d.complete()},function(a){return e.clear(),d.complete(),b.Promise.wrapError(a)})})},clear:function(){var a=this,c=new b._Signal;return this._synchronize(c).then(function(){var d=new b.UI._Selection(a._listView);return d.clear().then(function(){a._set(d),c.complete()},function(a){return d.clear(),c.complete(),b.Promise.wrapError(a)})})},add:function(a){var c=this,d=new b._Signal;return this._synchronize(d).then(function(){var e=c._cloneSelection();return e.add(a).then(function(){c._set(e),d.complete()},function(a){return e.clear(),d.complete(),b.Promise.wrapError(a)})})},remove:function(a){var c=this,d=new b._Signal;return this._synchronize(d).then(function(){var e=c._cloneSelection();return e.remove(a).then(function(){c._set(e),d.complete()},function(a){return e.clear(),d.complete(),b.Promise.wrapError(a)})})},selectAll:function(){var a=this,c=new b._Signal;return this._synchronize(c).then(function(){var d=new b.UI._Selection(a._listView);return d.selectAll().then(function(){a._set(d),c.complete()},function(a){return d.clear(),c.complete(),b.Promise.wrapError(a)})})},_synchronize:function(a){var c=this;return this._listView._versionManager.unlocked.then(function(){var d=c._pendingChange;return c._pendingChange=b.Promise.join([d,a.promise]).then(function(){}),d})},_reset:function(){this._pivot=b.UI._INVALID_INDEX,this._setFocused({type:b.UI.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=d.wrap(),this._selected.clear(),this._selected=new b.UI._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(a){var b=this;return this._fireSelectionChanging(a).then(function(c){return c?(b._selected.clear(),b._selected=a,b._listView._updateSelection(),b._fireSelectionChanged()):a.clear(),c})},_fireSelectionChanging:function(a){var b=document.createEvent("CustomEvent"),c=d.wrap();b.initCustomEvent("selectionchanging",!0,!0,{newSelection:a,preventTapBehavior:function(){},setPromise:function(a){c=a}});var e=this._listView._element.dispatchEvent(b);return c.then(function(){return e})},_fireSelectionChanged:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(a)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(a,b){this._focused={type:a.type,index:a.index},this._focusedByKeyboard=b},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(a){this._selected._itemsCount=a},_isIncluded:function(a){return this._selected._isIncluded(a)},_cloneSelection:function(){var a=new b.UI._Selection(this._listView);return a._ranges=this._selected.getRanges(),a._itemsCount=this._selected._itemsCount,a._retainRanges(),a}},a.supportedForProcessing=!1,a})})}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{_VirtualizeContentsView:b.Namespace._lazy(function(){function a(b){for(var c,d=b.job._workItems;d.length&&!b.shouldYield;)(c=d.shift())();b.setWork(a),d.length||b.job.pause()}function c(b,c){var d=j.schedule(a,b,null,c);return d._workItems=[],d.addWork=function(a,b){b?this._workItems.unshift(a):this._workItems.push(a),this.resume()},d.clearWork=function(){this._workItems.length=0},d.dispose=function(){this.cancel(),this._workItems.length=0},d}function d(a){return a._zooming||a._pinching}function e(a,c){return a._isZombie()?i.wrap():d(a)?(+c!==c&&(c=b.UI._VirtualizeContentsView._waitForSeZoTimeoutDuration),i.timeout(b.UI._VirtualizeContentsView._waitForSeZoIntervalDuration).then(function(){return c-=b.UI._VirtualizeContentsView._waitForSeZoIntervalDuration,0>=c?!0:e(a,c)})):i.wrap()}function f(a){if("number"==typeof a){var b=a;a=function(){return{position:b,direction:"right"}}}return a}function g(){}var h=b.Utilities,i=b.Promise,j=b.Utilities.Scheduler,k=function(a){this._listView=a,this._forceRelayout=!1,this.items=new b.UI._ItemsContainer(a),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=i.wrap(),this._state=new l(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=c(j.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=c(j.Priority.normal,"front off-screen items"),this._backOffscreenJob=c(j.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=f(0)};k._pagesToPrefetch=2,k._waitForSeZoIntervalDuration=100,k._waitForSeZoTimeoutDuration=500,k._chunkSize=500,k._startupChunkSize=100,k._maxTimePerCreateContainers=5,k._createContainersJobTimeslice=15,k._blocksToRelease=10,k._realizationLevel={skip:"skip",realize:"realize",normal:"normal"},k.prototype={_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(a,c,d,e){this._listView._writeProfilerMark("createItem("+a+") "+this._getBoundingRectString(a)+",info");var f=this;f._listView._itemsManager._itemFromItemPromiseThrottled(c).done(function(b){b?d(a,b,f._listView._itemsManager._recordFromElement(b)):e(a)},function(c){return e(a),b.Promise.wrapError(c)})},_addItem:function(a,b,c,d){if(this._realizePass===d){var e=this._listView._itemsManager._recordFromElement(c);delete this._pendingItemPromises[e.itemPromise.handle],this.items.setItemAt(b,{itemBox:null,container:null,element:c,detached:!0,itemsManagerRecord:e})}},finalItem:function(){return this.containers?i.wrap(this.containers.length-1):i.cancel},_setSkipRealizationForChange:function(a){a?this._realizationLevel!==b.UI._VirtualizeContentsView._realizationLevel.realize&&(this._realizationLevel=b.UI._VirtualizeContentsView._realizationLevel.skip):this._realizationLevel=b.UI._VirtualizeContentsView._realizationLevel.realize},_realizeItems:function(a,c,d,e,f,g,k,l,m,n){function o(a,c){A.push(b.Promise._cancelBlocker(c.renderComplete)),s(a)}function p(a,c){function d(a,c){!a.updatedSwipeableAttribute&&(E._listView.itemsDraggable||E._listView.itemsReorderable||E._listView._swipeable)&&a.itemsManagerRecord.renderComplete.done(function(){if(E._realizePass===f){var d=h.hasClass(c,b.UI._nonDraggableClass),e=h.hasClass(c,b.UI._nonSelectableClass),g=E._listView.itemsDraggable||E._listView.itemsReorderable,i=E._listView._selectionAllowed()&&E._listView._swipeBehavior===b.UI.SwipeBehavior.select;g&&!d&&(a.itemBox.draggable=!0),E._listView._swipeable&&(g&&!i&&d||i&&!g&&e||d&&e)&&h.addClass(a.itemBox,b.UI._nonSwipeableClass),a.updatedSwipeableAttribute=!0}})}if(E._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!E._listView._isZombie()){var e,g=0,i=-1,j=-1;for(e=a;c>=e;e++){var l=E.items.itemDataAt(e);if(l){var m=l.element,n=l.itemBox;n||(n=E._listView._itemBoxTemplate.cloneNode(!0),l.itemBox=n,n.appendChild(m),h.addClass(m,b.UI._itemClass),E._listView._setupAriaSelectionObserver(m),E._listView._isSelected(e)&&b.UI._ItemEventsHandler.renderSelection(n,m,!0,!0),E._listView._currentMode().renderDragSourceOnRealizedItem(e,n)),d(l,m,n);var o=E.getContainer(e);n.parentNode!==o&&(E._appendAndRestoreFocus(o,n),g++,0>i&&(i=e),j=e,l.container=o,E._listView._isSelected(e)&&h.addClass(o,b.UI._selectedClass),h.removeClass(o,b.UI._backdropClass),E.items.elementAvailable(e))}}E._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),g>0&&(E._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+g+" ("+i+"-"+j+"),info"),E._reportElementsLevel(k))}}function q(a,c,d,e){function f(a,c){var d=E.items.itemDataAt(a);if(d){var e=d.itemBox;return e&&e.parentNode?c?(h.addClass(e.parentNode,b.UI._backdropClass),e.parentNode.removeChild(e),!0):!1:!0}return!0}if(!n){for(var g=!1;a>=d;)g=f(a,g),a--;for(g=!1;e>=c;)g=f(c,g),c++}}function r(a,b,c,d,e){function g(a){var b=E.items.itemDataAt(a);if(b){var d=b.itemsManagerRecord;d.readyComplete||E._realizePass!==f||c.addWork(function(){E._listView._isZombie()||d.pendingReady&&E._realizePass===f&&(E._listView._writeProfilerMark("pendingReady("+a+"),info"),d.pendingReady())},e)}}for(var h=[],j=a;b>=j;j++){var k=E.items.itemDataAt(j);k&&h.push(k.itemsManagerRecord.itemPromise)}i.join(h).then(function(){if("right"===d)for(var c=a;b>=c;c++)g(c);else for(var c=b;c>=a;c--)g(c)})}function s(a){if(E._realizePass===f){if(a>=l&&m>=a){if(0===--x){if(p(l,m),q(l,m,c,d),E._firstLayoutPass){r(l,m,E._frontOffscreenJob,"right"===k?"left":"right",!0);var b=j.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!E._listView._isZombie()){E._listView._writeProfilerMark("entranceAnimation,StartTM");var a=E._listView._animateListEntrance(!E._firstEntranceAnimated);return E._firstEntranceAnimated=!0,a}});E._runningAnimations=i.join([E._runningAnimations,b]),E._runningAnimations.done(function(){E._listView._writeProfilerMark("entranceAnimation,StopTM"),E._realizePass===f&&(E._runningAnimations=null,B.complete())}),E._firstLayoutPass=!1,E._listView._isCurrentZoomView&&j.requestDrain(E._onscreenJob.priority)}else r(l,m,E._frontOffscreenJob,k),B.complete();E._updateHeaders(E._listView._canvas,l,m+1).done(function(){C.complete()})}}else l>a?(--z,z%w===0&&p(c,l-1),z||(E._updateHeaders(E._listView._canvas,c,l).done(function(){"right"!==k&&D.complete()}),r(c,l-1,"right"!==k?E._frontOffscreenJob:E._backOffscreenJob,"left"))):a>m&&(--y,y%w===0&&p(m+1,d-1),y||(E._updateHeaders(E._listView._canvas,m+1,d).then(function(){"right"===k&&D.complete()}),r(m+1,d-1,"right"===k?E._frontOffscreenJob:E._backOffscreenJob,"right")));v--,0===v&&(E._renderCompletePromise=i.join(A).then(null,function(a){var b=Array.isArray(a)&&a.some(function(a){return a&&!(a instanceof Error&&"Canceled"===a.name)});return b?i.wrapError(a):void 0}),(E._headerRenderPromises||i.wrap()).done(function(){j.schedule(function(){E._listView._isZombie()?J.cancel():J.complete()},Math.min(E._onscreenJob.priority,E._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function t(b,c,d){if(E._realizePass===f){var c=d.element;E._addItem(a,b,c,f),o(b,d)}}var u="_realizeItems("+c+"-"+(d-1)+") visible("+l+"-"+m+")";this._listView._writeProfilerMark(u+",StartTM"),k=k||"right";var v=d-c,w=m-l+1,x=w,y=d-m-1,z=l-c,A=[],B=new b._Signal,C=new b._Signal,D=new b._Signal,E=this;if(v>0){var F=0,G=0,H=0;E.firstIndexDisplayed=l,E.lastIndexDisplayed=m;var I=E._listView._isCurrentZoomView;E._highPriorityRealize&&(E._firstLayoutPass||E._hasAnimationInViewportPending)?(E._highPriorityRealize=!1,E._onscreenJob.priority=j.Priority.high,E._frontOffscreenJob.priority=j.Priority.normal,E._backOffscreenJob.priority=j.Priority.belowNormal):E._highPriorityRealize?(E._highPriorityRealize=!1,E._onscreenJob.priority=j.Priority.high,E._frontOffscreenJob.priority=j.Priority.high-1,E._backOffscreenJob.priority=j.Priority.high-1):I?(E._onscreenJob.priority=j.Priority.aboveNormal,E._frontOffscreenJob.priority=j.Priority.normal,E._backOffscreenJob.priority=j.Priority.belowNormal):(E._onscreenJob.priority=j.Priority.belowNormal,E._frontOffscreenJob.priority=j.Priority.idle,E._backOffscreenJob.priority=j.Priority.idle);var J=new b._Signal,K=E._listView._versionManager.cancelOnNotification(J.promise),L=function(a,b){b.startStage1&&b.stage0.then(function(){E._realizePass===f&&b.startStage1&&a.addWork(b.startStage1)})},M=function(a,b){var c=E.items.itemDataAt(b);if(!c){var d=E._listView._itemsManager._itemPromiseAtIndex(b);E._pendingItemPromises[d.handle]=d,delete E._previousRealizationPendingItemPromises[d.handle],a.addWork(function(){if(!E._listView._isZombie()&&(F++,E._createItem(b,d,t,s),!E._listView._isZombie()&&E._realizePass===f&&d.handle)){var c=E._listView._itemsManager._recordFromHandle(d.handle);L(a,c)}})}},N=function(a,b,c){for(var d=b;c>=d;d++)M(a,d)},O=function(a,b,c){for(var d=c;d>=b;d--)M(a,d)},P=function(a,b,c){for(var d=b;c>=d;d++){var e=E.items.itemDataAt(d);if(e){var f=e.itemsManagerRecord;o(d,f),G++,L(a,f)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var Q;"left"===k?(O(E._onscreenJob,l,m),O(E._frontOffscreenJob,c,l-1),Q=c>l-1):(N(E._onscreenJob,l,m),N(E._frontOffscreenJob,m+1,d-1),Q=m+1>d-1);for(var R=0,S=Object.keys(this._previousRealizationPendingItemPromises),T=S.length;T>R;R++){var U=S[R];E._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[U])}this._previousRealizationPendingItemPromises={},P(E._onscreenJob,l,m),"left"===k?P(E._frontOffscreenJob,c,l-1):P(E._frontOffscreenJob,m+1,d-1);var V=x===m-l+1;return E._firstLayoutPass?E._listView._canvas.style.opacity=0:V?E._listView._showProgressBar(E._listView._element,"50%","50%"):E._listView._hideProgressBar(),E._frontOffscreenJob.pause(),E._backOffscreenJob.pause(),C.promise.done(function(){E._frontOffscreenJob.resume(),Q&&D.complete()},function(){J.cancel()}),D.promise.done(function(){E._listView._writeProfilerMark("frontItemsRealized,info"),"left"===k?(N(E._backOffscreenJob,m+1,d-1),P(E._backOffscreenJob,m+1,d-1)):(O(E._backOffscreenJob,c,l-1),P(E._backOffscreenJob,c,l-1)),E._backOffscreenJob.resume()}),J.promise.done(function(){E._listView._versionManager.clearCancelOnNotification(K),E._listView._writeProfilerMark(u+" complete(created:"+F+" updated:"+G+"),info")},function(a){return E._listView._versionManager.clearCancelOnNotification(K),E._onscreenJob.clearWork(),E._frontOffscreenJob.clearWork(),E._backOffscreenJob.clearWork(),B.cancel(),C.cancel(),E._listView._writeProfilerMark(u+" canceled(created:"+F+" updated:"+G+" clean:"+H+"),info"),b.Promise.wrapError(a)}),E._listView._writeProfilerMark(u+",StopTM"),{viewportItemsRealized:C.promise,allItemsRealized:J.promise,loadingCompleted:i.join([J.promise,B.promise]).then(function(){for(var a=[],e=c;d>e;e++){var f=E.items.itemDataAt(e);f&&a.push(f.itemsManagerRecord.itemReadyPromise)}return b.Promise._cancelBlocker(i.join(a))})}}return E._listView._writeProfilerMark(u+",StopTM"),{viewportItemsRealized:i.wrap(),allItemsRealized:i.wrap(),loadingCompleted:i.wrap()}},_setAnimationInViewportState:function(a){if(this._hasAnimationInViewportPending=!1,a&&a.length>0)for(var b=this._listView._getViewportLength(),c=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+b-1),d=0,e=a.length;e>d;d++){var f=a[d];if(f.newIndex>=c.firstIndex&&f.newIndex<=c.lastIndex&&f.newIndex!==f.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(a,c){var d=this;return this._listView._groups.renderGroup(c).then(function(a){if(a){var e=d._getHeaderContainer(c);a.element.parentNode!==e&&(e.appendChild(a.element),h.addClass(a.element,b.UI._headerClass)),d._listView._groups.setDomElement(c,a.element)}})},_updateHeaders:function(a,b,c){function d(b){var c=f._listView._groups.group(b);if(c&&!c.header){var d=c.headerPromise;return d||(d=c.headerPromise=f._addHeader(a,b),d.done(function(){c.headerPromise=null},function(){c.headerPromise=null})),d}return i.wrap()}function e(){f._headerRenderPromises=null}var f=this;this._listView._groups.removeElements();var g=this._listView._groups.groupFromItem(b),h=g,j=this._listView._groups.groupFromItem(c-1),k=[];if(null!==h)for(;j>=h;h++)k.push(d(h));return this._headerRenderPromises=i.join(k,this._headerRenderPromises).then(e,e),this._headerRenderPromises||i.wrap()},_unrealizeItem:function(a){var c,d=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+a+"),info");var e=d._selection._getFocused();e.type!==b.UI.ObjectType.groupHeader&&e.index===a&&(d._unsetFocusOnItem(),c=!0);var f=this.items.itemDataAt(a),g=f.element,i=f.itemBox;i&&i.parentNode&&(h.removeClass(i.parentNode,b.UI._selectedClass),h.removeClass(i.parentNode,b.UI._footprintClass),h.addClass(i.parentNode,b.UI._backdropClass),i.parentNode.removeChild(i)),f.container=null,d._currentMode().itemUnrealized&&d._currentMode().itemUnrealized(a,i),this.items.removeItem(a),f.removed||d._itemsManager.releaseItem(g),b.Utilities._disposeElement(g),c&&d._setFocusOnItem(d._selection._getFocused())},_unrealizeGroup:function(a){var c,d=a.header,e=this._listView._selection._getFocused();e.type===b.UI.ObjectType.groupHeader&&this._listView._groups.group(e.index)===a&&(this._listView._unsetFocusOnItem(),c=!0),d.parentNode&&d.parentNode.removeChild(d),b.Utilities._disposeElement(d),a.header=null,a.left=-1,a.top=-1,c&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(a){var b=this,c=0;this.items.eachIndex(function(d){return d<b.begin||d>=b.end?(b._unrealizeItem(d),a&&++c>=a):void 0});var d=this._listView._groups,e=d.groupFromItem(this.begin);if(null!==e)for(var f=d.groupFromItem(this.end-1),g=0,h=d.length();h>g;g++){var i=d.group(g);(e>g||g>f)&&i.header&&this._unrealizeGroup(i)}},_unrealizeExcessiveItems:function(){var a=this.items.count(),b=this.end-this.begin,c=b+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+a+") approved("+c+"),info"),a>c&&this._unrealizeItems(a-c)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var a=this;return e(this._listView).then(function(){function b(){a._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(a._listView._isZombie())return void b();var c=[];a.items.eachIndex(function(b){(b<a.begin||b>=a.end)&&c.push(b)}),a._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+c.length+"),info");var f=[],g=a._listView._groups,h=g.groupFromItem(a.begin);if(null!==h)for(var k=g.groupFromItem(a.end-1),l=0,m=g.length();m>l;l++){var n=g.group(l);(h>l||l>k)&&n.header&&f.push(n)}if(c.length||f.length){var o,p=new i(function(b){function g(h){if(!a._listView._isZombie()){for(var i=-1,j=-1,k=0,l=d(a._listView);c.length&&!l&&!h.shouldYield;){var m=c.shift();a._unrealizeItem(m),k++,0>i&&(i=m),j=m}for(a._listView._writeProfilerMark("unrealizeWorker removeItems:"+k+" ("+i+"-"+j+"),info");f.length&&!l&&!h.shouldYield;)a._unrealizeGroup(f.shift());c.length||f.length?l?h.setPromise(e(a._listView).then(function(){return g})):h.setWork(g):b()}}o=j.schedule(g,j.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return p.then(b,function(b){return o.cancel(),a._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),a._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),i.wrapError(b)})}return b(),i.wrap()})},_getBoundingRectString:function(a){var b;if(a>=0&&a<this.containers.length){var c=this._listView._layout._getItemPosition(a);c&&(b="["+c.left+"; "+c.top+"; "+c.width+"; "+c.height+" ]")}return b||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),-1!==this.deferredActionCancelToken&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(a){function c(){g._listView._writeProfilerMark("aria work,StopTM")}function f(a){var b=g._listView._groups,c=b.group(a+1);return c?Math.min(c.startIndex-1,g.end-1):g.end-1}if(!this._listView._isZombie()){var g=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(h){if(!(h>0&&-1!==g.firstIndexDisplayed&&-1!==g.lastIndexDisplayed))return i.wrap();g._listView._writeProfilerMark("aria work,StartTM");var k,l,m,n,o,p,q=g._listView._ariaStartMarker,r=g._listView._ariaEndMarker,s=g.begin,t=g.items.itemAt(g.begin);return t?(b.UI._ensureId(t),g._listView._groupsEnabled()?(l=g._listView._groups,m=n=l.groupFromItem(g.begin),o=l.group(n),p=f(n),b.UI._ensureId(o.header),b.UI._setAttribute(o.header,"role",g._listView._headerRole),b.UI._setAttribute(o.header,"x-ms-aria-flowfrom",q.id),b.UI._setFlow(o.header,t),b.UI._setAttribute(o.header,"tabindex",g._listView._tabIndex)):b.UI._setAttribute(t,"x-ms-aria-flowfrom",q.id),new i(function(i){var q=a;k=j.schedule(function u(a){if(g._listView._isZombie())return void c();for(;s<g.end;s++){if(!q&&d(g._listView))return void a.setPromise(e(g._listView).then(function(a){return q=a,u}));if(a.shouldYield)return void a.setWork(u);t=g.items.itemAt(s);var j=g.items.itemAt(s+1);if(j&&b.UI._ensureId(j),b.UI._setAttribute(t,"role",g._listView._itemRole),b.UI._setAttribute(t,"aria-setsize",h),b.UI._setAttribute(t,"aria-posinset",s+1),b.UI._setAttribute(t,"tabindex",g._listView._tabIndex),g._listView._groupsEnabled())if(s!==p&&j)b.UI._setFlow(t,j);else{var k=l.group(n+1);k&&k.header&&j?(b.UI._setAttribute(k.header,"tabindex",g._listView._tabIndex),b.UI._setAttribute(k.header,"role",g._listView._headerRole),b.UI._ensureId(k.header),b.UI._setFlow(t,k.header),b.UI._setFlow(k.header,j)):b.UI._setAttribute(t,"aria-flowto",r.id),n++,o=k,p=f(n)}else j?b.UI._setFlow(t,j):b.UI._setAttribute(t,"aria-flowto",r.id);if(!j)break}g._listView._fireAccessibilityAnnotationCompleteEvent(g.begin,s,m,n-1),c(),i()},j.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){k.cancel(),c()})):void c()})}},_setupDeferredActions:function(){function a(){c._listView._isZombie()||(c.deferTimeout=null,c._listView._versionManager.clearCancelOnNotification(c.deferredActionCancelToken),c.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var c=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return b.Promise.timeout(b.UI._DEFERRED_ACTION)}).then(function(){return e(c._listView)}).then(function(a){return c._setupAria(a)}).then(a,function(b){return a(),i.wrapError(b)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(a,c,d){function e(){return g.items.itemAt(c)}function f(){for(var a=d;a>=c;a--)if(g.items.itemAt(a))return g.items.itemAt(a);return null}var g=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var h,i,j=this._listView._ariaStartMarker,k=this._listView._ariaEndMarker;if(-1!==c&&-1!==d&&d>=c&&(h=e(),i=f()),!a&&h&&i){if(b.UI._ensureId(h),b.UI._ensureId(i),this._listView._groupsEnabled()){var l=this._listView._groups,m=l.group(l.groupFromItem(c));m.header&&(b.UI._ensureId(m.header),c===m.startIndex?b.UI._setAttribute(j,"aria-flowto",m.header.id):b.UI._setAttribute(j,"aria-flowto",h.id))}else b.UI._setAttribute(j,"aria-flowto",h.id);b.UI._setAttribute(k,"x-ms-aria-flowfrom",i.id)}else b.UI._setFlow(j,k),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(a,c){var d=-1,e=b.UI.ObjectType.item;
b.Utilities.hasClass(a,b.UI._headerClass)?(d=this._listView._groups.index(a),e=b.UI.ObjectType.groupHeader,b.UI._setAttribute(a,"role",this._listView._headerRole)):(d=this.items.index(a),b.UI._setAttribute(a,"aria-setsize",c),b.UI._setAttribute(a,"aria-posinset",d+1),b.UI._setAttribute(a,"role",this._listView._itemRole)),e===b.UI.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,d,d):this._listView._fireAccessibilityAnnotationCompleteEvent(d,d,-1,-1)},_reportElementsLevel:function(a){function b(a,b){for(var c=0,e=a;b>=e;e++){var f=d.itemDataAt(e);f&&f.container&&c++}return c}var c,d=this.items;c=Math.floor("right"===a?100*b(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed):100*b(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+c+"),info")},_createHeaderContainer:function(a){return this._createSurfaceChild(b.UI._headerContainerClass,a)},_createItemsContainer:function(a){var c=this._createSurfaceChild(b.UI._itemsContainerClass,a),d=document.createElement("div");return d.className=b.UI._padderClass,c.appendChild(d),c},_ensureContainerInDOM:function(a){var b=this.containers[a];return b&&!this._listView._canvas.contains(b)?(this._forceItemsBlocksInDOM(a,a+1),!0):!1},_ensureItemsBlocksInDOM:function(a,b){if(this._expandedRange){var c=this._expandedRange.first.index,d=this._expandedRange.last.index+1;c>=a&&b>c?b=Math.max(b,d):d>a&&b>=d&&(a=Math.min(a,c))}this._forceItemsBlocksInDOM(a,b)},_removeRedundantItemsBlocks:function(){-1!==this.begin&&-1!==this.end&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var a=this;return e(this._listView).then(function(){function c(){a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(a._listView._isZombie())return void c();if(a._expandedRange&&-1!==a.begin&&-1!==a.end&&(a._expandedRange.first.index<a.begin||a._expandedRange.last.index+1>a.end)){var f,g=new i(function(c){function g(f){if(!a._listView._isZombie()){for(var h=d(a._listView);a._expandedRange.first.index<a.begin&&!h&&!f.shouldYield;){var i=Math.min(a.begin,a._expandedRange.first.index+a._blockSize*b.UI._VirtualizeContentsView._blocksToRelease);a._forceItemsBlocksInDOM(i,a.end)}for(;a._expandedRange.last.index+1>a.end&&!h&&!f.shouldYield;){var j=Math.max(a.end,a._expandedRange.last.index-a._blockSize*b.UI._VirtualizeContentsView._blocksToRelease);a._forceItemsBlocksInDOM(a.begin,j)}a._expandedRange.first.index<a.begin||a._expandedRange.last.index+1>a.end?h?f.setPromise(e(a._listView).then(function(){return g})):f.setWork(g):c()}}f=j.schedule(g,j.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return g.then(c,function(b){return f.cancel(),a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),a._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),i.wrapError(b)})}return c(),i.wrap()})},_forceItemsBlocksInDOM:function(a,b){function c(a,b){var c=a.element.firstElementChild;c.style[q]=b}function d(a){for(var b=0;b<n.tree.length;b++)for(var c=n.tree[b].itemsContainer,d=0,e=c.itemsBlocks.length;e>d;d++)if(a(c,c.itemsBlocks[d]))return}function e(a){n._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),n._listView._itemsBlockExtent=h[n._listView._horizontal()?"getTotalWidth":"getTotalHeight"](a.element),n._listView._writeProfilerMark("_itemsBlockExtent("+n._listView._itemsBlockExtent+"),info"),n._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function f(){return-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize&&b.element.parentNode===a.element?(e(b),!0):!1}),-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize?(a.element.appendChild(b.element),e(b),a.element.removeChild(b.element),!0):!1}),n._listView._itemsBlockExtent}function g(a,b,c){function d(b){var c=a.itemsBlocks[b];c&&c.element.parentNode===a.element&&(a.element.removeChild(c.element),p++)}if(Array.isArray(b))b.forEach(d);else for(var e=b;c>e;e++)d(e)}function i(a,b,c){for(var d=a.element.firstElementChild,e=d,f=b;c>f;f++){var g=a.itemsBlocks[f];g&&(g.element.parentNode!==a.element&&(a.element.insertBefore(g.element,e.nextElementSibling),o++),e=g.element)}}function j(a){if(a<n.tree.length){n._listView._writeProfilerMark("collapseGroup("+a+"),info");var b=n.tree[a].itemsContainer;g(b,0,b.itemsBlocks.length),c(b,"")}}function k(a){if(a<n.tree.length){n._listView._writeProfilerMark("expandGroup("+a+"),info");var b=n.tree[a].itemsContainer;i(b,0,b.itemsBlocks.length),c(b,"")}}function l(a,b){function c(a,b){for(var c=[],d=a;b>=d;d++)c.push(d);return c}var d=b[0],e=b[1],f=a[0],g=a[1];return f>e||d>g?c(f,g):d>f&&g>e?c(f,d-1).concat(c(e+1,g)):d>f?c(f,d-1):g>e?c(e+1,g):null}if(this._blockSize){var m="_forceItemsBlocksInDOM begin("+a+") end("+b+"),";this._listView._writeProfilerMark(m+"StartTM");var n=this,o=0,p=0,q="padding"+(this._listView._horizontal()?"Left":"Top"),r=this._listView._groups.groupFromItem(a),s=this._listView._groups.groupFromItem(b-1),t=this._listView._groups.group(r),u=n.tree[r].itemsContainer,v=Math.floor((a-t.startIndex)/this._blockSize),w=this._listView._groups.group(s),x=n.tree[s].itemsContainer,y=Math.floor((b-1-w.startIndex)/this._blockSize);v&&-1===n._listView._itemsBlockExtent&&d(function(a,b){return b.items.length===n._blockSize&&b.element.parentNode===a.element?(e(b),!0):!1});var z=this._expandedRange?l([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[r,s]):null;if(z&&z.forEach(j),this._expandedRange&&this._expandedRange.first.groupKey===t.key){var A=l([this._expandedRange.first.block,Number.MAX_VALUE],[v,Number.MAX_VALUE]);A&&g(u,A)}else this._expandedRange&&r>=this._expandedRange.first.groupIndex&&r<=this._expandedRange.last.groupIndex&&g(u,0,v);if(r!==s?(i(u,v,u.itemsBlocks.length),i(x,0,y+1)):i(u,v,y+1),this._expandedRange&&this._expandedRange.last.groupKey===w.key){var A=l([0,this._expandedRange.last.block],[0,y]);A&&g(x,A)}else this._expandedRange&&s>=this._expandedRange.first.groupIndex&&s<=this._expandedRange.last.groupIndex&&g(x,y+1,x.itemsBlocks.length);c(u,v?v*f()+"px":""),r!==s&&c(x,"");for(var B=r+1;s>B;B++)k(B);this._expandedRange={first:{index:a,groupIndex:r,groupKey:t.key,block:v},last:{index:b-1,groupIndex:s,groupKey:w.key,block:y}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+r+"-"+s+") blocks("+v+"-"+y+") added("+o+") removed("+p+"),info"),this._listView._writeProfilerMark(m+"StopTM")}},_realizePageImpl:function(){var a=this,c="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(c+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){a._listView._isZombie()||a._listView._batchViewUpdates(b.UI._ViewChange.realize,b.UI._ScrollToPriority.low,a._listView.scrollPosition)}),this._listView._writeProfilerMark(c+",StopTM"),i.cancel):new i(function(d){function e(){d(),k.complete()}function f(){a._listView._hideProgressBar(),a._state.setLoadingState(a._listView._LoadingState.viewPortLoaded),a._executeAnimations&&a._setState(u,k.promise)}function g(b){a._updateAriaMarkers(0===b,a.firstIndexDisplayed,a.lastIndexDisplayed),a._state.setLoadingState&&a._state.setLoadingState(a._listView._LoadingState.itemsLoaded)}function j(b){a._listView._clearInsertedItems(),a._listView._groups.removeElements(),f(),g(b),e()}var k=new b._Signal;a._state.setLoadingState(a._listView._LoadingState.itemsLoading),a._firstLayoutPass&&a._listView._showProgressBar(a._listView._element,"50%","50%");var l=a.containers.length;if(l){var m=b.UI._VirtualizeContentsView._pagesToPrefetch;a._listView._zooming&&(m=0);var n=a._listView._getViewportLength(),o=Math.max(0,a._scrollbarPos-m*n),p=a._scrollbarPos+(1+m)*n,q=a._listView._layout.itemsFromRange(o,p-1);if((q.firstIndex<0||q.firstIndex>=l)&&(q.lastIndex<0||q.lastIndex>=l))a.begin=-1,a.end=-1,a.firstIndexDisplayed=-1,a.lastIndexDisplayed=-1,j(l);else{var r=h._clamp(q.firstIndex,0,l-1),s=h._clamp(q.lastIndex+1,0,l),t=a._listView._layout.itemsFromRange(a._scrollbarPos,a._scrollbarPos+n-1),v=h._clamp(t.firstIndex,0,l-1),w=h._clamp(t.lastIndex,0,l-1);if(a._realizationLevel!==b.UI._VirtualizeContentsView._realizationLevel.skip||a.lastRealizePass||v!==a.firstIndexDisplayed||w!==a.lastIndexDisplayed)if((a._forceRelayout||r!==a.begin||s!==a.end||v!==a.firstIndexDisplayed||w!==a.lastIndexDisplayed)&&s>r&&p>o){a._listView._writeProfilerMark("realizePage currentInView("+v+"-"+w+") previousInView("+a.firstIndexDisplayed+"-"+a.lastIndexDisplayed+") change("+(v-a.firstIndexDisplayed)+"),info"),a._cancelRealize();var x=a._realizePass;a.begin=r,a.end=s,a.firstIndexDisplayed=v,a.lastIndexDisplayed=w,a.deletesWithoutRealize=0,a._ensureItemsBlocksInDOM(a.begin,a.end);var y=a._realizeItems(a._listView._itemCanvas,a.begin,a.end,l,x,a._scrollbarPos,a._direction,v,w,a._forceRelayout);a._forceRelayout=!1;var z=y.viewportItemsRealized.then(function(){return f(),y.allItemsRealized}).then(function(){return a._realizePass===x?a._updateHeaders(a._listView._canvas,a.begin,a.end).then(function(){g(l)}):void 0}).then(function(){return y.loadingCompleted}).then(function(){a._unrealizeExcessiveItems(),a.lastRealizePass=null,e()},function(c){return a._realizePass===x&&(a.lastRealizePass=null,a.begin=-1,a.end=-1),b.Promise.wrapError(c)});a.lastRealizePass=i.join([y.viewportItemsRealized,y.allItemsRealized,y.loadingCompleted,z]),a._unrealizeExcessiveItems()}else a.lastRealizePass?a.lastRealizePass.then(e):j(l);else a.begin=r,a.end=r+Object.keys(a.items._itemData).length,a._updateHeaders(a._listView._canvas,a.begin,a.end).done(function(){a.lastRealizePass=null,j(l)})}}else a.begin=-1,a.end=-1,a.firstIndexDisplayed=-1,a.lastIndexDisplayed=-1,j(l);a._reportElementsLevel(a._direction),a._listView._writeProfilerMark(c+",StopTM")})},realizePage:function(a,b,c,d){this._scrollToFunctor=f(a),this._forceRelayout=this._forceRelayout||b,this._scrollEndPromise=c,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(d||p)},onScroll:function(a,b){this.realizePage(a,!1,b,r)},reload:function(a,b){this._listView._isZombie()||(this._scrollToFunctor=f(a),this._forceRelayout=!0,this._highPriorityRealize=!!b,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(a){this._listView._isZombie()||(this._scrollToFunctor=f(a),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(a){var c=this,d=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return a>d?c._listView._itemsCount().then(function(b){return c.containers.length<b?i._cancelBlocker(c._creatingContainersWork&&c._creatingContainersWork.promise).then(function(){return c._getLayoutCompleted()}).then(function(){return a}):a}):b.Promise.wrap(a)},waitForEntityPosition:function(a){var c=this;return this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+a.type+": "+a.index+"),info"),i._cancelBlocker(this._state.waitForEntityPosition(a).then(function(){return a.type!==b.UI.ObjectType.groupHeader&&a.index>=c.containers.length||a.type===b.UI.ObjectType.groupHeader&&c._listView._groups.group(a.index).startIndex>=c.containers.length?c._creatingContainersWork&&c._creatingContainersWork.promise:void 0}).then(function(){return c._getLayoutCompleted()}))},stopWork:function(a){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(a),this._layoutWork&&this._layoutWork.cancel(),a&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),a&&(this._state=new l(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var a=this.lastRealizePass;a&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,a.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(a){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var c=this._listView;this._firstLayoutPass=!0,c._unsetFocusOnItem(),c._currentMode().onDataChanged&&c._currentMode().onDataChanged(),this.items.each(function(d,e){a&&e.parentNode&&e.parentNode.parentNode&&e.parentNode.parentNode.removeChild(e.parentNode),c._itemsManager.releaseItem(e),b.Utilities._disposeElement(e)}),this.items.removeItems(),this._deferredReparenting=[],a&&c._groups.removeElements(),c._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new l(this),this.resetItems(),!this._listView._isZombie()){var a=this._listView;a._groups.resetGroups(),a._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var a=this._listView._itemsManager;this.items.each(function(c,d){a.releaseItem(d),b.Utilities._disposeElement(d)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(a){return this.containers[a]},_getHeaderContainer:function(a){return this.tree[a].header},_getGroups:function(a){if(this._listView._groupDataSource){var b=this._listView._groups.groups,c=[];if(a)for(var d=0,e=b.length;e>d;d++){var f=b[d],g=e>d+1?b[d+1].startIndex:a;c.push({key:f.key,size:g-f.startIndex})}return c}return[{key:"-1",size:a}]},_createChunk:function(a,c,d){function e(a,c){var e=a.element.children,f=e.length,i=Math.min(c-a.items.length,d);h.insertAdjacentHTMLUnsafe(a.element,"beforeend",b.UI._repeat("<div class='win-container win-backdrop'></div>",i));for(var j=0;i>j;j++){var k=e[f+j];a.items.push(k),g.containers.push(k)}}function f(a){var b={header:g._listView._groupDataSource?g._createHeaderContainer():null,itemsContainer:{element:g._createItemsContainer(),items:[]}};g.tree.push(b),g.keyToGroupIndex[a.key]=g.tree.length-1,e(b.itemsContainer,a.size)}var g=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=a.length){var i=this.tree[this.tree.length-1],j=a[this.tree.length-1].size;if(i.itemsContainer.items.length<j)return e(i.itemsContainer,j),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<a.length&&f(a[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(a,c,d,e){function f(a,c){var f=a.itemsBlocks.length?a.itemsBlocks[a.itemsBlocks.length-1]:null;if(f&&f.items.length<d){var g=Math.min(c,d-f.items.length);h.insertAdjacentHTMLUnsafe(f.element,"beforeend",b.UI._repeat("<div class='win-container win-backdrop'></div>",g));var j=f.items.length;r=f.element.children;for(var k=0;g>k;k++){var l=r[j+k];f.items.push(l),i.containers.push(l)}c-=g}c>e&&(c=Math.min(c,Math.max(1,Math.floor(e/d))*d));var m=Math.floor(c/d),n=c%d,o="<div class='win-itemsblock'>"+b.UI._repeat("<div class='win-container win-backdrop'></div>",d)+"</div>",p=b.UI._repeat(o,m);n&&(p+="<div class='win-itemsblock'>"+b.UI._repeat("<div class='win-container win-backdrop'></div>",n)+"</div>",m++);var q=document.createElement("div");h.setInnerHTMLUnsafe(q,p);for(var r=q.children,s=0;m>s;s++){var t=r[s],u={element:t,items:b.UI._nodeListToArray(t.children)};a.itemsBlocks.push(u);for(var v=0;v<u.items.length;v++)i.containers.push(u.items[v])}}function g(a){var b={header:i._listView._groupDataSource?i._createHeaderContainer():null,itemsContainer:{element:i._createItemsContainer(),itemsBlocks:[]}};i.tree.push(b),i.keyToGroupIndex[a.key]=i.tree.length-1,f(b.itemsContainer,a.size)}var i=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=a.length){var j=this.tree[this.tree.length-1].itemsContainer,k=a[this.tree.length-1].size,l=0;if(j.itemsBlocks.length&&(l=(j.itemsBlocks.length-1)*d+j.itemsBlocks[j.itemsBlocks.length-1].items.length),k>l)return f(j,k-l),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<a.length&&g(a[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var a=this,c=0,f=!1;return function g(h){a._listView._versionManager.locked?h.setPromise(a._listView._versionManager.unlocked.then(function(){return g})):a._listView._itemsCount().then(function(i){var j=!f&&d(a._listView);if(j)h.setPromise(e(a._listView).then(function(a){return f=a,g}));else{if(a._listView._isZombie())return;f=!1;var l=b.Utilities._now()+k._createContainersJobTimeslice,m=a._getGroups(i),n=a.containers.length,o=a.end===a.containers.length,p=b.UI._VirtualizeContentsView._chunkSize;do a._blockSize?a._createChunkWithBlocks(m,i,a._blockSize,p):a._createChunk(m,i,p),c++;while(a.containers.length<i&&b.Utilities._now()<l);a._listView._writeProfilerMark("createContainers yields containers("+a.containers.length+"),info"),a._listView._affectedRange.add({start:n,end:a.containers.length},i),o?(a.stopWork(),a._listView._writeProfilerMark(a._state.name+"_relayout,info"),a._state.relayout()):(a._listView._writeProfilerMark(a._state.name+"_layoutNewContainers,info"),a._state.layoutNewContainers()),a.containers.length<i?h.setWork(g):(a._listView._writeProfilerMark("createContainers completed steps("+c+"),info"),a._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return h.Scheduler.schedule(this._generateCreateContainersWorker(),h.Scheduler.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var a,c=this;return this._listView._itemsCount().then(function(b){return 0===b&&c._listView._hideProgressBar(),a=b,c._listView._writeProfilerMark("createContainers("+a+"),StartTM"),c._listView._groupDataSource?c._listView._groups.initialize():void 0}).then(function(){return c._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),a&&c._listView._groups.length()?c._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(d){c._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+d+"),info"),c._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),c._listView._resetCanvas(),c.tree=[],c.keyToGroupIndex={},c.containers=[],c._blockSize=d;var e=c._getGroups(a),f=b.Utilities._now()+b.UI._VirtualizeContentsView._maxTimePerCreateContainers,g=Math.min(b.UI._VirtualizeContentsView._startupChunkSize,b.UI._VirtualizeContentsView._chunkSize);do var h=d?c._createChunkWithBlocks(e,a,d,g):c._createChunk(e,a,g);while(b.Utilities._now()<f&&c.containers.length<a&&!h);if(c._listView._writeProfilerMark("createContainers created("+c.containers.length+"),info"),c._listView._affectedRange.add({start:0,end:c.containers.length},a),c.containers.length<a){var i=c._scheduleLazyTreeCreation();c._creatingContainersWork.promise.done(null,function(){i.cancel()})}else c._listView._writeProfilerMark("createContainers completed synchronously,info"),c._creatingContainersWork.complete();c._listView._writeProfilerMark("createContainers("+a+"),StopTM")})},_updateItemsBlocks:function(a){function c(){var a=document.createElement("div");return a.className=b.UI._itemsBlockClass,a}function d(b,d){function g(){b.itemsBlocks=null,b.items=[];for(var a=0;k>a;a++){var c=e.containers[d+a];b.element.appendChild(c),b.items.push(c)}}function h(){b.itemsBlocks=[{element:j.length?j.shift():c(),items:[]}];for(var f=b.itemsBlocks[0],g=0;k>g;g++){if(f.items.length===a){var h=j.length?j.shift():c();b.itemsBlocks.push({element:h,items:[]}),f=b.itemsBlocks[b.itemsBlocks.length-1]}var i=e.containers[d+g];f.element.appendChild(i),f.items.push(i)}b.items=null}var i,j=[],k=0,l=b.itemsBlocks;if(l)for(i=0;i<l.length;i++)k+=l[i].items.length,j.push(l[i].element);else k=b.items.length;for(f?h():g(),i=0;i<j.length;i++){var m=j[i];m.parentNode===b.element&&b.element.removeChild(m)}return k}for(var e=this,f=!!a,g=0,h=0;g<this.tree.length;g++)h+=d(this.tree[g].itemsContainer,h);e._blockSize=a},_layoutItems:function(){var a=this;return this._listView._itemsCount().then(function(){return i.as(a._listView._layout.numberOfItemsPerItemsBlock).then(function(b){a._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+b+"),info"),b!==a._blockSize&&(a._updateItemsBlocks(b),a._listView._itemsBlockExtent=-1);var c,d=a._listView._affectedRange.get();return d&&(c={firstIndex:Math.max(d.start-1,0),lastIndex:Math.min(a.containers.length-1,d.end)},c.firstIndex<a.containers.length||0===a.containers.length)?a._listView._layout.layout(a.tree,c,a._modifiedElements||[],a._modifiedGroups||[]):(a._listView._affectedRange.clear(),{realizedRangeComplete:i.wrap(),layoutComplete:i.wrap()})})})},updateTree:function(a,b,c){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(a,b,c)},_updateTreeImpl:function(a,c,d,e){function f(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];d.parentNode.removeChild(d)}}if(this._executeAnimations=!0,this._modifiedElements=d,!d.handled){d.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var g,i=this;e||this._unrealizeItems();for(var g=0,j=d.length;j>g;g++)d[g]._itemBox&&d[g]._itemBox.parentNode&&h.removeClass(d[g]._itemBox.parentNode,b.UI._selectedClass);this.items.each(function(a,c,d){d.container&&h.removeClass(d.container,b.UI._selectedClass),d.container&&h.addClass(d.container,b.UI._backdropClass)});var k=this._listView._updateContainers(this._getGroups(a),a,c,d);f(k.removedHeaders),f(k.removedItemsContainers);for(var g=0,j=d.length;j>g;g++){var l=d[g];if(-1!==l.newIndex){if(l.element=this.getContainer(l.newIndex),!l.element)throw"Container missing after updateContainers."}else h.removeClass(l.element,b.UI._backdropClass)}var m=document.activeElement;this._listView._canvas.contains(m)&&(this._requireFocusRestore=m),this._deferredReparenting=[],this.items.each(function(a,c,d){var e=i.getContainer(a),f=d.itemBox;f&&e&&(f.parentNode!==e&&(a>=i.firstIndexDisplayed&&a<=i.lastIndexDisplayed?i._appendAndRestoreFocus(e,f):i._deferredReparenting.push({itemBox:f,container:e})),h.removeClass(e,b.UI._backdropClass),d.container=e,h[i._listView.selection._isIncluded(a)?"addClass":"removeClass"](e,b.UI._selectedClass),!i._listView.selection._isIncluded(a)&&h.hasClass(f,b.UI._selectedClass)&&b.UI._ItemEventsHandler.renderSelection(f,d.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var a=this._deferredReparenting.length;if(a>0){var b="_completeReparenting("+a+")";this._listView._writeProfilerMark(b+",StartTM");for(var c,d=0;a>d;d++)c=this._deferredReparenting[d],this._appendAndRestoreFocus(c.container,c.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(b+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(a,c){if(c.parentNode!==a){var d;if(this._requireFocusRestore&&(d=document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===d&&(a.contains(d)||c.contains(d))&&(this._listView._unsetFocusOnItem(),d=document.activeElement),h.empty(a),a.appendChild(c),this._requireFocusRestore&&d===this._listView._keyboardEventsHelper){var e=this._listView._selection._getFocused();e.type===b.UI.ObjectType.item&&this.items.itemBoxAt(e.index)===c&&(b.Utilities._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var a=this;this._hasAnimationInViewportPending=!1;var b=i.as(this._listView._layout.executeAnimations()).then(function(){a._listView._writeProfilerMark("startAnimations,StopTM")});return b},_setState:function(a,b){if(!this._listView._isZombie()){var c=this._state.name;this._state=new a(this,b),this._listView._writeProfilerMark(this._state.name+"_enter from("+c+"),info"),this._state.enter()}},getAdjacent:function(a,b){var c=this;return this.waitForEntityPosition(a).then(function(){return c._listView._layout.getAdjacent(a,b)})},hitTest:function(a,b){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var c=this._listView._layout.hitTest(a,b);return c.index=h._clamp(c.index,-1,this._listView._cachedCount-1,0),c.insertAfterIndex=h._clamp(c.insertAfterIndex,-1,this._listView._cachedCount-1,0),c},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new b._Signal;var a=this;this._creatingContainersWork.promise.done(function(){a._creatingContainersWork=null},function(){a._creatingContainersWork=null})}},_createLayoutSignal:function(){var a=this;this._layoutCompleted||(this._layoutCompleted=new b._Signal,this._layoutCompleted.promise.done(function(){a._layoutCompleted=null},function(){a._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new b._Signal,this._realizedRangeLaidOut.promise.done(function(){a._realizedRangeLaidOut=null},function(){a._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?b.Promise._cancelBlocker(this._layoutCompleted.promise):i.wrap()},_createSurfaceChild:function(a,b){var c=document.createElement("div");return c.className=a,this._listView._canvas.insertBefore(c,b?b.nextElementSibling:null),c},_executeScrollToFunctor:function(){var a=this;return i.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(b){a._scrollToFunctor=null,b=b||{},+b.position===b.position&&(a._scrollbarPos=b.position),a._direction=b.direction||"right"})}};var l=b.Class.define(function(a){this.view=a,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:g,realizePage:g,rebuildTree:function(){this.view._setState(m)},relayout:function(){this.view._setState(m)},layoutNewContainers:g,waitForEntityPosition:function(){return this.view._setState(m),this.view._getLayoutCompleted()},updateTree:g}),m=b.Class.define(function(a){this.view=a},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var a=this,c=new b._Signal;this.promise=c.promise.then(function(){return a.view._createContainers()}).then(function(){a.view._setState(n)},function(b){return a.canceling||(a.view._setState(l),a.view._listView._raiseViewComplete()),i.wrapError(b)}),c.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(l)},realizePage:g,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:g,layoutNewContainers:g,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:g}),n=b.Class.define(function(a,b){this.view=a,this.nextStateType=b||p},{name:"LayingoutState",enter:function(){var a=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var c=new b._Signal;this.promise=c.promise.then(function(){return a.view._layoutItems()}).then(function(b){return a.view._layoutWork=b.layoutComplete,b.realizedRangeComplete}).then(function(){a.view._listView._writeProfilerMark(a.name+"_enter_layoutItems,StopTM"),a.view._listView._clearInsertedItems(),a.view._setAnimationInViewportState(a.view._modifiedElements),a.view._modifiedElements=[],a.view._modifiedGroups=[],a.view._realizedRangeLaidOut.complete(),a.view._layoutWork.then(function(){a.view._listView._writeProfilerMark(a.name+"_enter_layoutCompleted,info"),a.view._listView._affectedRange.clear(),a.view._layoutCompleted.complete()}),a.canceling||a.view._setState(a.nextStateType)},function(b){return a.view._listView._writeProfilerMark(a.name+"_enter_layoutCanceled,info"),a.canceling||(a.view.firstIndexDisplayed=a.view.lastIndexDisplayed=-1,a.view._updateAriaMarkers(!0,a.view.firstIndexDisplayed,a.view.lastIndexDisplayed),a.view._setState(v)),i.wrapError(b)}),c.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(a){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),a&&this.view._setState(o)},stop:function(){this.cancelLayout(!0)},realizePage:g,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(m)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),o=b.Class.define(function(a){this.view=a},{name:"LayoutCanceledState",enter:g,stop:g,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(m)},relayout:function(){this.view._setState(n)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),p=b.Class.define(function(a){this.view=a,this.nextState=t,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var a=this,c=new b._Signal;this.promise=c.promise.then(function(){return a.view._executeScrollToFunctor()}).then(function(){return a.relayoutNewContainers=!1,i._cancelBlocker(a.view._realizePageImpl())}).then(function(){a.view._state===a&&(a.view._completeUpdateTree(),a.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),a.view._setState(a.nextState))},function(b){return a.view._state!==a||a.canceling||(a.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),a.view._setState(q)),i.wrapError(b)}),c.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(q)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(m)},relayout:function(){this.stop(),this.view._setState(n)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)},setLoadingState:function(a){this.view._listView._setViewState(a)}}),q=b.Class.define(function(a){this.view=a},{name:"CanceledState",enter:g,stop:function(){this.view._cancelRealize()},realizePage:function(a){this.stop(),this.view._setState(a)},rebuildTree:function(){this.stop(),this.view._setState(m)},relayout:function(a){this.stop(),this.view._setState(n,a)},layoutNewContainers:function(){this.relayout(q)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),r=b.Class.derive(p,function(a){this.view=a,this.nextState=s,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),s=b.Class.derive(q,function(a){this.view=a},{name:"ScrollingPausedState",enter:function(){var a=this;this.promise=i._cancelBlocker(this.view._scrollEndPromise).then(function(){a.view._setState(t)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),t=b.Class.define(function(a){this.view=a},{name:"UnrealizingState",enter:function(){var a=this;
this.promise=this.view._lazilyUnrealizeItems().then(function(){return a.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),a.view._renderCompletePromise}).then(function(){a.view._setState(v)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(q)},realizePage:function(a){this.promise.cancel(),this.view._setState(a)},rebuildTree:function(){this.view._setState(m)},relayout:function(){this.view._setState(n)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c)}}),u=b.Class.define(function(a,b){this.view=a,this.realizePromise=b,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var a=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new b._Signal,this.view._executeAnimations=!1,this.animatePromise.done(function(){a.animating=!1,a.modifiedElements?(a.view._updateTreeImpl(a.count,a.delta,a.modifiedElements),a.modifiedElements=null,a.view._setState(q)):a.animateSignal.complete()},function(b){return a.animating=!1,i.wrapError(b)}),this._waitForRealize()},_waitForRealize:function(){var a=this;this.realizing=!0,this.realizePromise.done(function(){a.realizing=!1});var b=++this.realizeId;i.join([this.realizePromise,this.animateSignal.promise]).done(function(){b===a.realizeId&&(a.view._completeUpdateTree(),a.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),a.view._setState(t))})},stop:function(a){this.realizePromise.cancel(),this.view._cancelRealize(),a&&(this.animatePromise.cancel(),this.view._setState(q))},realizePage:function(){if(!this.modifiedElements){var a=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return i._cancelBlocker(a.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(m)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(n)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(a,c,d){if(this.animating){var e=this.modifiedElements;return this.count=a,this.delta=c,this.modifiedElements=d,e?b.Promise.cancel:this.animatePromise}return this.view._updateTreeImpl(a,c,d)},setLoadingState:function(a){this.view._listView._setViewState(a)}}),v=b.Class.derive(q,function(a){this.view=a},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=b.UI._VirtualizeContentsView._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(w)},stop:function(){this._stopped=!0,q.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(w)},updateTree:function(a,b,c){return this.view._updateTreeImpl(a,b,c,!0)}}),w=b.Class.derive(q,function(a){this.view=a},{name:"LayingoutNewContainersState",enter:function(){var a=this;this.promise=b.Promise.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){a.view._relayoutInComplete=!1,a.relayout(q)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(a){this.stop(),this.view._setState(n,a)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return k})})}(this,WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{DatePicker:a.Namespace._lazy(function(){function b(a,b,c){var d=Windows.Globalization.DateTimeFormatting;a=a?a:c;var e=new d.DateTimeFormatter(a);return b?new d.DateTimeFormatter(a,e.languages,e.geographicRegion,b,e.clock):e}function c(a,c,d){var e=m[a];e||(e=m[a]={});var f=e[c];f||(f=e[c]={});var g=f[d];return g||(g=f[d]={},g.formatter=b(a,c,d),g.years={}),g}function d(a,b,d,e,f,g){var h=c(a,b,d),i=h.years[g.year+"-"+g.era];return i||(i=h.formatter.format(g.getDateTime()),h.years[g.year+"-"+g.era]=i),i}function e(a,b,d,e){var f=c(a,b,d);return f.formatter.format(e.getDateTime())}function f(a,b,d,e){var f=c(a,b,d);return f.formatter.format(e.getDateTime())}function g(a){var b=Windows.Globalization,c=new b.Calendar;return a?new b.Calendar(c.languages,a,c.getClock()):c}function h(a,b){var c=0;if(a.era==b.era)c=b.year-a.year;else for(;a.era!==b.era||a.year!==b.year;)c++,a.addYears(1);return c}var i="day",j="{month.full}",k="year.full",l={get ariaLabel(){return a.Resources._getWinJSString("ui/datePicker").value},get selectDay(){return a.Resources._getWinJSString("ui/selectDay").value},get selectMonth(){return a.Resources._getWinJSString("ui/selectMonth").value},get selectYear(){return a.Resources._getWinJSString("ui/selectYear").value}},m={},n=a.Class.define(function(b,c){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},b=b||document.createElement("div"),a.Utilities.addClass(b,"win-disposable"),b.winControl=this;var d=b.getAttribute("aria-label");d||b.setAttribute("aria-label",l.ariaLabel),this._init(b),a.UI.setOptions(this,c)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",l.selectDay),this._monthElement.setAttribute("aria-label",l.selectMonth),this._yearElement.setAttribute("aria-label",l.selectYear)},_addControlsInOrder:function(){var b=this._domElement,c=a.Utilities,d=this,e=0;d._information.order.forEach(function(a){switch(a){case"month":b.appendChild(d._monthElement),c.addClass(d._monthElement,"win-order"+e++);break;case"date":b.appendChild(d._dateElement),c.addClass(d._dateElement,"win-order"+e++);break;case"year":b.appendChild(d._yearElement),c.addClass(d._yearElement,"win-order"+e++)}})},_createControlElements:function(){this._monthElement=document.createElement("select"),this._monthElement.className="win-datepicker-month",this._dateElement=document.createElement("select"),this._dateElement.className="win-datepicker-date",this._yearElement=document.createElement("select"),this._yearElement.className="win-datepicker-year"},_createControls:function(){var b=this._information,c=b.getIndex(this.current);b.forceLanguage&&(this._domElement.setAttribute("lang",b.forceLanguage),this._domElement.setAttribute("dir",b.isRTL?"rtl":"ltr")),this._yearControl=new a.UI._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:c.year}),this._monthControl=new a.UI._Select(this._monthElement,{dataSource:this._information.months(c.year),disabled:this.disabled,index:c.month}),this._dateControl=new a.UI._Select(this._dateElement,{dataSource:this._information.dates(c.year,c.month),disabled:this.disabled,index:c.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(a){this._calendar=a,this._setElement(this._domElement)}},current:{get:function(){var a=this._currentDate,b=a.getFullYear();return new Date(Math.max(Math.min(this.maxYear,b),this.minYear),a.getMonth(),a.getDate(),12,0,0,0)},set:function(a){var b;"string"==typeof a?(b=new Date(Date.parse(a)),b.setHours(12,0,0,0)):b=a;var c=this._currentDate;c!=b&&(this._currentDate=b,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled!==a&&(this._disabled=a,this._yearControl&&(this._monthControl.setDisabled(a),this._dateControl.setDisabled(a),this._yearControl.setDisabled(a)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(a){this._datePatterns.date!==a&&(this._datePatterns.date=a,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(b){this._domElement=this._domElement||b,this._domElement&&(a.Utilities.empty(this._domElement),a.Utilities.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(a){this._minYear!==a&&(this._minYear=a,a>this._maxYear&&(this._maxYear=a),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var a={year:this._information.years.getLength()-1};return a.month=this._information.months(a.year).getLength()-1,a.date=this._information.dates(a.year,a.month).getLength()-1,this._information.getDate(a).getFullYear()},set:function(a){this._maxYear!==a&&(this._maxYear=a,a<this._minYear&&(this._minYear=a),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(a){this._datePatterns.month!==a&&(this._datePatterns.month=a,this._init())}},_updateInformation:function(){var b=new Date(this._minYear,0,1,12,0,0),c=new Date(this._maxYear,11,31,12,0,0);b.setFullYear(this._minYear),c.setFullYear(this._maxYear),this._information=a.UI.DatePicker.getInformation(b,c,this._calendar,this._datePatterns)},_init:function(a){this._setElement(a)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var a=this._information.getIndex(this.current);this._yearControl.index=a.year,this._monthControl.dataSource=this._information.months(a.year),this._monthControl.index=a.month,this._dateControl.dataSource=this._information.dates(a.year,a.month),this._dateControl.index=a.date}},_wireupEvents:function(){function a(){b._currentDate=b._information.getDate({year:b._yearControl.index,month:b._monthControl.index,date:b._dateControl.index},b._currentDate);var a=b._information.getIndex(b._currentDate);b._monthControl.dataSource=b._information.months(a.year),b._monthControl.index=a.month,b._dateControl.dataSource=b._information.dates(a.year,a.month),b._dateControl.index=a.date}var b=this;this._dateElement.addEventListener("change",a,!1),this._monthElement.addEventListener("change",a,!1),this._yearElement.addEventListener("change",a,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(a){this._datePatterns.year!==a&&(this._datePatterns.year=a,this._init())}}},{_getInformationWinRT:function(a,b,l,m){function n(a){return new Date(Math.min(new Date(Math.max(r,a)),s))}m=m||{date:i,month:j,year:k};var o=g(l),p=g(l),q=g(l);o.setToMin();var r=o.getDateTime();o.setToMax();var s=o.getDateTime();o.hour=12,a=n(a),b=n(b),o.setDateTime(b);var t={year:o.year,era:o.era};o.setDateTime(a);var u=(o.year,0);u=h(o,t)+1;var v=c("day month.full year",l).formatter,w=v.patterns[0],x=8207===w.charCodeAt(0),y=["date","month","year"],z={month:w.indexOf("{month"),date:w.indexOf("{day"),year:w.indexOf("{year")};y.sort(function(a,b){return z[a]<z[b]?-1:z[a]>z[b]?1:0});var A=function(){return{getLength:function(){return u},getValue:function(b){return o.setDateTime(a),o.addYears(b),d(m.year,l,k,m,y,o)}}}(),B=function(b){return p.setDateTime(a),p.addYears(b),{getLength:function(){return p.numberOfMonthsInThisYear},getValue:function(a){return p.month=p.firstMonthInThisYear,p.addMonths(a),e(m.month,l,j,p)}}},C=function(b,c){return q.setDateTime(a),q.addYears(b),q.month=q.firstMonthInThisYear,q.addMonths(c),q.day=q.firstDayInThisMonth,{getLength:function(){return q.numberOfDaysInThisMonth},getValue:function(a){return q.day=q.firstDayInThisMonth,q.addDays(a),f(m.date,l,i,q)}}};return{isRTL:x,forceLanguage:v.resolvedLanguage,order:y,getDate:function(b,c){var d;c&&(o.setDateTime(c),d={year:o.year,month:o.month,day:o.day});var e=o;e.setDateTime(a),e.addYears(b.year);var f;e.firstMonthInThisYear>e.lastMonthInThisYear?(f=b.month+e.firstMonthInThisYear>e.numberOfMonthsInThisYear?b.month+e.firstMonthInThisYear-e.numberOfMonthsInThisYear:b.month+e.firstMonthInThisYear,d&&d.year!==e.year&&(f=Math.max(Math.min(d.month,e.numberOfMonthsInThisYear),1))):f=d&&d.year!==e.year?Math.max(Math.min(d.month,e.firstMonthInThisYear+e.numberOfMonthsInThisYear-1),e.firstMonthInThisYear):Math.max(Math.min(b.month+e.firstMonthInThisYear,e.firstMonthInThisYear+e.numberOfMonthsInThisYear-1),e.firstMonthInThisYear),e.month=f;var g=Math.max(Math.min(b.date+e.firstDayInThisMonth,e.firstDayInThisMonth+e.numberOfDaysInThisMonth-1),e.firstDayInThisMonth);return!d||d.year===e.year&&d.month===e.month||(g=Math.max(Math.min(d.day,e.firstDayInThisMonth+e.numberOfDaysInThisMonth-1),e.firstDayInThisMonth)),e.day=e.firstDayInThisMonth,e.addDays(g-e.firstDayInThisMonth),e.getDateTime()},getIndex:function(b){var c=n(b);o.setDateTime(c);var d={year:o.year,era:o.era},e=0;o.setDateTime(a),o.month=1,e=h(o,d),o.setDateTime(c);var f=o.month-o.firstMonthInThisYear;0>f&&(f=o.month-o.firstMonthInThisYear+o.numberOfMonthsInThisYear);var g=o.day-o.firstDayInThisMonth,i={year:e,month:f,date:g};return i},years:A,months:B,dates:C}},_getInformationJS:function(a,b){var c=a.getFullYear(),d=b.getFullYear(),e={getLength:function(){return Math.max(0,d-c+1)},getValue:function(a){return c+a}},f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=function(){return{getLength:function(){return f.length},getValue:function(a){return f[a]},getMonthNumber:function(a){return Math.min(a,f.length-1)}}},h=function(a,b){var c=new Date,d=e.getValue(a),f=b+1;c.setFullYear(d,f,0);var g=c.getDate();return{getLength:function(){return g},getValue:function(a){return""+(a+1)},getDateNumber:function(a){return Math.min(a+1,g)}}};return{order:["month","date","year"],getDate:function(a){return new Date(e.getValue(a.year),g(a.year).getMonthNumber(a.month),h(a.year,a.month).getDateNumber(a.date),12,0)},getIndex:function(a){var b=0,d=a.getFullYear();b=c>d?0:d>this.maxYear?e.getLength()-1:a.getFullYear()-c;var f=Math.min(a.getMonth(),g(b).getLength()),i=Math.min(a.getDate()-1,h(b,f).getLength());return{year:b,month:f,date:i}},years:e,months:g,dates:h}}});return n.getInformation=a.Utilities.hasWinRT?n._getInformationWinRT:n._getInformationJS,a.Class.mix(n,a.Utilities.createEventProperties("change")),a.Class.mix(n,a.UI.DOMEventMixin),n})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{TimePicker:a.Namespace._lazy(function(){var b="{minute.integer(2)}",c="{hour.integer(1)}",d="{period.abbreviated(2)}",e={get ariaLabel(){return a.Resources._getWinJSString("ui/timePicker").value},get selectHour(){return a.Resources._getWinJSString("ui/selectHour").value},get selectMinute(){return a.Resources._getWinJSString("ui/selectMinute").value},get selectAMPM(){return a.Resources._getWinJSString("ui/selectAMPM").value}},f=function(a,b){return a.getHours()===b.getHours()&&a.getMinutes()===b.getMinutes()},g=a.Class.define(function(b,c){this._currentTime=a.UI.TimePicker._sentinelDate(),b=b||document.createElement("div"),a.Utilities.addClass(b,"win-disposable"),b.winControl=this;var d=b.getAttribute("aria-label");d||b.setAttribute("aria-label",e.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(b),a.UI.setOptions(this,c)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",e.selectHour),this._minuteElement.setAttribute("aria-label",e.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",e.selectAMPM)},_addControlsInOrder:function(b){var c=this,d=a.Utilities;b.order.forEach(function(a,b){switch(a){case"hour":c._domElement.appendChild(c._hourElement),d.addClass(c._hourElement,"win-order"+b);break;case"minute":c._domElement.appendChild(c._minuteElement),d.addClass(c._minuteElement,"win-order"+b);break;case"period":c._ampmElement&&(c._domElement.appendChild(c._ampmElement),d.addClass(c._ampmElement,"win-order"+b))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(a){this._clock!==a&&(this._clock=a,this._init())}},current:{get:function(){var b=this._currentTime;if(b){var c=a.UI.TimePicker._sentinelDate();return c.setHours(b.getHours()),c.setMinutes(this._getMinutesIndex(b)*this.minuteIncrement),c.setSeconds(0),c.setMilliseconds(0),c}return b},set:function(b){var c;"string"==typeof b?(c=a.UI.TimePicker._sentinelDate(),c.setTime(Date.parse(c.toDateString()+" "+b))):(c=a.UI.TimePicker._sentinelDate(),c.setHours(b.getHours()),c.setMinutes(b.getMinutes()));var d=this._currentTime;f(d,c)||(this._currentTime=c,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled!==a&&(this._disabled=a,this._hourControl&&(this._hourControl.setDisabled(a),this._minuteControl.setDisabled(a)),this._ampmControl&&this._ampmControl.setDisabled(a))}},element:{get:function(){return this._domElement}},_init:function(a){this._setElement(a),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(a){this._timePatterns.hour!==a&&(this._timePatterns.hour=a,this._init())}},_getHoursAmpm:function(a){var b=a.getHours();return this._ampmElement?0===b?{hours:12,ampm:0}:12>b?{hours:b,ampm:0}:{hours:b-12,ampm:1}:{hours:b}},_getHoursIndex:function(a){return this._ampmElement&&12===a?0:a},_getMinutesIndex:function(a){return parseInt(a.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(a){this._minuteIncrement!=a&&(this._minuteIncrement=a,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(a){this._timePatterns.minute!==a&&(this._timePatterns.minute=a,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(a){this._timePatterns.period!==a&&(this._timePatterns.period=a,this._init())}},_setElement:function(b){if(this._domElement=this._domElement||b,this._domElement){var c=a.UI.TimePicker.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=c,c.forceLanguage&&(this._domElement.setAttribute("lang",c.forceLanguage),this._domElement.setAttribute("dir",c.isRTL?"rtl":"ltr")),a.Utilities.empty(this._domElement),a.Utilities.addClass(this._domElement,"win-timepicker"),this._hourElement=document.createElement("select"),a.Utilities.addClass(this._hourElement,"win-timepicker-hour"),this._minuteElement=document.createElement("select"),a.Utilities.addClass(this._minuteElement,"win-timepicker-minute"),this._ampmElement=null,"12HourClock"===c.clock&&(this._ampmElement=document.createElement("select"),a.Utilities.addClass(this._ampmElement,"win-timepicker-period")),this._addControlsInOrder(c);var d=this._getHoursAmpm(this.current);this._hourControl=new a.UI._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(d.hours)}),this._minuteControl=new a.UI._Select(this._minuteElement,{dataSource:c.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new a.UI._Select(this._ampmElement,{dataSource:c.periods,disabled:this.disabled,index:d.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var a=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=a.ampm),this._hourControl.index=this._getHoursIndex(a.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var a=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=a.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(a.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var a=this,b=function(){var b=a._hourControl.index;return a._ampmElement&&1===a._ampmControl.index&&12!==b&&(b+=12),b},c=function(){var c=b();a._currentTime.setHours(c),a._currentTime.setMinutes(a._minuteControl.index*a.minuteIncrement)};this._hourElement.addEventListener("change",c,!1),this._minuteElement.addEventListener("change",c,!1),this._ampmElement&&this._ampmElement.addEventListener("change",c,!1)}},{_sentinelDate:function(){var a=new Date;return new Date(2011,6,15,a.getHours(),a.getMinutes())},_getInformationWinRT:function(e,f,g){var h=function(a,b){var c=Windows.Globalization.DateTimeFormatting;a=a?a:b;var d=new c.DateTimeFormatter(a);return e&&(d=c.DateTimeFormatter(a,d.languages,d.geographicRegion,d.calendar,e)),d},i=Windows.Globalization,j=new i.Calendar;e&&(j=new i.Calendar(j.languages,j.getCalendarSystem(),e)),j.setDateTime(a.UI.TimePicker._sentinelDate());var k=j.getClock(),l=24;l=j.numberOfHoursInThisPeriod;var m=function(){var b=h(g.period,d);return{getLength:function(){return 2},getValue:function(c){var d=a.UI.TimePicker._sentinelDate();if(0===c){d.setHours(1);var e=b.format(d);return e}if(1===c){d.setHours(13);var f=b.format(d);return f}return null}}}(),n=function(){var c=h(g.minute,b),d=a.UI.TimePicker._sentinelDate();return{getLength:function(){return 60/f},getValue:function(a){var b=a*f;return d.setMinutes(b),c.format(d)}}}(),o=function(){var b=h(g.hour,c),d=a.UI.TimePicker._sentinelDate();return{getLength:function(){return l},getValue:function(a){return d.setHours(a),b.format(d)}}}(),p=h("hour minute"),q=p.patterns[0],r=["hour","minute"],s={period:q.indexOf("{period"),hour:q.indexOf("{hour"),minute:q.indexOf("{minute")};s.period>-1&&r.push("period");var t=Windows.Globalization.DateTimeFormatting.DateTimeFormatter,u=new t("month.full",Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),v=u.patterns[0],w=8207===v.charCodeAt(0);if(w){var x=s.hour;s.hour=s.minute,s.minute=x}return r.sort(function(a,b){return s[a]<s[b]?-1:s[a]>s[b]?1:0}),{minutes:n,hours:o,clock:k,periods:m,order:r,forceLanguage:p.resolvedLanguage,isRTL:w}},_getInformationJS:function(a,b){var c=[12,1,2,3,4,5,6,7,8,9,10,11],d={};d.getLength=function(){return 60/b},d.getValue=function(a){var c=a*b;return 10>c?"0"+c.toString():c.toString()};var e=["hour","minute","period"];return"24HourClock"===a&&(c=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],e=["hour","minute"]),{minutes:d,hours:c,clock:a||"12HourClock",periods:["AM","PM"],order:e}}});return g.getInformation=a.Utilities.hasWinRT?g._getInformationWinRT:g._getInformationJS,a.Class.mix(g,a.Utilities.createEventProperties("change")),a.Class.mix(g,a.UI.DOMEventMixin),g})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{_Select:a.Namespace._lazy(function(){function b(a){return a.replace(g,function(a){return h[a]||""})}function c(a){return a.replace(i,"")}function d(a){return this[a]}function e(){return this.length}function f(a){return a.getValue||(a.getValue=d),a.getLength||(a.getLength=e),a}var g=/[&<>'"]/g,h={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},i=/[\u200e\u200f]/g;return a.Class.define(function(a,b){this._dataSource=f(b.dataSource),this._index=b.index||0,this._domElement=a,this._domElement.tabIndex=0,b.disabled&&this.setDisabled(b.disabled);var c=this;this._domElement.addEventListener("change",function(){c._index=c._domElement.selectedIndex},!1),this._createSelectElement()},{_index:0,_dataSource:null,dataSource:{get:function(){return this._dataSource},set:function(a){this._dataSource=f(a),this._domElement&&this._createSelectElement()}},setDisabled:function(a){a?this._domElement.setAttribute("disabled","disabled"):this._domElement.removeAttribute("disabled")},_createSelectElement:function(){for(var d=this._dataSource.getLength(),e="",f=0;d>f;f++){var g=""+this._dataSource.getValue(f),h=b(g),i=c(h);e+="<option value='"+i+"'>"+h+"</option>"}a.Utilities.setInnerHTMLUnsafe(this._domElement,e),this._domElement.selectedIndex=this._index},index:{get:function(){return Math.max(0,Math.min(this._index,this._dataSource.getLength()-1))},set:function(a){if(this._index!==a){this._index=a;var b=this._domElement;b&&b.selectedIndex!==a&&(b.selectedIndex=a)}}},value:{get:function(){return this._dataSource.getValue(this.index)}}})})})}(WinJS),function(a){"use strict";var b=a.Navigation,c=a.Utilities.Key,d="win-navigation-backbutton",e="win-back",f=3,g=function(){function a(){window.addEventListener("keyup",e,!1),window.addEventListener("pointerup",g,!1)}function d(){window.removeEventListener("keyup",e,!1),window.removeEventListener("pointerup",g,!1)}function e(a){(a.keyCode===c.leftArrow&&a.altKey&&!a.shiftKey&&!a.ctrlKey||a.keyCode===c.browserBack)&&b.back()}function g(a){a.button===f&&b.back()}var h=0;return{addRef:function(){0===h&&a(),h++},release:function(){h>0&&(h--,0===h&&d())},getCount:function(){return h}}}();a.Namespace.define("WinJS.UI",{BackButton:a.Namespace._lazy(function(){var c={get ariaLabel(){return a.Resources._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return a.Resources._getWinJSString("ui/duplicateConstruction").value},get badButtonElement(){return a.Resources._getWinJSString("ui/badButtonElement").value}},f=a.Class.define(function(d,e){if(d&&d.winControl)throw new a.ErrorFromName("WinJS.UI.BackButton.DuplicateConstruction",c.duplicateConstruction);this._element=d||document.createElement("button"),e=e||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,a.UI.setOptions(this,e),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),b.addEventListener("navigated",this._navigatedHandler,!1),g.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,b.removeEventListener("navigated",this._navigatedHandler,!1),g.release())},refresh:function(){this._element.disabled=b.canGoBack?!1:!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.BackButton.BadButtonElement",c.badButtonElement);a.Utilities.addClass(this._element,d),a.Utilities.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+e+'"></span>',this.refresh(),this._element.setAttribute("aria-label",c.ariaLabel),this._element.setAttribute("title",c.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){b.back()}});return f._getReferenceCount=function(){return g.getCount()},a.Class.mix(f,a.UI.DOMEventMixin),f})})}(WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{Rating:WinJS.Namespace._lazy(function(){var a=WinJS.Utilities,b=a._createEventProperty,c={get averageRating(){return WinJS.Resources._getWinJSString("ui/averageRating").value},get clearYourRating(){return WinJS.Resources._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return WinJS.Resources._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return WinJS.Resources._getWinJSString("ui/tooltipStringsIsInvalid").value},get unrated(){return WinJS.Resources._getWinJSString("ui/unrated").value},get userRating(){return WinJS.Resources._getWinJSString("ui/userRating").value}},d=5,e=!1,f="cancel",g="change",h="previewchange",i=0,j=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",k=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",l=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",m="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; display: none",n="win-rating",o="win-star win-empty",p="win-star win-average win-empty",q="win-star win-average win-full",r="win-star win-user win-empty",s="win-star win-user win-full",t="win-star win-tentative win-empty",u="win-star win-tentative win-full",v="win-disabled",w="win-average",x="win-user";return WinJS.Class.define(function(a,b){this._disposed=!1,a=a||document.createElement("div"),b=b||{},this._element=a,WinJS.Utilities.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=e,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(b.maxRating),b.tooltipStrings||this._updateTooltips(null),WinJS.UI.setOptions(this,b),this._controlUpdateNeeded=!0,this._forceLayout(),a.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(a){this._setControlSize(a),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(a){this._userRating=Math.max(0,Math.min(Number(a)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(a){this._averageRating=Number(a)<1?0:Math.min(Number(a)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(a){this._disabled=!!a,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(a){this._enableClear=!!a,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(a){if("object"!=typeof a)throw new WinJS.ErrorFromName("WinJS.UI.Rating.TooltipStringsIsInvalid",c.tooltipStringsIsInvalid);this._updateTooltips(a),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:b(f),onchange:b(g),onpreviewchange:b(h),dispose:function(){if(!this._disposed){this._disposed=!0;for(var a=0;a<this._toolTips.length;a++)this._toolTips[a].dispose();this._toolTips=null}},addEventListener:function(a,b,c){this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_forceLayout:function(){if(this._controlUpdateNeeded){var a=!1;this._updateControl=function(){a=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,a&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=m)},_createControl:function(){a.addClass(this._element,n);var b="";this._averageRatingHidden=!0;for(var c=0;c<=this._maxRating;c++)b=c===this._maxRating?b+"<div class='"+q+"' style='"+m+"'></div>":b+"<div class='"+r+"'></div>";this._element.innerHTML=b;for(var d=this._element.firstElementChild,c=0;d;)this._elements[c]=d,c<this._maxRating&&(WinJS.Utilities.data(d).msStarRating=c+1),d=d.nextElementSibling,c++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()
},_getText:function(a){var b=this._tooltipStrings[a];if(b){var d=document.createElement("div");return d.innerHTML=b,d.textContent}return a===this._maxRating?c.clearYourRating:a+1},_updateAccessibilityRestState:function(){var a=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),a.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(a.setAttribute("aria-valuenow",this._userRating),a.setAttribute("aria-label",c.userRating),a.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(a.setAttribute("aria-valuenow",this._averageRating),a.setAttribute("aria-label",c.averageRating),a.setAttribute("aria-valuetext",this._averageRating)):(a.setAttribute("aria-valuenow",c.unrated),a.setAttribute("aria-label",c.userRating),a.setAttribute("aria-valuetext",c.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var a=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),a.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(a.setAttribute("aria-label",c.tentativeRating),a.setAttribute("aria-valuenow",this._tentativeRating),a.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(a.setAttribute("aria-valuenow",c.unrated),a.setAttribute("aria-label",c.tentativeRating),a.setAttribute("aria-valuetext",this._getText(this._maxRating))):(a.setAttribute("aria-valuenow",c.unrated),a.setAttribute("aria-label",c.tentativeRating),a.setAttribute("aria-valuetext",c.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var a=0;a<this._maxRating;a++)this._toolTips[a]=new WinJS.UI.Tooltip(this._elements[a])},_decrementRating:function(){this._closeTooltip();var a=!0;0===this._tentativeRating||-1===this._tentativeRating&&0===this._userRating?a=!1:(this._tentativeRating>0?this._tentativeRating--:-1===this._tentativeRating&&(this._tentativeRating=0!==this._userRating&&this._userRating>0?this._userRating-1:0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,a=!1)),this._showTentativeRating(a,"keyboard")},_events:function(){function a(a){return{name:a,lowerCaseName:a.toLowerCase(),handler:function(b){var d=c["_on"+a];d&&d.apply(c,[b])}}}var b,c=this,d=[a("KeyDown"),a("FocusOut"),a("FocusIn"),a("PointerCancel"),a("PointerDown"),a("PointerMove"),a("PointerOver"),a("PointerUp"),a("PointerOut")],e=[a("DOMNodeInserted")];for(b=0;b<d.length;++b)WinJS.Utilities._addEventListener(this._element,d[b].lowerCaseName,d[b].handler,!1);for(b=0;b<e.length;++b)this._element.addEventListener(e[b].name,e[b].handler,!1);this._ariaValueNowMutationObserver=new WinJS.Utilities._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onDOMNodeInserted:function(a){a.target===this._element&&(this._recalculateStarProperties(),this._updateControl())},_recalculateStarProperties:function(){var a=0;1===this._averageRating&&(a=1);var b=getComputedStyle(this._elements[a]);this._elementWidth=b.width,"rtl"===getComputedStyle(this._element).direction?(this._elementPadding=b.paddingRight,this._elementBorder=b.borderRight):(this._elementPadding=b.paddingLeft,this._elementBorder=b.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var a=!0;(this._tentativeRating===this._maxRating||-1===this._tentativeRating&&this._userRating===this._maxRating)&&(a=!1),-1!==this._tentativeRating?this._tentativeRating<this._maxRating&&this._tentativeRating++:this._tentativeRating=0!==this._userRating?this._userRating<this._maxRating?this._userRating+1:this._maxRating:1,this._showTentativeRating(a,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var a=this._element.getAttributeNode("aria-valuenow");if(null!==a){var b=Number(a.nodeValue);this.userRating!==b&&(this.userRating=b,this._tentativeRating=this._userRating,this._raiseEvent(g,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(f,null),this._captured=!1},_onPointerDown:function(a){(a.pointerType!==l||a.button===i)&&(this._captured||(this._pointerDownAt={x:a.clientX,y:a.clientY},this._pointerDownFocus=!0,this._disabled||(WinJS.Utilities._setPointerCapture(this._element,a.pointerId),this._captured=!0,a.pointerType===j?(this._tentativeRating=WinJS.Utilities.data(a.target).msStarRating||0,this._setStarClasses(u,this._tentativeRating,t),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(h,this._tentativeRating)):this._openTooltip("mousedown"))))},_onCapturedPointerMove:function(a,b){var c,d=this._pointerDownAt||{x:a.clientX,y:a.clientY},e=WinJS.Utilities._elementsFromPoint(a.clientX,d.y);if(e)for(var f=0,g=e.length;g>f;f++){var h=e[f];if("tooltip"===h.getAttribute("role"))return;if(WinJS.Utilities.hasClass(h,"win-star")){c=h;break}}var i;if(c&&c.parentElement===this._element)i=WinJS.Utilities.data(c).msStarRating||0;else{var j=0,k=this.maxRating;"rtl"===getComputedStyle(this._element).direction&&(j=k,k=0),i=a.clientX<d.x?j:k}var l=!1,m=Math.min(Math.ceil(i),this._maxRating);0!==m||this._enableClear||(m=1),m!==this._tentativeRating&&(this._closeTooltip(),l=!0),this._tentativeRating=m,this._showTentativeRating(l,b),a.preventDefault()},_onPointerMove:function(a){this._captured&&(a.pointerType===j?this._onCapturedPointerMove(a,"touch"):this._onCapturedPointerMove(a,"mousedown"))},_onPointerOver:function(a){this._disabled||a.pointerType!==k&&a.pointerType!==l||this._onCapturedPointerMove(a,"mouseover")},_onPointerUp:function(a){this._captured&&(WinJS.Utilities._releasePointerCapture(this._element,a.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(f,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var a=0;a<this._maxRating;a++)this._elements[a].className=t;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(h,this._userRating):this._raiseEvent(h,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(b){var c=a.Key,d=b.keyCode,e=getComputedStyle(this._element).direction,g=!0;switch(d){case c.enter:this._onUserRatingChanged();break;case c.tab:this._onUserRatingChanged(),g=!1;break;case c.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(f,null);break;case c.leftArrow:"rtl"===e?this._incrementRating():this._decrementRating();break;case c.upArrow:this._incrementRating();break;case c.rightArrow:"rtl"===e?this._decrementRating():this._incrementRating();break;case c.downArrow:this._decrementRating();break;default:var h=0;if(d>=c.num0&&d<=c.num9?h=c.num0:d>=c.numPad0&&d<=c.numPad9&&(h=c.numPad0),h>0){var i=!1,j=Math.min(d-h,this._maxRating);0!==j||this._enableClear||(j=1),j!==this._tentativeRating&&(this._closeTooltip(),i=!0),this._tentativeRating=j,this._showTentativeRating(i,"keyboard")}else g=!1}g&&(b.stopPropagation(),b.preventDefault())},_onPointerOut:function(b){this._captured||a.eventWithinElement(this._element,b)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(f,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(g,this._userRating)))},_raiseEvent:function(a,b){if(!this._disabled&&(this._lastEventWasChange=a===g,this._lastEventWasCancel=a===f,document.createEvent)){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!1,!1,{tentativeRating:b}),this._element.dispatchEvent(c)}},_resetNextElement:function(a){if(null!==this._averageRatingElement.nextSibling){var b=this._averageRatingElement.nextSibling.style;b.msFlexPositive=1,b.msFlexNegative=1;var c=getComputedStyle(this._element).direction;a&&(c="rtl"===c?"ltr":"rtl"),"rtl"===c?(b.paddingRight=this._elementPadding,b.borderRight=this._elementBorder,b.direction="rtl"):(b.paddingLeft=this._elementPadding,b.borderLeft=this._elementBorder,b.direction="ltr"),b.backgroundPosition="left",b.backgroundSize="100% 100%",b.width=this._resizeStringValue(this._elementWidth,1,b.width)}},_resetAverageStar:function(a){this._resetNextElement(a),this._hideAverageRating()},_resizeStringValue:function(a,b,c){var d=parseFloat(a);if(isNaN(d))return null!==c?c:a;var e=a.substring(d.toString(10).length);return d*=b,d+e},_setControlSize:function(a){var b=(Number(a)||d)>>0;this._maxRating=b>0?b:d},_updateTooltips:function(a){var b,d=0;if(null!==a)for(d=a.length<=this._maxRating+1?a.length:this._maxRating+1,b=0;d>b;b++)this._tooltipStrings[b]=a[b];else{for(b=0;b<this._maxRating;b++)this._tooltipStrings[b]=b+1;this._tooltipStrings[this._maxRating]=c.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(a,b,c){for(var d=0;d<this._maxRating;d++)this._elements[d].className=b>d?a:c},_updateAverageStar:function(){var a=this._averageRatingElement.style,b=this._averageRatingElement.nextSibling.style;"rtl"==getComputedStyle(this._element).direction?(a.backgroundPosition="right",a.paddingRight=this._elementPadding,a.borderRight=this._elementBorder,b.paddingRight="0px",b.borderRight="0px",b.direction="ltr"):(a.backgroundPosition="left",b.backgroundPosition="right",a.paddingLeft=this._elementPadding,a.borderLeft=this._elementBorder,b.paddingLeft="0px",b.borderLeft="0px",b.direction="rtl"),a.width=this._resizeStringValue(this._elementWidth,this._floatingValue,a.width),a.msFlexPositive=this._floatingValue,a.msFlexNegative=this._floatingValue,a.backgroundSize=100/this._floatingValue+"% 100%",a.display=getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,b.msFlexPositive=1-this._floatingValue,b.msFlexNegative=1-this._floatingValue,b.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,b.width),b.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(a,b){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(u,this._tentativeRating,t),this._hideAverageStar()),this._updateAccessibilityHoverState(),a&&(this._openTooltip(b),this._raiseEvent(h,this._tentativeRating))},_openTooltip:function(a){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(a);else if(0===this._tentativeRating){this._clearElement=document.createElement("div");var b=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===getComputedStyle(this._element).direction&&(b*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+b+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new WinJS.UI.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(a)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var a=0;a<this._maxRating;a++)this._toolTips[a].innerHTML=null},_appendClass:function(b){for(var c=0;c<=this._maxRating;c++)a.addClass(this._elements[c],b)},_setClasses:function(a,b,c){for(var d=0;d<this._maxRating;d++)this._elements[d].className=b>d?a:c},_ensureAverageMSStarRating:function(){WinJS.Utilities.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(q,this._averageRating-1,p),this._averageRatingElement.className=q;for(var a=0;a<this._maxRating;a++)if(a<this._averageRating&&a+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[a]),this._floatingValue=this._averageRating-a;var b=getComputedStyle(this._elements[a]);this._elementWidth=b.width,"rtl"==getComputedStyle(this._element).direction?(this._elementPadding=b.paddingRight,this._elementBorder=b.borderRight):(this._elementPadding=b.paddingLeft,this._elementBorder=b.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(s,this._userRating,r),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(o,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(v),this._appendClass(0!==this._averageRating&&0===this._userRating?w:x),this._updateAccessibilityRestState()}}})})})}(this,WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{ToggleSwitch:WinJS.Namespace._lazy(function(){function a(a){var b=a[0].target.winControl;b.checked=b._switchElement.valueAsNumber}var b=0,c=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",d=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",e=(WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",{get on(){return WinJS.Resources._getWinJSString("ui/on").value},get off(){return WinJS.Resources._getWinJSString("ui/off").value}}),f="win-toggleswitch",g="win-switch",h="win-title",i="win-label",j="win-on",k="win-off",l="win-disabled",m="win-hidden",n="win-focus-hide",o=WinJS.Class.define(null,{raiseEvent:function(a,b){this.dispatchEvent(a,b)}}),p=WinJS.Utilities,q=p._createEventProperty;return WinJS.Class.mix(o,WinJS.UI.DOMEventMixin),WinJS.Class.derive(o,function(a,b){a=a||document.createElement("div");var c=p.data(a).toggle;return c?c:(this._domElement=null,this._switchElement=null,this._titleElement=null,this._labelGridElement=null,this._labelOnElement=null,this._labelOffElement=null,this._labelOn=e.on,this._labelOff=e.off,this._disposed=!1,this._spaceKeyDown=!1,this._gesture=WinJS.Utilities._createGestureRecognizer(),this._shouldHideFocus=!1,this._pointerId=0,this._hasCapture=!1,this._setElement(a),this._setDefaultOptions(),WinJS.UI.setOptions(this,b),a.winControl=this,WinJS.Utilities.addClass(a,"win-disposable"),void(p.data(a).toggle=this))},{checked:{get:function(){return this._checked},set:function(a){this._setChecked(a)}},disabled:{get:function(){return this._switchElement.disabled},set:function(a){var b=!!a;this._switchElement.disabled=b,b?(p.addClass(this._labelOnElement,l),p.addClass(this._labelOffElement,l),p.addClass(this._titleElement,l)):(p.removeClass(this._labelOnElement,l),p.removeClass(this._labelOffElement,l),p.removeClass(this._titleElement,l)),this._switchElement.setAttribute("aria-disabled",b)}},element:{get:function(){return this._domElement}},labelOn:{get:function(){return this._labelOn},set:function(a){this._labelOn=a,this._labelOnElement.innerHTML=this._labelOn}},labelOff:{get:function(){return this._labelOff},set:function(a){this._labelOff=a,this._labelOffElement.innerHTML=this._labelOff}},title:{get:function(){return this._titleElement.innerHTML},set:function(a){this._titleElement.innerHTML=a}},onchange:q("change"),_addControlsInOrder:function(){this._domElement.appendChild(this._titleElement),this._labelGridElement.appendChild(this._labelOnElement),this._labelGridElement.appendChild(this._labelOffElement),this._labelGridElement.appendChild(this._switchElement),this._domElement.appendChild(this._labelGridElement)},_setChecked:function(a){a=!!a,a!==this._checked&&(this._checked=a,this._checked?(p.removeClass(this._domElement,k),p.addClass(this._domElement,j),p.addClass(this._labelOffElement,m),p.removeClass(this._labelOnElement,m),this._switchElement.valueAsNumber=1):(p.removeClass(this._domElement,j),p.addClass(this._domElement,k),p.addClass(this._labelOnElement,m),p.removeClass(this._labelOffElement,m),this._switchElement.valueAsNumber=0),this._switchElement.setAttribute("aria-checked",this._checked))},_setDefaultOptions:function(){this.labelOn=e.on,this.labelOff=e.off,this.title="",this.checked=!1,this.disabled=!1},_setElement:function(a){this._domElement=a,p.addClass(this._domElement,f),p.addClass(this._domElement,k),this._titleElement=document.createElement("div"),this._titleElement.setAttribute("id",WinJS.Utilities._uniqueID(this._titleElement)),this._titleElement.setAttribute("role","note"),p.addClass(this._titleElement,h),this._switchElement=document.createElement("input"),this._switchElement.type="range",this._switchElement.max=1,this._switchElement.step=1,this._switchElement.setAttribute("role","checkbox"),this._switchElement.setAttribute("aria-labelledby",this._titleElement.id),p.addClass(this._switchElement,g),this._labelGridElement=document.createElement("div"),this._labelGridElement.style.display="-ms-grid",WinJS.Utilities.isPhone&&(this._labelGridElement.style.msGridColumns="1fr auto"),this._labelOnElement=document.createElement("div"),p.addClass(this._labelOnElement,i),this._labelOffElement=document.createElement("div"),p.addClass(this._labelOffElement,i),this._addControlsInOrder(),this._wireupEvents()},_valueHandler:function(a){var b=this._checked;this.checked=a?!this.checked:this._switchElement.valueAsNumber,b!==this._checked&&this.raiseEvent("change")},_wireupEvents:function(){var e=this,f=function(a){a.pointerId==e._pointerId&&e._valueHandler(!1)},g=function(a){a.keyCode===p.Key.space&&(e._spaceKeyDown||(e._switchElement.valueAsNumber=(e._switchElement.valueAsNumber+1)%2,e._spaceKeyDown=!0),a.preventDefault())},h=function(a){(a.keyCode===p.Key.space||a.keyCode>=p.Key.end&&a.keyCode<=p.Key.downArrow)&&(e._valueHandler(!1),a.keyCode===p.Key.space&&(e._spaceKeyDown=!1))},i=function(){e._valueHandler(!0)},j=function(){e._switchElement.valueAsNumber=e.checked,e._spaceKeyDown=!1},k=function(a){if(!e._switchElement.disabled)if(e._hasCapture||"MSGestureChange"!=a.type){if(e._hasCapture&&"MSGestureEnd"==a.type)try{e._hasCapture=!1}catch(b){}}else try{WinJS.Utilities._setPointerCapture(e._switchElement,e._pointerId),e._hasCapture=!0}catch(b){}},l=function(a){if(!e._switchElement.disabled&&(a.pointerType===c||a.pointerType===d||a.button===b)){if(!e._hasCapture)try{e._gesture.stop(),e._gesture.target=a.target,e._gesture.addPointer(a.pointerId),e._pointerId=a.pointerId}catch(f){}a.preventDefault(),o()}},m=function(a){if("aria-checked"===a.attrName){var b=e._switchElement.getAttributeNode("aria-checked");if(null!==b){var c=e._checked;e._setChecked("true"===b.nodeValue?!0:!1),c!==e._checked&&e.raiseEvent("change")}}},o=function(){e._switchElement.focus(),e._shouldHideFocus=!1},q=function(){p.addClass(e._switchElement,n),e._shouldHideFocus=!0},r=function(){e._shouldHideFocus||p.removeClass(e._switchElement,n)};WinJS.Utilities._addEventListener(this._switchElement,"pointercancel",j,!1),this._switchElement.addEventListener("lostpointercapture",j,!1),WinJS.Utilities._addEventListener(this._switchElement,"pointerup",f,!1),this._switchElement.addEventListener("MSGestureChange",k,!1),this._switchElement.addEventListener("MSGestureEnd",k,!1),this._switchElement.addEventListener("MSGestureTap",i,!1),this._switchElement.addEventListener("keydown",g,!1),this._switchElement.addEventListener("keyup",h,!1),new WinJS.Utilities._MutationObserver(a).observe(this._switchElement,{attributes:!0,attributeFilter:["value"]}),this._switchElement.addEventListener("change",function(a){a.stopPropagation()},!0),WinJS.Utilities._addEventListener(this._switchElement,"pointerdown",l,!1),this._switchElement.addEventListener("DOMAttrModified",m,!1),WinJS.Utilities._addEventListener(this._switchElement,"focusout",function(){r(),j()},!1),WinJS.Utilities._addEventListener(this._domElement,"focusin",o,!1),WinJS.Utilities._addEventListener(this._domElement,"pointerdown",q,!0)},dispose:function(){this._disposed||(this._disposed=!0,this._gesture.target=null,this._gesture=null)},addEventListener:function(a,b,c){"change"==a&&(c=!1),this._domElement.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return"change"==a&&(c=!1),this._domElement.removeEventListener(a,b,c)}})})})}(WinJS),function(a){"use strict";WinJS.Namespace.define("WinJS.UI",{SemanticZoom:WinJS.Namespace._lazy(function(){function b(a){return a}function c(a,b,c){return a+" "+WinJS.UI._animationTimeAdjustment(b)+"s "+c+" "+WinJS.UI._libraryDelay+"ms"}function d(){return c(L.cssName,E,"ease-in-out")+", "+c("opacity",C,"ease-in-out")}function e(){return c(L.cssName,F,"ease-in-out")+", "+c("opacity",D,"ease-in-out")}function f(){return c(L.cssName,I,K)}function g(){return c(L.cssName,J,K)}function h(a,b){return WinJS.Utilities.convertToPixels(a,b)}function i(a,b){WinJS.UI.isAnimationEnabled()&&(a.style[L.scriptName]="scale("+b+")")}function j(a){var b=a.target&&a.target.winControl;b&&!b._resizing&&b._onResize()}function k(a){var b=a[0].target&&a[0].target.winControl;b&&b instanceof WinJS.UI.SemanticZoom&&b._onPropertyChanged()}var l=WinJS.Utilities,m=WinJS.UI,n=WinJS.Utilities._browserStyleEquivalents,o={get invalidZoomFactor(){return WinJS.Resources._getWinJSString("ui/invalidZoomFactor").value}},p="win-semanticzoom-button",q="win-semanticzoom-button-location",r=3e3,s=8,t="win-semanticzoom",u="win-semanticzoom-zoomedinview",v="win-semanticzoom-zoomedoutview",w="zoomchanged",x=1.05,y=.65,z=.8,A=.2,B=4096,C=.333,D=.333,E=.333,F=.333,G=1e3*C,H=50,I=.333,J=.333,K="cubic-bezier(0.1,0.9,0.2,1)",L=n.transform,M=n.transition.scriptName,N=2,O=.2,P=.45,Q=1e3,R=50,S={none:0,zoomedIn:1,zoomedOut:2},T=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",U=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",V=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",W={x:0,y:0},X=WinJS.Class.define(function(b,c){this._disposed=!1;var d=this,e=WinJS.Utilities.isPhone;this._element=b,this._element.winControl=this,l.addClass(this._element,"win-disposable"),l.addClass(this._element,t),this._element.setAttribute("role","ms-semanticzoomcontainer");var f=this._element.getAttribute("aria-label");if(f||this._element.setAttribute("aria-label",""),c=c||{},this._zoomedOut=!!c.zoomedOut||!!c.initiallyZoomedOut||!1,this._enableButton=!e,e||void 0===c.enableButton||(this._enableButton=!!c.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=l._clamp(c.zoomFactor,A,z,y),this.zoomedInItem=c.zoomedInItem,this.zoomedOutItem=c.zoomedOutItem,WinJS.validation&&c._zoomFactor&&c._zoomFactor!==this._zoomFactor)throw new WinJS.ErrorFromName("WinJS.UI.SemanticZoom.InvalidZoomFactor",o.invalidZoomFactor);this._locked=!!c.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in a,this._initialize(),this._configure(),this._element.addEventListener("mselementresize",j),new WinJS.Utilities._MutationObserver(k).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),e||(this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),l._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),l._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),l._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),l._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),l._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(WinJS.Utilities._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(WinJS.Utilities._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),WinJS.UI._setOptions(this,c,!0),d._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(a){var b=!!a;this._enableButton===b||WinJS.Utilities.isPhone||(this._enableButton=b,b?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(a){this._zoom(!!a,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&WinJS.Utilities.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(a){var b=this._zoomFactor,c=l._clamp(a,A,z,y);b!==c&&(this._zoomFactor=c,this._onResize())}},locked:{get:function(){return this._locked},set:function(a){this._locked=!!a,a?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(a){this._zoomedInItem=a||b}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(a){this._zoomedOutItem=a||b}},dispose:function(){this._disposed||(this._disposed=!0,WinJS.Utilities._disposeElement(this._elementIn),WinJS.Utilities._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var a=l.children(this._element);this._elementIn=a[0],this._elementOut=a[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",m.processAll(this._elementIn),m.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._elementInIsListView=this._elementIn.winControl instanceof WinJS.UI.ListView,this._elementOutIsListView=this._elementOut.winControl instanceof WinJS.UI.ListView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=document.createElement("div"),this._element.appendChild(this._cropViewport),this._viewportIn=document.createElement("div"),this._opticalViewportIn=document.createElement("div"),this._viewportOut=document.createElement("div"),this._opticalViewportOut=document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=document.createElement("div"),this._canvasOut=document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),l.addClass(this._elementIn,u),l.addClass(this._elementOut,v),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=document.createElement("button"),this._sezoButton.className=p+" "+q,this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),this._element.addEventListener("pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var a=this._viewIn.getPanAxis(),b=this._viewOut.getPanAxis(),c=WinJS.Utilities.isPhone;if(this._pansHorizontallyIn="horizontal"===a||"both"===a,this._pansVerticallyIn="vertical"===a||"both"===a,this._pansHorizontallyOut="horizontal"===b||"both"===b,this._pansVerticallyOut="vertical"===b||"both"===b,!this._zoomInProgress){var d=1/this._zoomFactor-1,e=x-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),d),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),e),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,c||(this._zoomedOut?i(this._canvasIn,this._zoomFactor):i(this._canvasOut,1/this._zoomFactor));var f=this._opticalViewportIn.style,g=this._opticalViewportOut.style,h=this._canvasIn.style,j=this._canvasOut.style;h.opacity=this._zoomedOut&&!c?0:1,j.opacity=this._zoomedOut?1:0,c&&(h.zIndex=1,j.zIndex=2),WinJS.UI.isAnimationEnabled()&&!c&&(f[n["transition-property"].scriptName]=L.cssName,f[n["transition-duration"].scriptName]="0s",f[n["transition-timing-function"].scriptName]="linear",g[n["transition-property"].scriptName]=L.cssName,g[n["transition-duration"].scriptName]="0s",g[n["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var a=this._element.getAttribute("aria-checked"),b="true"===a;this._zoomedOut!==b&&(this.zoomedOut=b)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var a=function(a,b,c,d,e){var f=a.style;f.left=b+"px",f.top=c+"px",f.width=d+"px",f.height=e+"px"},b=window.getComputedStyle(this._element,null),c=parseFloat(b.width),d=parseFloat(b.height),e=h(this._element,b.paddingLeft),f=h(this._element,b.paddingRight),g=h(this._element,b.paddingTop),i=h(this._element,b.paddingBottom),j=c-e-f,k=d-g-i,l=1/this._zoomFactor;if(this._viewportWidth===j&&this._viewportHeight===k)return;this._sezoClientHeight=d,this._sezoClientWidth=c,this._viewportWidth=j,this._viewportHeight=k,this._configure();var m=2*l-1,n=Math.min(B,(this._pansHorizontallyIn?m:1)*j),o=Math.min(B,(this._pansVerticallyIn?m:1)*k);this._canvasLeftIn=.5*(n-j),this._canvasTopIn=.5*(o-k),a(this._cropViewport,e,g,j,k),a(this._viewportIn,0,0,j,k),a(this._opticalViewportIn,0,0,j,k),a(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,n,o),a(this._elementIn,this._canvasLeftIn,this._canvasTopIn,j,k);
var p=2*x-1,q=(this._pansHorizontallyOut?p:1)*j,r=(this._pansVerticallyOut?p:1)*k;this._canvasLeftOut=.5*(q-j),this._canvasTopOut=.5*(r-k),a(this._viewportOut,0,0,j,k),a(this._opticalViewportOut,0,0,j,k),a(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,q,r),a(this._elementOut,this._canvasLeftOut,this._canvasTopOut,j,k)}finally{this._resizing--}},_onResize:function(){this._onResizeImpl()},_onMouseMove:function(a){return this._zooming||!this._lastMouseX&&!this._lastMouseY||a.screenX===this._lastMouseX&&a.screenY===this._lastMouseY?(this._lastMouseX=a.screenX,void(this._lastMouseY=a.screenY)):void(Math.abs(a.screenX-this._lastMouseX)<=s&&Math.abs(a.screenY-this._lastMouseY)<=s||(this._lastMouseX=a.screenX,this._lastMouseY=a.screenY,this._displayButton()))},_displayButton:function(){clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var a=this;this._dismissButtonTimer=setTimeout(function(){a._hideSemanticZoomButton()},WinJS.UI._animationTimeAdjustment(r))},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(WinJS.UI.Animation.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(a){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(a)this._sezoButton.style.visibility="hidden";else{var b=this;WinJS.UI.Animation.fadeOut(this._sezoButton).then(function(){b._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(a){a.target!==this.element&&this._hideSemanticZoomButton(!0)},_onMouseWheel:function(a){a.ctrlKey&&(this._zoom(a.wheelDelta<0,this._getPointerLocation(a)),a.stopPropagation(),a.preventDefault())},_onPenHover:function(a){a.pointerType===U&&0===a.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(a){var b=!1;if(a.ctrlKey){var c=l.Key;switch(a.keyCode){case c.add:case c.equal:this._zoom(!1),b=!0;break;case c.subtract:case c.dash:this._zoom(!0),b=!0}}b&&(a.stopPropagation(),a.preventDefault())},_createPointerRecord:function(a,b){var c=this._getPointerLocation(a),d={};return d.startX=d.currentX=c.x,d.startY=d.currentY=c.y,d.fireCancelOnPinch=b,this._pointerRecords[a.pointerId]=d,this._pointerCount=Object.keys(this._pointerRecords).length,d},_deletePointerRecord:function(a){var b=this._pointerRecords[a];return delete this._pointerRecords[a],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),b},_fakeCancelOnPointer:function(a){var b=document.createEvent("UIEvent");b.initUIEvent("touchcancel",!0,!0,window,0),b.touches=a.touches,b.targetTouches=a.targetTouches,b.changedTouches=[a._currentTouch],b._fakedBySemanticZoom=!0,a.target.dispatchEvent(b)},_handlePointerDown:function(a){this._createPointerRecord(a,!1);for(var b=(this._element,Object.keys(this._pointerRecords)),c=0,d=b.length;d>c;c++)try{WinJS.Utilities._setPointerCapture(this._hiddenElement,b[c]||0)}catch(e){return void this._resetPointerRecords()}a.stopImmediatePropagation(),a.cancelBubble=!0,a.preventDefault()},_handleFirstPointerDown:function(a){this._resetPointerRecords(),this._createPointerRecord(a,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(a){a.target!==this._element&&this._isBouncing&&a.stopImmediatePropagation()},_onPointerDown:function(a){a.pointerType===T&&(0===this._pointerCount?this._handleFirstPointerDown(a):this._handlePointerDown(a))},_onPointerMove:function(a){function b(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))}function c(a,b){return{x:.5*(a.currentX+b.currentX)|0,y:.5*(a.currentY+b.currentY)|0}}if(a.pointerType===V||a.pointerType===U)return void this._onMouseMove(a);if(a.pointerType===T){var d=this._pointerRecords[a.pointerId],e=this._getPointerLocation(a);if(d){if(d.currentX=e.x,d.currentY=e.y,2===this._pointerCount){this._pinching=!0;var f=Object.keys(this._pointerRecords),g=this._pointerRecords[f[0]],h=this._pointerRecords[f[1]];this._currentMidPoint=c(g,h);var i=b(g.currentX,g.currentY,h.currentX,h.currentY),j=this,k=function(a){var b=a?S.zoomedOut:S.zoomedIn,d=a?j._pinchedDirection===S.zoomedIn&&!j._zoomingOut:j._pinchedDirection===S.zoomedOut&&j._zoomingOut,e=a?!j._zoomedOut:j._zoomedOut;if(j._pinchedDirection===S.none)e?(j._isBouncingIn=!1,j._zoom(a,c(g,h),!0),j._pinchedDirection=b):j._isBouncingIn||j._playBounce(!0,c(g,h));else if(d){var f=j._lastPinchDistance/j._lastPinchStartDistance,i=j._lastLastPinchDistance/j._lastPinchDistance;(a&&f>O||!a&&i>P)&&(j._zoom(a,c(g,h),!0),j._pinchedDirection=b)}};this._updatePinchDistanceRecords(i),this._pinchDistanceCount>=N&&(this._zooming||this._isBouncing||(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:EndPinchDetection,info"),k(this._lastPinchDirection===S.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(d.fireCancelOnPinch&&(this._fakeCancelOnPointer(a,d),d.fireCancelOnPinch=!1),a.stopImmediatePropagation(),a.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(a){a.pointerType===T&&a.target===this._element&&this._completePointerUp(a,!1)},_onPointerUp:function(a){this._releasePointerCapture(a),this._completePointerUp(a,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(a){a._fakedBySemanticZoom||(this._releasePointerCapture(a),this._completePointerUp(a,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(a){var b=this._pointerRecords[a.pointerId];b&&(b.dirty=!1)},_onLostPointerCapture:function(a){var b=this._pointerRecords[a.pointerId];if(b){b.dirty=!0;var c=this;WinJS.Promise.timeout(R).then(function(){b.dirty&&c._completePointerUp(a,!1)})}},_onMSContentZoom:function(a){var b=a.target;if(b===this._opticalViewportIn||b===this._opticalViewportOut){var c=b.msContentZoomFactor<.995,d=b.msContentZoomFactor>1.005;!c||this._zoomedOut||this._zoomingOut?d&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(a){function b(b){c._lastPinchDirection===b?c._pinchDistanceCount++:(c._pinchGesture++,c._pinchDistanceCount=0,c._lastPinchStartDistance=a),c._lastPinchDirection=b,c._lastPinchDistance=a,c._lastLastPinchDistance=c._lastPinchDistance}var c=this;-1===this._lastPinchDistance?(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=a):this._lastPinchDistance!==a&&b(this._lastPinchDistance>a?S.zoomedOut:S.zoomedIn)},_zoomFromCurrent:function(a){this._zoom(a,null,!1,!0)},_zoom:function(a,b,c,d,e){if(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+a+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!c)return;a!==this._zoomingOut&&this._startAnimations(a)}else if(a!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!c,b&&(a?this._viewIn:this._viewOut).setCurrentItem(b.x,b.y),this._zoomInProgress=!0,(a?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",a&&WinJS.Utilities.isPhone&&(this._canvasOut.style.opacity=1);var f=this._viewIn.beginZoom(),g=this._viewOut.beginZoom(),h=null;if((f||g)&&WinJS.Utilities.isPhone&&(h=WinJS.Promise.join([f,g])),d&&!e){var i=this;(a?this._viewIn:this._viewOut).getCurrentItem().then(function(b){var c=b.position;i._prepareForZoom(a,{x:i._rtl()?i._sezoClientWidth-c.left-.5*c.width:c.left+.5*c.width,y:c.top+.5*c.height},WinJS.Promise.wrap(b),h)})}else this._prepareForZoom(a,b||{},null,h,e)}},_prepareForZoom:function(a,b,c,d,e){function f(a,b){g._canvasIn.style[n["transform-origin"].scriptName]=g._canvasLeftIn+h-a.x+"px "+(g._canvasTopIn+i-a.y)+"px",g._canvasOut.style[n["transform-origin"].scriptName]=g._canvasLeftOut+h-b.x+"px "+(g._canvasTopOut+i-b.y)+"px"}WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var g=this,h=b.x,i=b.y;"number"==typeof h&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(h=.5*this._sezoClientWidth),"number"==typeof i&&this._pansVerticallyIn&&this._pansVerticallyOut||(i=.5*this._sezoClientHeight),f(W,W),e?this._aligning=!1:this._alignViewsPromise=this._alignViews(a,h,i,c).then(function(){g._aligning=!1,g._gestureEnding=!1,g._alignViewsPromise=null,g._zooming||g._gesturing||g._completeZoom()}),this._zoomingOut=a,getComputedStyle(this._canvasIn).opacity,getComputedStyle(this._canvasOut).opacity,WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(a,d)},_alignViews:function(a,b,c,d){var e=1-this._zoomFactor,f=this._rtl(),g=e*(f?this._viewportWidth-b:b),h=e*c,i=this;if(a){var j=d||this._viewIn.getCurrentItem();if(j)return j.then(function(a){var b=a.position,c={left:b.left*i._zoomFactor+g,top:b.top*i._zoomFactor+h,width:b.width*i._zoomFactor,height:b.height*i._zoomFactor};return i._viewOut.positionItem(i._zoomedOutItem(a.item),c)})}else{var k=d||this._viewOut.getCurrentItem();if(k)return k.then(function(a){var b=a.position,c={left:(b.left-g)/i._zoomFactor,top:(b.top-h)/i._zoomFactor,width:b.width/i._zoomFactor,height:b.height/i._zoomFactor};return i._viewIn.positionItem(i._zoomedInItem(a.item),c)})}return new WinJS.Promise(function(a){a({x:0,y:0})})},_startAnimations:function(a,b){this._zoomingOut=a;var c=WinJS.Utilities.isPhone;if(WinJS.UI.isAnimationEnabled()&&!c&&(WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[M]=a?d():e(),this._canvasOut.style[M]=a?e():d()),c||(i(this._canvasIn,a?this._zoomFactor:1),i(this._canvasOut,a?1:1/this._zoomFactor)),this._canvasIn.style.opacity=a&&!c?0:1,(!c||a)&&(this._canvasOut.style.opacity=a?1:0),WinJS.UI.isAnimationEnabled())if(b){var f=this,g=function(){f._canvasIn.style[L.scriptName]="",f._canvasOut.style[L.scriptName]="",f._onZoomAnimationComplete()};b.then(g,g)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),WinJS.UI._animationTimeAdjustment(G));else this._zooming=!1,this._canvasIn.style[L.scriptName]="",this._canvasOut.style[L.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(a){return this._disposed?void 0:a.target!==this._canvasOut&&a.target!==this._canvasIn||!this._isBouncing?void(a.target===this._canvasIn&&a.propertyName===L.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(a){a&&clearTimeout(a)},_completePointerUp:function(a,b){if(!this._disposed){var c=a.pointerId,d=this._pointerRecords[c];if(d&&(this._deletePointerRecord(c),this._isBouncingIn&&this._playBounce(!1),b&&this._pinchedDirection!==S.none&&(a.stopImmediatePropagation(),a.cancelBubble=!0),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==S.none&&this._pinchDistanceCount<N)return this._zoom(this._lastPinchDirection===S.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==S.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(a,b){var c=this;c._TTFFTimer=setTimeout(function(){this._disposed||(c._TTFFTimer=setTimeout(a,b))},H)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var a=this;(this._zoomInProgress||this._isBouncing)&&(a._completeZoomTimer=setTimeout(function(){a._completeZoom()},WinJS.UI._animationTimeAdjustment(Q)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!WinJS.Utilities.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var a=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),a=!0),this._setVisibility(),a){var b=document.createEvent("CustomEvent");b.initCustomEvent(w,!0,!0,this._zoomedOut),this._element.dispatchEvent(b),this._isActive&&WinJS.Utilities._setActive(this._zoomedOut?this._elementOut:this._elementIn)}WinJS.Utilities._writeProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var a=document.activeElement;return this._element===a||this._element.contains(a)},_setLayout:function(a,b,c){var d=a.style;d.position=b,d.overflow=c},_setupOpticalViewport:function(a){a.style["-ms-overflow-style"]="none",WinJS.Utilities.isPhone||(a.style["-ms-content-zooming"]="zoom",a.style["-ms-content-zoom-limit-min"]="99%",a.style["-ms-content-zoom-limit-max"]="101%",a.style["-ms-content-zoom-snap-points"]="snapList(100%)",a.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function a(a,b){a.style.visibility=b?"visible":"hidden"}a(this._opticalViewportIn,!this._zoomedOut||WinJS.Utilities.isPhone),a(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=S.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(a){var b=a.pointerId;try{WinJS.Utilities._releasePointerCapture(this._hiddenElement,b)}catch(c){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var a=this;this._recordResetPromise=WinJS.Promise.timeout(R).then(function(){0===a._pointerCount&&(a._resetPointerRecords(),a._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=S.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(a){var b={left:0,top:0};try{b=this._element.getBoundingClientRect()}catch(c){}var d=window.getComputedStyle(this._element,null),e=h(this._element,d.paddingLeft),f=h(this._element,d.paddingTop),g=h(this._element,d.borderLeftWidth);return{x:+a.clientX===a.clientX?a.clientX-b.left-e-g:0,y:+a.clientY===a.clientY?a.clientY-b.top-f-f:0}},_playBounce:function(a,b){if(WinJS.UI.isAnimationEnabled()&&this._isBouncingIn!==a){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=a,a?this._bounceCenter=b:this._aligned=!0;var c=this._zoomedOut?this._canvasOut:this._canvasIn,d=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,e=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;c.style[n["transform-origin"].scriptName]=d+this._bounceCenter.x+"px "+(e+this._bounceCenter.y)+"px",c.style[M]=a?f():g(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var h=a?this._zoomedOut?2-x:x:1;i(c,h),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),WinJS.UI._animationTimeAdjustment(G))}},_rtl:function(){return"rtl"===window.getComputedStyle(this._element,null).direction},_pinching:{set:function(a){this._elementInIsListView&&(this._elementIn.winControl._pinching=a),this._elementOutIsListView&&(this._elementOut.winControl._pinching=a)}}});return WinJS.Class.mix(X,WinJS.Utilities.createEventProperties("zoomchanged")),WinJS.Class.mix(X,WinJS.UI.DOMEventMixin),X})})}(this),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{Hub:b.Namespace._lazy(function(){function a(a){var b=document.createTextNode("object"==typeof a.header?JSON.stringify(a.header):""+a.header);return b}var c=b.Utilities.Key,d=b.Utilities._createEventProperty,e={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},f=500,g={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},h={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},i={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},j=b.Class.define(function(a,c){if(a=a||document.createElement("DIV"),c=c||{},a.winControl)throw new b.ErrorFromName("WinJS.UI.Hub.DuplicateConstruction",l.duplicateConstruction);this._id=a.id||b.Utilities._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),window.addEventListener("keydown",this._windowKeyDownHandlerBound),a.winControl=this,this._element=a,b.Utilities.addClass(this.element,b.UI.Hub._ClassName.hub),b.Utilities.addClass(this.element,"win-disposable"),this._viewportElement=document.createElement("DIV"),this._viewportElement.className=b.UI.Hub._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",l.hubViewportAriaLabel),this._surfaceElement=document.createElement("DIV"),this._surfaceElement.className=b.UI.Hub._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,c.orientation||(this._orientation=b.UI.Orientation.horizontal,b.Utilities.addClass(this.element,b.UI.Hub._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new b.Promise.wrap,this._currentIndexForSezo=0,this._parse(),b.UI.setOptions(this,c),b.Utilities._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this.element.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._surfaceElement.addEventListener("mselementresize",this._contentResizeHandler.bind(this)),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(a){this._measured=!1,a===b.UI.Orientation.vertical?(b.Utilities.removeClass(this.element,b.UI.Hub._ClassName.hubHorizontal),b.Utilities.addClass(this.element,b.UI.Hub._ClassName.hubVertical)):(a=b.UI.Orientation.horizontal,b.Utilities.removeClass(this.element,b.UI.Hub._ClassName.hubVertical),b.Utilities.addClass(this.element,b.UI.Hub._ClassName.hubHorizontal)),this._orientation=a,b.Utilities.Scheduler.schedule(this._updateSnapList.bind(this),b.Utilities.Scheduler.Priority.idle)}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(a){var b=!this._pendingSections;this._pendingSections=a,this._refresh(),b&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=a),this._headerTemplate)},set:function(b){this._pendingHeaderTemplate=b||a,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(a){if(a=Math.max(0,a),this._pendingRefresh)this._pendingScrollLocation=a,this._pendingSectionOnScreen=null;else{this._measure();var b=Math.max(0,Math.min(this._scrollLength-this._viewportSize,a));this._viewportElement[this._names.scrollPos]=this._scrollPosition=b}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var a=0;a<this._sectionSizes.length;a++){var b=this._sectionSizes[a];if(b.offset+b.size-b.borderEnd-b.paddingEnd>this._scrollPosition+this._startSpacer+b.borderStart+b.paddingStart)return a}return-1},set:function(a){a=Math.max(0,a),this._pendingRefresh?(this._pendingSectionOnScreen=a,this._pendingScrollLocation=null):(this._measure(),a>=0&&a<this._sectionSizes.length&&this._scrollToSection(a))}},indexOfFirstVisible:{get:function(){this._measure();for(var a=0;a<this._sectionSizes.length;a++){var b=this._sectionSizes[a];if(b.offset+b.size-b.borderEnd-b.paddingEnd>this._scrollPosition)return a}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var a=this._sectionSizes.length-1;a>=0;a--){var b=this._sectionSizes[a];if(b.offset+b.paddingStart+b.borderStart<this._scrollPosition+this._viewportSize)return a}return-1}},onheaderinvoked:d(e.headerInvoked),onloadingstatechanged:d(e.loadingStateChanged),oncontentanimating:d(e.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(b.UI.Hub.LoadingState.loading),this._pendingRefresh=!0,b.Utilities.Scheduler.schedule(this._refreshImpl.bind(this),b.Utilities.Scheduler.Priority.high))},_refreshImpl:function(){if(!this._disposed){var a=b.Promise.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,b.UI.isAnimationEnabled()))){var c=this._fireEvent(b.UI.Hub._EventName.contentAnimating,{type:b.UI.Hub.AnimationType.contentTransition});c&&(this._viewportElement.style["-ms-overflow-style"]="none",a=b.UI.Animation.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=c}a.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var a=!1;if(this._pendingSections){for(a=!0,this._updateEvents(this._sections,this._pendingSections),this._sections=this._pendingSections,this._pendingSections=null;this.element.firstElementChild!==this._viewportElement;){var c=this.element.firstElementChild;c.parentNode.removeChild(c)}b.Utilities.empty(this._surfaceElement)}this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),a&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:this.scrollPosition=+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(b.UI.Hub.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(a){if(!this._pendingSections){var c=a.detail.newValue,d=a.detail.oldValue;if(c._setHeaderTemplate(this.headerTemplate),c.element!==d.element){if(c.element.parentNode===this._surfaceElement)throw new b.ErrorFromName("WinJS.UI.Hub.DuplicateSection",l.duplicateSection);this._surfaceElement.insertBefore(c.element,d.element),this._surfaceElement.removeChild(d.element),this._measured=!1,this._setState(b.UI.Hub.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(a){if(!this._pendingSections){var c=a.detail.index,d=a.detail.value;d._animation&&d._animation.cancel();var e,f=this._fireEvent(b.UI.Hub._EventName.contentAnimating,{type:b.UI.Hub.AnimationType.insert,index:c,section:d});if(f){for(var g=[],h=c+1;h<this.sections.length;h++)g.push(this.sections.getAt(h).element);e=new b.UI.Animation._createUpdateListAnimation([d.element],[],g)}if(d.element.parentNode===this._surfaceElement)throw new b.ErrorFromName("WinJS.UI.Hub.DuplicateSection",l.duplicateSection);if(d._setHeaderTemplate(this.headerTemplate),c<this.sections.length-1?this._surfaceElement.insertBefore(d.element,this.sections.getAt(c+1).element):this._surfaceElement.appendChild(d.element),this._measured=!1,e){var i=e.execute();this.runningAnimations=b.Promise.join([this.runningAnimations,i])}this._setState(b.UI.Hub.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(a){if(!this._pendingSections){var c=a.detail.newIndex,d=a.detail.value;c<this.sections.length-1?this._surfaceElement.insertBefore(d.element,this.sections.getAt(c+1).element):this._surfaceElement.appendChild(d.element),this._measured=!1,this._setState(b.UI.Hub.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(a){if(!this._pendingSections){var c=a.detail.value,d=a.detail.index,e=b.Promise.wrap(),f=this._fireEvent(b.UI.Hub._EventName.contentAnimating,{type:b.UI.Hub.AnimationType.remove,index:d,section:c});if(f){for(var g=[],h=d;h<this.sections.length;h++)g.push(this.sections.getAt(h).element);var i=new b.UI.Animation._createUpdateListAnimation([],[c.element],g);this._measure();var j=c.element.offsetTop,k=c.element.offsetLeft;c.element.style.position="absolute",c.element.style.top=j,c.element.style.left=k,c.element.style.opacity=0,this._measured=!1,e=i.execute().then(function(){c.element.style.position="",c.element.style.top="",c.element.style.left="",c.element.style.opacity=1}.bind(this))}e.done(function(){this._disposed||(this._surfaceElement.removeChild(c.element),this._measured=!1)}.bind(this)),c._animation=e,this.runningAnimations=b.Promise.join([this.runningAnimations,e]),this._setState(b.UI.Hub.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(a,b){a&&(a.removeEventListener("itemchanged",this._handleSectionChangedBind),a.removeEventListener("iteminserted",this._handleSectionInsertedBind),a.removeEventListener("itemmoved",this._handleSectionMovedBind),a.removeEventListener("itemremoved",this._handleSectionRemovedBind),a.removeEventListener("reload",this._handleSectionReloadBind)),b&&(b.addEventListener("itemchanged",this._handleSectionChangedBind),b.addEventListener("iteminserted",this._handleSectionInsertedBind),b.addEventListener("itemmoved",this._handleSectionMovedBind),b.addEventListener("itemremoved",this._handleSectionRemovedBind),b.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var a=0;a<this.sections.length;a++){var c=this._sections.getAt(a);if(c._animation&&c._animation.cancel(),c.element.parentNode===this._surfaceElement)throw new b.ErrorFromName("WinJS.UI.Hub.DuplicateSection",l.duplicateSection);this._surfaceElement.appendChild(c.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var a=0;a<this.sections.length;a++){var b=this._sections.getAt(a);b._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(a){var b=this._sections.getAt(a);return b._process().then(function(){var a=b.contentElement.style;""!==a.visibility&&(a.visibility="")})},_loadSections:function(){function a(a){a.then(function(){b.Utilities.Scheduler.schedule(c,b.Utilities.Scheduler.Priority.idle)})}function c(){if(d===e._loadId&&!e._disposed)if(h.length){var b=h.shift(),c=e._loadSection(b);a(c)}else j.complete()}this._loadId++;var d=this._loadId,e=this,g=b.Promise.wrap(),h=[],i=b.Promise.wrap();if(this._showProgressPromise||(this._showProgressPromise=b.Promise.timeout(f).then(function(){this._disposed||(this._progressBar||(this._progressBar=document.createElement("progress"),b.Utilities.addClass(this._progressBar,b.UI.Hub._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var j=new b._Signal;i=j.promise;for(var k=[],l=Math.max(0,this.indexOfFirstVisible),m=Math.max(0,this.indexOfLastVisible),n=l;m>=n;n++)k.push(this._loadSection(n));for(l--,m++;l>=0||m<this.sections.length;)m<this.sections.length&&(h.push(m),m++),l>=0&&(h.push(l),l--);var o=b.Promise.join(k);o.done(function(){d!==this._loadId||e._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),b.Utilities.Scheduler.schedule(function(){if(d===this._loadId&&!e._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&b.UI.isAnimationEnabled()){var a={type:b.UI.Hub.AnimationType.entrance};(!this._fireEntrance||this._fireEvent(b.UI.Hub._EventName.contentAnimating,a))&&(this._viewportElement.style["-ms-overflow-style"]="none",g=b.UI.Animation.enterContent(this._viewportElement,[{left:this._fireEntrance?"100px":"40px",top:"0px",rtlflip:!0}],{mechanism:"transition"}).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this)))}this._element===document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},b.Utilities.Scheduler.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),a(o)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);b.Promise.join([this.runningAnimations,g,i]).done(function(){d!==this._loadId||e._disposed||(this.runningAnimations=b.Promise.wrap(),this._setState(b.UI.Hub.LoadingState.complete),b.Utilities.Scheduler.schedule(this._updateSnapList.bind(this),b.Utilities.Scheduler.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(a){if(a!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+a+",info"),this._loadingState=a;var c=document.createEvent("CustomEvent");c.initCustomEvent(b.UI.Hub._EventName.loadingStateChanged,!0,!1,{loadingState:a}),this._element.dispatchEvent(c)}},_parse:function(){for(var a=[],c=this.element.firstElementChild;c!==this._viewportElement;){b.UI.processAll(c);var d=c.winControl;if(!d)throw new b.ErrorFromName("WinJS.UI.Hub.InvalidContent",l.invalidContent);a.push(d);var e=c.nextElementSibling;c=e}this.sections=new b.Binding.List(a)},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!0,!0,b),this.element.dispatchEvent(c)},_findHeaderTabStop:function(a){if(a.parentNode&&b.Utilities._matchesSelector(a,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!b.Utilities.hasClass(a,"win-hub-section-header-tabstop");)a=a.parentElement;return a}return null},_isHeaderInteractive:function(a){return a.parentNode?b.Utilities._matchesSelector(a,".win-interactive, .win-interactive *"):!1
},_clickHandler:function(a){var c=this._findHeaderTabStop(a.target);if(c&&!this._isHeaderInteractive(a.target)){var d=c.parentElement.parentElement.winControl;if(!d.isHeaderStatic){var e=this.sections.indexOf(d);this._fireEvent(b.UI.Hub._EventName.headerInvoked,{index:e,section:d})}}},_resizeHandler:function(){this._measured=!1,b.Utilities.Scheduler.schedule(this._updateSnapList.bind(this),b.Utilities.Scheduler.Priority.idle)},_contentResizeHandler:function(){this._measured=!1,b.Utilities.Scheduler.schedule(this._updateSnapList.bind(this),b.Utilities.Scheduler.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==b.UI.Hub.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===getComputedStyle(this._element,null).direction,this._names=this.orientation===b.UI.Orientation.vertical?g:this._rtl?h:i,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=this._viewportElement[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var a=getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(a[this._names.marginStart])+parseFloat(a[this._names.borderStart])+parseFloat(a[this._names.paddingStart]),this._endSpacer=parseFloat(a[this._names.marginEnd])+parseFloat(a[this._names.borderEnd])+parseFloat(a[this._names.paddingEnd]),this._sectionSizes=[];for(var c=0;c<this.sections.length;c++){var d=this.sections.getAt(c),e=getComputedStyle(d.element);this._sectionSizes[c]={offset:d.element[this._names.offsetPos],size:d.element[this._names.offsetSize],marginStart:parseFloat(e[this._names.marginStart]),marginEnd:parseFloat(e[this._names.marginEnd]),borderStart:parseFloat(e[this._names.borderStart]),borderEnd:parseFloat(e[this._names.borderEnd]),paddingStart:parseFloat(e[this._names.paddingStart]),paddingEnd:parseFloat(e[this._names.paddingEnd])},this._rtl&&this.orientation===b.UI.Orientation.horizontal&&(this._sectionSizes[c].offset=this._viewportSize-(this._sectionSizes[c].offset+this._sectionSizes[c].size))}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var a="snapList(",c=0;c<this._sectionSizes.length;c++){c>0&&(a+=",");var d=this._sectionSizes[c];a+=d.offset-d.marginStart-this._startSpacer+"px"}a+=")";var e="",f="";this.orientation===b.UI.Orientation.vertical?e=a:f=a,this._lastSnapPointY!==e&&(this._lastSnapPointY=e,this._viewportElement.style["-ms-scroll-snap-points-y"]=e),this._lastSnapPointX!==f&&(this._lastSnapPointX=f,this._viewportElement.style["-ms-scroll-snap-points-x"]=f),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(a,b){this._measure();var c=this._sectionSizes[a],d=Math.min(this._scrollLength-this._viewportSize,c.offset-c.marginStart-this._startSpacer);this._scrollTo(d,b)},_ensureVisible:function(a,b){this._measure();var c=this._ensureVisibleMath(a,this._scrollPosition);this._scrollTo(c,b)},_ensureVisibleMath:function(a,b){this._measure();var c=this._sectionSizes[a],d=Math.min(this._scrollLength-this._viewportSize,c.offset-c.marginStart-this._startSpacer),e=Math.max(0,c.offset+c.size+c.marginEnd+this._endSpacer-this._viewportSize+1);return b>d?b=d:e>b&&(b=Math.min(d,e)),b},_scrollTo:function(a,c){this._scrollPosition=a,c?this.orientation===b.UI.Orientation.vertical?b.Utilities._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):b.Utilities._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0}):this._viewportElement[this._names.scrollPos]=this._scrollPosition},_windowKeyDownHandler:function(a){if(a.keyCode===c.tab){this._tabSeenLast=!0;var d=this;b.Utilities._yieldForEvents(function(){d._tabSeenLast=!1})}},_focusin:function(a){if(this._tabSeenLast){var c=this._findHeaderTabStop(a.target);if(c&&!this._isHeaderInteractive(a.target)){var d=this.sections.indexOf(c.parentElement.parentElement.winControl);d>-1&&this._ensureVisible(d,!0)}}for(var e=a.target;e&&!b.Utilities.hasClass(e,b.UI.HubSection._ClassName.hubSection);)e=e.parentElement;if(e){var d=this.sections.indexOf(e.winControl);d>-1&&(this._currentIndexForSezo=d)}if(a.target===this.element){var f;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(f=this._sectionToFocus,this._sectionToFocus=null):f=this.sectionOnScreen,this._moveFocusIn(f)}},_moveFocusIn:function(a){if(a>=0){for(var c=a;c<this.sections.length;c++){var d=this.sections.getAt(c),e=b.Utilities._trySetActive(d._headerTabStopElement);if(e)return;if(b.Utilities._setActiveFirstFocusableElement(d.contentElement))return}for(var c=a-1;c>=0;c--){var d=this.sections.getAt(c);if(b.Utilities._setActiveFirstFocusableElement(d.contentElement))return;var e=b.Utilities._trySetActive(d._headerTabStopElement);if(e)return}}},_keyDownHandler:function(a){var d=this._rtl?c.rightArrow:c.leftArrow,e=this._rtl?c.leftArrow:c.rightArrow;if(a.keyCode===c.upArrow||a.keyCode===c.downArrow||a.keyCode===c.leftArrow||a.keyCode===c.rightArrow||a.keyCode===c.pageUp||a.keyCode===c.pageDown){var f=this._findHeaderTabStop(a.target);if(f&&!this._isHeaderInteractive(a.target)){var g,h=this.sections.indexOf(f.parentElement.parentElement.winControl),i=!1;if(a.keyCode===c.pageDown||this.orientation===b.UI.Orientation.horizontal&&a.keyCode===e||this.orientation===b.UI.Orientation.vertical&&a.keyCode===c.downArrow)for(var j=h+1;j<this.sections.length;j++){{this.sections.getAt(j)}if(this._tryFocus(j)){g=j;break}}else if(a.keyCode===c.pageUp||this.orientation===b.UI.Orientation.horizontal&&a.keyCode===d||this.orientation===b.UI.Orientation.vertical&&a.keyCode===c.upArrow)for(var j=h-1;j>=0;j--){{this.sections.getAt(j)}if(this._tryFocus(j)){g=j;break}}(a.keyCode===c.upArrow||a.keyCode===c.downArrow||a.keyCode===c.leftArrow||a.keyCode===c.rightArrow)&&(i=!0),+g===g&&(i?this._ensureVisible(g,!0):this._scrollToSection(g,!0)),a.preventDefault()}}},_tryFocus:function(a){var c=this.sections.getAt(a);return b.Utilities._setActive(c._headerTabStopElement),document.activeElement===c._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new k(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===b.UI.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(a,c){var d;d=this.orientation===b.UI.Orientation.horizontal?a:c,this._measure(),d+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var e=1;e<this._sectionSizes.length;e++){var f=this._sectionSizes[e];if(f.offset-f.marginStart>d){this._currentIndexForSezo=e-1;break}}},_getCurrentItem:function(){var a;if(this._sectionSizes.length>0){this._measure();var c=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),d=this._sectionSizes[c];a=this.orientation===b.UI.Orientation.horizontal?{left:Math.max(0,d.offset-d.marginStart-this._scrollPosition),top:0,width:d.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,d.offset-d.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:d.size};var e=this.sections.getAt(c);return b.Promise.wrap({item:{data:e,index:c,groupIndexHint:c},position:a})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(a,c){if(a.index>=0&&a.index<this._sectionSizes.length){this._measure();var d,e=this._sectionSizes[a.index];d=this.orientation===b.UI.Orientation.horizontal?c.left:c.top,this._sectionToFocus=a.index;var f=e.offset-d,f=this._ensureVisibleMath(a.index,f);this._viewportElement[this._names.scrollPos]=this._scrollPosition=f}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(a){var c="WinJS.UI.Hub:"+this._id+":"+a;b.Utilities._writeProfilerMark(c),b.log&&b.log(c,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,window.removeEventListener("keydown",this._windowKeyDownHandlerBound),this._updateEvents(this._sections);for(var a=0;a<this.sections.length;a++)this.sections.getAt(a).dispose()}}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:e.contentAnimating,headerInvoked:e.headerInvoked,loadingStateChanged:e.loadingStateChanged}});b.Class.mix(j,b.UI.DOMEventMixin);var k=b.Class.define(function(a){this._hub=a},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(a,b,c,d){this._hub._configureForZoom(a,b,c,d)},setCurrentItem:function(a,b){this._hub._setCurrentItem(a,b)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(a,b){return this._hub._positionItem(a,b)},endZoom:function(a){this._hub._endZoom(a)}}),l={get duplicateConstruction(){return b.Resources._getWinJSString("ui/duplicateConstruction").value},get duplicateSection(){return b.Resources._getWinJSString("ui/duplicateSection").value},get invalidContent(){return b.Resources._getWinJSString("ui/invalidHubContent").value},get hubViewportAriaLabel(){return b.Resources._getWinJSString("ui/hubViewportAriaLabel").value}};return j})})}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{HubSection:b.Namespace._lazy(function(){var a={get duplicateConstruction(){return b.Resources._getWinJSString("ui/duplicateConstruction").value}};return b.Class.define(function(c,d){if(c=c||document.createElement("DIV"),d=d||{},c.winControl)throw new b.ErrorFromName("WinJS.UI.HubSection.DuplicateConstruction",a.duplicateConstruction);c.winControl=this,this._element=c,b.Utilities.addClass(this.element,b.UI.HubSection._ClassName.hubSection),b.Utilities.addClass(this.element,"win-disposable"),this._headerElement=document.createElement("DIV"),this._headerElement.className=b.UI.HubSection._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+b.UI.HubSection._ClassName.hubSectionInteractive+" "+b.UI.HubSection._ClassName.hubSectionHeaderTabStop+'"><h2 class="'+b.UI.HubSection._ClassName.hubSectionHeaderContent+" "+b.UI.HubSection._Constants.ellipsisTypeClassName+" "+b.UI.HubSection._Constants.xLargeTypeClassName+'"></h2><span class="'+b.UI.HubSection._ClassName.hubSectionHeaderChevron+" "+b.UI.HubSection._Constants.ellipsisTypeClassName+" "+b.UI.HubSection._Constants.xLargeTypeClassName+'"></span></button>',this._headerTabStopElement=this._headerElement.firstElementChild,this._headerContentElement=this._headerTabStopElement.firstElementChild,this._headerChevronElement=this._headerTabStopElement.lastElementChild,c.appendChild(this._headerElement),this._winKeyboard=new b.UI._WinKeyboard(this._headerElement),this._contentElement=document.createElement("DIV"),this._contentElement.className=b.UI.HubSection._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",c.appendChild(this._contentElement);for(var e=this.element.firstChild;e!==this._headerElement;){var f=e.nextSibling;this._contentElement.appendChild(e),e=f}this._processors=[b.UI.processAll],b.UI.setOptions(this,d)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(a){this._isHeaderStatic=a,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),b.Utilities.removeClass(this._headerTabStopElement,b.UI.HubSection._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),b.Utilities.addClass(this._headerTabStopElement,b.UI.HubSection._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(a){this._header=a,this._renderHeader()}},_setHeaderTemplate:function(a){this._template=b.Utilities._syncRenderer(a),this._renderHeader()},_renderHeader:function(){this._template&&(b.Utilities._disposeElement(this._headerContentElement),b.Utilities.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var a=this;return this._processed=(this._processors||[]).reduce(function(b,c){return b.then(function(){return c(a.contentElement)})},this._processed||b.Promise.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,b.Utilities._disposeElement(this._headerContentElement),b.Utilities.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},_Constants:{ellipsisTypeClassName:"win-type-ellipsis",xLargeTypeClassName:"win-type-x-large"},isDeclarativeControlContainer:b.Utilities.markSupportedForProcessing(function(a,c){c!==b.UI.processAll&&(a._processors=a._processors||[],a._processors.push(c),a._processed&&a._process())})})})})}(this,WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{_Overlay:a.Namespace._lazy(function(){function b(a){if(!a)return[];"string"!=typeof a&&a&&a.length||(a=[a]);var b,c=[];for(b=0;b<a.length;b++)if(a[b])if("string"==typeof a[b]){var d=document.getElementById(a[b]);d&&c.push(d)}else c.push(a[b].element?a[b].element:a[b]);return c}function c(a,b){var c=document.querySelectorAll("."+h);if(c)for(var d=c.length,e=0;d>e;e++){var f=c[e],g=f.winControl;g._disposed||g&&g[b](a)}}function d(){n._rightMouseMightEdgy||n._hideAllFlyouts()}var e=a.UI,f=a.Utilities,g=f._createEventProperty,h="win-overlay",i="win-hidefocus",j="beforeshow",k="aftershow",l="beforehide",m="afterhide",n=a.Class.define(function(a,b){this._baseOverlayConstructor(a,b)},{_baseOverlayConstructor:function(b,c){this._disposed=!1,b||(b=document.createElement("div"));var d=b.winControl;if(d)throw new a.ErrorFromName("WinJS.UI._Overlay.DuplicateConstruction",o.duplicateConstruction);this._element||(this._element=b),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,b.winControl=this,a.Utilities.addClass(this._element,h),a.Utilities.addClass(this._element,"win-disposable");var e=this._element.getAttribute("unselectable");(null===e||void 0===e)&&this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=a.Promise.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,c&&a.UI.setOptions(this,c)},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){a=!!a;var b=!!this._element.disabled;b!==a&&(this._element.disabled=a,!this.hidden&&this._element.disabled&&this._hideOrDismiss())}},onbeforeshow:g(j),onaftershow:g(k),onbeforehide:g(l),onafterhide:g(m),dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},show:function(){this._show()},_show:function(){this._baseShow()},hide:function(){this._hide()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext||this._fakeHide}},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_baseShow:function(){if(this._animating||this._keyboardShowing||this._keyboardHiding)return this._doNext="show",!1;if(this._currentDocumentWidth=this._currentDocumentWidth||document.documentElement.offsetWidth,"visible"!==this._element.style.visibility||this._fakeHide){this._element.winAnimating="showing",this._element.style.display="",this._fakeHide||(this._element.style.visibility="hidden"),this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._sendEvent(n.beforeShow),this._findPosition();var a=this;return this._animationPromise=this._currentAnimateIn().then(function(){a._baseEndShow()},function(){a._baseEndShow()}),this._fakeHide=!1,!0}return!1},_findPosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="",this._endShow(),"show"===this._doNext&&(this._doNext=""),this._sendEvent(n.afterShow),this._writeProfilerMark("show,StopTM"),a.Utilities.Scheduler.schedule(this._checkDoNext,a.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_endShow:function(){},_baseHide:function(){if(this._animating||this._keyboardShowing)return this._doNext="hide",!1;if(this._keyboardHiding&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(n.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var a=this;this._animationPromise=this._currentAnimateOut().then(function(){a._baseEndHide()},function(){a._baseEndHide()})}return!0}return this._fakeHide=!1,!1},_baseEndHide:function(){this._disposed||(this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._sendEvent(n.afterHide),this._writeProfilerMark("hide,StopTM"),a.Utilities.Scheduler.schedule(this._checkDoNext,a.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_checkDoNext:function(){this._animating||this._keyboardShowing||this._keyboardHiding||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",window.getComputedStyle(this._element,null).opacity,a.UI.Animation.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,window.getComputedStyle(this._element,null).opacity,a.UI.Animation.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(a,b){if(!this._disposed){var c=document.createEvent("CustomEvent");c.initEvent(a,!0,!0,b||{}),this._element.dispatchEvent(c)}},_showCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands(c.commands,[],b)},_hideCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands([],c.commands,b)},_showOnlyCommands:function(a,b){var c=this._resolveCommands(a);this._showAndHideCommands(c.commands,c.others,b)},_showAndHideCommands:function(a,b,c){c||this.hidden&&!this._animating?(this._showAndHideFast(a,b),this._removeFromQueue(a,this._queuedToShow),this._removeFromQueue(b,this._queuedToHide)):(this._updateAnimateQueue(a,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(b,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(a,b){var c;for(c=0;c<a.length;c++){var d;for(d=0;d<b.length;d++)if(b[d]===a[c]){b.splice(d,1);break}}},_updateAnimateQueue:function(b,c,d){if(!this._disposed){var e;for(e=0;e<b.length;e++){var f;for(f=0;f<c.length&&c[f]!==b[e];f++);for(f===c.length&&(c[f]=b[e]),f=0;f<d.length;f++)if(d[f]===b[e]){d.splice(f,1);break}}this._queuedCommandAnimation||(this._animating||a.Utilities.Scheduler.schedule(this._checkDoNext,a.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c],d&&d.style&&(d.style.visibility="",d.style.display="");for(c=0;c<b.length;c++)d=b[c],d&&d.style&&(d.style.visibility="hidden",d.style.display="none");this._contentChanged()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),a.Utilities.Scheduler.schedule(this._checkDoNext,a.Utilities.Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var b,c=this._queuedToShow,d=this._queuedToHide,e=this._findSiblings(c.concat(d));for(b=0;b<c.length;b++)c[b]&&c[b].style&&document.body.contains(c[b])?"hidden"!==c[b].style.visibility&&"0"!==c[b].style.opacity&&(e.push(c[b]),c.splice(b,1),b--):(c.splice(b,1),b--);for(b=0;b<d.length;b++)d[b]&&d[b].style&&document.body.contains(d[b])&&"hidden"!==d[b].style.visibility&&"0"!==d[b].style.opacity||(d.splice(b,1),b--);var f=this._baseBeginAnimateCommands(c,d,e),g=this;f?f.done(function(){g._baseEndAnimateCommands(d)},function(){g._baseEndAnimateCommands(d)}):a.Utilities.Scheduler.schedule(function(){g._baseEndAnimateCommands([])},a.Utilities.Scheduler.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(b,c,d){this._beginAnimateCommands(b,c,this._getVisibleCommands(d));var e=null,f=null;c.length>0&&(f=a.UI.Animation.createDeleteFromListAnimation(c,0===b.length?d:void 0)),b.length>0&&(e=a.UI.Animation.createAddToListAnimation(b,d));for(var g=0,h=c.length;h>g;g++){var i=c[g].getBoundingClientRect(),j=window.getComputedStyle(c[g]);c[g].style.top=i.top-parseFloat(j.marginTop)+"px",c[g].style.left=i.left-parseFloat(j.marginLeft)+"px",c[g].style.opacity=0,c[g].style.position="fixed"}this._element.winAnimating="rearranging";var k=null;for(f&&(k=f.execute()),g=0;g<b.length;g++)b[g].style.visibility="",b[g].style.display="",b[g].style.opacity=1;if(e){var l=e.execute();k=k?a.Promise.join([k,l]):l}return k},_beginAnimateCommands:function(){},_getVisibleCommands:function(a){var b,c=a,d=[];c||(c=this.element.querySelectorAll(".win-command"));for(var e=0,f=c.length;f>e;e++)b=c[e].winControl||c[e],b.hidden||d.push(b);return d},_baseEndAnimateCommands:function(a){if(!this._disposed){var b;for(b=0;b<a.length;b++)a[b].style.position="",a[b].getBoundingClientRect(),a[b].style.visibility="hidden",a[b].style.display="none",a[b].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(a){a=b(a);var c={};c.commands=[],c.others=[];var d,e,f=this.element.querySelectorAll(".win-command");for(d=0;d<f.length;d++){var g=!1;for(e=0;e<a.length;e++)if(a[e]===f[d]){c.commands.push(f[d]),a.splice(e,1),g=!0;break}g||c.others.push(f[d])}return c},_findSiblings:function(a){var b,c,d=[],e=this.element.querySelectorAll(".win-command");for(b=0;b<e.length;b++){var f=!1;for(c=0;c<a.length;c++)if(a[c]===e[b]){a.splice(c,1),f=!0;break}f||d.push(e[b])}return d},_baseResize:function(a){if(void 0!==this._currentDocumentWidth)if("hidden"===this._element.style.visibility)this._currentDocumentWidth=void 0;else{var b=document.documentElement.offsetWidth;this._currentDocumentWidth!==b&&(this._currentDocumentWidth=b,this._sticky||this._hideOrDismiss())}this._resize(a)},_hideOrDismiss:function(){var b=this._element;b&&a.Utilities.hasClass(b,"win-settingsflyout")?this._dismiss():this.hide()},_resize:function(){},_contentChanged:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(b,c){for(var d=b.children,e=new Array(d.length),f=0;f<d.length;f++){if(!a.Utilities.hasClass(d[f],"win-command")&&d[f].getAttribute("data-win-control")!==c)throw new a.ErrorFromName("WinJS.UI._Overlay.MustContainCommands",o.mustContainCommands);a.UI.processAll(d[f]),e[f]=d[f].winControl}return e},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||n._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var b=this._element.firstElementChild.tabIndex,c=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var d=a.Utilities._focusLastFocusableElement(this._element);return d&&n._trySelect(document.activeElement),this._element.firstElementChild.tabIndex=b,this._element.lastElementChild.tabIndex=c,d}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||n._trySetActive(this._element)},_focusOnFirstFocusableElement:function(){if(this._element.firstElementChild){var b=this._element.firstElementChild.tabIndex,c=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var d=a.Utilities._focusFirstFocusableElement(this._element);return d&&n._trySelect(document.activeElement),this._element.firstElementChild.tabIndex=b,this._element.lastElementChild.tabIndex=c,d}return!1},_addOverlayEventHandlers:function(b){if(!n._flyoutEdgeLightDismissEvent){window.addEventListener("blur",n._checkBlur,!1);var e=this;if(a.Utilities.hasWinRT){var f=Windows.UI.Input.EdgeGesture.getForCurrentView();f.addEventListener("starting",n._hideAllFlyouts),f.addEventListener("completed",d);var g=Windows.UI.ViewManagement.InputPane.getForCurrentView();g.addEventListener("showing",function(a){e._writeProfilerMark("_showingKeyboard,StartTM"),c(a,"_showingKeyboard"),e._writeProfilerMark("_showingKeyboard,StopTM")}),g.addEventListener("hiding",function(a){e._writeProfilerMark("_hidingKeyboard,StartTM"),c(a,"_hidingKeyboard"),e._writeProfilerMark("_hidingKeyboard,StopTM")}),document.addEventListener("scroll",function(a){e._writeProfilerMark("_checkScrollPosition,StartTM"),c(a,"_checkScrollPosition"),e._writeProfilerMark("_checkScrollPosition,StopTM")})}window.addEventListener("resize",function(a){e._writeProfilerMark("_baseResize,StartTM"),c(a,"_baseResize"),e._writeProfilerMark("_baseResize,StopTM")}),n._flyoutEdgeLightDismissEvent=!0}b&&this._handleEventsForFlyoutOrSettingsFlyout()},_handleEventsForFlyoutOrSettingsFlyout:function(){var b=this;a.Utilities._addEventListener(this._element,"focusout",function(a){n._hideIfLostFocus(b,a)},!1),a.Utilities._addEventListener(this._element,"pointerdown",n._checkRightClickDown,!0),a.Utilities._addEventListener(this._element,"pointerup",n._checkRightClickUp,!0)},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI._Overlay:"+this._id+":"+b)}});n._clickEatingAppBarDiv=!1,n._clickEatingFlyoutDiv=!1,n._flyoutEdgeLightDismissEvent=!1,n._hideFlyouts=function(a,b){for(var c=a.querySelectorAll(".win-flyout"),d=c.length,e=0;d>e;e++){var f=c[e];if("hidden"!==f.style.visibility){var g=f.winControl;!g||b&&g._sticky||g._hideOrDismiss()}}},n._hideSettingsFlyouts=function(a,b){for(var c=a.querySelectorAll(".win-settingsflyout"),d=c.length,e=0;d>e;e++){var f=c[e];if("hidden"!==f.style.visibility){var g=f.winControl;!g||b&&g._sticky||g._hideOrDismiss()}}},n._hideAllFlyouts=function(){n._hideFlyouts(document,!0),n._hideSettingsFlyouts(document,!0)},n._createClickEatingDivTemplate=function(b,c){var d=document.createElement("section");return a.Utilities.addClass(d,b),a.Utilities._addEventListener(d,"pointerdown",function(a){n._checkSameClickEatingPointerUp(a,!0)},!0),a.Utilities._addEventListener(d,"pointerup",function(a){n._checkClickEatingPointerDown(a,!0)},!0),d.addEventListener("click",c,!0),d.setAttribute("role","menuitem"),d.setAttribute("aria-label",o.closeOverlay),d.setAttribute("unselectable","on"),document.body.appendChild(d),d},n._createClickEatingDivAppBar=function(){n._clickEatingAppBarDiv||(n._clickEatingAppBarDiv=n._createClickEatingDivTemplate(n._clickEatingAppBarClass,n._handleAppBarClickEatingClick))},n._createClickEatingDivFlyout=function(){n._clickEatingFlyoutDiv||(n._clickEatingFlyoutDiv=n._createClickEatingDivTemplate(n._clickEatingFlyoutClass,n._handleFlyoutClickEatingClick))},n._checkClickEatingPointerDown=function(a,b){var c=a.currentTarget;if(c)try{c._winPointerId=a.pointerId,c._winRightMouse=2===a.button}catch(d){}b&&!c._winRightMouse&&(a.stopPropagation(),a.preventDefault())},n._checkSameClickEatingPointerUp=function(a,b){var c=!1,d=!1,e=a.currentTarget;try{e&&e._winPointerId===a.pointerId&&(c=!0,d=e._winRightMouse,d&&b&&(c=!1))}catch(f){}return b&&!d&&(a.stopPropagation(),a.preventDefault()),c},n._handleAppBarClickEatingClick=function(a){a.stopPropagation(),a.preventDefault(),e.AppBar._hideLightDismissAppBars(null,!1),n._hideClickEatingDivAppBar(),n._hideAllFlyouts()},n._handleFlyoutClickEatingClick=function(a){a.stopPropagation(),a.preventDefault(),n._hideClickEatingDivFlyout(),n._hideFlyouts(document,!0)},n._checkRightClickDown=function(a){n._checkClickEatingPointerDown(a,!1)},n._checkRightClickUp=function(b){n._checkSameClickEatingPointerUp(b,!1)&&(n._rightMouseMightEdgy=!0,a.Utilities._yieldForEvents(function(){n._rightMouseMightEdgy=!1}))},n._showClickEatingDivAppBar=function(){a.Utilities.Scheduler.schedule(function(){n._clickEatingAppBarDiv.style.display="block"},a.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivAppBar")},n._hideClickEatingDivAppBar=function(){a.Utilities.Scheduler.schedule(function(){n._clickEatingAppBarDiv.style.display="none"},a.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivAppBar")},n._showClickEatingDivFlyout=function(){a.Utilities.Scheduler.schedule(function(){n._clickEatingFlyoutDiv.style.display="block"},a.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._showClickEatingDivFlyout")},n._hideClickEatingDivFlyout=function(){a.Utilities.Scheduler.schedule(function(){n._clickEatingFlyoutDiv.style.display="none"},a.Utilities.Scheduler.Priority.high,null,"WinJS.UI._Overlay._hideClickEatingDivFlyout")},n._isFlyoutVisible=function(){return n._clickEatingFlyoutDiv?"block"===n._clickEatingFlyoutDiv.style.display:!1},n._hideIfLostFocus=function(b){if(!b.hidden&&"showing"!==b.element.winAnimating&&!b._sticky){var c=document.activeElement;if(!b._element||!b._element.contains(c)){if(a.Utilities.hasClass(b._element,"win-settingsflyout")){var d=b,e=n._getParentControlUsingClassName(c,"win-flyout");if(e&&e._previousFocus&&d.element.contains(e._previousFocus))return void a.Utilities._addEventListener(e.element,"focusout",function f(b){n._hideIfLostFocus(d,b),a.Utilities._removeEventListener(e.element,"focusout",f,!1)},!1)}c&&(a.Utilities.hasClass(c,n._clickEatingFlyoutClass)||a.Utilities.hasClass(c,n._clickEatingAppBarClass))||b._hideOrDismiss()}}},n._checkBlur=function(){if(document.hasFocus()){if(n._clickEatingFlyoutDiv&&"block"===n._clickEatingFlyoutDiv.style.display||n._clickEatingAppBarDiv&&"block"===n._clickEatingAppBarDiv.style.display){var a=document.activeElement;a&&"IFRAME"===a.tagName&&!a.msLightDismissBlur&&(a.addEventListener("blur",n._checkBlur,!1),a.msLightDismissBlur=!0)}}else n._hideAllFlyouts(),e.AppBar._hideLightDismissAppBars(null,!1)},n._trySetActive=function(b){return b&&document.body&&document.body.contains(b)&&a.Utilities._setActive(b)?b===document.activeElement:!1},n._trySelect=function(a){try{a&&a.select&&a.select()}catch(b){}},n._addHideFocusClass=function(b){b&&(a.Utilities.addClass(b,i),a.Utilities._addEventListener(b,"focusout",n._removeHideFocusClass,!1))
},n._removeHideFocusClass=function(b){var c=b.target;c&&c!==document.activeElement&&(a.Utilities.removeClass(c,i),a.Utilities._removeEventListener(b.target,"focusout",n._removeHideFocusClass,!1))},n._getParentControlUsingClassName=function(b,c){for(;b&&b!==document.body;){if(a.Utilities.hasClass(b,c))return b.winControl;b=b.parentNode}return null},n._keyboardInfo={get _visible(){try{return a.Utilities.hasWinRT&&Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(b){return!1}},get _extraOccluded(){var b;if(a.Utilities.hasWinRT)try{b=Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height}catch(c){}return b&&!n._keyboardInfo._isResized?b:0},get _isResized(){var a=document.documentElement.clientHeight/window.innerHeight,b=document.documentElement.clientWidth/window.innerWidth;return.99>b/a},get _visibleDocTop(){return window.pageYOffset-document.documentElement.scrollTop},get _visibleDocBottom(){return n._keyboardInfo._visibleDocTop+n._keyboardInfo._visibleDocHeight},get _visibleDocHeight(){return n._keyboardInfo._visualViewportHeight-n._keyboardInfo._extraOccluded},get _visualViewportHeight(){var a=n._keyboardInfo._visualViewportSpace;return a.bottom-a.top},get _visualViewportWidth(){var a=n._keyboardInfo._visualViewportSpace;return a.right-a.left},get _visualViewportSpace(){var a="win-visualviewport-space",b=document.body.querySelector("."+a);return b||(b=document.createElement("DIV"),b.className=a,document.body.appendChild(b)),b.getBoundingClientRect()},get _visibleDocBottomOffset(){return n._keyboardInfo._isResized?0:n._keyboardInfo._extraOccluded},get _animationShowLength(){if(!a.Utilities.hasWinRT)return 0;for(var b=Windows.UI.Core.AnimationMetrics,c=new b.AnimationDescription(b.AnimationEffect.showPanel,b.AnimationEffectTarget.primary),d=c.animations,e=0,f=0;f<d.size;f++){var g=d[f];e=Math.max(e,g.delay+g.duration)}return e}},n._clickEatingAppBarClass="win-appbarclickeater",n._clickEatingFlyoutClass="win-flyoutmenuclickeater",n._scrollTimeout=150,n.beforeShow=j,n.beforeHide=l,n.afterShow=k,n.afterHide=m,n.commonstrings={get cannotChangeCommandsWhenVisible(){return a.Resources._getWinJSString("ui/cannotChangeCommandsWhenVisible").value},get cannotChangeHiddenProperty(){return a.Resources._getWinJSString("ui/cannotChangeHiddenProperty").value}};var o={get duplicateConstruction(){return a.Resources._getWinJSString("ui/duplicateConstruction").value},get mustContainCommands(){return a.Resources._getWinJSString("ui/mustContainCommands").value},get closeOverlay(){return a.Resources._getWinJSString("ui/closeOverlay").value}};return a.Class.mix(n,a.UI.DOMEventMixin),n})})}(WinJS),function(a){"use strict";var b=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview"];a.Namespace.define("WinJS.UI.AppBarIcon",b.reduce(function(b,c){return b[c]={get:function(){return a.Resources._getWinJSString("ui/appBarIcons/"+c).value}},b},{}))}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{AppBarCommand:a.Namespace._lazy(function(){function b(a){var b=this.winControl;if(b){if(b._type===j)b.selected=!b.selected;else if(b._type===k&&b._flyout){var d=c._Overlay._getParentControlUsingClassName(this,"win-appbar"),e="top";d&&"top"===d.placement&&(e="bottom");var f=b._flyout;"string"==typeof f&&(f=document.getElementById(f)),f.show||(f=f.winControl),f&&f.show&&f.show(this,e)}b.onclick&&b.onclick(a)}}var c=a.UI,d="win-command",e="win-global",f="win-selection",g="win-reduced",h="separator",i="button",j="toggle",k="flyout",l="content",m="selection",n="global",o={get ariaLabel(){return a.Resources._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return a.Resources._getWinJSString("ui/duplicateConstruction").value},get badClick(){return a.Resources._getWinJSString("ui/badClick").value},get badDivElement(){return a.Resources._getWinJSString("ui/badDivElement").value},get badHrElement(){return a.Resources._getWinJSString("ui/badHrElement").value},get badButtonElement(){return a.Resources._getWinJSString("ui/badButtonElement").value}};return a.Class.define(function(e,f){if(e&&e.winControl)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.DuplicateConstruction",o.duplicateConstruction);if(this._disposed=!1,f||(f={}),f.type||(this._type=i),f.section=f.section||n,this._element=e,f.type===l?this._createContent():f.type===h?this._createSeparator():this._createButton(),a.Utilities.addClass(this._element,"win-disposable"),this._element.winControl=this,a.Utilities.addClass(this._element,d),f.onclick&&(this.onclick=f.onclick),f.onclick=b,a.UI.setOptions(this,f),this._type!==j||f.selected||(this.selected=!1),this._type!==h){var g=this;a.Utilities._addEventListener(this._element,"pointerdown",function(){c._Overlay._addHideFocusClass(g._element)},!1);var m=this._element.getAttribute("role");(null===m||""===m||void 0===m)&&(m=this._type===j?"menuitemcheckbox":this._type===l?"group":"menuitem",this._element.setAttribute("role",m),this._type===k&&this._element.setAttribute("aria-haspopup",!0));var p=this._element.getAttribute("aria-label");(null===p||""===p||void 0===p)&&this._element.setAttribute("aria-label",o.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(a){a&&!this._element.id&&(this._element.id=a)}},type:{get:function(){return this._type},set:function(a){this._type||(this._type=a!==l&&a!==k&&a!==j&&a!==h?i:a)}},label:{get:function(){return this._label},set:function(a){this._label=a,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(b){this._icon=a.UI.AppBarIcon[b]||b,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none"))}},onclick:{get:function(){return this._onclick},set:function(b){if(b&&"function"!=typeof b)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.BadClick",a.Resources._formatString(o.badClick,"AppBarCommand"));this._onclick=b}},flyout:{get:function(){var a=this._flyout;return"string"==typeof a&&(a=document.getElementById(a)),a&&!a.element&&(a=a.winControl),a},set:function(b){var c=b;c&&"string"!=typeof c&&(c.element&&(c=c.element),c&&(c.id?c=c.id:(c.id=a.Utilities._uniqueID(c),c=c.id))),"string"==typeof c&&this._element.setAttribute("aria-owns",c),this._flyout=b}},section:{get:function(){return this._section},set:function(a){(!this._section||window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled)&&this._setSection(a)}},tooltip:{get:function(){return this._tooltip},set:function(a){this._tooltip=a,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(a){this._element.setAttribute("aria-checked",a)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){this._element.disabled=a}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(b){var d=c._Overlay._getParentControlUsingClassName(this._element,"win-appbar");if(d&&!d.hidden)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.CannotChangeHiddenProperty",a.Resources._formatString(c._Overlay.commonstrings.cannotChangeHiddenProperty,"AppBar"));if(b!==this.hidden){var e=this._element.style;b?(e.visibility="hidden",e.display="none"):(e.visibility="",e.display="inline-block"),d&&d._contentChanged()}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(a){this._firstElementFocus=a===this.element?null:a,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(a){this._lastElementFocus=a===this.element?null:a,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===l&&a.Utilities.disposeSubTree(this.element))},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},extraClass:{get:function(){return this._extraClass},set:function(b){this._extraClass&&a.Utilities.removeClass(this._element,this._extraClass),this._extraClass=b,a.Utilities.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.BadDivElement",o.badDivElement)}else this._element=document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.BadHrElement",o.badHrElement)}else this._element=document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.AppBarCommand.BadButtonElement",o.badButtonElement);var b=this._element.getAttribute("type");(null===b||""===b||void 0===b)&&this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=document.createElement("button");this._element.type="button",this._iconSpan=document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon win-commandring",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new a.UI.Tooltip(this._element);var d=this;this._tooltipControl.addEventListener("beforeopen",function(){d._hideIfFullSize&&!c._Overlay._getParentControlUsingClassName(d._element.parentElement,g)&&d._tooltipControl.close()},!1)},_setSection:function(b){b||(b=n),this._section&&(this._section===n?a.Utilities.removeClass(this._element,e):this.section===m&&a.Utilities.removeClass(this._element,f)),this._section=b,b===n?a.Utilities.addClass(this._element,e):b===m&&a.Utilities.addClass(this._element,f)},_updateTabStop:function(){this.element.tabIndex=this._firstElementFocus||this._lastElementFocus?-1:0},_isFocusable:function(){return!this.hidden&&this._type!==h&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)}})})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{AppBar:a.Namespace._lazy(function(){function b(b){if(!u._Overlay._rightMouseMightEdgy||b.kind!==Windows.UI.Input.EdgeGestureKind.mouse)if(N)N=null;else{var c=b.kind===Windows.UI.Input.EdgeGestureKind.keyboard;a.UI.AppBar._toggleAppBarEdgy(c)}}function c(){N||(N=a.UI.AppBar._toggleAppBarEdgy(!1))}function d(){var a=f();"showing"===N?g(a,!1):"hiding"===N&&h(a,!1),N=null}function e(a){var b=document.querySelectorAll("."+x);if(b)for(var c=b.length,d=0;c>d;d++){var e=b[d],f=e.winControl;f&&!e.disabled&&f._manipulationChanged(a)}}function f(){var a=document.querySelectorAll("."+x),b=a.length,c=[];c._visible=!1,c._hidden=!1;for(var d=0;b>d;d++){var e=a[d];if(!e.disabled){var f=e.winControl;f&&(c.push(f),f._element.winAnimating?"hiding"===f._element.winAnimating?c._hidden=!0:c._visible=!0:"hidden"===f._element.style.visibility?c._hidden=!0:c._visible=!0)}}return c}function g(b,c){for(var d=b.length,e=new Array(d),f=0;d>f;f++)b[f]._keyboardInvoked=c,b[f].hide(),e[f]=b[f]._animationPromise;return a.Promise.join(e)}function h(b,c){for(var d=b.length,e=new Array(d),f=0;d>f;f++)b[f]._keyboardInvoked=c,b[f]._doNotFocus=!1,b[f]._show(),e[f]=b[f]._animationPromise;return a.Promise.join(e)}function i(a,b,c){for(var d=a;d>=0;d--)if(c[d].winControl&&c[d].winControl.placement===b&&!c[d].winControl.hidden&&c[d].winControl._focusOnLastFocusableElement&&c[d].winControl._focusOnLastFocusableElement())return!0;return!1}function j(a,b){for(var c=a;c>=0;c--)if(b[c].winControl&&b[c].winControl.placement!=F&&b[c].winControl.placement!=E&&!b[c].winControl.hidden&&b[c].winControl._focusOnLastFocusableElement&&b[c].winControl._focusOnLastFocusableElement())return!0;return!1}function k(){var a=document.querySelectorAll("."+x);if(a.length){for(var b=0,c=0;c<a.length;c++)if(a[c]===this.parentElement){b=c;break}var d=this.parentElement.winControl;if(d.placement===F){if(b&&i(b-1,F,a))return;if(j(a.length-1,a))return;if(i(a.length-1,E,a))return;if(i(a.length-1,F,a))return}else if(d.placement===E){if(b&&i(b-1,E,a))return;if(i(a.length-1,F,a))return;if(j(a.length-1,a))return;if(i(a.length-1,E,a))return}else{if(b&&j(b-1,a))return;if(i(a.length-1,E,a))return;if(i(a.length-1,F,a))return;if(j(a.length-1,a))return}}}function l(a,b,c){for(var d=a;d<c.length;d++)if(c[d].winControl&&c[d].winControl.placement===b&&!c[d].winControl.hidden&&c[d].winControl._focusOnFirstFocusableElement&&c[d].winControl._focusOnFirstFocusableElement())return!0;return!1}function m(a,b){for(var c=a;c<b.length;c++)if(b[c].winControl&&b[c].winControl.placement!=F&&b[c].winControl.placement!=E&&!b[c].winControl.hidden&&b[c].winControl._focusOnFirstFocusableElement&&b[c].winControl._focusOnFirstFocusableElement())return!0;return!1}function n(){for(var a=document.querySelectorAll("."+x),b=0,c=0;c<a.length;c++)if(a[c]===this.parentElement){b=c;break}this.parentElement.winControl;if(this.parentElement.winControl.placement===F){if(l(b+1,F,a))return;if(l(0,E,a))return;if(m(0,a))return;if(l(0,F,a))return}else if(this.parentElement.winControl.placement===E){if(l(b+1,E,a))return;if(m(0,a))return;if(l(0,F,a))return;if(l(0,E,a))return}else{if(m(b+1,a))return;if(l(0,F,a))return;if(l(0,E,a))return;if(m(0,a))return}}function o(){for(var a=document.querySelectorAll("."+x),b=0;b<a.length;b++)a[b].winControl&&!a[b].winControl.hidden&&a[b].winControl._updateFirstAndFinalDiv&&a[b].winControl._updateFirstAndFinalDiv()}function p(){for(var a=document.querySelectorAll("."+x),b=0;b<a.length;b++){var c=a[b].winControl;if(c&&!c.sticky&&(!c.hidden||"showing"===c._element.winAnimating))return!0}return!1}function q(){u.AppBar._isAppBarOrChild(document.activeElement)||(u.AppBar._hideLightDismissAppBars(null,!1),u.AppBar._ElementWithFocusPreviousToAppBar=null)}function r(a){a.relatedTarget&&a.relatedTarget.focus&&!u.AppBar._isAppBarOrChild(a.relatedTarget)&&s(a.relatedTarget)}function s(a){a&&(u.AppBar._ElementWithFocusPreviousToAppBar=a)}function t(){u._Overlay._trySetActive(u.AppBar._ElementWithFocusPreviousToAppBar)}var u=a.UI,v=a.Utilities.Key,w="win-commandlayout",x="win-appbar",y="win-reduced",z="win-settingsflyout",A="win-top",B="win-bottom",C="win-firstdiv",D="win-finaldiv",E="top",F="bottom",G="custom",H="commands",I="separator",J="content",K=60,L=100,M=!1,N=null,O={get ariaLabel(){return a.Resources._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return a.Resources._getWinJSString("ui/requiresCommands").value},get nullCommand(){return a.Resources._getWinJSString("ui/nullCommand").value},get cannotChangePlacementWhenVisible(){return a.Resources._getWinJSString("ui/cannotChangePlacementWhenVisible").value},get badLayout(){return a.Resources._getWinJSString("ui/badLayout").value},get cannotChangeLayoutWhenVisible(){return a.Resources._getWinJSString("ui/cannotChangeLayoutWhenVisible").value}},P=a.Class.derive(a.UI._Overlay,function(f,g){this._initializing=!0,g=g||{},this._element=f||document.createElement("div"),this._id=this._element.id||a.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),g.layout!==G&&!g.commands&&this._element&&(g=a.Utilities._shallowCopy(g),g.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.AppBarCommand")),this._baseOverlayConstructor(this._element,g),this._initializing=!1,u._Overlay._createClickEatingDivAppBar(),a.Utilities.addClass(this._element,x),g.layout!==G&&a.Utilities.addClass(this._element,w),g.placement||(this.placement=F);var h=this._element.getAttribute("role");h||this._element.setAttribute("role","menubar");var i=this._element.getAttribute("aria-label");if(i||this._element.setAttribute("aria-label",O.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),!M){if(a.Utilities.hasWinRT){var j=Windows.UI.Input.EdgeGesture.getForCurrentView();j.addEventListener("starting",c),j.addEventListener("completed",b),j.addEventListener("canceled",d)}document.addEventListener("MSManipulationStateChanged",e,!1),M=!0}return this._addOverlayEventHandlers(!1),a.Utilities._addEventListener(this._element,"focusin",function(a){r(a)},!1),a.Utilities._addEventListener(this._element,"focusout",function(){q()},!1),this.layout===H&&(this._element.style.display="none"),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(b){var c=!1;if(window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled&&!this.hidden&&(this._hide(),c=!0),!this.hidden)throw new a.ErrorFromName("WinJS.UI.AppBar.CannotChangePlacementWhenVisible",O.cannotChangePlacementWhenVisible);this._placement=b,this._placement===E?(a.Utilities.addClass(this._element,A),a.Utilities.removeClass(this._element,B)):this._placement===F?(a.Utilities.removeClass(this._element,A),a.Utilities.addClass(this._element,B)):(a.Utilities.removeClass(this._element,A),a.Utilities.removeClass(this._element,B)),this._assignAnimations(),c&&this._show()}},layout:{get:function(){return this._layout?this._layout:H},set:function(b){if(b!==H&&b!==G)throw new a.ErrorFromName("WinJS.UI.AppBar.BadLayout",O.badLayout);var c=!1;if(window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled&&!this.hidden&&(this._hide(),c=!0),!this.hidden)throw new a.ErrorFromName("WinJS.UI.AppBar.CannotChangeLayoutWhenVisible",O.cannotChangeLayoutWhenVisible);this._layout=b,this._layout===H?a.Utilities.addClass(this._element,w):a.Utilities.removeClass(this._element,w),c&&this._show()},configurable:!0},sticky:{get:function(){return this._sticky},set:function(a){this._sticky!==!!a&&(this._sticky=!!a,this.hidden||"visible"!==this._element.style.visibility||(o(),this._sticky?p()||u._Overlay._hideClickEatingDivAppBar():(u._Overlay._showClickEatingDivAppBar(),this._shouldStealFocus()&&(s(document.activeElement),this._setFocusToAppBar()))))}},commands:{set:function(b){if(!this.hidden)throw new a.ErrorFromName("WinJS.UI.AppBar.CannotChangeCommandsWhenVisible",a.Resources._formatString(u._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"AppBar"));this._initializing||this._disposeChildren(),a.Utilities.empty(this._element),Array.isArray(b)||(b=[b]);for(var c=b.length,d=0;c>d;d++)this._addCommand(b[d]);this._needToMeasure=!0,a.Utilities.Scheduler.schedule(this._layoutCommands,a.Utilities.Scheduler.Priority.idle,this,"WinJS.AppBar._layoutCommands")}},getCommandById:function(a){for(var b=this.element.querySelectorAll("#"+a),c=[],d=0,e=b.length;e>d;d++)b[d].winControl&&c.push(b[d].winControl);return 1===c.length?c[0]:0===c.length?null:c},showCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",O.requiresCommands);this._showCommands(b)},hideCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",O.requiresCommands);this._hideCommands(b)},showOnlyCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.AppBar.RequiresCommands",O.requiresCommands);this._showOnlyCommands(b)},show:function(){this._writeProfilerMark("show,StartTM"),this._keyboardInvoked=!1,this._doNotFocus=!!this.sticky,this._show()},_show:function(){if(!this.disabled){if(this._layoutCommands(),this._scaleAppBar(),this._keyboardObscured&&(this._fakeHide=!0,this._keyboardObscured=!1),this.sticky||u._Overlay._showClickEatingDivAppBar(),this._element.winAnimating)return this._doNext="show",!1;this._baseShow(),!this.sticky&&p()?o():this._updateFirstAndFinalDiv(),!this._doNotFocus&&this._shouldStealFocus()&&(u.AppBar._ElementWithFocusPreviousToAppBar||s(document.activeElement),this._setFocusToAppBar())}},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._keyboardObscured&&!this._animating?(this._keyboardObscured=!1,this._baseEndHide()):this._baseHide();var a,b=document.querySelectorAll("."+x),c=!1,d=!1;for(a=0;a<b.length;a++){var e=b[a].winControl;if(e&&!e.hidden&&e!==this&&(c=!0,!e.sticky)){d=!0;break}}var f=document.querySelectorAll("."+z),g=!1;for(a=0;a<f.length;a++){var h=f[a].winControl;if(h&&!h.hidden){g=!0;break}}d||g||u._Overlay._hideClickEatingDivAppBar();var i=this;if(c){if(u.AppBar._isWithinAppBarOrChild(document.activeElement,i.element)){var j=!1;for(a=0;a<=b.length;a++){a===b.length&&(a=0);var k=b[a];if(k===this.element)j=!0;else if(j&&!k.winControl.hidden){k.winControl._keyboardInvoked=!!this._keyboardInvoked,k.winControl._setFocusToAppBar();break}}}}else!u.AppBar._ElementWithFocusPreviousToAppBar||document.activeElement&&!u.AppBar._isAppBarOrChild(document.activeElement)||t(),u.AppBar._ElementWithFocusPreviousToAppBar=null;this.sticky||p()||o(),this._keyboardInvoked=!1,this._doNotFocus=!1},_dispose:function(){a.Utilities.disposeSubTree(this.element),this._hide()},_disposeChildren:function(){var b=this._element.querySelectorAll("."+C);b=b.length>=1?b[0]:null;var c=this._element.querySelectorAll("."+D);c=c.length>=1?c[0]:null;for(var d=this.element.children,e=d.length,f=0;e>f;f++){var g=d[f];g!==b&&g!==c&&(this.layout===H?g.winControl.dispose():a.Utilities.disposeSubTree(g))}},_handleKeyDown:function(b){if(b.keyCode===v.escape&&b.keyCode!==v.IME&&(b.preventDefault(),b.stopPropagation(),u._Overlay._hideAllFlyouts(),u.AppBar._hideLightDismissAppBars(null,!0)),this.layout===H&&!b.altKey){if(a.Utilities._matchesSelector(b.target,".win-interactive, .win-interactive *"))return;var c="rtl"===getComputedStyle(this._element).direction,d=c?v.rightArrow:v.leftArrow,e=c?v.leftArrow:v.rightArrow;if(b.keyCode===d||b.keyCode==e||b.keyCode===v.home||b.keyCode===v.end){var f,g=this._getFocusableCommandsInLogicalOrder();if(g.length)switch(b.keyCode){case d:var h=Math.max(-1,g.focusedIndex-1)+g.length;f=g[h%g.length].winControl.lastElementFocus;break;case e:var h=g.focusedIndex+1+g.length;f=g[h%g.length].winControl.firstElementFocus;break;case v.home:var h=0;f=g[h].winControl.firstElementFocus;break;case v.end:var h=g.length-1;f=g[h].winControl.lastElementFocus}f&&(f.focus(),b.preventDefault())}}},_getFocusableCommandsInLogicalOrder:function(){if(this.layout===H){for(var a=[],b=[],c=this._element.children,d=!1,e=-1,f=function(c,f,g){f?(b.push(c),g&&(e=b.length-1,d=!0)):(a.push(c),g&&(e=a.length-1))},g=1,h=c.length;h-1>g;g++){var i=c[g];if(i&&i.winControl){var j=i.contains(document.activeElement);if(i.winControl._isFocusable()||j){var k="global"===i.winControl.section;f(i,k,j)}}}var l=a.concat(b);return l.focusedIndex=d?e+a.length:e,l}},_assignAnimations:function(){this._placement===E||this._placement===F?(this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut):(this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut)},_animateSlideIn:function(){var b,c=this._element.offsetHeight;return this._checkPosition(),this._placement===E?(b={top:"-"+c+"px",left:"0px"},this._element.style.bottom="auto"):(b={top:c+"px",left:"0px"},this._element.style.top="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",a.UI.Animation.showEdgeUI(this._element,b,{mechanism:"transition"})},_animateSlideOut:function(){var b,c=this._element.offsetHeight;return this._placement===E?(b={top:"-"+c+"px",left:"0px"},this._element.style.top=this._getTopOfVisualViewport()+"px"):(b={top:c+"px",left:"0px"},this._element.style.bottom=this._getAdjustedBottom()+"px"),a.UI.Animation.hideEdgeUI(this._element,b,{mechanism:"transition"})},_isABottomAppBarInTheProcessOfShowing:function(){for(var a=document.querySelectorAll("."+x+"."+B),b=0;b<a.length;b++)if("showing"===a[b].winAnimating)return!0;return!1},_shouldStealFocus:function(){var a=u.AppBar._isAppBarOrChild(document.activeElement);if(this._element===a)return!1;if(this._placement===F)return!0;var b=this._isABottomAppBarInTheProcessOfShowing();return a?a.winControl&&(a.winControl._placement===F||a.winControl._placement===E||b)?!1:!0:!b},_setFocusToAppBar:function(){this._focusOnFirstFocusableElement()?this._keyboardInvoked||u._Overlay._addHideFocusClass(document.activeElement):u._Overlay._trySetActive(this._element)},_contentChanged:function(){this._updateCommandsWidth(),this._scaleAppBar()},_scaleAppBar:function(){if(this.layout===H){var b=this._getCommandsWidth();this._appBarTotalKnownWidth!==+this._appBarTotalKnownWidth&&(this._appBarTotalKnownWidth=this._scaleAppBarHelper()),b<=this._appBarTotalKnownWidth?a.Utilities.removeClass(this._element,y):a.Utilities.addClass(this._element,y)}},_scaleAppBarHelper:function(){return document.documentElement.clientWidth},_updateCommandsWidth:function(a){if(this.layout===H){var b=a;this._widthOfAllCommands=0,b||(b=this._getVisibleCommands()),this._widthOfAllCommands=this._getCommandsWidth(b)}},_getCommandsWidth:function(a){if(!a)return this._widthOfAllCommands;for(var b,c=0,d=0,e=0,f=0,g=a.length;g>f;f++)b=a[f].winControl||a[f],b._type===I?c++:b._type!==J?d++:e+=b._fullSizeWidth;return e+=c*K+d*L},_beginAnimateCommands:function(a,b,c){if(this.layout===H){this._scaleCommandsAfterAnimations=!1;var d=c.concat(a);this._updateCommandsWidth(d);var e=this._getCommandsWidth(a)-this._getCommandsWidth(b);e>0?this._scaleAppBar():0>e&&(this._scaleCommandsAfterAnimations=!0)}},_endAnimateCommands:function(){this._scaleCommandsAfterAnimations&&this._scaleAppBar()},_addCommand:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.AppBar.NullCommand",O.nullCommand);b._element||(b=new a.UI.AppBarCommand(null,b)),b._element.parentElement&&b._element.parentElement.removeChild(b._element),this._element.appendChild(b._element)},_measureContentCommands:function(){if(document.body.contains(this.element)){this._needToMeasure=!1;var b=a.Utilities.hasClass(this.element,y);a.Utilities.removeClass(this._element,y);var c,d=this.element.style.display;this.element.style.display="";for(var e,f=this._element.children,g=0,h=f.length;h>g;g++)e=f[g],e.winControl&&e.winControl._type===J&&(c=e.style.display,e.style.display="",e.winControl._fullSizeWidth=a.Utilities.getTotalWidth(e)||0,e.style.display=c);this.element.display=d,b&&a.Utilities.addClass(this._element,y)}},_layoutCommands:function(){this._needToMeasure&&this.layout===H&&(this._measureContentCommands(),this._contentChanged())},_getTopOfVisualViewport:function(){return 0},_getAdjustedBottom:function(){return u._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(a){if(this._keyboardObscured=!1,this._keyboardHiding=!1,!u._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._keyboardShowing=!0,!this.hidden&&this._element.contains(document.activeElement)&&(a.ensuredFocusedElementInView=!0),!this.hidden&&this._placement!==E&&u._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var b=this;setTimeout(function(a){b._checkKeyboardTimer(a)},u._Overlay._keyboardInfo._animationShowLength+u._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._keyboardShowing=!1,this._keyboardHiding=!0,u._Overlay._keyboardInfo._isResized||((!this.hidden||this._fakeHide||this._animating)&&(this._checkScrollPosition(),this._element.style.display="",this._fakeHide=!1),this._keyboardHiding=!1)},_resize:function(){this._keyboardShowing?this.hidden||this._placement===E||this._keyboardObscured||(this._element.style.display="none"):this._keyboardHiding&&(this._keyboardHiding=!1,(!this.hidden||this._animating)&&(this._checkScrollPosition(),this._element.style.display="",this._fakeHide=!1)),this._appBarTotalKnownWidth=null,this.hidden||this._scaleAppBar()},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(a){0===a.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){this._keyboardShowing&&(this._keyboardShowing=!1,this._keyboardObscured||this.hidden&&!this._fakeHide||this._placement===E&&0===u._Overlay._keyboardInfo._visibleDocTop?this._checkDoNext():(this._doNotFocus=!0,this._fakeHide=!0,this._show())),this._scrollHappened=!1},_checkPosition:function(){this._placement===F?this._element.style.bottom=this._getAdjustedBottom()+"px":this._placement===E&&(this._element.style.top=this._getTopOfVisualViewport()+"px")},_checkScrollPosition:function(){return this._keyboardShowing?void(this._scrollHappened=!0):void((!this.hidden||this._animating)&&(this._checkPosition(),this._checkDoNext()))},_alreadyInPlace:function(){if(this._placement===F){if(parseInt(this._element.style.bottom)===this._getAdjustedBottom())return!0}else if(this._placement===E&&parseInt(this._element.style.top)===this._getTopOfVisualViewport())return!0;return!1},_updateFirstAndFinalDiv:function(){var b=this._element.querySelectorAll("."+C);
b=b.length>=1?b[0]:null;var c=this._element.querySelectorAll("."+D);if(c=c.length>=1?c[0]:null,b&&this._element.children[0]!=b&&(b.parentNode.removeChild(b),b=null),c&&this._element.children[this._element.children.length-1]!=c&&(c.parentNode.removeChild(c),c=null),b||(b=document.createElement("div"),b.style.display="inline",b.className=C,b.tabIndex=-1,b.setAttribute("aria-hidden","true"),a.Utilities._addEventListener(b,"focusin",k,!1),this._element.children[0]?this._element.insertBefore(b,this._element.children[0]):this._element.appendChild(b)),c||(c=document.createElement("div"),c.style.display="inline",c.className=D,c.tabIndex=-1,c.setAttribute("aria-hidden","true"),a.Utilities._addEventListener(c,"focusin",n,!1),this._element.appendChild(c)),p()){var d=this._element.getElementsByTagName("*");b&&(b.tabIndex=a.Utilities._getLowestTabIndexInList(d)),c&&(c.tabIndex=a.Utilities._getHighestTabIndexInList(d))}else b&&(b.tabIndex=-1),c&&(c.tabIndex=-1)},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI.AppBar:"+this._id+":"+b)}});P._ElementWithFocusPreviousToAppBar=null,P._isAppBarOrChild=function(b){if(!b)return null;if(a.Utilities.hasClass(b,u._Overlay._clickEatingAppBarClass)||a.Utilities.hasClass(b,u._Overlay._clickEatingFlyoutClass)||a.Utilities.hasClass(b,C)||a.Utilities.hasClass(b,D))return b;for(;b&&b!==document;){if(a.Utilities.hasClass(b,x))return b;if(a.Utilities.hasClass(b,"win-flyout")&&b!=b.winControl._previousFocus){var c=b.winControl,d=u.AppBar._isAppBarOrChild(c._previousFocus);return d&&a.Utilities._addEventListener(c.element,"focusout",function e(){q(),a.Utilities._removeEventListener(c.element,"focusout",e,!1)},!1),d}b=b.parentNode}return null},P._isWithinAppBarOrChild=function(a,b){if(!a||!b)return!1;if(b.contains(a))return!0;var c=u._Overlay._getParentControlUsingClassName(a,"win-flyout");return c&&b.contains(c._previousFocus)},P._hideLightDismissAppBars=function(a,b){for(var c=document.querySelectorAll("."+x),d=c.length,e=[],f=0;d>f;f++){var h=c[f].winControl;!h||h.sticky||h.hidden||e.push(h)}g(e,b)};var Q=a.Promise.as();return P._toggleAppBarEdgy=function(a){var b=f();return b._visible&&!b._hidden?(Q=Q.then(function(){return g(b,a)}),"hiding"):(Q=Q.then(function(){return h(b,a)}),"showing")},P})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{Flyout:a.Namespace._lazy(function(){function b(a,b){return parseFloat(a,window.getComputedStyle(a,null)[b])}var c=a.UI,d=a.Utilities.Key,e="win-flyout",f="win-ui-light",g="win-menu",h="win-scrolls",i="win-finaldiv",j="win-firstdiv",k={get ariaLabel(){return a.Resources._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return a.Resources._getWinJSString("ui/noAnchor").value},get badPlacement(){return a.Resources._getWinJSString("ui/badPlacement").value},get badAlignment(){return a.Resources._getWinJSString("ui/badAlignment").value}},l=a.Class.derive(a.UI._Overlay,function(b,c){c=c||{},this._element=b||document.createElement("div"),this._id=this._element.id||a.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,c);var d=this._element.getElementsByTagName("*"),e=this._addFirstDiv();e.tabIndex=a.Utilities._getLowestTabIndexInList(d);var f=this._addFinalDiv();return f.tabIndex=a.Utilities._getHighestTabIndexInList(d),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(b,d){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(b,d),c._Overlay._createClickEatingDivFlyout(),this._element.style.visibilty="hidden",this._element.style.display="none",a.Utilities.addClass(this._element,e),a.Utilities.addClass(this._element,f);var h=this._element.getAttribute("role");(null===h||""===h||void 0===h)&&(a.Utilities.hasClass(this._element,g)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var i=this._element.getAttribute("aria-label");(null===i||""===i||void 0===i)&&this._element.setAttribute("aria-label",k.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,this._addOverlayEventHandlers(!0)},anchor:{get:function(){return this._anchor},set:function(a){this._anchor=a}},placement:{get:function(){return this._placement},set:function(b){if("top"!==b&&"bottom"!==b&&"left"!==b&&"right"!==b&&"auto"!==b)throw new a.ErrorFromName("WinJS.UI.Flyout.BadPlacement",k.badPlacement);this._placement=b}},alignment:{get:function(){return this._alignment},set:function(b){if("right"!==b&&"left"!==b&&"center"!==b)throw new a.ErrorFromName("WinJS.UI.Flyout.BadAlignment",k.badAlignment);this._alignment=b}},_dispose:function(){a.Utilities.disposeSubTree(this.element),this._hide(),this.anchor=null},show:function(a,b,c){this._writeProfilerMark("show,StartTM"),this._show(a,b,c)},_show:function(a,b,c){this._baseFlyoutShow(a,b,c)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._keyboardInvoked=!1,this._hide()},_hide:function(){if(this._baseHide()){var b=document.activeElement;if(this._previousFocus&&b&&(this._element.contains(b)||a.Utilities.hasClass(b,c._Overlay._clickEatingFlyoutClass))&&void 0!==this._previousFocus.focus){var d=c.AppBar._isAppBarOrChild(this._previousFocus);if(!d||d.winControl&&!d.winControl.hidden&&!d.winAnimating){var e=this._previousFocus.getAttribute("role"),f=c._Overlay._keyboardInfo._visible&&!this._keyboardWasUp;if(f&&this._previousFocus.setAttribute("role",""),this._keyboardInvoked?this._previousFocus.focus():c._Overlay._trySetActive(this._previousFocus),b=document.activeElement,f){var g=this._previousFocus;g&&a.Utilities._yieldForDomModification(function(){g.setAttribute("role",e)})}}!this._keyboardInvoked&&this._previousFocus===b&&d&&b&&c._Overlay._addHideFocusClass(b)}this._previousFocus=null,this._isThereVisibleFlyout()||c._Overlay._hideClickEatingDivFlyout()}},_baseFlyoutShow:function(b,d,e){if(!this.disabled){if(b||(b=this._anchor),d||(d=this._placement),e||(e=this._alignment),"string"==typeof b?b=document.getElementById(b):b&&b.element&&(b=b.element),b)this._currentAnchor=b,this._currentPlacement=d,this._currentAlignment=e;else{if(!this._retryLast)throw new a.ErrorFromName("WinJS.UI.Flyout.NoAnchor",k.noAnchor);this._retryLast=null}if(this._sticky||c._Overlay._showClickEatingDivFlyout(),this._element.winAnimating)return this._doNext="show",void(this._retryLast=!0);if(this._baseShow()){if(!a.Utilities.hasClass(this.element,"win-menu")){var f=this._element.getElementsByTagName("*"),g=this.element.querySelectorAll(".win-first");this.element.children.length&&!a.Utilities.hasClass(this.element.children[0],j)&&(g&&g.length>0&&g.item(0).parentNode.removeChild(g.item(0)),g=this._addFirstDiv()),g.tabIndex=a.Utilities._getLowestTabIndexInList(f);var h=this.element.querySelectorAll(".win-final");a.Utilities.hasClass(this.element.children[this.element.children.length-1],i)||(h&&h.length>0&&h.item(0).parentNode.removeChild(h.item(0)),h=this._addFinalDiv()),h.tabIndex=a.Utilities._getHighestTabIndexInList(f)}this._hideAllOtherFlyouts(this),this._previousFocus=document.activeElement}}},_endShow:function(){this._keyboardWasUp=c._Overlay._keyboardInfo._visible,a.Utilities.hasClass(this.element,"win-menu")?c._Overlay._trySetActive(this._element):(this._focusOnFirstFocusableElementOrThis(),c._Overlay._addHideFocusClass(document.activeElement))},_findPosition:function(){this._nextHeight=null,this._keyboardMovedUs=!1,this._hasScrolls=!1,this._keyboardSquishedUs=0,this._checkToggle&&this._checkToggle(),this._updateAdjustments(this._currentAlignment),this._getTopLeft(),this._scrollTop=this._nextTop,this._nextTop<0?(this._element.style.bottom="0px",this._element.style.top="auto"):(this._element.style.top=this._nextTop+"px",this._element.style.bottom="auto"),this._nextLeft<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._nextLeft+"px",this._element.style.right="auto"),null!==this._nextHeight&&(a.Utilities.addClass(this._element,h),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._nextHeight+"px",this._nextBottom=this._nextTop+this._nextHeight,this._hasScrolls=!0),c._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_getTopLeft:function(){var d=this._currentAnchor.getBoundingClientRect(),e={},f={};switch(f.top=d.top,f.bottom=d.bottom,f.left=d.left,f.right=d.right,f.height=f.bottom-f.top,f.width=f.right-f.left,e.marginTop=b(this._element,"marginTop"),e.marginBottom=b(this._element,"marginBottom"),e.marginLeft=b(this._element,"marginLeft"),e.marginRight=b(this._element,"marginRight"),e.width=a.Utilities.getTotalWidth(this._element),e.height=a.Utilities.getTotalHeight(this._element),e.innerWidth=a.Utilities.getContentWidth(this._element),e.innerHeight=a.Utilities.getContentHeight(this._element),this._nextMarginPadding=e.height-e.innerHeight,this._currentPlacement){case"top":this._fitTop(f,e)||(this._nextTop=0,this._nextHeight=f.top-this._nextMarginPadding),this._centerHorizontally(f,e,this._currentAlignment);break;case"bottom":this._fitBottom(f,e)||(this._nextTop=-1,this._nextHeight=c._Overlay._keyboardInfo._visibleDocHeight-f.bottom-this._nextMarginPadding),this._centerHorizontally(f,e,this._currentAlignment);break;case"left":this._fitLeft(f,e)||(this._nextLeft=0),this._centerVertically(f,e);break;case"right":this._fitRight(f,e)||(this._nextLeft=-1),this._centerVertically(f,e);break;case"auto":this._sometimesFitsAbove(f,e)?(this._fitTop(f,e)||this._fitBottom(f,e),this._centerHorizontally(f,e,this._currentAlignment)):this._fitLeft(f,e)||this._fitRight(f,e)?this._centerVertically(f,e):(this._topHasMoreRoom(f)?(this._nextTop=0,this._nextHeight=f.top-this._nextMarginPadding):(this._nextTop=-1,this._nextHeight=c._Overlay._keyboardInfo._visibleDocHeight-f.bottom-this._nextMarginPadding),this._centerHorizontally(f,e,this._currentAlignment));break;default:throw new a.ErrorFromName("WinJS.UI.Flyout.BadPlacement",k.badPlacement)}this._nextBottom=this._nextTop+e.height},_sometimesFitsAbove:function(a,b){return(c._Overlay._keyboardInfo._visibleDocHeight-a.height)/2>=b.height},_topHasMoreRoom:function(a){return a.top>c._Overlay._keyboardInfo._visibleDocHeight-a.bottom},_fitTop:function(a,b){return this._nextTop=a.top-b.height,this._nextAnimOffset={top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},this._nextTop>=0&&this._nextTop+b.height<=c._Overlay._keyboardInfo._visibleDocBottom},_fitBottom:function(a,b){return this._nextTop=a.bottom,this._nextAnimOffset={top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},this._nextTop>=0&&this._nextTop+b.height<=c._Overlay._keyboardInfo._visibleDocBottom},_fitLeft:function(a,b){return this._nextLeft=a.left-b.width,this._nextAnimOffset={top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},this._nextLeft>=0&&this._nextLeft+b.width<=c._Overlay._keyboardInfo._visualViewportWidth},_fitRight:function(a,b){return this._nextLeft=a.right,this._nextAnimOffset={top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"},this._nextLeft>=0&&this._nextLeft+b.width<=c._Overlay._keyboardInfo._visualViewportWidth},_centerVertically:function(a,b){this._nextTop=a.top+a.height/2-b.height/2,this._nextTop<0?this._nextTop=0:this._nextTop+b.height>=c._Overlay._keyboardInfo._visibleDocBottom&&(this._nextTop=-1)},_centerHorizontally:function(b,c,d){if("center"===d)this._nextLeft=b.left+b.width/2-c.width/2;else if("left"===d)this._nextLeft=b.left;else{if("right"!==d)throw new a.ErrorFromName("WinJS.UI.Flyout.BadAlignment",k.badAlignment);this._nextLeft=b.right-c.width}this._nextLeft<0?this._nextLeft=0:this._nextLeft+c.width>=document.documentElement.clientWidth&&(this._nextLeft=-1)},_updateAdjustments:function(b){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",a.Utilities.removeClass(this._element,h),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),"center"===b?(a.Utilities.removeClass(this._element,"win-leftalign"),a.Utilities.removeClass(this._element,"win-rightalign")):"left"===b?(a.Utilities.addClass(this._element,"win-leftalign"),a.Utilities.removeClass(this._element,"win-rightalign")):"right"===b&&(a.Utilities.addClass(this._element,"win-rightalign"),a.Utilities.removeClass(this._element,"win-leftalign"))},_showingKeyboard:function(a){if(!this.hidden&&(a.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var b=this;setTimeout(function(){b._adjustForKeyboard(),b._baseAnimateIn()},c._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._keyboardHiding){var b=this;a.Utilities._setImmediate(function(){b._findPosition()}),this._keyboardHiding=!1}},_checkKeyboardFit:function(){var b=a.Utilities.getTotalHeight(this._element),d=c._Overlay._keyboardInfo._visibleDocHeight-this._nextMarginPadding;b>d?(this._keyboardMovedUs=!0,this._scrollTop=0,this._keyboardSquishedUs=d):-1===this._nextTop?this._keyboardMovedUs=!0:this._nextTop<0?(this._scrollTop=0,this._keyboardMovedUs=!0):this._nextBottom>c._Overlay._keyboardInfo._visibleDocBottom&&(this._scrollTop=-1,this._keyboardMovedUs=!0)},_adjustForKeyboard:function(){this._keyboardSquishedUs&&(this._hasScrolls||(a.Utilities.addClass(this._element,h),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._keyboardSquishedUs+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(c._Overlay._keyboardInfo._isResized)this._keyboardHiding=!0;else{var b=this;a.Utilities._setImmediate(function(){b._findPosition()})}},_checkScrollPosition:function(a){(!this.hidden||a)&&(this._scrollTop<0?(this._element.style.bottom=c._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top="0px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",a.UI.Animation.showPopup(this._element,this._nextAnimOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,a.UI.Animation.hidePopup(this._element,this._nextAnimOffset))},_hideAllOtherFlyouts:function(a){for(var b=document.querySelectorAll(".win-flyout"),c=0;c<b.length;c++){var d=b[c].winControl;d&&!d.hidden&&d!==a&&d.hide()}},_isThereVisibleFlyout:function(){for(var a=document.querySelectorAll(".win-flyout"),b=0;b<a.length;b++){var c=a[b].winControl;if(c&&!c.hidden)return!0}return!1},_handleKeyDown:function(a){a.keyCode===d.escape&&a.keyCode!==d.IME?(a.preventDefault(),a.stopPropagation(),this.winControl._keyboardInvoked=!0,this.winControl._hide()):a.keyCode!==d.space&&a.keyCode!==d.enter||this!==document.activeElement?!a.shiftKey||a.keyCode!==d.tab||this!==document.activeElement||a.altKey||a.ctrlKey||a.metaKey||(a.preventDefault(),a.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(a.preventDefault(),a.stopPropagation(),this.winControl.hide())},_addFirstDiv:function(){var b=document.createElement("div");b.className=j,b.style.display="inline",b.setAttribute("role","menuitem"),b.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(b,this._element.children[0]):this._element.appendChild(b);var c=this;return a.Utilities._addEventListener(b,"focusin",function(){c._focusOnLastFocusableElementOrThis()},!1),b},_addFinalDiv:function(){var b=document.createElement("div");b.className=i,b.style.display="inline",b.setAttribute("role","menuitem"),b.setAttribute("aria-hidden","true"),this._element.appendChild(b);var c=this;return a.Utilities._addEventListener(b,"focusin",function(){c._focusOnFirstFocusableElementOrThis()},!1),b},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI.Flyout:"+this._id+":"+b)}});return l})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{Menu:a.Namespace._lazy(function(){var b=a.UI,c=a.Utilities.Key,d="win-menu",e="win-menu-toggle",f={get ariaLabel(){return a.Resources._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return a.Resources._getWinJSString("ui/requiresCommands").value},get nullCommand(){return a.Resources._getWinJSString("ui/nullCommand").value}},g=a.Class.derive(a.UI.Flyout,function(b,c){c=c||{},this._element=b||document.createElement("div"),this._id=this._element.id||a.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!c.commands&&this._element&&(c=a.Utilities._shallowCopy(c),c.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var e=this._element?this._element.getAttribute("role"):null,g=this._element?this._element.getAttribute("aria-label"):null;this._baseFlyoutConstructor(this._element,c),(null===e||""===e||void 0===e)&&this._element.setAttribute("role","menu"),(null===g||""===g||void 0===g)&&this._element.setAttribute("aria-label",f.ariaLabel),this._element.addEventListener("keydown",this._handleKeyDown,!0),a.Utilities.addClass(this._element,d),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(c){if(!this.hidden)throw new a.ErrorFromName("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",a.Resources._formatString(b._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));a.Utilities.empty(this._element),Array.isArray(c)||(c=[c]);for(var d=c.length,e=0;d>e;e++)this._addCommand(c[e])}},getCommandById:function(a){for(var b=this.element.querySelectorAll("#"+a),c=[],d=0,e=b.length;e>d;d++)b[d].winControl&&c.push(b[d].winControl);return 1===c.length?c[0]:0===c.length?null:c},showCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.Menu.RequiresCommands",f.requiresCommands);this._showCommands(b,!0)},hideCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.Menu.RequiresCommands",f.requiresCommands);this._hideCommands(b,!0)},showOnlyCommands:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.Menu.RequiresCommands",f.requiresCommands);this._showOnlyCommands(b,!0)},show:function(a,b,c){this._writeProfilerMark("show,StartTM"),this._show(a,b,c)},_show:function(a,b,c){this._checkForFlyoutCommands(),this._baseFlyoutShow(a,b,c)},_addCommand:function(b){if(!b)throw new a.ErrorFromName("WinJS.UI.Menu.NullCommand",f.nullCommand);b._element||(b=new a.UI.MenuCommand(null,b)),b._element.parentElement&&b._element.parentElement.removeChild(b._element),this._element.appendChild(b._element)},_checkToggle:function(){var b=this._element.querySelectorAll(".win-command[aria-checked]"),c=!1;if(b)for(var d=0;d<b.length;d++)if(b[d]&&b[d].winControl&&!b[d].winControl.hidden){c=!0;break}c?a.Utilities.addClass(this._element,e):a.Utilities.removeClass(this._element,e)},_checkForFlyoutCommands:function(){for(var a=this._element.querySelectorAll(".win-command"),b=0;b<a.length;b++)a[b].winControl&&(a[b].winControl._parentFlyout=this)},_handleKeyDown:function(a){if(a.keyCode===c.escape)this.winControl._keyboardInvoked=!0,this.winControl._hide();else if(a.keyCode!==c.space&&a.keyCode!==c.enter||this!==document.activeElement)if(a.keyCode===c.upArrow){var d=this;b.Menu._focusOnPreviousElement(d),a.preventDefault()}else a.keyCode===c.downArrow?(d=this,b.Menu._focusOnNextElement(d),a.preventDefault()):a.keyCode===c.tab&&a.preventDefault();else a.preventDefault(),this.winControl.hide()},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI.Menu:"+this._id+":"+b)}});return g._focusOnNextElement=function(a){var b=document.activeElement;do b=b===a?b.firstElementChild:b.nextElementSibling,b?b.focus():b=a;while(b!==document.activeElement)},g._focusOnPreviousElement=function(a){var b=document.activeElement;do b=b===a?b.lastElementChild:b.previousElementSibling,b?b.focus():b=a;while(b!==document.activeElement)},g})})}(WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{MenuCommand:a.Namespace._lazy(function(){function b(a){var b=this.winControl;if(b){var c=!0;if(b._type===k)b.selected=!b.selected;else if(b._type===l&&b._flyout){var d=b._flyout;"string"==typeof d&&(d=document.getElementById(d)),d.show||(d=d.winControl),d&&d.show&&(b._parentFlyout?(c=!1,d.show(b._parentFlyout._currentAnchor,b._parentFlyout._currentPlacement,b._parentFlyout._currentAlignment)):d.show(this))}b.onclick&&b.onclick(a),c&&b._parentFlyout&&b._parentFlyout.hide()}}function c(){this&&this.focus&&(this.focus(),this.addEventListener("mousemove",d,!1))}function d(){this&&this.focus&&this!==document.activeElement&&this.focus()}function e(){var b=this,c=f(b);c&&this===document.activeElement&&a.Utilities.hasClass(c,"win-menu")&&c.focus?c.focus():c&&this===document.activeElement&&c.children&&c.children.length>0&&c.children[0]&&a.Utilities.hasClass(c.children[0],"win-firstdiv")&&c.children[0].focus&&c.children[0].focus(),this.removeEventListener("mousemove",d,!1)}function f(b){for(;b&&!a.Utilities.hasClass(b,"win-flyout");)b=b.parentElement;return b}var g=a.UI,h="win-command",i="separator",j="button",k="toggle",l="flyout",m={get ariaLabel(){return a.Resources._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return a.Resources._getWinJSString("ui/duplicateConstruction").value},get badClick(){return a.Resources._getWinJSString("ui/badClick").value},get badHrElement(){return a.Resources._getWinJSString("ui/badHrElement").value},get badButtonElement(){return a.Resources._getWinJSString("ui/badButtonElement").value}};return a.Class.define(function(d,f){if(d&&d.winControl)throw new a.ErrorFromName("WinJS.UI.MenuCommand.DuplicateConstruction",m.duplicateConstruction);if(this._disposed=!1,f||(f={}),f.type||(this._type=j),this._element=d,f.type===i?this._createSeparator():this._createButton(),a.Utilities.addClass(this._element,"win-disposable"),this._element.winControl=this,a.Utilities.addClass(this._element,h),f.selected||f.type!==k||(this.selected=!1),f.onclick&&(this.onclick=f.onclick),f.onclick=b,a.UI.setOptions(this,f),this._type!==i){var g=this._element.getAttribute("role");(null===g||""===g||void 0===g)&&(g="menuitem",this._type===k&&(g="menuitemcheckbox"),this._element.setAttribute("role",g),this._type===l&&this._element.setAttribute("aria-haspopup",!0));var n=this._element.getAttribute("aria-label");(null===n||""===n||void 0===n)&&this._element.setAttribute("aria-label",m.ariaLabel)}this._element.addEventListener("mouseover",c,!1),this._element.addEventListener("mouseout",e,!1)},{id:{get:function(){return this._element.id},set:function(a){this._element.id||(this._element.id=a)}},type:{get:function(){return this._type},set:function(a){this._type||(this._type=a!==j&&a!==l&&a!==k&&a!==i?j:a)}},label:{get:function(){return this._label},set:function(a){this._label=a,this._element.textContent=this.label,this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(b){if(b&&"function"!=typeof b)throw new a.ErrorFromName("WinJS.UI.MenuCommand.BadClick",a.Resources._formatString(m.badClick,"MenuCommand"));this._onclick=b}},flyout:{get:function(){var a=this._flyout;return"string"==typeof a&&(a=document.getElementById(a)),a&&!a.element&&(a=a.winControl),a},set:function(b){var c=b;c&&"string"!=typeof c&&(c.element&&(c=c.element),c&&(c.id?c=c.id:(c.id=a.Utilities._uniqueID(c),c=c.id))),"string"==typeof c&&this._element.setAttribute("aria-owns",c),this._flyout=b}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(a){this._element.setAttribute("aria-checked",!!a)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(a){this._element.disabled=!!a}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(b){var c=g._Overlay._getParentControlUsingClassName(this._element,"win-menu");if(c&&!c.hidden)throw new a.ErrorFromName("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",a.Resources._formatString(g._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var d=this._element.style;b?(d.visibility="hidden",d.display="none"):(d.visibility="",d.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(b){this._extraClass&&a.Utilities.removeClass(this._element,this._extraClass),this._extraClass=b,a.Utilities.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0,this._flyout&&this._flyout.dispose())},addEventListener:function(a,b,c){return this._element.addEventListener(a,b,c)},removeEventListener:function(a,b,c){return this._element.removeEventListener(a,b,c)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.MenuCommand.BadHrElement",m.badHrElement)}else this._element=document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new a.ErrorFromName("WinJS.UI.MenuCommand.BadButtonElement",m.badButtonElement);this._element.innerHTML=""}else this._element=document.createElement("button");this._element.type="button"}})})})}(WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{SearchBox:WinJS.Namespace._lazy(function(){var a=WinJS.Utilities,b=WinJS.Utilities._createEventProperty,c=a.Key,d={searchBox:"win-searchbox",searchBoxInput:"win-searchbox-input",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxSuggestionSelected:"win-searchbox-suggestion-selected",searchBoxFlyoutHighlightText:"win-searchbox-flyout-highlighttext",searchBoxButtonInputFocus:"win-searchbox-button-input-focus",searchBoxInputFocus:"win-searchbox-input-focus",searchBoxSuggestionResultText:"win-searchbox-suggestion-result-text",searchBoxSuggestionResultDetailedText:"win-searchbox-suggestion-result-detailed-text",searchboxDisabled:"win-searchbox-disabled",searchboxHitHighlightSpan:"win-searchbox-hithighlight-span"},e={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested",receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},f={Query:0,Result:1,Separator:2},g={get duplicateConstruction(){return WinJS.Resources._getWinJSString("ui/duplicateConstruction").value},get invalidSearchBoxSuggestionKind(){return WinJS.Resources._getWinJSString("ui/invalidSearchBoxSuggestionKind").value},get ariaLabel(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value},get ariaLabelButton(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelButton").value},get ariaLabelQuery(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelQuery").value},get ariaLabelSeparator(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelSeparator").value},get ariaLabelResult(){return WinJS.Resources._getWinJSString("ui/searchBoxAriaLabelResult").value}},h=WinJS.Class.define(function(a,b){if(a=a||document.createElement("div"),a.winControl)throw new WinJS.ErrorFromName("WinJS.UI.SearchBox.DuplicateConstruction",g.duplicateConstruction);a.winControl=this,this._domElement=null,this._inputElement=null,this._buttonElement=null,this._flyout=null,this._flyoutDivElement=null,this._repeaterDivElement=null,this._repeater=null,this._disposed=!1,this._focusOnKeyboardInput=!1,this._chooseSuggestionOnEnter=!1,this._lastKeyPressLanguage="",this._prevQueryText="",this._prevLinguisticDetails=this._createSearchQueryLinguisticDetails([],0,0,"",""),this._prevCompositionStart=0,this._prevCompositionLength=0,this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1,this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._suggestionRendererBind=this._suggestionRenderer.bind(this),this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._suggestionsRequestedHandlerBind=this._suggestionsRequestedHandler.bind(this),this._suggestionsChangedHandlerBind=this._suggestionsChangedHandler.bind(this),this._searchSuggestionManager=null,this._searchSuggestions=null,window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.Search&&Windows.ApplicationModel.Search.Core&&Windows.ApplicationModel.Search.Core.SearchSuggestionManager&&(this._searchSuggestionManager=new Windows.ApplicationModel.Search.Core.SearchSuggestionManager,this._searchSuggestions=this._searchSuggestionManager.suggestions),this._hitFinder=null,this._setElement(a),WinJS.UI.setOptions(this,b),this._setAccessibilityProperties(),WinJS.Utilities.addClass(a,"win-disposable")},{element:{get:function(){return this._domElement}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(a){this._inputElement.placeholder=a,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(a){this._inputElement.value=a}},searchHistoryDisabled:{get:function(){return this._searchSuggestionManager?!this._searchSuggestionManager.searchHistoryEnabled:!0},set:function(a){this._searchSuggestionManager&&(this._searchSuggestionManager.searchHistoryEnabled=!a)}},searchHistoryContext:{get:function(){return this._searchSuggestionManager?this._searchSuggestionManager.searchHistoryContext:""},set:function(a){this._searchSuggestionManager&&(this._searchSuggestionManager.searchHistoryContext=a)}},focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(a){this._focusOnKeyboardInput&&!a?this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&a&&this._searchSuggestionManager&&this._searchSuggestionManager.addEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._focusOnKeyboardInput=!!a}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(a){this._chooseSuggestionOnEnter=!!a,this._updateSearchButtonClass()}},disabled:{get:function(){return this._inputElement.disabled},set:function(b){this._inputElement.disabled!==!!b&&(b?(this._isFlyoutShown&&this._hideFlyout(),a.addClass(this.element,d.searchboxDisabled),this._inputElement.disabled=!0,this._buttonElement.disabled=!0,this._domElement.disabled=!0):(this._inputElement.disabled=!1,this._buttonElement.disabled=!1,this._domElement.disabled=!1,a.removeClass(this.element,d.searchboxDisabled),document.activeElement===this.element&&WinJS.Utilities._setActive(this._inputElement)))}},setLocalContentSuggestionSettings:function(a){this._searchSuggestionManager&&this._searchSuggestionManager.setLocalContentSuggestionSettings(a)},dispose:function(){this._disposed||(this._flyoutOpenPromise&&this._flyoutOpenPromise.cancel(),this._focusOnKeyboardInput&&this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._searchSuggestions&&this._searchSuggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandlerBind),this._searchSuggestionManager&&this._searchSuggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandlerBind),this._searchSuggestionManager=null,this._searchSuggestions=null,this._hitFinder=null,this._disposed=!0)
},onquerychanged:b(e.querychanged),onquerysubmitted:b(e.querysubmitted),onresultsuggestionchosen:b(e.resultsuggestionchosen),onsuggestionsrequested:b(e.suggestionsrequested),_isFlyoutShown:function(){return"none"!==this._flyoutDivElement.style.display},_isFlyoutBelow:function(){return this._flyoutDivElement.getBoundingClientRect().top>this._inputElement.getBoundingClientRect().top?!0:!1},_getFlyoutTop:function(){if(this._isFlyoutBelow())return this._inputElement.getBoundingClientRect().bottom;var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;return this._inputElement.getBoundingClientRect().top-a},_getFlyoutBottom:function(){if(this._isFlyoutBelow()){var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;return this._inputElement.getBoundingClientRect().bottom+a}return this._inputElement.getBoundingClientRect().top},_updateFlyoutTopAndTouchAction:function(){var a=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;this._isFlyoutBelow()||(this._flyoutDivElement.style.top="-"+a+"px"),this._flyoutDivElement.style.touchAction=this._flyoutDivElement.scrollHeight>a?"pan-y":"none"},_showFlyout:function(){if(!this._isFlyoutShown()&&0!==this._suggestionsData.length){this._flyoutDivElement.style.display="block";var a=this._flyoutDivElement.clientHeight;a<WinJS.UI.SearchBox._Constants.MIN_POPUP_HEIGHT&&(a=WinJS.UI.SearchBox._Constants.MIN_POPUP_HEIGHT);var b=this._flyoutDivElement.getBoundingClientRect(),c=this.element.getBoundingClientRect(),d=b.bottom-b.top,e=b.right-b.left,f=c.right-c.left,g=document.documentElement.clientHeight,h=document.documentElement.clientWidth,i=this.element.clientHeight,j=this.element.clientLeft,k=!0;c.bottom+a<=g?this._flyoutDivElement.style.top=i+"px":c.top-a>=0?(this._flyoutDivElement.style.top="-"+d+"px",k=!1):this._flyoutDivElement.style.top=i+"px";var l;l="rtl"===window.getComputedStyle(this._flyoutDivElement).direction?c.right-e>=0||c.left+e>h:c.left+e>h&&c.right-e>=0,this._flyoutDivElement.style.left=l?f-e-j+"px":"-"+j+"px",this._flyoutDivElement.style.touchAction=this._flyoutDivElement.scrollHeight>d?"pan-y":"none",this._addFlyoutIMEPaddingIfRequired(),this._flyoutOpenPromise&&(this._flyoutOpenPromise.cancel(),this._flyoutOpenPromise=null);var m=k?"WinJS-flyoutBelowSearchBox-showPopup":"WinJS-flyoutAboveSearchBox-showPopup";this._flyoutOpenPromise=WinJS.UI.Animation.showPopup(this._flyoutDivElement,{top:"0px",left:"0px",keyframe:m})}},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutDivElement.style.display="none",this._updateSearchButtonClass())},_addNewSpan:function(b,c,e){var f=document.createElement("span");return f.textContent=c,f.setAttribute("aria-hidden","true"),a.addClass(f,d.searchboxHitHighlightSpan),b.insertBefore(f,e),f},_addHitHighlightedText:function(b,c,e){if(e){a.query("."+d.searchboxHitHighlightSpan,b).forEach(function(a){a.parentNode.removeChild(a)});var g=b.firstChild,h=c.hits;h||null===this._hitFinder||c.kind===f.Separator||(h=this._hitFinder.find(e));for(var i=WinJS.UI.SearchBox._sortAndMergeHits(h),j=0,k=0;k<i.length;k++){var l=i[k];this._addNewSpan(b,e.substring(j,l.startPosition),g),j=l.startPosition+l.length;var m=this._addNewSpan(b,e.substring(l.startPosition,j),g);a.addClass(m,d.searchBoxFlyoutHighlightText)}j<e.length&&this._addNewSpan(b,e.substring(j),g)}},_findSuggestionElementIndex:function(a){if(a)for(var b=0;b<this._suggestionsData.length;b++)if(this._repeater.elementFromIndex(b)===a)return b;return-1},_isSuggestionSelectable:function(a){return a.kind===f.Query||a.kind===f.Result},_findNextSuggestionElementIndex:function(a){var b=a+1;0>b&&(b=0);for(var c=b;c<this._suggestionsData.length;c++)if(this._repeater.elementFromIndex(c)&&this._isSuggestionSelectable(this._suggestionsData.getAt(c)))return c;return-1},_findPreviousSuggestionElementIndex:function(a){var b=a-1;b>=this._suggestionsData.length&&(b=this._suggestionsData.length-1);for(var c=b;c>=0;c--)if(this._repeater.elementFromIndex(c)&&this._isSuggestionSelectable(this._suggestionsData.getAt(c)))return c;return-1},_trySetFocusOnSuggestionIndex:function(a){try{this._repeater.elementFromIndex(a).focus()}catch(b){}},_updateFakeFocus:function(){var a;a=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(a)},_updateSearchButtonClass:function(){-1!==this._currentSelectedIndex||document.activeElement!==this._inputElement?a.removeClass(this._buttonElement,d.searchBoxButtonInputFocus):document.activeElement===this._inputElement&&a.addClass(this._buttonElement,d.searchBoxButtonInputFocus)},_selectSuggestionAtIndex:function(b){for(var c=null,e=0;e<this._suggestionsData.length;e++)c=this._repeater.elementFromIndex(e),e!==b?(a.removeClass(c,d.searchBoxSuggestionSelected),c.setAttribute("aria-selected","false")):(a.addClass(c,d.searchBoxSuggestionSelected),this._scrollToView(c),c.setAttribute("aria-selected","true"));this._updateSearchButtonClass(),this._currentSelectedIndex=b,c?this._inputElement.setAttribute("aria-activedescendant",this._repeaterDivElement.id+b):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_scrollToView:function(a){var b=this._flyoutDivElement.getBoundingClientRect().bottom-this._flyoutDivElement.getBoundingClientRect().top;if(a.offsetTop+a.offsetHeight>this._flyoutDivElement.scrollTop+b){var c=a.offsetTop+a.offsetHeight-(this._flyoutDivElement.scrollTop+b);WinJS.Utilities._zoomTo(this._flyoutDivElement,{contentX:0,contentY:this._flyoutDivElement.scrollTop+c,viewportX:0,viewportY:0})}else a.offsetTop<this._flyoutDivElement.scrollTop&&WinJS.Utilities._zoomTo(this._flyoutDivElement,{contentX:0,contentY:a.offsetTop,viewportX:0,viewportY:0})},_querySuggestionRenderer:function(b){var c=document.createElement("div");this._addHitHighlightedText(c,b,b.text),c.title=b.text,a.addClass(c,d.searchBoxSuggestionQuery);var e=this;c.addEventListener("click",function(a){e._inputElement.focus(),e._processSuggestionChosen(b,a)}),c.setAttribute("role","option");var f=WinJS.Resources._formatString(g.ariaLabelQuery,b.text);return c.setAttribute("aria-label",f),c},_separatorSuggestionRenderer:function(b){var c=document.createElement("div");if(b.text.length>0){var e=document.createElement("div");e.textContent=b.text,e.title=b.text,e.setAttribute("aria-hidden","true"),c.appendChild(e)}c.insertAdjacentHTML("beforeend","<hr/>"),a.addClass(c,d.searchBoxSuggestionSeparator),c.setAttribute("role","separator");var f=WinJS.Resources._formatString(g.ariaLabelSeparator,b.text);return c.setAttribute("aria-label",f),c},_resultSuggestionRenderer:function(b){var c=document.createElement("div"),e=new Image;e.style.opacity=0;var f=function(a){function b(){e.removeEventListener("load",b,!1),WinJS.UI.Animation.fadeIn(e)}e.addEventListener("load",b,!1),e.src=a};null!==b.image?b.image.openReadAsync().then(function(a){null!==a&&f(URL.createObjectURL(a,{oneTimeOnly:!0}))}):null!=b.imageUrl&&f(b.imageUrl),e.setAttribute("aria-hidden","true"),c.appendChild(e);var h=document.createElement("div");a.addClass(h,d.searchBoxSuggestionResultText),this._addHitHighlightedText(h,b,b.text),h.title=b.text,h.setAttribute("aria-hidden","true"),c.appendChild(h);var i=document.createElement("br");h.appendChild(i);var j=document.createElement("span");a.addClass(j,d.searchBoxSuggestionResultDetailedText),this._addHitHighlightedText(j,b,b.detailText),j.title=b.detailText,j.setAttribute("aria-hidden","true"),h.appendChild(j),a.addClass(c,d.searchBoxSuggestionResult);var k=this;c.addEventListener("click",function(a){k._inputElement.focus(),k._processSuggestionChosen(b,a)}),c.setAttribute("role","option");var l=WinJS.Resources._formatString(g.ariaLabelResult,b.text,b.detailText);return c.setAttribute("aria-label",l),c},_suggestionRenderer:function(a){var b=null;if(!a)return b;if(a.kind===f.Query)b=this._querySuggestionRenderer(a);else if(a.kind===f.Separator)b=this._separatorSuggestionRenderer(a);else{if(a.kind!==f.Result)throw new WinJS.ErrorFromName("WinJS.UI.SearchBox.invalidSearchBoxSuggestionKind",g.invalidSearchBoxSuggestionKind);b=this._resultSuggestionRenderer(a)}return b},_setElement:function(b){this._domElement=b,a.addClass(this._domElement,d.searchBox),this._inputElement=document.createElement("input"),this._inputElement.type="search",a.addClass(this._inputElement,d.searchBoxInput),this._buttonElement=document.createElement("div"),this._buttonElement.tabIndex=-1,a.addClass(this._buttonElement,d.searchBoxButton),this._flyoutDivElement=document.createElement("div"),a.addClass(this._flyoutDivElement,d.searchBoxFlyout),this._repeaterDivElement=document.createElement("div"),this._suggestionsData=new WinJS.Binding.List,this._repeater=new WinJS.UI.Repeater(this._repeaterDivElement,{data:this._suggestionsData,template:this._suggestionRendererBind}),this._domElement.appendChild(this._inputElement),this._domElement.appendChild(this._buttonElement),this._domElement.appendChild(this._flyoutDivElement),this._flyoutDivElement.appendChild(this._repeaterDivElement),this._hideFlyout(),this._wireupUserEvents(),this._wireupWinRTEvents(),this._wireupRepeaterEvents()},_setAccessibilityProperties:function(){var a=this._domElement.getAttribute("aria-label");a||this._domElement.setAttribute("aria-label",g.ariaLabel),this._domElement.setAttribute("role","group"),this._updateInputElementAriaLabel(),this._inputElement.setAttribute("role","textbox"),this._buttonElement.setAttribute("role","button"),this._buttonElement.setAttribute("aria-label",g.ariaLabelButton),this._repeaterDivElement.setAttribute("role","listbox"),WinJS.UI._ensureId(this._repeaterDivElement),this._inputElement.setAttribute("aria-controls",this._repeaterDivElement.id),this._repeaterDivElement.setAttribute("aria-live","polite")},_updateInputElementAriaLabel:function(){var a=g.ariaLabelInputNoPlaceHolder;this._inputElement.placeholder&&this._inputElement.placeholder&&(a=WinJS.Resources._formatString(g.ariaLabelInputPlaceHolder,this._inputElement.placeholder)),this._inputElement.setAttribute("aria-label",a)},_submitQuery:function(a,b,c){this._disposed||(window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(WinJS.UI.SearchBox._EventName.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,b),queryText:a,keyModifiers:WinJS.UI.SearchBox._getKeyModifiers(c)}),this._searchSuggestionManager&&this._searchSuggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_processSuggestionChosen:function(a,b){this.queryText=a.text,a.kind===f.Query?this._submitQuery(a.text,!1,b):a.kind===f.Result&&this._fireEvent(WinJS.UI.SearchBox._EventName.resultsuggestionchosen,{tag:a.tag,keyModifiers:WinJS.UI.SearchBox._getKeyModifiers(b),storageFile:null}),this._hideFlyout()},_buttonClickHandler:function(a){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,a),this._hideFlyout()},_inputOrImeChangeHandler:function(){var a=WinJS.Utilities._matchesSelector(this._buttonElement,":active");if(!this._isProcessingImeFocusLossKey()&&!a&&!this._isFlyoutPointerDown){var b=this._getLinguisticDetails(!1,!0),c=this._hasLinguisticDetailsChanged(b);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||b.queryTextCompositionLength>0)&&(this._prevCompositionStart=b.queryTextCompositionStart,this._prevCompositionLength=b.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!c)return;this._prevQueryText=this._inputElement.value,window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag),window.Windows&&Windows.Data&&Windows.Data.Text&&Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):null),this._fireEvent(WinJS.UI.SearchBox._EventName.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:b});this._searchSuggestionManager&&this._searchSuggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,b)}},_createSearchQueryLinguisticDetails:function(a,b,c,d,e){for(var f=null,g=[],h=0;h<a.length;h++)g[h]=d+a[h]+e;return f=window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.Search&&Windows.ApplicationModel.Search.SearchQueryLinguisticDetails?new Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(g,b,c):{queryTextAlternatives:g,queryTextCompositionStart:b,queryTextCompositionLength:c}},_getLinguisticDetails:function(a,b){var c=null;if(this._inputElement.value===this._prevQueryText&&a&&this._prevLinguisticDetails&&b)c=this._prevLinguisticDetails;else{var d=[],e=0,f=0,g="",h="";if(b&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext().getCompositionAlternatives){var i=this._inputElement.msGetInputContext();d=i.getCompositionAlternatives(),e=i.compositionStartOffset,f=i.compositionEndOffset-i.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||f>0?(g=this._inputElement.value.substring(0,e),h=this._inputElement.value.substring(e+f)):(g=this._inputElement.value.substring(0,this._prevCompositionStart),h=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength))}c=this._createSearchQueryLinguisticDetails(d,e,f,g,h)}return c},_handleTabKeyDown:function(a){var b=!0;a.shiftKey?-1!==this._currentFocusedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation(),b=!1):-1===this._currentFocusedIndex&&(this._currentFocusedIndex=this._isFlyoutBelow()?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),-1!=this._currentFocusedIndex&&(this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation(),b=!1)),b&&this._hideFlyout()},_keyDownHandler:function(a){if(this._lastKeyPressLanguage=a.locale,a.keyCode===c.tab?this._isProcessingTabKey=!0:a.keyCode===c.upArrow?this._isProcessingUpKey=!0:a.keyCode===c.downArrow?this._isProcessingDownKey=!0:a.keyCode===c.enter&&"ko"===a.locale&&(this._isProcessingEnterKey=!0),a.keyCode!==c.IME)if(a.keyCode===c.tab)this._handleTabKeyDown(a);else if(a.keyCode===c.escape)-1!==this._currentFocusedIndex?(this.queryText=this._prevQueryText,this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation());else if(a.keyCode===c.upArrow){var b;-1!==this._currentSelectedIndex?(b=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),-1===b&&(this.queryText=this._prevQueryText)):b=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),this._currentFocusedIndex=b,this._selectSuggestionAtIndex(b),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()}else if(a.keyCode===c.downArrow){var d=this._findNextSuggestionElementIndex(this._currentSelectedIndex);-1!==this._currentSelectedIndex&&-1===d&&(this.queryText=this._prevQueryText),this._currentFocusedIndex=d,this._selectSuggestionAtIndex(d),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),this._updateSearchButtonClass(),a.preventDefault(),a.stopPropagation()}else a.keyCode===c.enter?(-1===this._currentSelectedIndex?this._submitQuery(this._inputElement.value,!0,a):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),a),this._hideFlyout()):WinJS.UI.SearchBox._isTypeToSearchKey(a)&&-1!==this._currentFocusedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(-1),this._updateFakeFocus())},_keyPressHandler:function(a){this._lastKeyPressLanguage=a.locale},_keyUpHandler:function(a){a.keyCode===c.tab?this._isProcessingTabKey=!1:a.keyCode===c.upArrow?this._isProcessingUpKey=!1:a.keyCode===c.downArrow?this._isProcessingDownKey=!1:a.keyCode===c.enter&&(this._isProcessingEnterKey=!1)},_searchBoxFocusInHandler:function(b){this._inputElement.value!==this._prevQueryText&&window.Windows&&Windows.Data&&Windows.Data.Text&&Windows.Data.Text.SemanticTextQuery&&(this._hitFinder=""!==this._inputElement.value?new Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):null),b.target!==this._inputElement||this._isElementInSearchControl(b.relatedTarget)||(this._showFlyout(),-1!==this._currentFocusedIndex?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._searchSuggestionManager&&this._searchSuggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),a.addClass(this.element,d.searchBoxInputFocus),this._updateSearchButtonClass()},_searchBoxFocusOutHandler:function(b){this._hideFlyoutIfLeavingSearchControl(b.relatedTarget),a.removeClass(this.element,d.searchBoxInputFocus),this._updateSearchButtonClass(),this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_isIMEOccludingFlyout:function(a){var b=this._getFlyoutTop(),c=this._getFlyoutBottom();return a.top>=b&&a.top<=c||a.bottom>=b&&a.bottom<=c?!0:!1},_addFlyoutIMEPaddingIfRequired:function(){if(this._isFlyoutShown()&&this._isFlyoutBelow()&&this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext()){var a=this._inputElement.msGetInputContext(),b=a.getCandidateWindowClientRect();if(this._isIMEOccludingFlyout(b)){var c=WinJS.UI.Animation.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop=b.bottom-b.top+"px",c.execute()}}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var a=WinJS.UI.Animation.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop="",a.execute()}},_wireupUserEvents:function(){var a=this._inputOrImeChangeHandler.bind(this);if(this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),this._inputElement.addEventListener("input",a),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),WinJS.Utilities._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),WinJS.Utilities._addEventListener(this._flyoutDivElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),WinJS.Utilities._addEventListener(this._flyoutDivElement,"pointerup",this._flyoutPointerReleasedHandler.bind(this)),WinJS.Utilities._addEventListener(this._flyoutDivElement,"pointercancel",this._flyoutPointerReleasedHandler.bind(this)),WinJS.Utilities._addEventListener(this._flyoutDivElement,"pointerout",this._flyoutPointerReleasedHandler.bind(this)),WinJS.Utilities._addEventListener(this.element,"focusin",this._searchBoxFocusInHandler.bind(this),!1),WinJS.Utilities._addEventListener(this.element,"focusout",this._searchBoxFocusOutHandler.bind(this),!1),this._inputElement.addEventListener("compositionstart",a),this._inputElement.addEventListener("compositionupdate",a),this._inputElement.addEventListener("compositionend",a),this._inputElement.msGetInputContext&&this._inputElement.msGetInputContext()){var b=this._inputElement.msGetInputContext();b.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),b.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))}},_repeaterChangedHandler:function(){this._updateFlyoutTopAndTouchAction(),this._isFlyoutShown()&&(this._repeaterDivElement.style.display="none",this._repeaterDivElement.style.display="block")},_wireupRepeaterEvents:function(){var a=this._repeaterChangedHandler.bind(this);this._repeater.addEventListener("itemchanged",a),this._repeater.addEventListener("iteminserted",a),this._repeater.addEventListener("itemremoved",a),this._repeater.addEventListener("itemsreloaded",a)},_inputPointerDownHandler:function(){document.activeElement===this._inputElement&&-1!==this._currentSelectedIndex&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_flyoutPointerDownHandler:function(a){this._isFlyoutPointerDown=!0;for(var b=a.target;b&&b.parentNode!==this._repeaterDivElement;)b=b.parentNode;var c=this._findSuggestionElementIndex(b);c>=0&&c<this._suggestionsData.length&&this._currentFocusedIndex!==c&&this._isSuggestionSelectable(this._suggestionsData.getAt(c))&&(this._currentFocusedIndex=c,this._selectSuggestionAtIndex(c),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),a.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var a=WinJS.UI.Animation.createRepositionAnimation(this._flyoutDivElement.children);this._flyoutDivElement.style.paddingTop="",a.execute()}},_isElementInSearchControl:function(a){return this.element.contains(a)||this.element===a},_hideFlyoutIfLeavingSearchControl:function(a){this._isFlyoutShown()&&(this._isElementInSearchControl(a)||this._hideFlyout())},_wireupWinRTEvents:function(){this._searchSuggestions&&this._searchSuggestions.addEventListener("vectorchanged",this._suggestionsChangedHandlerBind),this._searchSuggestionManager&&this._searchSuggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandlerBind)},_suggestionsChangedHandler:function(b){var c=b.collectionChange;if(c===Windows.Foundation.Collections.CollectionChange.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(c===Windows.Foundation.Collections.CollectionChange.itemInserted){var e=b.index,f=this._searchSuggestions[e];this._suggestionsData.splice(e,0,f),this._showFlyout()}else if(c===Windows.Foundation.Collections.CollectionChange.itemRemoved){1===this._suggestionsData.length&&(WinJS.Utilities._setActive(this._inputElement),this._hideFlyout());var e=b.index;this._suggestionsData.splice(e,1)}else if(c===Windows.Foundation.Collections.CollectionChange.itemChanged){var e=b.index,f=this._searchSuggestions[e];if(f!==this._suggestionsData.getAt(e))this._suggestionsData.setAt(e,f);else{var g=this._repeater.elementFromIndex(e);if(a.hasClass(g,d.searchBoxSuggestionQuery))this._addHitHighlightedText(g,f,f.text);else{var h=g.querySelector("."+d.searchBoxSuggestionResultText);if(h){this._addHitHighlightedText(h,f,f.text);var i=g.querySelector("."+d.searchBoxSuggestionResultDetailedText);i&&this._addHitHighlightedText(i,f,f.detailText)}}}}document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(a){window.Windows&&Windows.Globalization&&Windows.Globalization.Language&&(this._lastKeyPressLanguage=Windows.Globalization.Language.currentInputMethodLanguageTag);var b,c=a;this._fireEvent(WinJS.UI.SearchBox._EventName.suggestionsrequested,{setPromise:function(a){b=c.request.getDeferral(),a.then(function(){b.complete()})},searchSuggestionCollection:c.request.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!0,!0,b),this.element.dispatchEvent(c)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(WinJS.UI.SearchBox._EventName.receivingfocusonkeyboardinput,null),document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(a){}},_hasLinguisticDetailsChanged:function(a){var b=!1;return(this._prevLinguisticDetails.queryTextCompositionStart!==a.queryTextCompositionStart||this._prevLinguisticDetails.queryTextCompositionLength!==a.queryTextCompositionLength||this._prevLinguisticDetails.queryTextAlternatives.length!==a.queryTextAlternatives.length)&&(b=!0),this._prevLinguisticDetails=a,b},_isProcessingImeFocusLossKey:function(){return this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey},_updateQueryTextWithSuggestionText:function(a){a>=0&&a<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(a).text)}},{_EventName:{querychanged:e.querychanged,querysubmitted:e.querysubmitted,resultsuggestionchosen:e.resultsuggestionchosen,suggestionsrequested:e.suggestionsrequested,receivingfocusonkeyboardinput:e.receivingfocusonkeyboardinput},_Constants:{MIN_POPUP_HEIGHT:152},_getKeyModifiers:function(a){var b={ctrlKey:1,altKey:2,shiftKey:4},c=0;return a.ctrlKey&&(c|=b.ctrlKey),a.altKey&&(c|=b.altKey),a.shiftKey&&(c|=b.shiftKey),c},_sortAndMergeHits:function(a){var b=[];if(a){for(var c=new Array(a.length),d=0;d<a.length;d++)c.push({startPosition:a[d].startPosition,length:a[d].length});c.sort(WinJS.UI.SearchBox._hitStartPositionAscendingSorter),c.reduce(WinJS.UI.SearchBox._hitIntersectionReducer,b)}return b},_hitStartPositionAscendingSorter:function(a,b){var c=0;return a.startPosition<b.startPosition?c=-1:a.startPosition>b.startPosition&&(c=1),c},_hitIntersectionReducer:function(a,b,c){if(0===c)a.push(b);else{var d=a[a.length-1],e=d.startPosition+d.length;if(b.startPosition<=e){var f=b.startPosition+b.length;f>e&&(d.length=f-d.startPosition)}else a.push(b)}return a},_isTypeToSearchKey:function(a){return a.shiftKey||a.ctrlKey||a.altKey?!1:!0}});return WinJS.Class.mix(h,WinJS.UI.DOMEventMixin),h})})}(this,WinJS),function(a){"use strict";a.Namespace.define("WinJS.UI",{SettingsFlyout:a.Namespace._lazy(function(){function b(){if(a.Utilities.hasWinRT&&Windows.UI.ApplicationSettings.SettingsEdgeLocation){var b=Windows.UI.ApplicationSettings;return b.SettingsPane.edge===b.SettingsEdgeLocation.left}return!1}function c(a,b){for(var c,d,e=a.querySelectorAll(h),f=0;f<e.length;f++)if(d=e[f].winControl){if(d.settingsCommandId===b){c=d;break}e[f].id===b&&(c=c||d)}return c}var d,e=a.UI,f=a.Utilities.Key,g="win-settingsflyout",h="."+g,i="win-ui-light",j="win-narrow",k="win-wide",l="win-firstdiv",m="win-finaldiv",n="narrow",o="wide",p=a.Class.derive(a.UI._Overlay,function(b,c){this._element=b||document.createElement("div"),this._id=this._element.id||a.Utilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,c),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),e._Overlay._createClickEatingDivAppBar(),this._element.style.visibilty="hidden",this._element.style.display="none",a.Utilities.addClass(this._element,g),a.Utilities.query("div.win-content",this._element).forEach(function(b){a.Utilities._matchesSelector(b,".win-ui-dark, .win-ui-dark *")||a.Utilities.addClass(b,i)});var d=this._element.getAttribute("role");(null===d||""===d||void 0===d)&&this._element.setAttribute("role","dialog");var f=this._element.getAttribute("aria-label");(null===f||""===f||void 0===f)&&this._element.setAttribute("aria-label",r.ariaLabel),this._addOverlayEventHandlers(!0),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(b){a.Utilities._deprecated(r.widthDeprecationMessage),b!==this._width&&(this._width===n?a.Utilities.removeClass(this._element,j):this._width===o&&a.Utilities.removeClass(this._element,k),this._width=b,this._width===n?a.Utilities.addClass(this._element,j):this._width===o&&a.Utilities.addClass(this._element,k))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(a){this._settingsCommandId=a}},show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){a.Utilities.disposeSubTree(this.element),this._dismiss()},_show:function(){this._baseShow(),e._Overlay._showClickEatingDivAppBar()},_endShow:function(){this._initAfterAnimation()},_initAfterAnimation:function(){if(d=0,!a.Utilities.hasClass(this.element.children[0],l)){var b=this.element.querySelectorAll(".win-first");b&&b.length>0&&b.item(0).parentNode.removeChild(b.item(0)),this._addFirstDiv()}if(this.element.children[0]&&(a.Utilities._addEventListener(this.element.children[0],"focusout",function(){d=1},!1),this.element.children[0].focus()),!a.Utilities.hasClass(this.element.children[this.element.children.length-1],m)){var c=this.element.querySelectorAll(".win-final");c&&c.length>0&&c.item(0).parentNode.removeChild(c.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel()},_setBackButtonsAriaLabel:function(){for(var a,b=this.element.querySelectorAll(".win-backbutton"),c=0;c<b.length;c++)a=b[c].getAttribute("aria-label"),(null===a||""===a||void 0===a)&&b[c].setAttribute("aria-label",r.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()&&e._Overlay._hideClickEatingDivAppBar()},_animateSlideIn:function(){var c=b(),d=c?"-100px":"100px";a.Utilities.query("div.win-content",this._element).forEach(function(b){a.UI.Animation.enterPage(b,{left:d})});var e,f=this._element.offsetWidth;return c?(e={top:"0px",left:"-"+f+"px"},this._element.style.right="auto",this._element.style.left="0px"):(e={top:"0px",left:f+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",a.UI.Animation.showPanel(this._element,e)},_animateSlideOut:function(){var c,d=this._element.offsetWidth;return b()?(c={top:"0px",left:d+"px"},this._element.style.right="auto",this._element.style.left="-"+d+"px"):(c={top:"0px",left:"-"+d+"px"},this._element.style.right="-"+d+"px",this._element.style.left="auto"),a.UI.Animation.showPanel(this._element,c)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(a){this._fragDiv=a}},_unloadPage:function(b){var c=b.currentTarget.winControl;c.removeEventListener(e._Overlay.afterHide,this._unloadPage,!1),a.Promise.as().then(function(){c._fragmentDiv&&(document.body.removeChild(c._fragmentDiv),c._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(e._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(a){if(a.keyCode===f.escape)a.preventDefault(),a.stopPropagation(),this.winControl._dismiss();else if(a.keyCode!==f.space&&a.keyCode!==f.enter||this.children[0]!==document.activeElement){if(a.shiftKey&&a.keyCode===f.tab&&this.children[0]===document.activeElement){a.preventDefault(),a.stopPropagation();for(var b=this.getElementsByTagName("*"),c=b.length-2;c>=0&&(b[c].focus(),b[c]!==document.activeElement);c--);}}else a.preventDefault(),a.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var b=document.activeElement;if(d&&b&&a.Utilities.hasClass(b,l)){var c=this.parentElement.getElementsByTagName("*");if(!(c.length<=2)){var e=c[c.length-1].tabIndex;if(e){for(var f=c.length-2;f>0;f--)if(c[f].tabIndex===e){c[f].focus();break}}else for(f=c.length-2;f>0&&("DIV"===c[f].tagName&&null===c[f].getAttribute("tabIndex")||(c[f].focus(),c[f]!==document.activeElement));f--);}}},_focusOnFirstFocusableElementFromParent:function(){var b=document.activeElement;
if(b&&a.Utilities.hasClass(b,m)){var c=this.parentElement.getElementsByTagName("*");if(!(c.length<=2)){var d=c[0].tabIndex;if(d){for(var e=1;e<c.length-1;e++)if(c[e].tabIndex===d){c[e].focus();break}}else for(e=1;e<c.length-1&&("DIV"===c[e].tagName&&null===c[e].getAttribute("tabIndex")||(c[e].focus(),c[e]!==document.activeElement));e++);}}},_addFirstDiv:function(){for(var b=this._element.getElementsByTagName("*"),c=0,d=0;d<b.length;d++)0<b[d].tabIndex&&(0===c||b[d].tabIndex<c)&&(c=b[d].tabIndex);var e=document.createElement("div");e.className=l,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),e.tabIndex=c,a.Utilities._addEventListener(e,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(e,this._element.children[0]):this._element.appendChild(e)},_addFinalDiv:function(){for(var b=this._element.getElementsByTagName("*"),c=0,d=0;d<b.length;d++)b[d].tabIndex>c&&(c=b[d].tabIndex);var e=document.createElement("div");e.className=m,e.style.display="inline",e.setAttribute("role","menuitem"),e.setAttribute("aria-hidden","true"),e.tabIndex=c,a.Utilities._addEventListener(e,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(e)},_writeProfilerMark:function(b){a.Utilities._writeProfilerMark("WinJS.UI.SettingsFlyout:"+this._id+":"+b)}});p.show=function(){a.Utilities.hasWinRT&&Windows.UI.ApplicationSettings.SettingsPane.show();for(var b=document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),c=b.length,d=0;c>d;d++){var e=b[d].winControl;e&&e._dismiss()}};var q={event:void 0};p.populateSettings=function(a){if(q.event=a.detail,q.event.applicationcommands){var b=Windows.UI.ApplicationSettings;Object.keys(q.event.applicationcommands).forEach(function(a){var c=q.event.applicationcommands[a];c.title||(c.title=a);var d=new b.SettingsCommand(a,c.title,e.SettingsFlyout._onSettingsCommand);q.event.e.request.applicationCommands.append(d)})}},p._onSettingsCommand=function(a){var b=a.id;q.event.applicationcommands&&q.event.applicationcommands[b]&&e.SettingsFlyout.showSettings(b,q.event.applicationcommands[b].href)},p.showSettings=function(b,d){var e=c(document,b);if(e)e.show();else{if(!d)throw new a.ErrorFromName("WinJS.UI.SettingsFlyout.BadReference",r.badReference);var f=document.createElement("div");f=document.body.appendChild(f),a.UI.Pages.render(d,f).then(function(){e=c(f,b),e?(e._fragmentDiv=f,e.show()):document.body.removeChild(f)})}};var r={get ariaLabel(){return a.Resources._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return a.Resources._getWinJSString("ui/badReference").value},get backbuttonAriaLabel(){return a.Resources._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return a.Resources._getWinJSString("ui/settingsFlyoutWidthIsDeprecated").value}};return p})})}(WinJS),function(a,b){"use strict";var c=b.Utilities,d=c._createEventProperty,e={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};b.Namespace.define("WinJS.UI",{ItemContainer:b.Namespace._lazy(function(){var a={get duplicateConstruction(){return b.Resources._getWinJSString("ui/duplicateConstruction").value}},f=b.Class.define(function(c,d){function e(a,b,c){return{name:b?a:a.toLowerCase(),handler:function(b){f["_on"+a](b)},capture:c}}if(c=c||document.createElement("DIV"),this._id=c.id||b.Utilities._uniqueID(c),this._writeProfilerMark("constructor,StartTM"),d=d||{},c.winControl)throw new b.ErrorFromName("WinJS.UI.ItemContainer.DuplicateConstruction",a.duplicateConstruction);c.winControl=this,this._element=c,b.Utilities.addClass(c,"win-disposable"),this._selectionMode=b.UI.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX},this.tapBehavior=b.UI.TapBehavior.invokeOnly,this.swipeOrientation=b.UI.Orientation.vertical,this.swipeBehavior=b.UI.SwipeBehavior.select,b.Utilities.addClass(this.element,b.UI.ItemContainer._ClassName.itemContainer+" "+b.UI._containerClass),this._setupInternalTree(),this._selection=new b.UI._SingleItemSelectionManager(c,this._itemBox),this._setTabIndex(),b.UI.setOptions(this,d),this._mutationObserver=new b.Utilities._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(c,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var f=this;this.selectionDisabled||b.Utilities.Scheduler.schedule(function(){f._setDirectionClass()},b.Utilities.Scheduler.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new b.UI._ItemEventsHandler(Object.create({containerFromElement:function(){return f.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return b.UI._INVALID_INDEX},itemBoxAtIndex:function(){return f._itemBox},itemAtIndex:function(){return f.element},headerAtIndex:function(){return null},containerAtIndex:function(){return f.element},isZombie:function(){return this._disposed},getItemPosition:function(){return f._getItemPosition()},rtl:function(){return f._rtl()},fireInvokeEvent:function(){f._fireInvokeEvent()},verifySelectionAllowed:function(){return f._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(a,b){return f._selection.set({firstIndex:a,lastIndex:b})}},{pressedEntity:{get:function(){return f._pressedEntity},set:function(a){f._pressedEntity=a}},pressedElement:{enumerable:!0,set:function(a){f._pressedElement=a}},eventHandlerRoot:{enumerable:!0,get:function(){return f.element}},swipeBehavior:{enumerable:!0,get:function(){return f._swipeBehavior}},selectionMode:{enumerable:!0,get:function(){return f._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return b.UI._containerClass}},canvasProxy:{enumerable:!0,get:function(){return f._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return f._tapBehavior}},draggable:{enumerable:!0,get:function(){return f._draggable}},selection:{enumerable:!0,get:function(){return f._selection}},horizontal:{enumerable:!0,get:function(){return f._swipeOrientation===b.UI.Orientation.vertical}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var g=[e("MSManipulationStateChanged",!0,!0),e("PointerDown"),e("Click"),e("PointerUp"),e("PointerCancel"),e("LostPointerCapture"),e("ContextMenu"),e("MSHoldVisual",!0),e("FocusIn"),e("FocusOut"),e("DragStart"),e("DragEnd"),e("KeyDown")];g.forEach(function(a){b.Utilities._addEventListener(f.element,a.name,a.handler,!!a.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(a){c.isPhone||this._draggable!==a&&(this._draggable=a,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(a){this._selection.selected!==a&&(this._selection.selected=a)}},swipeOrientation:{get:function(){return this._swipeOrientation},set:function(a){a===b.UI.Orientation.vertical?(b.Utilities.removeClass(this.element,b.UI.ItemContainer._ClassName.horizontal),b.Utilities.addClass(this.element,b.UI.ItemContainer._ClassName.vertical)):(a=b.UI.Orientation.horizontal,b.Utilities.removeClass(this.element,b.UI.ItemContainer._ClassName.vertical),b.Utilities.addClass(this.element,b.UI.ItemContainer._ClassName.horizontal)),this._swipeOrientation=a}},tapBehavior:{get:function(){return this._tapBehavior},set:function(a){c.isPhone&&a===b.UI.TapBehavior.directSelect||(this._tapBehavior=a,this._setAriaRole())}},swipeBehavior:{get:function(){return this._swipeBehavior},set:function(a){this._swipeBehavior=a,this._setSwipeClass()}},selectionDisabled:{get:function(){return this._selectionMode===b.UI.SelectionMode.none},set:function(a){a?this._selectionMode=b.UI.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=b.UI.SelectionMode.single),this._setSwipeClass(),this._setAriaRole()}},oninvoked:d(e.invoked),onselectionchanging:d(e.selectionchanging),onselectionchanged:d(e.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),b.Utilities.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(a){this._itemEventsHandler.onMSManipulationStateChanged(a)},_onPointerDown:function(a){this._itemEventsHandler.onPointerDown(a)},_onClick:function(a){this._itemEventsHandler.onClick(a)},_onPointerUp:function(a){c.hasClass(this._itemBox,b.UI._itemFocusClass)&&this._onFocusOut(a),this._itemEventsHandler.onPointerUp(a)},_onPointerCancel:function(a){this._itemEventsHandler.onPointerCancel(a)},_onLostPointerCapture:function(a){this._itemEventsHandler.onLostPointerCapture(a)},_onContextMenu:function(a){this._itemEventsHandler.onContextMenu(a)},_onMSHoldVisual:function(a){this._itemEventsHandler.onMSHoldVisual(a)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+b.UI._itemFocusOutlineClass)&&b.UI._keyboardSeenLast){c.addClass(this._itemBox,b.UI._itemFocusClass);var a=document.createElement("div");a.className=b.UI._itemFocusOutlineClass,this._itemBox.appendChild(a)}},_onFocusOut:function(){c.removeClass(this._itemBox,b.UI._itemFocusClass);var a=this._itemBox.querySelector("."+b.UI._itemFocusOutlineClass);a&&a.parentNode.removeChild(a)},_onDragStart:function(a){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))a.preventDefault();else{this._dragging=!0;var d=this;if(a.dataTransfer.setData("text",""),a.dataTransfer.setDragImage){var e=this.element.getBoundingClientRect();a.dataTransfer.setDragImage(this.element,a.clientX-e.left,a.clientY-e.top)}b.Utilities._yieldForDomModification(function(){d._dragging&&c.addClass(d._itemBox,b.UI._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,c.removeClass(this._itemBox,b.UI._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(a){if(!this._itemEventsHandler._isInteractive(a.target)){var d=c.Key,e=a.keyCode,f=this._swipeBehavior===b.UI.SwipeBehavior.select,g=!1;if(a.ctrlKey||e!==d.enter)a.ctrlKey&&e===d.enter||f&&a.shiftKey&&e===d.F10||f&&e===d.menu||e===d.space?this.selectionDisabled||(this.selected=!this.selected,g=b.Utilities._setActive(this.element)):e===d.escape&&this.selected&&(this.selected=!1,g=!0);else{var h=this._verifySelectionAllowed();h.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),g=!0}g&&(a.stopPropagation(),a.preventDefault())}},_setTabIndex:function(){var a=this.element.getAttribute("tabindex");a||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===window.getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){c[this._rtl()?"addClass":"removeClass"](this.element,b.UI._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===window.getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var a=this.element;return a?b.Promise.wrap({left:this._rtl()?a.offsetParent.offsetWidth-a.offsetLeft-a.offsetWidth:a.offsetLeft,top:a.offsetTop,totalWidth:c.getTotalWidth(a),totalHeight:c.getTotalHeight(a),contentWidth:c.getContentWidth(a),contentHeight:c.getContentHeight(a)}):b.Promise.cancel},_itemPropertyChange:function(a){if(!this._disposed){var c=a[0].target,d="true"===c.getAttribute("aria-selected");d!==b.UI._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?b.UI._setAttribute(c,"aria-selected",!d):(this.selected=d,d!==this.selected&&b.UI._setAttribute(c,"aria-selected",!d)))}},_setSwipeClass:function(){c.isPhone||(this._swipeBehavior===b.UI.SwipeBehavior.select&&this._selectionMode!==b.UI.SelectionMode.none||this._draggable?c.addClass(this._element,b.UI._swipeableClass):c.removeClass(this._element,b.UI._swipeableClass))},_updateDraggableAttribute:function(){this._setSwipeClass(),this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode===b.UI.SelectionMode.none||this._tapBehavior!==b.UI.TapBehavior.toggleSelect&&this._swipeBehavior!==b.UI.SwipeBehavior.select)return{canSelect:!1,canTapSelect:!1};var a=this._selection.fireSelectionChanging();return{canSelect:a,canTapSelect:a&&this._tapBehavior===b.UI.TapBehavior.toggleSelect}},_setupInternalTree:function(){var a=document.createElement("div");a.className=b.UI._itemClass,this._captureProxy=document.createElement("div"),this._itemBox=document.createElement("div"),this._itemBox.className=b.UI._itemBoxClass;for(var c=this.element.firstChild;c;){var d=c.nextSibling;a.appendChild(c),c=d}this.element.appendChild(this._itemBox),this._itemBox.appendChild(a),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==b.UI.TapBehavior.none){var a=document.createEvent("CustomEvent");a.initCustomEvent(e.invoked,!0,!1,{}),this.element.dispatchEvent(a)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var a;a=this.tapBehavior===b.UI.TapBehavior.none&&this.selectionDisabled?"listitem":"option",b.UI._setAttribute(this.element,"role",a)}},_writeProfilerMark:function(a){var c="WinJS.UI.ItemContainer:"+this._id+":"+a;b.Utilities._writeProfilerMark(c),b.log&&b.log(c,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return b.Class.mix(f,b.UI.DOMEventMixin),f}),_SingleItemSelectionManager:b.Namespace._lazy(function(){return b.Class.define(function(a,b){this._selected=!1,this._element=a,this._itemBox=b},{selected:{get:function(){return this._selected},set:function(a){a=!!a,this._selected!==a&&this.fireSelectionChanging()&&(this._selected=a,b.UI._ItemEventsHandler.renderSelection(this._itemBox,this._element,a,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var a=document.createEvent("CustomEvent");return a.initCustomEvent(e.selectionchanging,!0,!0,{}),this._element.dispatchEvent(a)},fireSelectionChanged:function(){var a=document.createEvent("CustomEvent");a.initCustomEvent(e.selectionchanged,!0,!1,{}),this._element.dispatchEvent(a)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:b.UI.ObjectType.item,index:b.UI._INVALID_INDEX}}})})})}(this,WinJS),function(a,b){"use strict";a.document&&(b.UI._keyboardSeenLast=!1,window.addEventListener("pointerdown",function(){b.UI._keyboardSeenLast&&(b.UI._keyboardSeenLast=!1)},!0),window.addEventListener("keydown",function(){b.UI._keyboardSeenLast||(b.UI._keyboardSeenLast=!0)},!0),b.Namespace.define("WinJS.UI",{_WinKeyboard:function(a){a.addEventListener("pointerdown",function(a){b.Utilities.removeClass(a.target,"win-keyboard")},!0),a.addEventListener("keydown",function(a){b.Utilities.addClass(a.target,"win-keyboard")},!0),b.Utilities._addEventListener(a,"focusin",function(a){b.UI._keyboardSeenLast&&b.Utilities.addClass(a.target,"win-keyboard")},!1),b.Utilities._addEventListener(a,"focusout",function(a){b.Utilities.removeClass(a.target,"win-keyboard")},!1)},_KeyboardBehavior:b.Namespace._lazy(function(){var a=b.Utilities.Key;return b.Class.define(function(a,c){a=a||document.createElement("DIV"),c=c||{},a._keyboardBehavior=this,this._element=a,this._fixedDirection=b.UI._KeyboardBehavior.FixedDirection.width,this._fixedSize=1,this._currentIndex=0,b.UI.setOptions(this,c),this._element.addEventListener("keydown",this._keyDownHandler.bind(this)),this._element.addEventListener("pointerdown",this._MSPointerDownHandler.bind(this)),this._element.addEventListener("beforeactivate",this._beforeActivateHandler.bind(this))},{element:{get:function(){return this._element}},fixedDirection:{get:function(){return this._fixedDirection},set:function(a){this._fixedDirection=a}},fixedSize:{get:function(){return this._fixedSize},set:function(a){+a===a&&(a=Math.max(1,a),this._fixedSize=a)}},currentIndex:{get:function(){return this._element.children.length>0?this._currentIndex:-1},set:function(a){if(+a===a){var b=this._element.children.length;a=Math.max(0,Math.min(b-1,a)),this._currentIndex=a}}},getAdjacent:{get:function(){return this._getAdjacent},set:function(a){this._getAdjacent=a}},_keyDownHandler:function(c){if(!c.altKey){if(b.Utilities._matchesSelector(c.target,".win-interactive, .win-interactive *"))return;var d=!1,e=this.currentIndex,f=this._element.children.length-1,g="rtl"===getComputedStyle(this._element).direction,h=g?a.rightArrow:a.leftArrow,i=g?a.leftArrow:a.rightArrow,j=this.getAdjacent&&this.getAdjacent(e,c.keyCode);if(+j===j)d=!0,e=j;else{var k=e%this.fixedSize;c.keyCode===h?(d=!0,this.fixedDirection===b.UI._KeyboardBehavior.FixedDirection.width?0!==k&&e--:e>=this.fixedSize&&(e-=this.fixedSize)):c.keyCode===i?(d=!0,this.fixedDirection===b.UI._KeyboardBehavior.FixedDirection.width?k!==this.fixedSize-1&&e++:e+this.fixedSize-k<=f&&(e+=this.fixedSize)):c.keyCode===a.upArrow?(d=!0,this.fixedDirection===b.UI._KeyboardBehavior.FixedDirection.height?0!==k&&e--:e>=this.fixedSize&&(e-=this.fixedSize)):c.keyCode===a.downArrow?(d=!0,this.fixedDirection===b.UI._KeyboardBehavior.FixedDirection.height?k!==this.fixedSize-1&&e++:e+this.fixedSize-k<=f&&(e+=this.fixedSize)):c.keyCode===a.home?(d=!0,e=0):c.keyCode===a.end?(d=!0,e=this._element.children.length-1):c.keyCode===a.pageUp?d=!0:c.keyCode===a.pageDown&&(d=!0)}e=Math.max(0,Math.min(this._element.children.length-1,e)),e!==this.currentIndex&&(this._focus(e,c.keyCode),(c.keyCode===h||c.keyCode===i||c.keyCode===a.upArrow||c.keyCode===a.downArrow)&&c.stopPropagation()),d&&c.preventDefault()}},_focus:function(a,c){a=+a===a?a:this.currentIndex;var d=this._element.children[a];d&&(d.winControl&&d.winControl._getFocusInto&&(d=d.winControl._getFocusInto(c)),this.currentIndex=a,b.Utilities._setActive(d))},_MSPointerDownHandler:function(a){var b=a.target;if(b!==this.element){for(;b.parentNode!==this.element;)b=b.parentNode;for(var c=-1;b;)c++,b=b.previousElementSibling;this.currentIndex=c}},_beforeActivateHandler:function(a){var b=!1;if(this._element.children.length){var c=this._element.children[this.currentIndex];(c===a.target||c.contains(a.target))&&(b=!0)}b||(a.stopPropagation(),a.preventDefault())}},{FixedDirection:{height:"height",width:"width"}})})}))}(this,WinJS),function(a,b){"use strict";var c="custom";b.Namespace.define("WinJS.UI",{NavBar:b.Namespace._lazy(function(){var a="childrenprocessed",d=b.Utilities._createEventProperty;return b.Class.derive(b.UI.AppBar,function(a,d){d=d||{},d=b.Utilities._shallowCopy(d),d.placement=d.placement||"top",d.layout=c,b.UI.AppBar.call(this,a,d),this._element.addEventListener("beforeshow",this._handleBeforeShow.bind(this)),b.Utilities.addClass(this.element,b.UI.NavBar._ClassName.navbar),window.Windows&&Windows.ApplicationModel&&Windows.ApplicationModel.DesignMode&&Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():b.Utilities.Scheduler.schedule(this._processChildren.bind(this),b.Utilities.Scheduler.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{layout:{get:function(){return c},set:function(){}},onchildrenprocessed:d(a),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var a=this,c=b.Promise.as();return this._processors&&this._processors.forEach(function(b){for(var d=0,e=a.element.children.length;e>d;d++)!function(a){c=c.then(function(){b(a)})}(a.element.children[d])}),c.then(function(){a._writeProfilerMark("processChildren,StopTM"),a._fireEvent(b.UI.NavBar._EventName.childrenProcessed)},function(){a._writeProfilerMark("processChildren,StopTM"),a._fireEvent(b.UI.NavBar._EventName.childrenProcessed)})}return b.Promise.wrap()},_show:function(){if(!this.disabled){var a=this;this._processChildren().then(function(){b.UI.AppBar.prototype._show.call(a)})}},_handleBeforeShow:function(){if(!this._disposed)for(var a=this.element.querySelectorAll(".win-navbarcontainer"),b=0;b<a.length;b++)a[b].winControl.forceLayout()},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b||{}),this.element.dispatchEvent(c)},_writeProfilerMark:function(a){b.Utilities._writeProfilerMark("WinJS.UI.NavBar:"+this._id+":"+a)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:a},isDeclarativeControlContainer:b.Utilities.markSupportedForProcessing(function(a,b){if(a._processed)for(var c=0,d=a.element.children.length;d>c;c++)b(a.element.children[c]);else a._processors=a._processors||[],a._processors.push(b)})})})})}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{NavBarContainer:b.Namespace._lazy(function(){var a=b.Utilities.Key,c=3e3,d=b.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",e=0,f=b.Utilities._createEventProperty,g={invoked:"invoked",splittoggle:"splittoggle"},h={get duplicateConstruction(){return b.Resources._getWinJSString("ui/duplicateConstruction").value},get navBarContainerViewportAriaLabel(){return b.Resources._getWinJSString("ui/navBarContainerViewportAriaLabel").value}},i=b.Class.define(function(a,c){if(a=a||document.createElement("DIV"),this._id=a.id||b.Utilities._uniqueID(a),this._writeProfilerMark("constructor,StartTM"),c=c||{},a.winControl)throw new b.ErrorFromName("WinJS.UI.NavBarContainer.DuplicateConstruction",h.duplicateConstruction);a.winControl=this,this._element=a,b.Utilities.addClass(this.element,b.UI.NavBarContainer._ClassName.navbarcontainer),b.Utilities.addClass(this.element,"win-disposable"),this._currentManipulationState=e,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),this._navigatedBound=this._navigated.bind(this),b.Navigation.addEventListener("navigated",this._navigatedBound),this.layout=c.layout||b.UI.Orientation.horizontal,c.maxRows&&(this.maxRows=c.maxRows),c.template&&(this.template=c.template),c.data&&(this.data=c.data),c.fixedSize&&(this.fixedSize=c.fixedSize),b.UI._setOptions(this,c,!0),this._duringConstructor=!1,c.currentIndex&&(this.currentIndex=c.currentIndex),this._updatePageUI(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(a){if(this._template=a,this._repeater){var b=this.element.contains(document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),b&&this._keyboardBehavior._focus(0))}}},_render:function(a){var c=document.createElement("div"),d=this._template;d&&(d.render?d.render(a,c):d.winControl&&d.winControl.render?d.winControl.render(a,c):c.appendChild(d(a)));new b.UI.NavBarCommand(c,a);return c},data:{get:function(){return this._repeater&&this._repeater.data},set:function(a){a||(a=new b.Binding.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var c=this.element.contains(document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new b.UI.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(a),this._repeater.data=a,this._addDataChangedEvents(a),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),c&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(a){a=+a===a?a:1,this._maxRows=Math.max(1,a),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(a){a===b.UI.Orientation.vertical?(this._layout=b.UI.Orientation.vertical,b.Utilities.removeClass(this.element,b.UI.NavBarContainer._ClassName.horizontal),b.Utilities.addClass(this.element,b.UI.NavBarContainer._ClassName.vertical)):(this._layout=b.UI.Orientation.horizontal,b.Utilities.removeClass(this.element,b.UI.NavBarContainer._ClassName.vertical),b.Utilities.addClass(this.element,b.UI.NavBarContainer._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(a){if(a===+a){var b=this.element.contains(document.activeElement);this._keyboardBehavior.currentIndex=a,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),b&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(a){this._fixedSize=!!a,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:f(g.invoked),onsplittoggle:f(g.splittoggle),forceLayout:function(){this._measured&&(this._scrollPosition=this.layout===b.UI.Orientation.horizontal?this._viewportEl.scrollLeft:this._viewportEl.scrollTop),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_navigated:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(a){this._elementHadFocus=document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===a.type?this._surfaceEl.children[a.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===a.type?this._surfaceEl.children[a.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===a.type?this._surfaceEl.children[a.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===a.type&&this._closeSplitIfOpen())},_dataChanged:function(a){this._measured=!1,"itemremoved"===a.type?a.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:a.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,null===document.activeElement&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===a.type?a.detail.index===this._keyboardBehavior.currentIndex&&null===document.activeElement&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===a.type?a.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===a.type?a.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=a.detail.newIndex,null===document.activeElement&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===a.type&&(this._keyboardBehavior.currentIndex=0,null===document.activeElement&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_reset:function(){this._keyboardBehavior.currentIndex=0,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(a){a.addEventListener("itemchanged",this._dataChangingBound),a.addEventListener("iteminserted",this._dataChangingBound),a.addEventListener("itemmoved",this._dataChangingBound),a.addEventListener("itemremoved",this._dataChangingBound),a.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(a){a.pointerType===d&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(a){a.pointerType!==d&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=b.Promise.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),b.Utilities._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),b.Utilities._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),b.Utilities._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=document.createElement("div"),b.Utilities.addClass(this._pageindicatorsEl,b.UI.NavBarContainer._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=document.createElement("div"),b.Utilities.addClass(this._viewportEl,b.UI.NavBarContainer._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",h.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),window.addEventListener("resize",this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=document.createElement("div"),b.Utilities.addClass(this._surfaceEl,b.UI.NavBarContainer._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener("_invoked",this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener("_splittoggle",this._navbarCommandSplitToggleHandler.bind(this)),b.Utilities._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var a=this.element.firstElementChild;a!==this._pageindicatorsEl;)this._surfaceEl.appendChild(a),b.UI.process(a),a=this.element.firstElementChild;
this._leftArrowEl=document.createElement("div"),b.Utilities.addClass(this._leftArrowEl,b.UI.NavBarContainer._ClassName.navleftarrow),b.Utilities.addClass(this._leftArrowEl,b.UI.NavBarContainer._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=b.Promise.wrap(),this._rightArrowEl=document.createElement("div"),b.Utilities.addClass(this._rightArrowEl,b.UI.NavBarContainer._ClassName.navrightarrow),b.Utilities.addClass(this._rightArrowEl,b.UI.NavBarContainer._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=b.Promise.wrap(),this._keyboardBehavior=new b.UI._KeyboardBehavior(this._surfaceEl),this._winKeyboard=new b.UI._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var a=this._sizes.rowsPerPage*this._sizes.columnsPerPage,b=Math.min(Math.floor(this._keyboardBehavior.currentIndex/a)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(a*b,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var a=this._sizes.rowsPerPage*this._sizes.columnsPerPage,b=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/a)-1);this._keyboardBehavior.currentIndex=Math.max(a*b,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===b.UI.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured&&(this._measured=!1,!this._pendingResize)){if(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound);for(var a=this.element.parentNode;a&&!b.Utilities.hasClass(a,"win-appbar");)a=a.parentNode;this._appBarEl=a}this._appBarEl&&this._appBarEl.winControl&&this._appBarEl.winControl.hidden?(b.Utilities.Scheduler.schedule(this._resizeImplBound,b.Utilities.Scheduler.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeshow",this._resizeImplBound)):this._resizeImpl()}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this._surfaceEl.children.length>0&&(this._surfaceEl.children[0].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(c){var d=c.keyCode;if(!c.altKey&&(d===a.pageUp||d===a.pageDown)){var e=c.target;if(b.Utilities._matchesSelector(e,".win-interactive, .win-interactive *"))return;var f=this._keyboardBehavior.currentIndex;this._measure();var g=this._sizes,h=Math.floor(f/(g.columnsPerPage*g.rowsPerPage)),i=null;if(d===a.pageUp){if(this.layout===b.UI.Orientation.horizontal){var j=h*g.columnsPerPage*g.rowsPerPage;f===j&&this._surfaceEl.children[f].winControl._buttonEl===document.activeElement?f-=g.columnsPerPage*g.rowsPerPage:f=j}else{var k=this._surfaceEl.children[f],l=k.offsetTop,m=l+k.offsetHeight,n=this._zooming?this._zoomPosition:this._scrollPosition;if(l>=n&&m<n+g.viewportOffsetHeight)for(;f>0&&this._surfaceEl.children[f-1].offsetTop>n;)f--;if(this._keyboardBehavior.currentIndex===f){var o=m-g.viewportOffsetHeight;for(f=Math.max(0,f-1);f>0&&this._surfaceEl.children[f-1].offsetTop>o;)f--;i=f>0?this._surfaceEl.children[f].offsetTop-this._sizes.itemMarginTop:0}}f=Math.max(f,0),this._keyboardBehavior.currentIndex=f;var p=this._surfaceEl.children[f].winControl._buttonEl;this._surfaceEl.children[f].winControl._splitButtonActive=!1,null!==i&&this._scrollTo(i),b.Utilities._setActive(p)}else{if(this.layout===b.UI.Orientation.horizontal){var q=(h+1)*g.columnsPerPage*g.rowsPerPage-1;f===q?f+=g.columnsPerPage*g.rowsPerPage:f=q}else{var k=this._surfaceEl.children[this._keyboardBehavior.currentIndex],l=k.offsetTop,m=l+k.offsetHeight,n=this._zooming?this._zoomPosition:this._scrollPosition;if(l>=n&&m<n+g.viewportOffsetHeight)for(;f<this._surfaceEl.children.length-1&&this._surfaceEl.children[f+1].offsetTop+this._surfaceEl.children[f+1].offsetHeight<n+g.viewportOffsetHeight;)f++;if(f===this._keyboardBehavior.currentIndex){var r=l+g.viewportOffsetHeight;for(f=Math.min(this._surfaceEl.children.length-1,f+1);f<this._surfaceEl.children.length-1&&this._surfaceEl.children[f+1].offsetTop+this._surfaceEl.children[f+1].offsetHeight<r;)f++;i=f<this._surfaceEl.children.length-1?this._surfaceEl.children[f+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}f=Math.min(f,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=f;var p=this._surfaceEl.children[f].winControl._buttonEl;this._surfaceEl.children[f].winControl._splitButtonActive=!1,null!==i&&this._scrollTo(i);try{b.Utilities._setActive(p)}catch(s){}}}},_focusHandler:function(a){var b=a.target;this._surfaceEl.contains(b)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(a){var b=a.target;if(b!==this._surfaceEl){for(;b.parentNode!==this._surfaceEl;)b=b.parentNode;for(var c=-1;b;)c++,b=b.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(c)}},_ensureVisible:function(a,c){if(this._measure(),this.layout===b.UI.Orientation.horizontal){var d=Math.floor(a/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(d*this._sizes.viewportOffsetWidth,c)}else{var e,f=this._surfaceEl.children[a];e=a>0?f.offsetTop-this._sizes.itemMarginTop:0;var g;g=a<this._surfaceEl.children.length-1?this._surfaceEl.children[a+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var h=this._zooming?this._zoomPosition:this._scrollPosition;h=Math.max(h,g),h=Math.min(h,e),this._scrollTo(h,c)}},_scrollTo:function(a,c){this._measure(),a=this.layout===b.UI.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,a)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,a)),c?Math.abs(this._scrollPosition-a)>1&&(this._zooming=!1,this._scrollPosition=a,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen(),this.layout===b.UI.Orientation.horizontal?this._viewportEl.scrollLeft=a:this._viewportEl.scrollTop=a):(!this._zooming&&Math.abs(this._scrollPosition-a)>1||this._zooming&&Math.abs(this._zoomPosition-a)>1)&&(this._zoomPosition=a,this._zooming=!0,this.layout===b.UI.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",b.Utilities._zoomTo(this._viewportEl,{contentX:a,contentY:0,viewportX:0,viewportY:0})):b.Utilities._zoomTo(this._viewportEl,{contentX:0,contentY:a,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(a){this._currentManipulationState=a.currentState,a.currentState===a.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),clearTimeout(this._manipulationStateTimeoutId),a.currentState===a.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(this._measured=!1,!this._checkingScroll){var a=this;this._checkingScroll=requestAnimationFrame(function(){a._checkingScroll=null;var c;c=a.layout===b.UI.Orientation.horizontal?a._viewportEl.scrollLeft:a._viewportEl.scrollTop,c!==a._scrollPosition&&(a._scrollPosition=c,a._closeSplitIfOpen()),a._updatePageUI(),a._zooming||this._currentManipulationState!==e||a._updateCurrentIndexIfPageChanged()})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===b.UI.Orientation.horizontal){this._measure();var a=this._currentPage,c=a*this._sizes.rowsPerPage*this._sizes.columnsPerPage,d=(a+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<c||this._keyboardBehavior.currentIndex>d)&&(this._keyboardBehavior.currentIndex=c,this._surfaceEl.children.length>0&&(this._surfaceEl.children[this._keyboardBehavior.currentIndex].winControl._splitButtonActive=!1),this.element.contains(document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var a=this._sizes;a.rtl="rtl"===getComputedStyle(this._element).direction;var c=this._surfaceEl.children.length;if(c>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var d=this._surfaceEl.firstElementChild;d.style.margin="",d.style.width="";var e=getComputedStyle(d);a.itemOffsetWidth=parseFloat(getComputedStyle(d).width),0===d.offsetWidth&&(a.itemOffsetWidth=0),a.itemMarginLeft=parseFloat(e.marginLeft),a.itemMarginRight=parseFloat(e.marginRight),a.itemWidth=a.itemOffsetWidth+a.itemMarginLeft+a.itemMarginRight,a.itemOffsetHeight=parseFloat(getComputedStyle(d).height),0===d.offsetHeight&&(a.itemOffsetHeight=0),a.itemMarginTop=parseFloat(e.marginTop),a.itemMarginBottom=parseFloat(e.marginBottom),a.itemHeight=a.itemOffsetHeight+a.itemMarginTop+a.itemMarginBottom,a.itemOffsetWidth>0&&a.itemOffsetHeight>0&&(a.itemMeasured=!0),this._writeProfilerMark("measureItem,StopTM")}if(a.viewportOffsetWidth=parseFloat(getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(a.viewportOffsetWidth=0),a.viewportOffsetHeight=parseFloat(getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(a.viewportOffsetHeight=0),this._measured=0===a.viewportOffsetWidth||0===a.itemOffsetHeight?!1:!0,this.layout===b.UI.Orientation.horizontal){this._scrollPosition=this._viewportEl.scrollLeft,a.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(getComputedStyle(this._leftArrowEl).marginRight);var f=a.viewportOffsetWidth-2*a.leadingEdge;a.maxColumns=a.itemWidth?Math.max(1,Math.floor(f/a.itemWidth)):1,a.rowsPerPage=Math.min(this.maxRows,Math.ceil(c/a.maxColumns)),a.columnsPerPage=Math.min(a.maxColumns,c),a.pages=Math.ceil(c/(a.columnsPerPage*a.rowsPerPage)),a.trailingEdge=a.leadingEdge,a.extraSpace=f-a.columnsPerPage*a.itemWidth,this._scrollLength=a.viewportOffsetWidth*a.pages,this._keyboardBehavior.fixedSize=a.rowsPerPage,this._keyboardBehavior.fixedDirection=b.UI._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=a.itemHeight*a.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,a.leadingEdge=0,a.rowsPerPage=c,a.columnsPerPage=1,a.pages=1,a.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=a.columnsPerPage,this._keyboardBehavior.fixedDirection=b.UI._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else a.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var a=this._sizes,c=this._surfaceEl.children.length,d=0;c>d;d++){var e,f,g,h,i=this._surfaceEl.children[d],j="";if(this.layout===b.UI.Orientation.horizontal){var k=Math.floor(d%a.rowsPerPage),l=Math.floor(d/a.rowsPerPage),m=l%a.columnsPerPage===0,n=l%a.columnsPerPage===a.columnsPerPage-1,o=a.trailingEdge;if(this.fixedSize)o+=a.extraSpace;else{var p=a.extraSpace-(a.maxColumns-a.columnsPerPage)*a.itemWidth;j=a.itemOffsetWidth+p/a.maxColumns+"px"}g=k+1,h=l+1;var q,r;a.rtl?(q=m?a.leadingEdge:0,r=n?o:0):(q=n?o:0,r=m?a.leadingEdge:0),e=q+a.itemMarginRight+"px",f=r+a.itemMarginLeft+"px"}else g="",h="",e="",f="";i.style.msGridRow!==g&&(i.style.msGridRow=g),i.style.msGridColumn!==h&&(i.style.msGridColumn=h),i.style.marginRight!==e&&(i.style.marginRight=e),i.style.marginLeft!==f&&(i.style.marginLeft=f),i.style.width!==j&&(i.style.width=j)}},_updatePageUI:function(){this._measure();var a=this._currentPage;this._hasPreviousContent=0!==a,this._hasNextContent=a<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+b.UI.NavBarContainer._ClassName.indicator+'"></span>'));for(var c=0;c<this._pageindicatorsEl.children.length;c++)c===a?b.Utilities.addClass(this._pageindicatorsEl.children[c],b.UI.NavBarContainer._ClassName.currentindicator):b.Utilities.removeClass(this._pageindicatorsEl.children[c],b.UI.NavBarContainer._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX="",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==b.UI.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var d=a*this._sizes.rowsPerPage*this._sizes.columnsPerPage,e=this._surfaceEl.children[d].winControl._buttonEl;b.UI._ensureId(e),this._ariaStartMarker.setAttribute("aria-flowto",e.id);var f=Math.min(this._surfaceEl.children.length-1,(a+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),g=this._surfaceEl.children[f].winControl._buttonEl;b.UI._ensureId(g),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",g.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var a=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,d=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,e=this;this._mouseInViewport&&a?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||b.UI.Animation.fadeIn(this._leftArrowEl)):(a?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||b.Promise.timeout(b.UI._animationTimeAdjustment(c)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=b.Promise.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||b.UI.Animation.fadeOut(this._leftArrowEl).then(function(){e._leftArrowEl.style.visibility="hidden"})}.bind(this))),this._mouseInViewport&&d?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||b.UI.Animation.fadeIn(this._rightArrowEl)):(d?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||b.Promise.timeout(b.UI._animationTimeAdjustment(c)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=b.Promise.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||b.UI.Animation.fadeOut(this._rightArrowEl).then(function(){e._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(a){for(var c=a.target,d=-1;c;)d++,c=c.previousSibling;this._fireEvent(b.UI.NavBarContainer._EventName.invoked,{index:d,navbarCommand:a.target.winControl,data:this._repeater?this._repeater.data.getAt(d):null})},_navbarCommandSplitToggleHandler:function(a){for(var c=a.target,d=-1;c;)d++,c=c.previousSibling;var e=a.target.winControl;this._closeSplitIfOpen(),e.splitOpened&&(this._currentSplitNavItem=e),this._fireEvent(b.UI.NavBarContainer._EventName.splitToggle,{opened:e.splitOpened,index:d,navbarCommand:e,data:this._repeater?this._repeater.data.getAt(d):null})},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b),this.element.dispatchEvent(c)},_writeProfilerMark:function(a){var c="WinJS.UI.NavBarContainer:"+this._id+":"+a;b.Utilities._writeProfilerMark(c),b.log&&b.log(c,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&this._appBarEl.removeEventListener("beforeshow",this._resizeImplBound),b.Navigation.removeEventListener("navigated",this._navigatedBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),window.removeEventListener("resize",this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:g.invoked,splitToggle:g.splittoggle}});return b.Class.mix(i,b.UI.DOMEventMixin),i})})}(this,WinJS),function(a,b){"use strict";b.Namespace.define("WinJS.UI",{_WinPressed:b.Namespace._lazy(function(){return b.Class.define(function(a){this._element=a,b.Utilities._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(a){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),a.isPrimary&&(this._pointerId&&this._resetPointer(),b.Utilities._matchesSelector(a.target,".win-interactive, .win-interactive *")||(this._pointerId=a.pointerId,b.Utilities._addEventListener(window,"pointerup",this._pointerUpBound,!0),b.Utilities._addEventListener(window,"pointercancel",this._pointerCancelBound),!0,b.Utilities._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),b.Utilities._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),b.Utilities.addClass(this._element,b.UI._WinPressed.winPressed)))},_MSPointerOverHandler:function(a){this._pointerId===a.pointerId&&b.Utilities.addClass(this._element,b.UI._WinPressed.winPressed)},_MSPointerOutHandler:function(a){this._pointerId===a.pointerId&&b.Utilities.removeClass(this._element,b.UI._WinPressed.winPressed)},_MSPointerCancelHandler:function(a){this._pointerId===a.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(a){this._pointerId===a.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,window.removeEventListener("pointerup",this._pointerUpBound,!0),window.removeEventListener("pointercancel",this._pointerCancelBound,!0),this._element.removeEventListener("pointerover",this._pointerOverBound,!0),this._element.removeEventListener("pointerout",this._pointerOutBound,!0),b.Utilities.removeClass(this._element,b.UI._WinPressed.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"})}),NavBarCommand:b.Namespace._lazy(function(){var a=b.Utilities.Key,c={get duplicateConstruction(){return b.Resources._getWinJSString("ui/duplicateConstruction").value}},d=b.Class.define(function(a,d){if(a=a||document.createElement("DIV"),d=d||{},a.winControl)throw new b.ErrorFromName("WinJS.UI.NavBarCommand.DuplicateConstruction",c.duplicateConstruction);a.winControl=this,this._element=a,b.Utilities.addClass(this.element,b.UI.NavBarCommand._ClassName.navbarcommand),b.Utilities.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),a.addEventListener("keydown",this._keydownHandler.bind(this)),b.UI.setOptions(this,d)},{element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(a){this._label=a,this._labelEl.textContent=a}},tooltip:{get:function(){return this._tooltip},set:function(a){this._tooltip=a,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(a){this._icon=b.UI.AppBarIcon[a]||a,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},location:{get:function(){return this._location},set:function(a){this._location=a}},state:{get:function(){return this._state},set:function(a){this._state=a}},splitButton:{get:function(){return this._split},set:function(a){this._split=a,this._splitButtonEl.style.display=this._split?"flex":"none"}},splitOpened:{get:function(){return this._splitOpened},set:function(a){this._splitOpened!==!!a&&this._toggleSplit()}},_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(b.Utilities.addClass(this._splitButtonEl,b.UI.NavBarCommand._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","true")):(b.Utilities.removeClass(this._splitButtonEl,b.UI.NavBarCommand._ClassName.navbarcommandsplitbuttonopened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(b.UI.NavBarCommand._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===window.getComputedStyle(this.element).direction}},_keydownHandler:function(c){if(!b.Utilities._matchesSelector(c.target,".win-interactive, .win-interactive *")){var d=this._rtl?a.rightArrow:a.leftArrow,e=this._rtl?a.leftArrow:a.rightArrow;c.altKey||c.keyCode!==d&&c.keyCode!==a.home&&c.keyCode!==a.end||c.target!==this._splitButtonEl?c.altKey||c.keyCode!==e||!this.splitButton||c.target!==this._buttonEl&&!this._buttonEl.contains(c.target)?c.keyCode!==a.space&&c.keyCode!==a.enter||c.target!==this._buttonEl&&!this._buttonEl.contains(c.target)?c.keyCode!==a.space&&c.keyCode!==a.enter||c.target!==this._splitButtonEl||this._toggleSplit():(this.location&&b.Navigation.navigate(this.location,this.state),this._fireEvent(b.UI.NavBarCommand._EventName._invoked)):(this._splitButtonActive=!0,b.Utilities._setActive(this._splitButtonEl),c.keyCode===e&&c.stopPropagation(),c.preventDefault()):(this._splitButtonActive=!1,b.Utilities._setActive(this._buttonEl),c.keyCode===d&&c.stopPropagation(),c.preventDefault())}},_getFocusInto:function(b){var c=this._rtl?a.rightArrow:a.leftArrow;return b===c&&this.splitButton?(this._splitButtonActive=!0,this._splitButtonEl):(this._splitButtonActive=!1,this._buttonEl)},_buildDom:function(){var a='<div tabindex="0" role="button" class="'+b.UI.NavBarCommand._ClassName.navbarcommandbutton+'"><div class="'+b.UI.NavBarCommand._ClassName.navbarcommandbuttoncontent+'"><div class="'+b.UI.NavBarCommand._ClassName.navbarcommandicon+'"></div><div class="'+b.UI.NavBarCommand._ClassName.navbarcommandlabel+'"></div></div></div><div tabindex="0" aria-expanded="false" class="'+b.UI.NavBarCommand._ClassName.navbarcommandsplitbutton+'"></div>';this.element.insertAdjacentHTML("afterBegin",a),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new b.UI._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new b.UI._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",b.UI._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this)),this._buttonEl.addEventListener("beforeactivate",this._beforeactivateButtonHandler.bind(this)),this._buttonEl.addEventListener("pointerdown",this._MSPointerDownButtonHandler.bind(this));var c=new b.Utilities._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));c.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this)),this._splitButtonEl.addEventListener("beforeactivate",this._beforeactivateSplitButtonHandler.bind(this)),this._splitButtonEl.addEventListener("pointerdown",this._MSPointerDownSplitButtonHandler.bind(this));for(var d=this._splitButtonEl.nextSibling;d;)this._buttonEl.insertBefore(d,this._contentEl),"#text"!==d.nodeName&&b.UI.processAll(d),d=this._splitButtonEl.nextSibling},_MSPointerDownButtonHandler:function(){this._splitButtonActive=!1},_MSPointerDownSplitButtonHandler:function(){this._splitButtonActive=!0},_handleButtonClick:function(a){var c=a.target;c.msMatchesSelector(".win-interactive, .win-interactive *")||(this.location&&b.Navigation.navigate(this.location,this.state),this._fireEvent(b.UI.NavBarCommand._EventName._invoked))},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_beforeactivateSplitButtonHandler:function(a){this._splitButtonActive||(a.stopPropagation(),a.preventDefault())},_beforeactivateButtonHandler:function(a){this._splitButtonActive&&(a.stopPropagation(),a.preventDefault())},_fireEvent:function(a,b){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!0,!1,b),this.element.dispatchEvent(c)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:{navbarcommand:"win-navbarcommand",navbarcommandbutton:"win-navbarcommand-button",navbarcommandbuttoncontent:"win-navbarcommand-button-content",navbarcommandsplitbutton:"win-navbarcommand-splitbutton",navbarcommandsplitbuttonopened:"win-navbarcommand-splitbutton-opened",navbarcommandicon:"win-navbarcommand-icon",navbarcommandlabel:"win-navbarcommand-label"},_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return b.Class.mix(d,b.UI.DOMEventMixin),d})})}(this,WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{Tooltip:WinJS.Namespace._lazy(function(){var a=0,b=WinJS.Utilities,c=WinJS.UI.Animation,d=b.Key,e="top",f=WinJS.UI._animationTimeAdjustment(400),g=WinJS.UI._animationTimeAdjustment(1200),h=WinJS.UI._animationTimeAdjustment(400),i=WinJS.UI._animationTimeAdjustment(5e3),j=WinJS.UI._animationTimeAdjustment(0),k=WinJS.UI._animationTimeAdjustment(600),l=WinJS.UI._animationTimeAdjustment(400),m=WinJS.UI._animationTimeAdjustment(600),n=WinJS.UI._animationTimeAdjustment(200),o=WinJS.UI._animationTimeAdjustment(3e5),p=12,q=20,r=45,s=20,t=12,u=1,v=WinJS.Utilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",w={keyup:"",pointerover:""},x={pointermove:""},y={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},z={pointerover:"",pointerout:""},A="win-tooltip",B="win-tooltip-phantom",C=h,D=2*C,E=2.5*C,F=i,G=!1,H=!1,I=WinJS.Utilities._createEventProperty;return WinJS.Class.define(function(a,c){a=a||document.createElement("div");var d=b.data(a).tooltip;if(d)return d;if(!H&&WinJS.Utilities.hasWinRT){var f=new Windows.UI.ViewManagement.UISettings;C=f.mouseHoverTime,D=2*C,E=2.5*C,F=1e3*f.messageDuration;var g=f.handPreference;G=g==Windows.UI.ViewManagement.HandPreference.leftHanded}H=!0,this._disposed=!1,this._placement=e,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=a,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,a.winControl=this,WinJS.Utilities.addClass(a,"win-disposable"),a.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),WinJS.UI.setOptions(this,c),this._events(),b.data(a).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(a){if(this._innerHTML=a,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=a,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(a){if(this._contentElement=a,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(a){"top"!==a&&"bottom"!==a&&"left"!==a&&"right"!==a&&(a=e),this._placement=a,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(a){this._infotip=!!a}},extraClass:{get:function(){return this._extraClass},set:function(a){this._extraClass=a}},onbeforeopen:I("beforeopen"),onopened:I("opened"),onbeforeclose:I("beforeclose"),onclosed:I("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,WinJS.Utilities.disposeSubTree(this.element);for(var a=0,c=this._eventListenerRemoveStack.length;c>a;a++)this._eventListenerRemoveStack[a]();this._onDismiss();var d=b.data(this._anchorElement);d&&delete d.tooltip}},addEventListener:function(a,b,c){if(this._anchorElement){this._anchorElement.addEventListener(a,b,c);var d=this;this._eventListenerRemoveStack.push(function(){d._anchorElement.removeEventListener(a,b,c)})}},removeEventListener:function(a,b,c){this._anchorElement&&this._anchorElement.removeEventListener(a,b,c)},open:function(a){switch(this._triggerByOpen=!0,"touch"!==a&&"mouseover"!==a&&"mousedown"!==a&&"keyboard"!==a&&(a="default"),a){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(WinJS.Utilities.disposeSubTree(this._domElement),document.body.removeChild(this._domElement),this._domElement=null,document.body.removeChild(this._phantomDiv),this._phantomDiv=null)
},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=document.createElement("div");var a=WinJS.Utilities._uniqueID(this._domElement);this._domElement.setAttribute("id",a);var c=document.defaultView.getComputedStyle(this._anchorElement,null),d=this._domElement.style;d.direction=c.direction,d.writingMode=c["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",a),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,document.body.appendChild(this._domElement),b.addClass(this._domElement,A),this._extraClass&&b.addClass(this._domElement,this._extraClass),this._phantomDiv=document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),document.body.appendChild(this._phantomDiv),b.addClass(this._phantomDiv,B);var e=document.defaultView.getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=e},_raiseEvent:function(a,b){if(this._anchorElement){var c=document.createEvent("CustomEvent");c.initCustomEvent(a,!1,!1,b),this._anchorElement.dispatchEvent(c)}},_captureLastKeyBlurOrPointerOverEvent:function(a,b){switch(b._lastKeyOrBlurEvent=b._currentKeyOrBlurEvent,a.type){case"keyup":b._currentKeyOrBlurEvent=a.keyCode===d.shift?null:"keyboard";break;case"focusout":b._currentKeyOrBlurEvent=null}},_registerEventToListener:function(a,b,c){var d=function(a){c._captureLastKeyBlurOrPointerOverEvent(a,c),c._handleEvent(a)};WinJS.Utilities._addEventListener(a,b,d,!1),this._eventListenerRemoveStack.push(function(){WinJS.Utilities._removeEventListener(a,b,d,!1)})},_events:function(){for(var a in w)this._registerEventToListener(this._anchorElement,a,this);for(var a in x)this._registerEventToListener(this._anchorElement,a,this);for(a in y)this._registerEventToListener(this._anchorElement,a,this)},_handleEvent:function(a){var b=a._normalizedType||a.type;if(!this._triggerByOpen){if(b in z){for(var c=a.relatedTarget;c&&c!==this._anchorElement&&c!==document.body;)try{c=c.parentNode}catch(d){if(d instanceof Error&&"Permission denied"===d.message)return;throw d}if(c===this._anchorElement)return}if(b in w)if(a.pointerType==v)this._onInvoke("touch","never",a),this._showTrigger="touch";else{var e="key"===b.substring(0,3)?"keyboard":"mouse";this._onInvoke(e,"auto",a),this._showTrigger=e}else if(b in x)this._contactPoint={x:a.clientX,y:a.clientY};else if(b in y){var f;if(a.pointerType==v){if("pointerdown"==b)return;f="touch"}else f="key"===b.substring(0,3)?"keyboard":"mouse";if("focusout"!=b&&f!=this._showTrigger)return;this._onDismiss()}}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var a=this,b=this._infotip?Math.min(3*F,o):F;this._hideDelayTimer=setTimeout(function(){a._onDismiss()},b)}},_onHideAnimationEnd:function(){document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),a=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(b){var c;if(this._useAnimation=!0,"nodelay"==b)c=0,this._useAnimation=!1;else{var d=(new Date).getTime();n>=d-a?(c="touch"==b?this._infotip?l:j:this._infotip?m:k,this._useAnimation=!1):c="touch"==b?this._infotip?g:f:this._infotip?E:D}return c},_getAnchorPositionFromElementWindowCoord:function(){var a=this._anchorElement.getBoundingClientRect();return{x:a.left,y:a.top,width:a.width,height:a.height}},_getAnchorPositionFromPointerWindowCoord:function(a){return{x:a.x,y:a.y,width:1,height:1}},_canPositionOnSide:function(a,b,c,d){var e=0,f=0;switch(a){case"top":e=d.width+this._offset,f=c.y;break;case"bottom":e=d.width+this._offset,f=b.height-c.y-c.height;break;case"left":e=c.x,f=d.height+this._offset;break;case"right":e=b.width-c.x-c.width,f=d.height+this._offset}return e>=d.width+this._offset&&f>=d.height+this._offset},_positionOnSide:function(a,b,c,d){var e=0,f=0;switch(a){case"top":case"bottom":e=c.x+c.width/2-d.width/2,e=Math.min(Math.max(e,0),b.width-d.width-u),f="top"==a?c.y-d.height-this._offset:c.y+c.height+this._offset;break;case"left":case"right":f=c.y+c.height/2-d.height/2,f=Math.min(Math.max(f,0),b.height-d.height-u),e="left"==a?c.x-d.width-this._offset:c.x+c.width+this._offset}this._domElement.style.left=e+"px",this._domElement.style.top=f+"px",this._phantomDiv.style.left=e+"px",this._phantomDiv.style.top=f+"px",this._phantomDiv.style.width=d.width+"px",this._phantomDiv.style.height=d.height+"px"},_position:function(a){var b={width:0,height:0},c={x:0,y:0,width:0,height:0},d={width:0,height:0};b.width=document.documentElement.clientWidth,b.height=document.documentElement.clientHeight,"tb-rl"===document.defaultView.getComputedStyle(document.body,null)["writing-mode"]&&(b.width=document.documentElement.clientHeight,b.height=document.documentElement.clientWidth),c=!this._contactPoint||"touch"!==a&&"mouse"!==a?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),d.width=this._domElement.offsetWidth,d.height=this._domElement.offsetHeight;var e={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};G&&(e.top[2]="right",e.top[3]="left",e.bottom[2]="right",e.bottom[3]="left");for(var f=e[this._placement],g=f.length,h=0;g>h;h++)if(h==g-1||this._canPositionOnSide(f[h],b,c,d)){this._positionOnSide(f[h],b,c,d);break}return f[h]},_showTooltip:function(a){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var b=this;this._removeTooltip=function(a){for(var c=b._anchorElement;c;){if(a.target==c){document.body.removeEventListener("DOMNodeRemoved",b._removeTooltip,!1),b._cleanUpDOM();break}c=c.parentNode}},document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM();{this._position(a)}this._useAnimation?c.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(a,b,c){if(this._shouldDismiss=!1,!this._isShown&&(!c||"keyup"!==c.type||"keyboard"!=this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||c.keyCode===d.tab))){this._hideDelay=b,this._contactPoint=null,c?(this._contactPoint={x:c.clientX,y:c.clientY},this._offset="touch"==a?r:"keyboard"===a?p:q):this._offset="touch"==a?s:t,clearTimeout(this._delayTimer),clearTimeout(this._hideDelayTimer);var e=this._decideOnDelay(a);if(e>0){var f=this;this._delayTimer=setTimeout(function(){f._showTooltip(a)},e)}else this._showTooltip(a)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?c.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return f}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return g}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return h}},_DEFAULT_MESSAGE_DURATION:{get:function(){return i}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return j}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return k}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return l}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return m}},_RESHOW_THRESHOLD:{get:function(){return n}},_HIDE_DELAY_MAX:{get:function(){return o}}})})})}(this,WinJS),function(){"use strict";WinJS.Namespace.define("WinJS.UI",{ViewBox:WinJS.Namespace._lazy(function(){function a(a){if(a&&!a._resizing){a._resizing=a._resizing||0,a._resizing++;try{a._updateLayout()}finally{a._resizing--}}}function b(b){b.target&&a(b.target.winControl)}function c(b){b.target&&a(b.target.parentElement.winControl)}var d=WinJS.Utilities.Scheduler,e={get invalidViewBoxChildren(){return WinJS.Resources._getWinJSString("ui/invalidViewBoxChildren").value}},f=WinJS.Class.define(function(a){this._disposed=!1,this._element=a||document.createElement("div");var b=this.element;b.winControl=this,WinJS.Utilities.addClass(b,"win-disposable"),WinJS.Utilities.addClass(b,"win-viewbox"),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===window.getComputedStyle(this.element).direction}},_initialize:function(){var a=this.element;if(a.firstElementChild!==this._sizer){if(WinJS.validation&&1!=a.childElementCount)throw new WinJS.ErrorFromName("WinJS.UI.ViewBox.InvalidChildren",e.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var f=a.firstElementChild;if(this._sizer=f,f&&(a.addEventListener("mselementresize",b),f.addEventListener("mselementresize",c)),0===a.clientWidth&&0===a.clientHeight){var g=this;d.schedule(function(){g._updateLayout()},d.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var a=this._sizer;if(a){var b=this.element,c=a.clientWidth,d=a.clientHeight,e=b.clientWidth,f=b.clientHeight,g=e/c,h=f/d,i=Math.min(g,h),j=Math.abs(e-c*i)/2,k=Math.abs(f-d*i)/2,l=this._rtl;this._sizer.style[WinJS.Utilities._browserStyleEquivalents.transform.scriptName]="translate("+(l?"-":"")+j+"px,"+k+"px) scale("+i+")",this._sizer.style[WinJS.Utilities._browserStyleEquivalents["transform-origin"].scriptName]=l?"top right":"top left"}},dispose:function(){this._disposed||(this._disposed=!0,WinJS.Utilities.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return WinJS.Class.mix(f,WinJS.UI.DOMEventMixin),f})})}(this),WinJS.Utilities._writeProfilerMark("WinJS.2.1 2.0.1.WinJS.2014.4.28 ui.js,StopTM");